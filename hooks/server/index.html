
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Official documentation for the Lilia Framework">
      
      
        <meta name="author" content="Lilia Framework Team">
      
      
        <link rel="canonical" href="https://liliaframework.github.io/hooks/server/">
      
      
        <link rel="prev" href="../client/">
      
      
        <link rel="next" href="../shared/">
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Server-Side Hooks - Lilia Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lavender">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#server-side-hooks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Lilia Documentation" class="md-header__button md-logo" aria-label="Lilia Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lilia Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Server-Side Hooks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lavender"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="lavender"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/LiliaFramework/Lilia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../compatibility/" class="md-tabs__link">
        
  
  
    
  
  Addon Compatibility

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../gettingstarted/" class="md-tabs__link">
        
  
  
    
  
  Getting Started with Lilia

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../definitions/attributes/" class="md-tabs__link">
          
  
  
    
  
  Definitions

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../client/" class="md-tabs__link">
          
  
  
    
  
  Hooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../libraries/lia.admin/" class="md-tabs__link">
          
  
  
    
  
  Libraries

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../meta/character/" class="md-tabs__link">
          
  
  
    
  
  Meta

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules/" class="md-tabs__link">
          
  
  
    
  
  Modules

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Lilia Documentation" class="md-nav__button md-logo" aria-label="Lilia Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Lilia Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LiliaFramework/Lilia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compatibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Addon Compatibility
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gettingstarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started with Lilia
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../definitions/attributes/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Hooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Hooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Client-Side Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Server-Side Hooks
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Server-Side Hooks
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#addwarning" class="md-nav__link">
    <span class="md-ellipsis">
      AddWarning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjustcreationdata" class="md-nav__link">
    <span class="md-ellipsis">
      AdjustCreationData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baginventoryready" class="md-nav__link">
    <span class="md-ellipsis">
      BagInventoryReady
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baginventoryremoved" class="md-nav__link">
    <span class="md-ellipsis">
      BagInventoryRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancharbetransfered" class="md-nav__link">
    <span class="md-ellipsis">
      CanCharBeTransfered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#candeletechar" class="md-nav__link">
    <span class="md-ellipsis">
      CanDeleteChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caninvitetoclass" class="md-nav__link">
    <span class="md-ellipsis">
      CanInviteToClass
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caninvitetofaction" class="md-nav__link">
    <span class="md-ellipsis">
      CanInviteToFaction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canitembetransfered" class="md-nav__link">
    <span class="md-ellipsis">
      CanItemBeTransfered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canperformvendoredit" class="md-nav__link">
    <span class="md-ellipsis">
      CanPerformVendorEdit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canpersistentity" class="md-nav__link">
    <span class="md-ellipsis">
      CanPersistEntity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canpickupmoney" class="md-nav__link">
    <span class="md-ellipsis">
      CanPickupMoney
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayeraccessdoor" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerAccessDoor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayeraccessvendor" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerAccessVendor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerchooseweapon" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerChooseWeapon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayercreatechar" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerCreateChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerdropitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerDropItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerearnsalary" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerEarnSalary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerequipitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerEquipItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerholdobject" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerHoldObject
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerinteractitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerInteractItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerjoinclass" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerJoinClass
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerknock" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerKnock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerlock" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerLock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayermodifyconfig" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerModifyConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayeropenscoreboard" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerOpenScoreboard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerrotateitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerRotateItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerseelogcategory" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerSeeLogCategory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerspawnstorage" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerSpawnStorage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerswitchchar" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerSwitchChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayertakeitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerTakeItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerthrowpunch" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerThrowPunch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayertradewithvendor" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerTradeWithVendor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerunequipitem" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerUnequipItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerunlock" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerUnlock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerusechar" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerUseChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerusecommand" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerUseCommand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerusedoor" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerUseDoor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canplayerviewinventory" class="md-nav__link">
    <span class="md-ellipsis">
      CanPlayerViewInventory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canrunitemaction" class="md-nav__link">
    <span class="md-ellipsis">
      CanRunItemAction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cansavedata" class="md-nav__link">
    <span class="md-ellipsis">
      CanSaveData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charcleanup" class="md-nav__link">
    <span class="md-ellipsis">
      CharCleanUp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chardeleted" class="md-nav__link">
    <span class="md-ellipsis">
      CharDeleted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charforcerecognized" class="md-nav__link">
    <span class="md-ellipsis">
      CharForceRecognized
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charhasflags" class="md-nav__link">
    <span class="md-ellipsis">
      CharHasFlags
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charloaded" class="md-nav__link">
    <span class="md-ellipsis">
      CharLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charpostsave" class="md-nav__link">
    <span class="md-ellipsis">
      CharPostSave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charpresave" class="md-nav__link">
    <span class="md-ellipsis">
      CharPreSave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charrestored" class="md-nav__link">
    <span class="md-ellipsis">
      CharRestored
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chatparsed" class="md-nav__link">
    <span class="md-ellipsis">
      ChatParsed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checkfactionlimitreached" class="md-nav__link">
    <span class="md-ellipsis">
      CheckFactionLimitReached
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commandran" class="md-nav__link">
    <span class="md-ellipsis">
      CommandRan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configchanged" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#createcharacter" class="md-nav__link">
    <span class="md-ellipsis">
      CreateCharacter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#createdefaultinventory" class="md-nav__link">
    <span class="md-ellipsis">
      CreateDefaultInventory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#createsalarytimers" class="md-nav__link">
    <span class="md-ellipsis">
      CreateSalaryTimers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databaseconnected" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseConnected
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deletecharacter" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteCharacter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discordrelaysend" class="md-nav__link">
    <span class="md-ellipsis">
      DiscordRelaySend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discordrelayunavailable" class="md-nav__link">
    <span class="md-ellipsis">
      DiscordRelayUnavailable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discordrelayed" class="md-nav__link">
    <span class="md-ellipsis">
      DiscordRelayed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doorenabledtoggled" class="md-nav__link">
    <span class="md-ellipsis">
      DoorEnabledToggled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doorhiddentoggled" class="md-nav__link">
    <span class="md-ellipsis">
      DoorHiddenToggled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doorlocktoggled" class="md-nav__link">
    <span class="md-ellipsis">
      DoorLockToggled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doorownabletoggled" class="md-nav__link">
    <span class="md-ellipsis">
      DoorOwnableToggled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doorpriceset" class="md-nav__link">
    <span class="md-ellipsis">
      DoorPriceSet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doortitleset" class="md-nav__link">
    <span class="md-ellipsis">
      DoorTitleSet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetchspawns" class="md-nav__link">
    <span class="md-ellipsis">
      FetchSpawns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forcerecognizerange" class="md-nav__link">
    <span class="md-ellipsis">
      ForceRecognizeRange
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getallcaseclaims" class="md-nav__link">
    <span class="md-ellipsis">
      GetAllCaseClaims
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getattributemax" class="md-nav__link">
    <span class="md-ellipsis">
      GetAttributeMax
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getattributestartingmax" class="md-nav__link">
    <span class="md-ellipsis">
      GetAttributeStartingMax
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getcharmaxstamina" class="md-nav__link">
    <span class="md-ellipsis">
      GetCharMaxStamina
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getdamagescale" class="md-nav__link">
    <span class="md-ellipsis">
      GetDamageScale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getdefaultchardesc" class="md-nav__link">
    <span class="md-ellipsis">
      GetDefaultCharDesc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getdefaultcharname" class="md-nav__link">
    <span class="md-ellipsis">
      GetDefaultCharName
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getdefaultinventorysize" class="md-nav__link">
    <span class="md-ellipsis">
      GetDefaultInventorySize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getdefaultinventorytype" class="md-nav__link">
    <span class="md-ellipsis">
      GetDefaultInventoryType
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getentitysavedata" class="md-nav__link">
    <span class="md-ellipsis">
      GetEntitySaveData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gethandsattackspeed" class="md-nav__link">
    <span class="md-ellipsis">
      GetHandsAttackSpeed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getitemdropmodel" class="md-nav__link">
    <span class="md-ellipsis">
      GetItemDropModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getitemstackkey" class="md-nav__link">
    <span class="md-ellipsis">
      GetItemStackKey
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getitemstacks" class="md-nav__link">
    <span class="md-ellipsis">
      GetItemStacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getmaxplayerchar" class="md-nav__link">
    <span class="md-ellipsis">
      GetMaxPlayerChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getmaxstartingattributepoints" class="md-nav__link">
    <span class="md-ellipsis">
      GetMaxStartingAttributePoints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getmoneymodel" class="md-nav__link">
    <span class="md-ellipsis">
      GetMoneyModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getoocdelay" class="md-nav__link">
    <span class="md-ellipsis">
      GetOOCDelay
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getplaytime" class="md-nav__link">
    <span class="md-ellipsis">
      GetPlayTime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getplayerdeathsound" class="md-nav__link">
    <span class="md-ellipsis">
      GetPlayerDeathSound
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getplayerpainsound" class="md-nav__link">
    <span class="md-ellipsis">
      GetPlayerPainSound
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getplayerpunchdamage" class="md-nav__link">
    <span class="md-ellipsis">
      GetPlayerPunchDamage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getplayerpunchragdolltime" class="md-nav__link">
    <span class="md-ellipsis">
      GetPlayerPunchRagdollTime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getpriceoverride" class="md-nav__link">
    <span class="md-ellipsis">
      GetPriceOverride
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getragdolltime" class="md-nav__link">
    <span class="md-ellipsis">
      GetRagdollTime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getsalaryamount" class="md-nav__link">
    <span class="md-ellipsis">
      GetSalaryAmount
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getticketsbyrequester" class="md-nav__link">
    <span class="md-ellipsis">
      GetTicketsByRequester
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getvendorsalescale" class="md-nav__link">
    <span class="md-ellipsis">
      GetVendorSaleScale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getwarnings" class="md-nav__link">
    <span class="md-ellipsis">
      GetWarnings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getwarningsbyissuer" class="md-nav__link">
    <span class="md-ellipsis">
      GetWarningsByIssuer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handleitemtransferrequest" class="md-nav__link">
    <span class="md-ellipsis">
      HandleItemTransferRequest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initializestorage" class="md-nav__link">
    <span class="md-ellipsis">
      InitializeStorage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventorydeleted" class="md-nav__link">
    <span class="md-ellipsis">
      InventoryDeleted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventoryitemadded" class="md-nav__link">
    <span class="md-ellipsis">
      InventoryItemAdded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventoryitemremoved" class="md-nav__link">
    <span class="md-ellipsis">
      InventoryItemRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issuitablefortrunk" class="md-nav__link">
    <span class="md-ellipsis">
      IsSuitableForTrunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#itemcombine" class="md-nav__link">
    <span class="md-ellipsis">
      ItemCombine
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#itemdeleted" class="md-nav__link">
    <span class="md-ellipsis">
      ItemDeleted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#itemdraggedoutofinventory" class="md-nav__link">
    <span class="md-ellipsis">
      ItemDraggedOutOfInventory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#itemfunctioncalled" class="md-nav__link">
    <span class="md-ellipsis">
      ItemFunctionCalled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#itemtransfered" class="md-nav__link">
    <span class="md-ellipsis">
      ItemTransfered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keylock" class="md-nav__link">
    <span class="md-ellipsis">
      KeyLock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keyunlock" class="md-nav__link">
    <span class="md-ellipsis">
      KeyUnlock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liliatablesloaded" class="md-nav__link">
    <span class="md-ellipsis">
      LiliaTablesLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loaddata" class="md-nav__link">
    <span class="md-ellipsis">
      LoadData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifycharactermodel" class="md-nav__link">
    <span class="md-ellipsis">
      ModifyCharacterModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onadminsystemloaded" class="md-nav__link">
    <span class="md-ellipsis">
      OnAdminSystemLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharattribboosted" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharAttribBoosted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharattribupdated" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharAttribUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharcreated" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharCreated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onchardelete" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharDelete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onchardisconnect" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharDisconnect
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharfallover" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharFallover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharflagsgiven" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharFlagsGiven
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharflagstaken" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharFlagsTaken
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onchargetup" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharGetup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharkick" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharKick
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharnetvarchanged" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharNetVarChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharpermakilled" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharPermakilled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharrecognized" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharRecognized
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onchartradevendor" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharTradeVendor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncharvarchanged" class="md-nav__link">
    <span class="md-ellipsis">
      OnCharVarChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncheatercaught" class="md-nav__link">
    <span class="md-ellipsis">
      OnCheaterCaught
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncheaterstatuschanged" class="md-nav__link">
    <span class="md-ellipsis">
      OnCheaterStatusChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oncreateplayerragdoll" class="md-nav__link">
    <span class="md-ellipsis">
      OnCreatePlayerRagdoll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ondataset" class="md-nav__link">
    <span class="md-ellipsis">
      OnDataSet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ondatabaseloaded" class="md-nav__link">
    <span class="md-ellipsis">
      OnDatabaseLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onentityloaded" class="md-nav__link">
    <span class="md-ellipsis">
      OnEntityLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onentitypersistupdated" class="md-nav__link">
    <span class="md-ellipsis">
      OnEntityPersistUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onentitypersisted" class="md-nav__link">
    <span class="md-ellipsis">
      OnEntityPersisted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onitemadded" class="md-nav__link">
    <span class="md-ellipsis">
      OnItemAdded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onitemcreated" class="md-nav__link">
    <span class="md-ellipsis">
      OnItemCreated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onitemspawned" class="md-nav__link">
    <span class="md-ellipsis">
      OnItemSpawned
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onloadtables" class="md-nav__link">
    <span class="md-ellipsis">
      OnLoadTables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onoocmessagesent" class="md-nav__link">
    <span class="md-ellipsis">
      OnOOCMessageSent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onpac3parttransfered" class="md-nav__link">
    <span class="md-ellipsis">
      OnPAC3PartTransfered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onpickupmoney" class="md-nav__link">
    <span class="md-ellipsis">
      OnPickupMoney
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerdropweapon" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerDropWeapon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerentersequence" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerEnterSequence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerinteractitem" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerInteractItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerjoinclass" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerJoinClass
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerleavesequence" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerLeaveSequence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerloststackitem" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerLostStackItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerobserve" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerObserve
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerpurchasedoor" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerPurchaseDoor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onplayerswitchclass" class="md-nav__link">
    <span class="md-ellipsis">
      OnPlayerSwitchClass
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onrequestitemtransfer" class="md-nav__link">
    <span class="md-ellipsis">
      OnRequestItemTransfer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onsalaryadjust" class="md-nav__link">
    <span class="md-ellipsis">
      OnSalaryAdjust
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onsalarygiven" class="md-nav__link">
    <span class="md-ellipsis">
      OnSalaryGiven
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onsaveditemloaded" class="md-nav__link">
    <span class="md-ellipsis">
      OnSavedItemLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onserverlog" class="md-nav__link">
    <span class="md-ellipsis">
      OnServerLog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onticketclaimed" class="md-nav__link">
    <span class="md-ellipsis">
      OnTicketClaimed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onticketclosed" class="md-nav__link">
    <span class="md-ellipsis">
      OnTicketClosed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onticketcreated" class="md-nav__link">
    <span class="md-ellipsis">
      OnTicketCreated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ontransferred" class="md-nav__link">
    <span class="md-ellipsis">
      OnTransferred
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onusergroupcreated" class="md-nav__link">
    <span class="md-ellipsis">
      OnUsergroupCreated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onusergrouppermissionschanged" class="md-nav__link">
    <span class="md-ellipsis">
      OnUsergroupPermissionsChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onusergroupremoved" class="md-nav__link">
    <span class="md-ellipsis">
      OnUsergroupRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onusergrouprenamed" class="md-nav__link">
    <span class="md-ellipsis">
      OnUsergroupRenamed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onvendoredited" class="md-nav__link">
    <span class="md-ellipsis">
      OnVendorEdited
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onlinestaffdatareceived" class="md-nav__link">
    <span class="md-ellipsis">
      OnlineStaffDataReceived
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optionreceived" class="md-nav__link">
    <span class="md-ellipsis">
      OptionReceived
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overridespawntime" class="md-nav__link">
    <span class="md-ellipsis">
      OverrideSpawnTime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playeraccessvendor" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerAccessVendor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playercheatdetected" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerCheatDetected
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerdisconnect" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerDisconnect
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playergagged" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerGagged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerliliadataloaded" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerLiliaDataLoaded
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerloadedchar" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerLoadedChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playermessagesend" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerMessageSend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playermodelchanged" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerModelChanged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playermuted" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerMuted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playershouldact" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerShouldAct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playershouldpermakill" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerShouldPermaKill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerspawnpointselected" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerSpawnPointSelected
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerthrowpunch" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerThrowPunch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerungagged" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerUngagged
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerunmuted" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerUnmuted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#playerusedoor" class="md-nav__link">
    <span class="md-ellipsis">
      PlayerUseDoor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postdoordataload" class="md-nav__link">
    <span class="md-ellipsis">
      PostDoorDataLoad
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postloaddata" class="md-nav__link">
    <span class="md-ellipsis">
      PostLoadData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postplayerinitialspawn" class="md-nav__link">
    <span class="md-ellipsis">
      PostPlayerInitialSpawn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postplayerloadedchar" class="md-nav__link">
    <span class="md-ellipsis">
      PostPlayerLoadedChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postplayerloadout" class="md-nav__link">
    <span class="md-ellipsis">
      PostPlayerLoadout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postplayersay" class="md-nav__link">
    <span class="md-ellipsis">
      PostPlayerSay
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postscaledamage" class="md-nav__link">
    <span class="md-ellipsis">
      PostScaleDamage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prechardelete" class="md-nav__link">
    <span class="md-ellipsis">
      PreCharDelete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predoordatasave" class="md-nav__link">
    <span class="md-ellipsis">
      PreDoorDataSave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preplayerinteractitem" class="md-nav__link">
    <span class="md-ellipsis">
      PrePlayerInteractItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preplayerloadedchar" class="md-nav__link">
    <span class="md-ellipsis">
      PrePlayerLoadedChar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#presalarygive" class="md-nav__link">
    <span class="md-ellipsis">
      PreSalaryGive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prescaledamage" class="md-nav__link">
    <span class="md-ellipsis">
      PreScaleDamage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registerpreparedstatements" class="md-nav__link">
    <span class="md-ellipsis">
      RegisterPreparedStatements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#removewarning" class="md-nav__link">
    <span class="md-ellipsis">
      RemoveWarning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runadminsystemcommand" class="md-nav__link">
    <span class="md-ellipsis">
      RunAdminSystemCommand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#savedata" class="md-nav__link">
    <span class="md-ellipsis">
      SaveData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sendpopup" class="md-nav__link">
    <span class="md-ellipsis">
      SendPopup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setupbaginventoryaccessrules" class="md-nav__link">
    <span class="md-ellipsis">
      SetupBagInventoryAccessRules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setupbotplayer" class="md-nav__link">
    <span class="md-ellipsis">
      SetupBotPlayer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setupdatabase" class="md-nav__link">
    <span class="md-ellipsis">
      SetupDatabase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setupplayermodel" class="md-nav__link">
    <span class="md-ellipsis">
      SetupPlayerModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shoulddatabesaved" class="md-nav__link">
    <span class="md-ellipsis">
      ShouldDataBeSaved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shoulddeletesaveditems" class="md-nav__link">
    <span class="md-ellipsis">
      ShouldDeleteSavedItems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storagecantransferitem" class="md-nav__link">
    <span class="md-ellipsis">
      StorageCanTransferItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storageentityremoved" class="md-nav__link">
    <span class="md-ellipsis">
      StorageEntityRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storageinventoryset" class="md-nav__link">
    <span class="md-ellipsis">
      StorageInventorySet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storageitemremoved" class="md-nav__link">
    <span class="md-ellipsis">
      StorageItemRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storageopen" class="md-nav__link">
    <span class="md-ellipsis">
      StorageOpen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storagerestored" class="md-nav__link">
    <span class="md-ellipsis">
      StorageRestored
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storespawns" class="md-nav__link">
    <span class="md-ellipsis">
      StoreSpawns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synccharlist" class="md-nav__link">
    <span class="md-ellipsis">
      SyncCharList
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ticketsystemclaim" class="md-nav__link">
    <span class="md-ellipsis">
      TicketSystemClaim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ticketsystemclose" class="md-nav__link">
    <span class="md-ellipsis">
      TicketSystemClose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ticketsystemcreated" class="md-nav__link">
    <span class="md-ellipsis">
      TicketSystemCreated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#togglelock" class="md-nav__link">
    <span class="md-ellipsis">
      ToggleLock
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transferitem" class="md-nav__link">
    <span class="md-ellipsis">
      TransferItem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updateentitypersistence" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateEntityPersistence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendorclassupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorClassUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoredited" class="md-nav__link">
    <span class="md-ellipsis">
      VendorEdited
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendorfactionupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorFactionUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoritemmaxstockupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorItemMaxStockUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoritemmodeupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorItemModeUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoritempriceupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorItemPriceUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoritemstockupdated" class="md-nav__link">
    <span class="md-ellipsis">
      VendorItemStockUpdated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendoropened" class="md-nav__link">
    <span class="md-ellipsis">
      VendorOpened
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vendortradeevent" class="md-nav__link">
    <span class="md-ellipsis">
      VendorTradeEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warningissued" class="md-nav__link">
    <span class="md-ellipsis">
      WarningIssued
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warningremoved" class="md-nav__link">
    <span class="md-ellipsis">
      WarningRemoved
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setdata" class="md-nav__link">
    <span class="md-ellipsis">
      setData
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shared/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shared Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../libraries/lia.admin/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Libraries
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../meta/character/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Meta
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../modules/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="server-side-hooks">Server-Side Hooks</h1>
<p>Server-side hook system for the Lilia framework.</p>
<hr />
<p>Overview</p>
<p>Server-side hooks in the Lilia framework handle game logic, data persistence, player management, and other server-specific functionality. All server hooks follow the standard Garry's Mod hook system and can be overridden or extended by addons and modules.</p>
<hr />
<h3 id="addwarning">AddWarning</h3>
<p><strong>Purpose</strong></p>
<p>Adds a warning to a character's record in the administration system</p>
<p><strong>When Called</strong></p>
<p>When an admin issues a warning to a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>charID</code> (<em>number</em>): The character ID of the warned player</li>
<li><code>warned</code> (<em>string</em>): The name of the warned player</li>
<li><code>warnedSteamID</code> (<em>string</em>): The Steam ID of the warned player</li>
<li><code>timestamp</code> (<em>number</em>): Unix timestamp when the warning was issued</li>
<li><code>message</code> (<em>string</em>): The warning message/reason</li>
<li><code>warner</code> (<em>string</em>): The name of the admin who issued the warning</li>
<li><code>warnerSteamID</code> (<em>string</em>): The Steam ID of the admin who issued the warning</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">-- Simple: Add a basic warning</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;AddWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="nv">playerName</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;Rule violation&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">adminName</span><span class="p">,</span><span class="w"> </span><span class="nv">adminSteamID</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">-- Medium: Add warning with custom message</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Excessive RDM - 3 kills in 5 minutes&quot;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;AddWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">():</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Nick</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nv">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Nick</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">-- High: Add warning with validation and logging</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;AddWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="nv">warned</span><span class="p">,</span><span class="w"> </span><span class="nv">warnedSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">warner</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1">-- Log the warning to a custom system</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Warning issued: %s warned %s for: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">warner</span><span class="p">,</span><span class="w"> </span><span class="nv">warned</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">))</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1">-- Send notification to other admins</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="nv">admin</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;[WARNING] %s warned %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">warner</span><span class="p">,</span><span class="w"> </span><span class="nv">warned</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">))</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="kr">end</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="c1">-- Check for warning limits</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">warnings</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="c1">-- Auto-kick after 3 warnings</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetBySteamID</span><span class="p">(</span><span class="nv">warnedSteamID</span><span class="p">)</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="nv">target</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Too many warnings&quot;</span><span class="p">)</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="kr">end</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="adjustcreationdata">AdjustCreationData</h3>
<p><strong>Purpose</strong></p>
<p>Allows modification of character creation data before the character is created</p>
<p><strong>When Called</strong></p>
<p>During character creation process, before the character is saved to database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>data</code> (<em>table</em>): The current character data being created</li>
<li><code>newData</code> (<em>table</em>): Additional data to be merged with the character data</li>
<li><code>originalData</code> (<em>table</em>): The original character data before any modifications</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">-- Simple: Add default money to new characters</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;AdjustCreationData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">,</span><span class="w"> </span><span class="nv">newData</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="c1">-- Give extra starting money</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">-- Medium: Modify character based on faction</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;AdjustCreationData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionBonuses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">,</span><span class="w"> </span><span class="nv">newData</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="c1">-- Police get extra money</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">desc</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">[Police Officer]&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="c1">-- Citizens get small bonus</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="kr">end</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">-- High: Complex character creation system with validation</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;AdjustCreationData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">,</span><span class="w"> </span><span class="nv">newData</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1">-- Validate character name</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; Jr.&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kr">end</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1">-- Add faction-specific bonuses</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">}},</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">}},</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}}</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="p">}</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">data</span><span class="p">.</span><span class="py">faction</span><span class="p">]</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">money</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">bonus</span><span class="p">.</span><span class="py">money</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">startingItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">startingItems</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonus</span><span class="p">.</span><span class="py">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">startingItems</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="kr">end</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="c1">-- Add creation timestamp</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="nv">data</span><span class="p">.</span><span class="py">creationTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="nv">data</span><span class="p">.</span><span class="py">creationIP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IPAddress</span><span class="p">()</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="baginventoryready">BagInventoryReady</h3>
<p><strong>Purpose</strong></p>
<p>Called when a bag item's inventory is ready and accessible</p>
<p><strong>When Called</strong></p>
<p>When a bag item's inventory is created or restored from database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Item</em>): The bag item instance</li>
<li><code>inventory</code> (<em>Inventory</em>): The inventory instance that was created/loaded</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">-- Simple: Log when bag inventory is ready</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryReady&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bag inventory ready for item: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">-- Medium: Add special items to bag inventory</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryReady&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SpecialBags&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;magic_bag&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="c1">-- Add a magic item to the bag</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">magicItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="s2">&quot;magic_crystal&quot;</span><span class="p">)</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">magicItem</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">magicItem</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">-- High: Complex bag inventory system with validation</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryReady&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedBags&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="c1">-- Set up faction-specific bag contents</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bagContents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;police_badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stethoscope&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="p">{</span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">bagContents</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">contents</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">contents</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">content</span><span class="p">.</span><span class="py">item</span><span class="p">)</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;quantity&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">content</span><span class="p">.</span><span class="py">quantity</span><span class="p">)</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">                </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span><span class="c1">-- Set up access rules based on character data</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">        </span><span class="c1">-- High level characters get extra space</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="c1">-- Log the bag creation</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Bag inventory created for %s (Level %d, Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">charLevel</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">))</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="baginventoryremoved">BagInventoryRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when a bag item's inventory is removed or destroyed</p>
<p><strong>When Called</strong></p>
<p>When a bag item is deleted or its inventory is cleaned up</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Item</em>): The bag item instance</li>
<li><code>inv</code> (<em>Inventory</em>): The inventory instance that was removed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">-- Simple: Log when bag inventory is removed</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inv</span><span class="p">)</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bag inventory removed for item: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">-- Medium: Clean up custom data when bag is removed</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CleanupBags&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inv</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;bagCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bagCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">-- High: Complex cleanup with item recovery</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;BagInventoryRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inv</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="c1">-- Check if bag had valuable items</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">valuableItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inv</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gold_bar&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;diamond&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">            </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">valuableItems</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="c1">-- Transfer valuable items to character inventory</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">valuableItems</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">valuableItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">            </span><span class="nv">charInv</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Valuable items recovered from destroyed bag!&quot;</span><span class="p">)</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="cancharbetransfered">CanCharBeTransfered</h3>
<p><strong>Purpose</strong></p>
<p>Determines if a character can be transferred (alias for CanBeTransfered)</p>
<p><strong>When Called</strong></p>
<p>When attempting to transfer a character to another faction</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>targetChar</code> (<em>Character</em>): The character being transferred</li>
<li><code>faction</code> (<em>string</em>): The target faction name</li>
<li><code>client</code> (<em>Player</em>): The player requesting the transfer</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if transfer is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">-- Simple: Use same logic as CanBeTransfered</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanCharBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">-- Medium: Add additional character-specific checks</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanCharBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharChecks&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1">-- Check if character is banned</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">isBanned</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1">-- Check character age</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">charAge</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c1">-- Must be 21+ to be police</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="kr">return</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">-- High: Advanced character transfer system</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanCharBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharTransfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">()</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1">-- Check character reputation</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">reputation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">charData</span><span class="p">.</span><span class="py">reputation</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">reputation</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need a good reputation to join the police&quot;</span><span class="p">)</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1">-- Check for outstanding warrants</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charData</span><span class="p">.</span><span class="py">warrants</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="o">#</span><span class="nv">charData</span><span class="p">.</span><span class="py">warrants</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have outstanding warrants and cannot transfer&quot;</span><span class="p">)</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="c1">-- Check faction capacity</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getCharacters</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="nv">factionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="kd">local</span><span class="w"> </span><span class="nv">maxFactionMembers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="p">[</span><span class="s2">&quot;mayor&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="p">}</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="kd">local</span><span class="w"> </span><span class="nv">maxMembers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">maxFactionMembers</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="kr">if</span><span class="w"> </span><span class="nv">maxMembers</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">factionCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">maxMembers</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;That faction is full&quot;</span><span class="p">)</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="kr">return</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="candeletechar">CanDeleteChar</h3>
<p><strong>Purpose</strong></p>
<p>Determines if a character can be deleted</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to delete a character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player requesting the deletion</li>
<li><code>character</code> (<em>Character</em>): The character to be deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if deletion is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">-- Simple: Allow all character deletions</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanDeleteChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">-- Medium: Prevent deletion of high-level characters</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanDeleteChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;LevelRestrictions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot delete characters above level 10&quot;</span><span class="p">)</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">-- High: Complex deletion validation system</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanDeleteChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charMoney</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1">-- Check if character has valuable items</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">hasValuables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">charInv</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gold_bar&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;diamond&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">        </span><span class="nv">hasValuables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">        </span><span class="kr">break</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hasValuables</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must remove all valuable items before deleting this character&quot;</span><span class="p">)</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="c1">-- Check if character is in a faction</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must leave your faction before deleting this character&quot;</span><span class="p">)</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="c1">-- Check cooldown</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastDeletion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastCharDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastDeletion</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">86400</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 24 hour cooldown</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must wait 24 hours before deleting another character&quot;</span><span class="p">)</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="caninvitetoclass">CanInviteToClass</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can invite another to a class</p>
<p><strong>When Called</strong></p>
<p>When attempting to invite a player to a class</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting the invite</li>
<li><code>target</code> (<em>Player</em>): The player being invited</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">-- Simple: Allow admins only</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">-- Medium: Check faction and rank</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ClassInviteCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">-- High: Complex class invitation system</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedClassInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="c1">-- Check if client has permission</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need rank 3 or higher to invite players&quot;</span><span class="p">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="c1">-- Check if target is in same faction</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Target must be in your faction&quot;</span><span class="p">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="c1">-- Check cooldown</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastInvite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastClassInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastInvite</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before inviting again&quot;</span><span class="p">)</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastClassInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="caninvitetofaction">CanInviteToFaction</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can invite another to a faction</p>
<p><strong>When Called</strong></p>
<p>When attempting to invite a player to a faction</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting the invite</li>
<li><code>target</code> (<em>Player</em>): The player being invited</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">-- Simple: Allow admins only</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToFaction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">-- Medium: Check faction leader status</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToFaction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionInviteCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;factionLeader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">-- High: Complex faction invitation system</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanInviteToFaction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFactionInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="c1">-- Check if client is faction leader</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;factionLeader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Only faction leaders can invite players&quot;</span><span class="p">)</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span><span class="c1">-- Check faction member limit</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">memberCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">            </span><span class="nv">memberCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">memberCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxMembers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">memberCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">maxMembers</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Faction is at maximum capacity&quot;</span><span class="p">)</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">    </span><span class="c1">-- Check cooldown</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastInvite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastFactionInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastInvite</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before inviting again&quot;</span><span class="p">)</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastFactionInvite&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canitembetransfered">CanItemBeTransfered</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if an item can be transferred between inventories</p>
<p><strong>When Called</strong></p>
<p>When attempting to move an item from one inventory to another</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>item</code> (<em>Item</em>): The item being transferred</li>
<li><code>fromInventory</code> (<em>Inventory</em>): The source inventory</li>
<li><code>toInventory</code> (<em>Inventory</em>): The destination inventory</li>
<li><code>client</code> (<em>Player</em>): The player performing the transfer</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if transfer is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">-- Simple: Allow all transfers</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanItemBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">fromInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">-- Medium: Check inventory types</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanItemBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InventoryTypeCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">fromInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1">-- Prevent transferring to vendor inventories</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">.</span><span class="py">isVendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1">-- Check if item is transferable</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">-- High: Complex transfer validation system</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanItemBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTransferValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">fromInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="c1">-- Check if item is transferable</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be transferred&quot;</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="c1">-- Check inventory types</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">.</span><span class="py">isVendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot transfer items to vendor inventories&quot;</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">    </span><span class="c1">-- Check weight limits</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough space in destination inventory&quot;</span><span class="p">)</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot transfer faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to transfer this item&quot;</span><span class="p">)</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">    </span><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot transfer equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="w">    </span><span class="c1">-- Check for special item restrictions</span>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a><span class="w">        </span><span class="c1">-- Special handling for weapons</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need weapon flags to transfer weapons&quot;</span><span class="p">)</span>
</span><span id="__span-26-49"><a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-26-50"><a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-26-51"><a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-26-52"><a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-26-53"><a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canperformvendoredit">CanPerformVendorEdit</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can edit a vendor</p>
<p><strong>When Called</strong></p>
<p>When attempting to modify vendor settings</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The vendor entity</li>
<li><code>vendor</code> (<em>table</em>): The vendor data table</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">-- Simple: Allow admins only</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPerformVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">activator</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">-- Medium: Check vendor ownership</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPerformVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorEditCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">activator</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">owner</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">-- High: Complex vendor editing system</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPerformVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">activator</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">        </span><span class="c1">-- Admins can always edit</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">            </span><span class="c1">-- Check vendor ownership</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">owner</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">            </span><span class="c1">-- Check edit cooldown</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastEdit</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before editing again&quot;</span><span class="p">)</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">            </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canpersistentity">CanPersistEntity</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if an entity can be persisted</p>
<p><strong>When Called</strong></p>
<p>When determining if an entity should be saved across map changes</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>entity</code> (<em>Entity</em>): The entity to check</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to persist, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">-- Simple: Persist all props</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPersistEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prop_physics&quot;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">-- Medium: Persist specific entities</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPersistEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;EntityPersistCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">persistClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">[</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="p">[</span><span class="s2">&quot;prop_dynamic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="p">[</span><span class="s2">&quot;lia_item&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="p">}</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">persistClasses</span><span class="p">[</span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">-- High: Complex entity persistence system</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPersistEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEntityPersist&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="c1">-- Check entity class</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">persistClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;prop_dynamic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;lia_item&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;lia_vendor&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">persistClasses</span><span class="p">[</span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="c1">-- Check if entity is marked as temporary</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;temporary&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">    </span><span class="c1">-- Check entity age</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">spawnTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;spawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">spawnTime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">    </span><span class="c1">-- Check entity owner</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">ownerPly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetBySteamID</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ownerPly</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canpickupmoney">CanPickupMoney</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if money can be picked up</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to pick up money</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>activator</code> (<em>Player</em>): The player trying to pick up money</li>
<li><code>self</code> (<em>Entity</em>): The money entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">-- Simple: Allow all money pickup</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">-- Medium: Check distance and amount</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CheckMoneyPickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">-- High: Complex money pickup system</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedMoneyPickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">activator</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">        </span><span class="c1">-- Check distance</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">            </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are too far away to pick up the money&quot;</span><span class="p">)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">        </span><span class="c1">-- Check amount</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">        </span><span class="c1">-- Check if money is owned</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">ownerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">owner</span><span class="p">]</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ownerChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ownerChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;alive&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">                </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This money belongs to someone else&quot;</span><span class="p">)</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="w">        </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ghost&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="w">        </span><span class="c1">-- Check if player is tied</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;tied&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="w">            </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot pick up money while tied&quot;</span><span class="p">)</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayeraccessdoor">CanPlayerAccessDoor</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can access a door</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to interact with a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting access</li>
<li><code>self</code> (<em>Entity</em>): The door entity</li>
<li><code>access</code> (<em>number</em>): The access level being checked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">-- Simple: Allow all players</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">access</span><span class="p">)</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">-- Medium: Check door ownership</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorAccessCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">access</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">-- High: Complex door access system</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorAccess&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">access</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="c1">-- Admins can access all doors</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">        </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">            </span><span class="c1">-- Check faction access</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;allowedFactions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">            </span><span class="c1">-- Check if player has key</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorID&quot;</span><span class="p">)</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorID</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">hasItem</span><span class="p">(</span><span class="s2">&quot;door_key_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">doorID</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">            </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayeraccessvendor">CanPlayerAccessVendor</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can access a vendor</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to interact with a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>activator</code> (<em>Player</em>): The player attempting access</li>
<li><code>self</code> (<em>Entity</em>): The vendor entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">-- Simple: Allow all players</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">-- Medium: Check faction restrictions</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorAccessCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;allowedFactions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">-- High: Complex vendor access system</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorAccess&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;allowedFactions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">        </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your faction cannot access this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">        </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to access this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">    </span><span class="c1">-- Check reputation</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;requiredReputation&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charRep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;reputation&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charRep</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">        </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; reputation to access this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerchooseweapon">CanPlayerChooseWeapon</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can choose a weapon</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to select a weapon</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>weapon</code> (<em>Weapon</em>): The weapon being chosen</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">-- Simple: Allow all weapons</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerChooseWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">weapon</span><span class="p">)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">-- Medium: Restrict specific weapons</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerChooseWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RestrictWeapons&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">weapon</span><span class="p">)</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedWeapons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_crowbar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">}</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="kr">return</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">restrictedWeapons</span><span class="p">,</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">())</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">-- High: Complex weapon selection system</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerChooseWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWeaponSelection&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">weapon</span><span class="p">)</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetOwner</span><span class="p">()</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">        </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">weaponClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">policeWeapons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">}</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">policeWeapons</span><span class="p">,</span><span class="w"> </span><span class="nv">weaponClass</span><span class="p">)</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">medicWeapons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">}</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">medicWeapons</span><span class="p">,</span><span class="w"> </span><span class="nv">weaponClass</span><span class="p">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">        </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">        </span><span class="c1">-- Check if weapon is broken</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayercreatechar">CanPlayerCreateChar</h3>
<p><strong>Purpose</strong></p>
<p>Determines if a player can create a new character</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to create a new character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>data</code> (<em>table</em>): The character creation data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if creation is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">-- Simple: Allow all character creation</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerCreateChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1">-- Medium: Check character limit</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerCreateChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharLimit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">client</span><span class="p">.</span><span class="py">liaCharList</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">maxChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetMaxPlayerChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">maxChars</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have reached the maximum number of characters&quot;</span><span class="p">)</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">-- High: Complex character creation validation</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerCreateChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="c1">-- Check if player is banned</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsBanned</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are banned and cannot create characters&quot;</span><span class="p">)</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="c1">-- Check character name validity</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">name</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character name must be at least 3 characters long&quot;</span><span class="p">)</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">name</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character name must be less than 32 characters&quot;</span><span class="p">)</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="c1">-- Check for inappropriate names</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bannedWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;moderator&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;staff&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">}</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bannedWords</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">name</span><span class="p">),</span><span class="w"> </span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">word</span><span class="p">))</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;That name is not allowed&quot;</span><span class="p">)</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">faction</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionRequirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="p">[</span><span class="s2">&quot;mayor&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a><span class="p">}</span>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionRequirements</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a><span class="kr">if</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">playerLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to create a &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; character&quot;</span><span class="p">)</span>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-38"><a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-39"><a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a><span class="c1">-- Check character count</span>
</span><span id="__span-47-40"><a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">client</span><span class="p">.</span><span class="py">liaCharList</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-47-41"><a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a><span class="kd">local</span><span class="w"> </span><span class="nv">maxChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetMaxPlayerChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-47-42"><a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">maxChars</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-47-43"><a id="__codelineno-47-43" name="__codelineno-47-43" href="#__codelineno-47-43"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have reached the maximum number of characters&quot;</span><span class="p">)</span>
</span><span id="__span-47-44"><a id="__codelineno-47-44" name="__codelineno-47-44" href="#__codelineno-47-44"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-47-45"><a id="__codelineno-47-45" name="__codelineno-47-45" href="#__codelineno-47-45"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-47-46"><a id="__codelineno-47-46" name="__codelineno-47-46" href="#__codelineno-47-46"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-47-47"><a id="__codelineno-47-47" name="__codelineno-47-47" href="#__codelineno-47-47"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerdropitem">CanPlayerDropItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can drop an item</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to drop an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to drop the item</li>
<li><code>item</code> (<em>Item</em>): The item being dropped</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if dropping is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1">-- Simple: Allow all item drops</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerDropItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">-- Medium: Check item restrictions</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerDropItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemDropCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="c1">-- Prevent dropping important items</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drop equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">-- High: Complex item drop validation system</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerDropItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDropValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="c1">-- Check if item is droppable</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drop equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot drop faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to drop this item&quot;</span><span class="p">)</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">    </span><span class="c1">-- Check for special item restrictions</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a><span class="w">        </span><span class="c1">-- Special handling for weapons</span>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need weapon flags to drop weapons&quot;</span><span class="p">)</span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">        </span><span class="c1">-- Special handling for money</span>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drop more than $1000 at once&quot;</span><span class="p">)</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a><span class="w">    </span><span class="c1">-- Check location restrictions</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedAreas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a><span class="w">    </span><span class="p">{</span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="nv">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">},</span><span class="w"> </span><span class="c1">-- Example restricted area</span>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">area</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">restrictedAreas</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">pos</span><span class="p">:</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">area</span><span class="p">.</span><span class="py">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">area</span><span class="p">.</span><span class="py">radius</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drop items in this area&quot;</span><span class="p">)</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">    </span><span class="c1">-- Check for admin restrictions</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;adminRestricted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are restricted from dropping items&quot;</span><span class="p">)</span>
</span><span id="__span-50-60"><a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-50-61"><a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-50-62"><a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-50-63"><a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerearnsalary">CanPlayerEarnSalary</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can earn salary</p>
<p><strong>When Called</strong></p>
<p>When salary payment is being processed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player being checked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1">-- Simple: Allow all players</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEarnSalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">-- Medium: Check if player is AFK</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEarnSalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SalaryAFKCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">isAFK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;afk&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isAFK</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">-- High: Complex salary eligibility system</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEarnSalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalaryCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="c1">-- Check if player is AFK</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">isAFK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;afk&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">isAFK</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">    </span><span class="c1">-- Check minimum playtime</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">    </span><span class="c1">-- Check faction requirements</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">        </span><span class="c1">-- Citizens need to be employed</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;employed&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerequipitem">CanPlayerEquipItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can equip an item</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to equip an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to equip the item</li>
<li><code>item</code> (<em>Item</em>): The item being equipped</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if equipping is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">-- Simple: Allow all item equips</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEquipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1">-- Medium: Check item type restrictions</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEquipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemEquipCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="c1">-- Check if item is equippable</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equippable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be equipped&quot;</span><span class="p">)</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="c1">-- Check if already equipped</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is already equipped&quot;</span><span class="p">)</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1">-- High: Complex item equip validation system</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerEquipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEquipValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="c1">-- Check if item is equippable</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equippable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be equipped&quot;</span><span class="p">)</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">    </span><span class="c1">-- Check if already equipped</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is already equipped&quot;</span><span class="p">)</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot equip faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-22"><a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-56-23"><a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-24"><a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-56-25"><a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-56-26"><a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-56-27"><a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-28"><a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to equip this item&quot;</span><span class="p">)</span>
</span><span id="__span-56-29"><a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-30"><a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-31"><a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a><span class="w">    </span><span class="c1">-- Check attribute requirements</span>
</span><span id="__span-56-32"><a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredAttribs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredAttribs&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-56-33"><a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">requiredAttribs</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-56-34"><a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-56-35"><a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charAttr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-36"><a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">attr</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to equip this item&quot;</span><span class="p">)</span>
</span><span id="__span-56-37"><a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-38"><a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-56-39"><a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-40"><a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a><span class="w">    </span><span class="c1">-- Check for conflicting items</span>
</span><span id="__span-56-41"><a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemType&quot;</span><span class="p">)</span>
</span><span id="__span-56-42"><a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-43"><a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">equippedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-56-44"><a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">equippedItem</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">equippedItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-56-45"><a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">equippedItem</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">equippedItem</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemType&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-46"><a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You already have a &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; equipped&quot;</span><span class="p">)</span>
</span><span id="__span-56-47"><a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-48"><a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-56-49"><a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-56-50"><a id="__codelineno-56-50" name="__codelineno-56-50" href="#__codelineno-56-50"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-51"><a id="__codelineno-56-51" name="__codelineno-56-51" href="#__codelineno-56-51"></a><span class="w">    </span><span class="c1">-- Check for special item restrictions</span>
</span><span id="__span-56-52"><a id="__codelineno-56-52" name="__codelineno-56-52" href="#__codelineno-56-52"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-53"><a id="__codelineno-56-53" name="__codelineno-56-53" href="#__codelineno-56-53"></a><span class="w">        </span><span class="c1">-- Special handling for weapons</span>
</span><span id="__span-56-54"><a id="__codelineno-56-54" name="__codelineno-56-54" href="#__codelineno-56-54"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-55"><a id="__codelineno-56-55" name="__codelineno-56-55" href="#__codelineno-56-55"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need weapon flags to equip weapons&quot;</span><span class="p">)</span>
</span><span id="__span-56-56"><a id="__codelineno-56-56" name="__codelineno-56-56" href="#__codelineno-56-56"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-57"><a id="__codelineno-56-57" name="__codelineno-56-57" href="#__codelineno-56-57"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-56-58"><a id="__codelineno-56-58" name="__codelineno-56-58" href="#__codelineno-56-58"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;armor_vest&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-59"><a id="__codelineno-56-59" name="__codelineno-56-59" href="#__codelineno-56-59"></a><span class="w">        </span><span class="c1">-- Special handling for armor</span>
</span><span id="__span-56-60"><a id="__codelineno-56-60" name="__codelineno-56-60" href="#__codelineno-56-60"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getClass</span><span class="p">()</span>
</span><span id="__span-56-61"><a id="__codelineno-56-61" name="__codelineno-56-61" href="#__codelineno-56-61"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-62"><a id="__codelineno-56-62" name="__codelineno-56-62" href="#__codelineno-56-62"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Citizens cannot equip armor&quot;</span><span class="p">)</span>
</span><span id="__span-56-63"><a id="__codelineno-56-63" name="__codelineno-56-63" href="#__codelineno-56-63"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-64"><a id="__codelineno-56-64" name="__codelineno-56-64" href="#__codelineno-56-64"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-56-65"><a id="__codelineno-56-65" name="__codelineno-56-65" href="#__codelineno-56-65"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-66"><a id="__codelineno-56-66" name="__codelineno-56-66" href="#__codelineno-56-66"></a><span class="w">    </span><span class="c1">-- Check for admin restrictions</span>
</span><span id="__span-56-67"><a id="__codelineno-56-67" name="__codelineno-56-67" href="#__codelineno-56-67"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;adminRestricted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-56-68"><a id="__codelineno-56-68" name="__codelineno-56-68" href="#__codelineno-56-68"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are restricted from equipping items&quot;</span><span class="p">)</span>
</span><span id="__span-56-69"><a id="__codelineno-56-69" name="__codelineno-56-69" href="#__codelineno-56-69"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-56-70"><a id="__codelineno-56-70" name="__codelineno-56-70" href="#__codelineno-56-70"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-56-71"><a id="__codelineno-56-71" name="__codelineno-56-71" href="#__codelineno-56-71"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-56-72"><a id="__codelineno-56-72" name="__codelineno-56-72" href="#__codelineno-56-72"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerholdobject">CanPlayerHoldObject</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can hold an object</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to pick up or hold an entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to hold the object</li>
<li><code>entity</code> (<em>Entity</em>): The entity being held</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if holding is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">-- Simple: Allow all object holding</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerHoldObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1">-- Medium: Check entity type restrictions</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerHoldObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ObjectHoldCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="c1">-- Prevent holding certain entity types</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prop_physics&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1">-- High: Complex object holding validation</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerHoldObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedHoldValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">    </span><span class="c1">-- Check entity validity</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">        </span><span class="c1">-- Check entity class</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;prop_physics_multiplayer&quot;</span><span class="p">}</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedClasses</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">        </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prisoner&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Prisoners cannot hold objects&quot;</span><span class="p">)</span>
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-59-18"><a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="w">        </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-59-19"><a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-59-20"><a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-59-21"><a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level 5 to hold objects&quot;</span><span class="p">)</span>
</span><span id="__span-59-22"><a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-59-23"><a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-59-24"><a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-59-25"><a id="__codelineno-59-25" name="__codelineno-59-25" href="#__codelineno-59-25"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerinteractitem">CanPlayerInteractItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can interact with an item</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to perform an action on an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting the interaction</li>
<li><code>action</code> (<em>string</em>): The action being performed</li>
<li><code>self</code> (<em>Item</em>): The item being interacted with</li>
<li><code>data</code> (<em>table</em>): Additional data for the interaction</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if interaction is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1">-- Simple: Allow all item interactions</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1">-- Medium: Check action restrictions</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemInteractionCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="c1">-- Check if action is allowed</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;drop&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1">-- High: Complex item interaction validation</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInteractionValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">    </span><span class="c1">-- Check action restrictions</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">        </span><span class="c1">-- Check if item is usable</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be used&quot;</span><span class="p">)</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;drop&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="w">        </span><span class="c1">-- Check if item is droppable</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;equip&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">        </span><span class="c1">-- Check if item is equippable</span>
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equippable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-21"><a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be equipped&quot;</span><span class="p">)</span>
</span><span id="__span-62-22"><a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-62-23"><a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-62-24"><a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-62-25"><a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-62-26"><a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-62-27"><a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-28"><a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-62-29"><a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-62-30"><a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot interact with faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-62-31"><a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-62-32"><a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-62-33"><a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-62-34"><a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-62-35"><a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerjoinclass">CanPlayerJoinClass</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can join a class</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to join a specific class</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to join the class</li>
<li><code>class</code> (<em>number</em>): The class ID being joined</li>
<li><code>info</code> (<em>table</em>): Additional class information</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if joining is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1">-- Simple: Allow all class joins</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1">-- Medium: Check faction requirements</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ClassJoinCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1">-- High: Complex class join validation</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedClassJoin&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="c1">-- Check faction requirements</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must be in the &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; faction to join this class&quot;</span><span class="p">)</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to join this class&quot;</span><span class="p">)</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w">    </span><span class="c1">-- Check flag requirements</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">flags</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="nv">info</span><span class="p">.</span><span class="py">flags</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have the required flags to join this class&quot;</span><span class="p">)</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerknock">CanPlayerKnock</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can knock on doors</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to knock on a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to knock</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if knocking is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1">-- Simple: Allow all knocking</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerKnock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1">-- Medium: Check character status</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerKnock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;KnockCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1">-- High: Complex knock validation</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerKnock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedKnockValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">    </span><span class="c1">-- Check if player is unconscious</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot knock while unconscious&quot;</span><span class="p">)</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">    </span><span class="c1">-- Check if player is gagged</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;gagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot knock while gagged&quot;</span><span class="p">)</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="w">    </span><span class="c1">-- Check knock cooldown</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastKnock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastKnock&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastKnock</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before knocking again&quot;</span><span class="p">)</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastKnock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerlock">CanPlayerLock</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can lock a door</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to lock a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to lock the door</li>
<li><code>door</code> (<em>Entity</em>): The door entity being locked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if locking is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1">-- Simple: Allow all door locking</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1">-- Medium: Check door ownership</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorLockCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1">-- High: Complex door lock validation</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">    </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this door&quot;</span><span class="p">)</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="w">    </span><span class="c1">-- Check if door is lockable</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;noLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This door cannot be locked&quot;</span><span class="p">)</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="w">    </span><span class="c1">-- Check faction permissions</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to lock this door&quot;</span><span class="p">)</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayermodifyconfig">CanPlayerModifyConfig</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can modify configuration</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to change a config value</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to modify config</li>
<li><code>key</code> (<em>string</em>): The configuration key being modified</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if modification is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1">-- Simple: Only allow admins</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerModifyConfig&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1">-- Medium: Check specific config permissions</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerModifyConfig&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ConfigModCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;serverPassword&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1">-- High: Complex config modification validation</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerModifyConfig&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedConfigMod&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="c1">-- Super admins can modify anything</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="c1">-- Regular admins have limited access</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;serverPassword&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rconPassword&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;adminFlags&quot;</span><span class="p">}</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">restrictedKeys</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to modify this config&quot;</span><span class="p">)</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="c1">-- Check custom permissions</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to modify config&quot;</span><span class="p">)</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayeropenscoreboard">CanPlayerOpenScoreboard</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can open the scoreboard</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to open the scoreboard</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to open the scoreboard</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if opening is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1">-- Simple: Allow all scoreboard access</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerOpenScoreboard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1">-- Medium: Check character status</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerOpenScoreboard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ScoreboardCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1">-- High: Complex scoreboard access validation</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerOpenScoreboard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedScoreboardAccess&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">    </span><span class="c1">-- Check if player is unconscious</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prisoner&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerrotateitem">CanPlayerRotateItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can rotate an item in inventory</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to rotate an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to rotate the item</li>
<li><code>item</code> (<em>Item</em>): The item being rotated</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if rotation is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1">-- Simple: Allow all item rotation</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerRotateItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1">-- Medium: Check item properties</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerRotateItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RotateCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="c1">-- Check if item is rotatable</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noRotate&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1">-- High: Complex item rotation validation</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerRotateItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRotation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w">    </span><span class="c1">-- Check if item is rotatable</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noRotate&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be rotated&quot;</span><span class="p">)</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="w">    </span><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot rotate equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerseelogcategory">CanPlayerSeeLogCategory</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can see a log category</p>
<p><strong>When Called</strong></p>
<p>When determining which log categories a player can view</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player checking log access</li>
<li><code>k</code> (<em>string</em>): The log category key</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if viewing is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1">-- Simple: Allow admins to see all logs</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSeeLogCategory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1">-- Medium: Different permissions for different categories</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSeeLogCategory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;LogCategoryCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1">-- High: Complex log category access control</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSeeLogCategory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedLogAccess&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="c1">-- Super admins see everything</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="c1">-- Regular admins have limited access</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedCategories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;security&quot;</span><span class="p">}</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">restrictedCategories</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="c1">-- Check custom permissions</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerspawnstorage">CanPlayerSpawnStorage</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can spawn storage entities</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to spawn a storage container</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to spawn storage</li>
<li><code>entity</code> (<em>Entity</em>): The storage entity being spawned</li>
<li><code>info</code> (<em>table</em>): Information about the storage entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if spawning is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1">-- Simple: Allow all storage spawning</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSpawnStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1">-- Medium: Check faction permissions</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSpawnStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;StorageSpawnCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1">-- High: Complex storage spawn validation</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSpawnStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">info</span><span class="p">)</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">    </span><span class="c1">-- Check storage flags</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need storage flags to spawn storage&quot;</span><span class="p">)</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot spawn this faction&#39;s storage&quot;</span><span class="p">)</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">info</span><span class="p">.</span><span class="py">level</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to spawn this storage&quot;</span><span class="p">)</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">    </span><span class="c1">-- Check storage limit</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">storageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;storageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">storageCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have reached the maximum storage limit&quot;</span><span class="p">)</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerswitchchar">CanPlayerSwitchChar</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can switch characters</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to switch from one character to another</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to switch</li>
<li><code>currentChar</code> (<em>Character</em>): The current character</li>
<li><code>character</code> (<em>Character</em>): The character being switched to</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if switching is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1">-- Simple: Allow all character switching</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSwitchChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1">-- Medium: Check switch cooldown</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSwitchChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SwitchCooldown&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 5 minute cooldown</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before switching characters&quot;</span><span class="p">)</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1">-- High: Complex character switch validation</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerSwitchChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="c1">-- Check switch cooldown</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="mi">300</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="p">))</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; seconds before switching&quot;</span><span class="p">)</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="c1">-- Check if current character is in combat</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;inCombat&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot switch characters while in combat&quot;</span><span class="p">)</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="c1">-- Check if current character is unconscious</span>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot switch characters while unconscious&quot;</span><span class="p">)</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="c1">-- Check faction switch limits</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionSwitches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;factionSwitches&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">factionSwitches</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have reached the maximum faction switch limit&quot;</span><span class="p">)</span>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;factionSwitches&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">factionSwitches</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-89-27"><a id="__codelineno-89-27" name="__codelineno-89-27" href="#__codelineno-89-27"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-89-28"><a id="__codelineno-89-28" name="__codelineno-89-28" href="#__codelineno-89-28"></a><span class="c1">-- Update last switch time</span>
</span><span id="__span-89-29"><a id="__codelineno-89-29" name="__codelineno-89-29" href="#__codelineno-89-29"></a><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-89-30"><a id="__codelineno-89-30" name="__codelineno-89-30" href="#__codelineno-89-30"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-89-31"><a id="__codelineno-89-31" name="__codelineno-89-31" href="#__codelineno-89-31"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayertakeitem">CanPlayerTakeItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can take an item</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to take an item from the ground or another source</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to take the item</li>
<li><code>item</code> (<em>Item</em>): The item being taken</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if taking is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1">-- Simple: Allow all item takes</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTakeItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1">-- Medium: Check item restrictions</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTakeItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemTakeCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="c1">-- Check if item is takeable</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noTake&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be taken&quot;</span><span class="p">)</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="c1">-- Check if item is owned by someone else</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item belongs to someone else&quot;</span><span class="p">)</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1">-- High: Complex item take validation system</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTakeItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTakeValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">    </span><span class="c1">-- Check if item is takeable</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noTake&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be taken&quot;</span><span class="p">)</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w">    </span><span class="c1">-- Check if item is owned by someone else</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item belongs to someone else&quot;</span><span class="p">)</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot take faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-92-22"><a id="__codelineno-92-22" name="__codelineno-92-22" href="#__codelineno-92-22"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-23"><a id="__codelineno-92-23" name="__codelineno-92-23" href="#__codelineno-92-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-92-24"><a id="__codelineno-92-24" name="__codelineno-92-24" href="#__codelineno-92-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-25"><a id="__codelineno-92-25" name="__codelineno-92-25" href="#__codelineno-92-25"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-92-26"><a id="__codelineno-92-26" name="__codelineno-92-26" href="#__codelineno-92-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-92-27"><a id="__codelineno-92-27" name="__codelineno-92-27" href="#__codelineno-92-27"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-92-28"><a id="__codelineno-92-28" name="__codelineno-92-28" href="#__codelineno-92-28"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-29"><a id="__codelineno-92-29" name="__codelineno-92-29" href="#__codelineno-92-29"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to take this item&quot;</span><span class="p">)</span>
</span><span id="__span-92-30"><a id="__codelineno-92-30" name="__codelineno-92-30" href="#__codelineno-92-30"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-31"><a id="__codelineno-92-31" name="__codelineno-92-31" href="#__codelineno-92-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-32"><a id="__codelineno-92-32" name="__codelineno-92-32" href="#__codelineno-92-32"></a><span class="w">    </span><span class="c1">-- Check weight limits</span>
</span><span id="__span-92-33"><a id="__codelineno-92-33" name="__codelineno-92-33" href="#__codelineno-92-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-92-34"><a id="__codelineno-92-34" name="__codelineno-92-34" href="#__codelineno-92-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-92-35"><a id="__codelineno-92-35" name="__codelineno-92-35" href="#__codelineno-92-35"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-92-36"><a id="__codelineno-92-36" name="__codelineno-92-36" href="#__codelineno-92-36"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span>
</span><span id="__span-92-37"><a id="__codelineno-92-37" name="__codelineno-92-37" href="#__codelineno-92-37"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-38"><a id="__codelineno-92-38" name="__codelineno-92-38" href="#__codelineno-92-38"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough space in your inventory&quot;</span><span class="p">)</span>
</span><span id="__span-92-39"><a id="__codelineno-92-39" name="__codelineno-92-39" href="#__codelineno-92-39"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-40"><a id="__codelineno-92-40" name="__codelineno-92-40" href="#__codelineno-92-40"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-41"><a id="__codelineno-92-41" name="__codelineno-92-41" href="#__codelineno-92-41"></a><span class="w">    </span><span class="c1">-- Check for special item restrictions</span>
</span><span id="__span-92-42"><a id="__codelineno-92-42" name="__codelineno-92-42" href="#__codelineno-92-42"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-43"><a id="__codelineno-92-43" name="__codelineno-92-43" href="#__codelineno-92-43"></a><span class="w">        </span><span class="c1">-- Special handling for weapons</span>
</span><span id="__span-92-44"><a id="__codelineno-92-44" name="__codelineno-92-44" href="#__codelineno-92-44"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-45"><a id="__codelineno-92-45" name="__codelineno-92-45" href="#__codelineno-92-45"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need weapon flags to take weapons&quot;</span><span class="p">)</span>
</span><span id="__span-92-46"><a id="__codelineno-92-46" name="__codelineno-92-46" href="#__codelineno-92-46"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-47"><a id="__codelineno-92-47" name="__codelineno-92-47" href="#__codelineno-92-47"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-92-48"><a id="__codelineno-92-48" name="__codelineno-92-48" href="#__codelineno-92-48"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-49"><a id="__codelineno-92-49" name="__codelineno-92-49" href="#__codelineno-92-49"></a><span class="w">        </span><span class="c1">-- Special handling for money</span>
</span><span id="__span-92-50"><a id="__codelineno-92-50" name="__codelineno-92-50" href="#__codelineno-92-50"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-92-51"><a id="__codelineno-92-51" name="__codelineno-92-51" href="#__codelineno-92-51"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-52"><a id="__codelineno-92-52" name="__codelineno-92-52" href="#__codelineno-92-52"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot take more than $10,000 at once&quot;</span><span class="p">)</span>
</span><span id="__span-92-53"><a id="__codelineno-92-53" name="__codelineno-92-53" href="#__codelineno-92-53"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-54"><a id="__codelineno-92-54" name="__codelineno-92-54" href="#__codelineno-92-54"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-92-55"><a id="__codelineno-92-55" name="__codelineno-92-55" href="#__codelineno-92-55"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-56"><a id="__codelineno-92-56" name="__codelineno-92-56" href="#__codelineno-92-56"></a><span class="w">    </span><span class="c1">-- Check location restrictions</span>
</span><span id="__span-92-57"><a id="__codelineno-92-57" name="__codelineno-92-57" href="#__codelineno-92-57"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-92-58"><a id="__codelineno-92-58" name="__codelineno-92-58" href="#__codelineno-92-58"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span id="__span-92-59"><a id="__codelineno-92-59" name="__codelineno-92-59" href="#__codelineno-92-59"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemPos</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">pos</span><span class="p">:</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">itemPos</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-60"><a id="__codelineno-92-60" name="__codelineno-92-60" href="#__codelineno-92-60"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item is too far away&quot;</span><span class="p">)</span>
</span><span id="__span-92-61"><a id="__codelineno-92-61" name="__codelineno-92-61" href="#__codelineno-92-61"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-62"><a id="__codelineno-92-62" name="__codelineno-92-62" href="#__codelineno-92-62"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-63"><a id="__codelineno-92-63" name="__codelineno-92-63" href="#__codelineno-92-63"></a><span class="w">    </span><span class="c1">-- Check for admin restrictions</span>
</span><span id="__span-92-64"><a id="__codelineno-92-64" name="__codelineno-92-64" href="#__codelineno-92-64"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;adminRestricted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-92-65"><a id="__codelineno-92-65" name="__codelineno-92-65" href="#__codelineno-92-65"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are restricted from taking items&quot;</span><span class="p">)</span>
</span><span id="__span-92-66"><a id="__codelineno-92-66" name="__codelineno-92-66" href="#__codelineno-92-66"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-92-67"><a id="__codelineno-92-67" name="__codelineno-92-67" href="#__codelineno-92-67"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-92-68"><a id="__codelineno-92-68" name="__codelineno-92-68" href="#__codelineno-92-68"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-92-69"><a id="__codelineno-92-69" name="__codelineno-92-69" href="#__codelineno-92-69"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerthrowpunch">CanPlayerThrowPunch</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can throw a punch</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to punch</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to punch</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1">-- Simple: Allow all players</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1">-- Medium: Check stamina</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PunchStaminaCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough stamina to punch&quot;</span><span class="p">)</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1">-- High: Complex punch system</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPunchSystem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="w">    </span><span class="c1">-- Check stamina</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough stamina to punch&quot;</span><span class="p">)</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">    </span><span class="c1">-- Check cooldown</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastPunch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastPunch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">    </span><span class="c1">-- Check if player is tied</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;tied&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">())</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayertradewithvendor">CanPlayerTradeWithVendor</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can trade with a vendor</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to buy/sell from a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to trade</li>
<li><code>vendor</code> (<em>table</em>): The vendor data</li>
<li><code>itemType</code> (<em>string</em>): The item type being traded</li>
<li><code>isSellingToVendor</code> (<em>boolean</em>): True if selling, false if buying</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1">-- Simple: Allow all trades</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTradeWithVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1">-- Medium: Check faction restrictions</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTradeWithVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorTradeCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">allowedFactions</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your faction cannot trade with this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1">-- High: Complex vendor trading system</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerTradeWithVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorTrade&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">allowedFactions</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your faction cannot trade with this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">requiredLevel</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to trade with this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a><span class="w">    </span><span class="c1">-- Check reputation</span>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">.</span><span class="py">requiredReputation</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charRep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;reputation&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-98-21"><a id="__codelineno-98-21" name="__codelineno-98-21" href="#__codelineno-98-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charRep</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-98-22"><a id="__codelineno-98-22" name="__codelineno-98-22" href="#__codelineno-98-22"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredRep</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; reputation to trade with this vendor&quot;</span><span class="p">)</span>
</span><span id="__span-98-23"><a id="__codelineno-98-23" name="__codelineno-98-23" href="#__codelineno-98-23"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-98-24"><a id="__codelineno-98-24" name="__codelineno-98-24" href="#__codelineno-98-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-98-25"><a id="__codelineno-98-25" name="__codelineno-98-25" href="#__codelineno-98-25"></a><span class="w">    </span><span class="c1">-- Check trade cooldown</span>
</span><span id="__span-98-26"><a id="__codelineno-98-26" name="__codelineno-98-26" href="#__codelineno-98-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastTrade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastVendorTrade&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-98-27"><a id="__codelineno-98-27" name="__codelineno-98-27" href="#__codelineno-98-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastTrade</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-98-28"><a id="__codelineno-98-28" name="__codelineno-98-28" href="#__codelineno-98-28"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before trading again&quot;</span><span class="p">)</span>
</span><span id="__span-98-29"><a id="__codelineno-98-29" name="__codelineno-98-29" href="#__codelineno-98-29"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-98-30"><a id="__codelineno-98-30" name="__codelineno-98-30" href="#__codelineno-98-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-98-31"><a id="__codelineno-98-31" name="__codelineno-98-31" href="#__codelineno-98-31"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastVendorTrade&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-98-32"><a id="__codelineno-98-32" name="__codelineno-98-32" href="#__codelineno-98-32"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-98-33"><a id="__codelineno-98-33" name="__codelineno-98-33" href="#__codelineno-98-33"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerunequipitem">CanPlayerUnequipItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can unequip an item</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to unequip an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to unequip the item</li>
<li><code>item</code> (<em>Item</em>): The item being unequipped</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if unequipping is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1">-- Simple: Allow all item unequips</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnequipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="c1">-- Medium: Check if item is equipped</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnequipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemUnequipCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is not equipped&quot;</span><span class="p">)</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="c1">-- Check if item is unequippable</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noUnequip&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be unequipped&quot;</span><span class="p">)</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="c1">-- High: Complex item unequip validation system</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnequipItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUnequipValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="w">    </span><span class="c1">-- Check if item is equipped</span>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is not equipped&quot;</span><span class="p">)</span>
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-10"><a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="w">    </span><span class="c1">-- Check if item is unequippable</span>
</span><span id="__span-101-11"><a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;noUnequip&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-12"><a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item cannot be unequipped&quot;</span><span class="p">)</span>
</span><span id="__span-101-13"><a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-14"><a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-15"><a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-101-16"><a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-101-17"><a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-18"><a id="__codelineno-101-18" name="__codelineno-101-18" href="#__codelineno-101-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-101-19"><a id="__codelineno-101-19" name="__codelineno-101-19" href="#__codelineno-101-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">charFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-20"><a id="__codelineno-101-20" name="__codelineno-101-20" href="#__codelineno-101-20"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot unequip faction-restricted items&quot;</span><span class="p">)</span>
</span><span id="__span-101-21"><a id="__codelineno-101-21" name="__codelineno-101-21" href="#__codelineno-101-21"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-22"><a id="__codelineno-101-22" name="__codelineno-101-22" href="#__codelineno-101-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-101-23"><a id="__codelineno-101-23" name="__codelineno-101-23" href="#__codelineno-101-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-24"><a id="__codelineno-101-24" name="__codelineno-101-24" href="#__codelineno-101-24"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-101-25"><a id="__codelineno-101-25" name="__codelineno-101-25" href="#__codelineno-101-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-101-26"><a id="__codelineno-101-26" name="__codelineno-101-26" href="#__codelineno-101-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-101-27"><a id="__codelineno-101-27" name="__codelineno-101-27" href="#__codelineno-101-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-28"><a id="__codelineno-101-28" name="__codelineno-101-28" href="#__codelineno-101-28"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to unequip this item&quot;</span><span class="p">)</span>
</span><span id="__span-101-29"><a id="__codelineno-101-29" name="__codelineno-101-29" href="#__codelineno-101-29"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-30"><a id="__codelineno-101-30" name="__codelineno-101-30" href="#__codelineno-101-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-31"><a id="__codelineno-101-31" name="__codelineno-101-31" href="#__codelineno-101-31"></a><span class="w">    </span><span class="c1">-- Check for special item restrictions</span>
</span><span id="__span-101-32"><a id="__codelineno-101-32" name="__codelineno-101-32" href="#__codelineno-101-32"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-33"><a id="__codelineno-101-33" name="__codelineno-101-33" href="#__codelineno-101-33"></a><span class="w">        </span><span class="c1">-- Special handling for weapons</span>
</span><span id="__span-101-34"><a id="__codelineno-101-34" name="__codelineno-101-34" href="#__codelineno-101-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-35"><a id="__codelineno-101-35" name="__codelineno-101-35" href="#__codelineno-101-35"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need weapon flags to unequip weapons&quot;</span><span class="p">)</span>
</span><span id="__span-101-36"><a id="__codelineno-101-36" name="__codelineno-101-36" href="#__codelineno-101-36"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-37"><a id="__codelineno-101-37" name="__codelineno-101-37" href="#__codelineno-101-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-101-38"><a id="__codelineno-101-38" name="__codelineno-101-38" href="#__codelineno-101-38"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;armor_vest&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-39"><a id="__codelineno-101-39" name="__codelineno-101-39" href="#__codelineno-101-39"></a><span class="w">        </span><span class="c1">-- Special handling for armor</span>
</span><span id="__span-101-40"><a id="__codelineno-101-40" name="__codelineno-101-40" href="#__codelineno-101-40"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getClass</span><span class="p">()</span>
</span><span id="__span-101-41"><a id="__codelineno-101-41" name="__codelineno-101-41" href="#__codelineno-101-41"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-42"><a id="__codelineno-101-42" name="__codelineno-101-42" href="#__codelineno-101-42"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Citizens cannot unequip armor&quot;</span><span class="p">)</span>
</span><span id="__span-101-43"><a id="__codelineno-101-43" name="__codelineno-101-43" href="#__codelineno-101-43"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-44"><a id="__codelineno-101-44" name="__codelineno-101-44" href="#__codelineno-101-44"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-101-45"><a id="__codelineno-101-45" name="__codelineno-101-45" href="#__codelineno-101-45"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-46"><a id="__codelineno-101-46" name="__codelineno-101-46" href="#__codelineno-101-46"></a><span class="w">    </span><span class="c1">-- Check for admin restrictions</span>
</span><span id="__span-101-47"><a id="__codelineno-101-47" name="__codelineno-101-47" href="#__codelineno-101-47"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;adminRestricted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-48"><a id="__codelineno-101-48" name="__codelineno-101-48" href="#__codelineno-101-48"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are restricted from unequipping items&quot;</span><span class="p">)</span>
</span><span id="__span-101-49"><a id="__codelineno-101-49" name="__codelineno-101-49" href="#__codelineno-101-49"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-50"><a id="__codelineno-101-50" name="__codelineno-101-50" href="#__codelineno-101-50"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-51"><a id="__codelineno-101-51" name="__codelineno-101-51" href="#__codelineno-101-51"></a><span class="w">    </span><span class="c1">-- Check inventory space</span>
</span><span id="__span-101-52"><a id="__codelineno-101-52" name="__codelineno-101-52" href="#__codelineno-101-52"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-101-53"><a id="__codelineno-101-53" name="__codelineno-101-53" href="#__codelineno-101-53"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-101-54"><a id="__codelineno-101-54" name="__codelineno-101-54" href="#__codelineno-101-54"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough space in your inventory&quot;</span><span class="p">)</span>
</span><span id="__span-101-55"><a id="__codelineno-101-55" name="__codelineno-101-55" href="#__codelineno-101-55"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-101-56"><a id="__codelineno-101-56" name="__codelineno-101-56" href="#__codelineno-101-56"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-101-57"><a id="__codelineno-101-57" name="__codelineno-101-57" href="#__codelineno-101-57"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-101-58"><a id="__codelineno-101-58" name="__codelineno-101-58" href="#__codelineno-101-58"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerunlock">CanPlayerUnlock</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can unlock a door</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to unlock a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to unlock the door</li>
<li><code>door</code> (<em>Entity</em>): The door entity being unlocked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if unlocking is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="c1">-- Simple: Allow all door unlocking</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1">-- Medium: Check door ownership</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorUnlockCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="c1">-- High: Complex door unlock validation</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="w">    </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this door&quot;</span><span class="p">)</span>
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">    </span><span class="c1">-- Check faction permissions</span>
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-104-13"><a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-104-14"><a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to unlock this door&quot;</span><span class="p">)</span>
</span><span id="__span-104-15"><a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-104-16"><a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-104-17"><a id="__codelineno-104-17" name="__codelineno-104-17" href="#__codelineno-104-17"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-104-18"><a id="__codelineno-104-18" name="__codelineno-104-18" href="#__codelineno-104-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerusechar">CanPlayerUseChar</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can use a character</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to load a character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to use the character</li>
<li><code>character</code> (<em>Character</em>): The character being used</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if using is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="c1">-- Simple: Allow all character usage</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1">-- Medium: Check character ownership</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharUseCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getSteamID</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1">-- High: Complex character use validation</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="c1">-- Check character ownership</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getSteamID</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This character doesn&#39;t belong to you&quot;</span><span class="p">)</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="c1">-- Check if character is banned</span>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;banned&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This character is banned&quot;</span><span class="p">)</span>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="c1">-- Check if character is deleted</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This character has been deleted&quot;</span><span class="p">)</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerusecommand">CanPlayerUseCommand</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can use a command</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to execute a command</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to use the command</li>
<li><code>command</code> (<em>string</em>): The command being executed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if command use is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="c1">-- Simple: Allow all commands</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="c1">-- Medium: Check admin commands</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CommandCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">adminCommands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;kick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ban&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slay&quot;</span><span class="p">}</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">adminCommands</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="c1">-- High: Complex command permission system</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCommandPerms&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span><span class="c1">-- Check admin commands</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">adminCommands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;kick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ban&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bring&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;goto&quot;</span><span class="p">}</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">adminCommands</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need admin permissions to use this command&quot;</span><span class="p">)</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">    </span><span class="c1">-- Check faction-specific commands</span>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionCommands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;arrest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;warrant&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;unarrest&quot;</span><span class="p">},</span>
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;heal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;revive&quot;</span><span class="p">}</span>
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-110-18"><a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-110-19"><a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">fac</span><span class="p">,</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">factionCommands</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-110-20"><a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">commands</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-110-21"><a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">fac</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-110-22"><a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be in the &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">fac</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; faction to use this command&quot;</span><span class="p">)</span>
</span><span id="__span-110-23"><a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-110-24"><a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-110-25"><a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-110-26"><a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-110-27"><a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="w">    </span><span class="c1">-- Check command cooldowns</span>
</span><span id="__span-110-28"><a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastCommand_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-110-29"><a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastCommand</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-110-30"><a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before using this command again&quot;</span><span class="p">)</span>
</span><span id="__span-110-31"><a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-110-32"><a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-110-33"><a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCommand_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-110-34"><a id="__codelineno-110-34" name="__codelineno-110-34" href="#__codelineno-110-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-110-35"><a id="__codelineno-110-35" name="__codelineno-110-35" href="#__codelineno-110-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerusedoor">CanPlayerUseDoor</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can use a door</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to interact with a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player attempting to use the door</li>
<li><code>door</code> (<em>Entity</em>): The door entity being used</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if door use is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1">-- Simple: Allow all door usage</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="c1">-- Medium: Check door ownership</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorUseCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1">-- High: Complex door use validation</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">        </span><span class="c1">-- Check if door is shared</span>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">sharedWith</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;sharedWith&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">sharedWith</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to use this door&quot;</span><span class="p">)</span>
</span><span id="__span-113-12"><a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-113-13"><a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-113-14"><a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-113-15"><a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">    </span><span class="c1">-- Check faction permissions</span>
</span><span id="__span-113-16"><a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-113-17"><a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">doorFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-113-18"><a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to use this faction&#39;s door&quot;</span><span class="p">)</span>
</span><span id="__span-113-19"><a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-113-20"><a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-113-21"><a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="w">    </span><span class="c1">-- Check if door is locked</span>
</span><span id="__span-113-22"><a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-113-23"><a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This door is locked&quot;</span><span class="p">)</span>
</span><span id="__span-113-24"><a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-113-25"><a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-113-26"><a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-113-27"><a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canplayerviewinventory">CanPlayerViewInventory</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player can view inventories</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to open any inventory</p>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if viewing inventories is allowed, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="c1">-- Simple: Allow all inventory viewing</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerViewInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="c1">-- Medium: Check player status</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerViewInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InventoryViewCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">()</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">        </span><span class="c1">-- Check if player is unconscious</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot view inventories while unconscious&quot;</span><span class="p">)</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-115-13"><a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="c1">-- High: Complex inventory view validation system</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanPlayerViewInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInventoryView&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">()</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w">        </span><span class="c1">-- Check if player is unconscious</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot view inventories while unconscious&quot;</span><span class="p">)</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="w">        </span><span class="c1">-- Check if player is dead</span>
</span><span id="__span-116-13"><a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-14"><a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot view inventories while dead&quot;</span><span class="p">)</span>
</span><span id="__span-116-15"><a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-16"><a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-17"><a id="__codelineno-116-17" name="__codelineno-116-17" href="#__codelineno-116-17"></a><span class="w">        </span><span class="c1">-- Check if player is gagged</span>
</span><span id="__span-116-18"><a id="__codelineno-116-18" name="__codelineno-116-18" href="#__codelineno-116-18"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;gagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-19"><a id="__codelineno-116-19" name="__codelineno-116-19" href="#__codelineno-116-19"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot view inventories while gagged&quot;</span><span class="p">)</span>
</span><span id="__span-116-20"><a id="__codelineno-116-20" name="__codelineno-116-20" href="#__codelineno-116-20"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-21"><a id="__codelineno-116-21" name="__codelineno-116-21" href="#__codelineno-116-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-22"><a id="__codelineno-116-22" name="__codelineno-116-22" href="#__codelineno-116-22"></a><span class="w">        </span><span class="c1">-- Check if player is muted</span>
</span><span id="__span-116-23"><a id="__codelineno-116-23" name="__codelineno-116-23" href="#__codelineno-116-23"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;muted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-24"><a id="__codelineno-116-24" name="__codelineno-116-24" href="#__codelineno-116-24"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot view inventories while muted&quot;</span><span class="p">)</span>
</span><span id="__span-116-25"><a id="__codelineno-116-25" name="__codelineno-116-25" href="#__codelineno-116-25"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-26"><a id="__codelineno-116-26" name="__codelineno-116-26" href="#__codelineno-116-26"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-27"><a id="__codelineno-116-27" name="__codelineno-116-27" href="#__codelineno-116-27"></a><span class="w">        </span><span class="c1">-- Check for admin restrictions</span>
</span><span id="__span-116-28"><a id="__codelineno-116-28" name="__codelineno-116-28" href="#__codelineno-116-28"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;adminRestricted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-29"><a id="__codelineno-116-29" name="__codelineno-116-29" href="#__codelineno-116-29"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are restricted from viewing inventories&quot;</span><span class="p">)</span>
</span><span id="__span-116-30"><a id="__codelineno-116-30" name="__codelineno-116-30" href="#__codelineno-116-30"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-31"><a id="__codelineno-116-31" name="__codelineno-116-31" href="#__codelineno-116-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-32"><a id="__codelineno-116-32" name="__codelineno-116-32" href="#__codelineno-116-32"></a><span class="w">        </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-116-33"><a id="__codelineno-116-33" name="__codelineno-116-33" href="#__codelineno-116-33"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-116-34"><a id="__codelineno-116-34" name="__codelineno-116-34" href="#__codelineno-116-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prisoner&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-35"><a id="__codelineno-116-35" name="__codelineno-116-35" href="#__codelineno-116-35"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Prisoners cannot view inventories&quot;</span><span class="p">)</span>
</span><span id="__span-116-36"><a id="__codelineno-116-36" name="__codelineno-116-36" href="#__codelineno-116-36"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-37"><a id="__codelineno-116-37" name="__codelineno-116-37" href="#__codelineno-116-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-38"><a id="__codelineno-116-38" name="__codelineno-116-38" href="#__codelineno-116-38"></a><span class="w">        </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-116-39"><a id="__codelineno-116-39" name="__codelineno-116-39" href="#__codelineno-116-39"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-116-40"><a id="__codelineno-116-40" name="__codelineno-116-40" href="#__codelineno-116-40"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-41"><a id="__codelineno-116-41" name="__codelineno-116-41" href="#__codelineno-116-41"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level 1 to view inventories&quot;</span><span class="p">)</span>
</span><span id="__span-116-42"><a id="__codelineno-116-42" name="__codelineno-116-42" href="#__codelineno-116-42"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-43"><a id="__codelineno-116-43" name="__codelineno-116-43" href="#__codelineno-116-43"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-44"><a id="__codelineno-116-44" name="__codelineno-116-44" href="#__codelineno-116-44"></a><span class="w">        </span><span class="c1">-- Check for special conditions</span>
</span><span id="__span-116-45"><a id="__codelineno-116-45" name="__codelineno-116-45" href="#__codelineno-116-45"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-116-46"><a id="__codelineno-116-46" name="__codelineno-116-46" href="#__codelineno-116-46"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedAreas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-47"><a id="__codelineno-116-47" name="__codelineno-116-47" href="#__codelineno-116-47"></a><span class="w">        </span><span class="p">{</span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="nv">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">},</span><span class="w"> </span><span class="c1">-- Example restricted area</span>
</span><span id="__span-116-48"><a id="__codelineno-116-48" name="__codelineno-116-48" href="#__codelineno-116-48"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-116-49"><a id="__codelineno-116-49" name="__codelineno-116-49" href="#__codelineno-116-49"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">area</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">restrictedAreas</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-116-50"><a id="__codelineno-116-50" name="__codelineno-116-50" href="#__codelineno-116-50"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">pos</span><span class="p">:</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">area</span><span class="p">.</span><span class="py">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">area</span><span class="p">.</span><span class="py">radius</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-116-51"><a id="__codelineno-116-51" name="__codelineno-116-51" href="#__codelineno-116-51"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot view inventories in this area&quot;</span><span class="p">)</span>
</span><span id="__span-116-52"><a id="__codelineno-116-52" name="__codelineno-116-52" href="#__codelineno-116-52"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-116-53"><a id="__codelineno-116-53" name="__codelineno-116-53" href="#__codelineno-116-53"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-116-54"><a id="__codelineno-116-54" name="__codelineno-116-54" href="#__codelineno-116-54"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-116-55"><a id="__codelineno-116-55" name="__codelineno-116-55" href="#__codelineno-116-55"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-116-56"><a id="__codelineno-116-56" name="__codelineno-116-56" href="#__codelineno-116-56"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="canrunitemaction">CanRunItemAction</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if an item action can be run</p>
<p><strong>When Called</strong></p>
<p>When attempting to execute an item action</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>itemTable</code> (<em>table</em>): The item table containing the action</li>
<li><code>k</code> (<em>string</em>): The action key being executed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if action can be run, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="c1">-- Simple: Allow all item actions</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanRunItemAction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="c1">-- Medium: Check action restrictions</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanRunItemAction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ActionCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="c1">-- Check if action exists</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">[</span><span class="nv">k</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="c1">-- Check if action is disabled</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;actionDisabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-118-10"><a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-118-11"><a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-118-12"><a id="__codelineno-118-12" name="__codelineno-118-12" href="#__codelineno-118-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="c1">-- High: Complex item action validation</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanRunItemAction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedActionValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="c1">-- Check if action exists</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">[</span><span class="nv">k</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="c1">-- Check if action is disabled</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;actionDisabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-9"><a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-119-10"><a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-119-11"><a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-119-12"><a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">actionFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;actionFaction&quot;</span><span class="p">)</span>
</span><span id="__span-119-13"><a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">actionFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-14"><a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">():</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-119-15"><a id="__codelineno-119-15" name="__codelineno-119-15" href="#__codelineno-119-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">actionFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-16"><a id="__codelineno-119-16" name="__codelineno-119-16" href="#__codelineno-119-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-119-17"><a id="__codelineno-119-17" name="__codelineno-119-17" href="#__codelineno-119-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-119-18"><a id="__codelineno-119-18" name="__codelineno-119-18" href="#__codelineno-119-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-119-19"><a id="__codelineno-119-19" name="__codelineno-119-19" href="#__codelineno-119-19"></a><span class="c1">-- Check level requirements</span>
</span><span id="__span-119-20"><a id="__codelineno-119-20" name="__codelineno-119-20" href="#__codelineno-119-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;requiredLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-119-21"><a id="__codelineno-119-21" name="__codelineno-119-21" href="#__codelineno-119-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">():</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-119-22"><a id="__codelineno-119-22" name="__codelineno-119-22" href="#__codelineno-119-22"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-23"><a id="__codelineno-119-23" name="__codelineno-119-23" href="#__codelineno-119-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-119-24"><a id="__codelineno-119-24" name="__codelineno-119-24" href="#__codelineno-119-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-119-25"><a id="__codelineno-119-25" name="__codelineno-119-25" href="#__codelineno-119-25"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-119-26"><a id="__codelineno-119-26" name="__codelineno-119-26" href="#__codelineno-119-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-119-27"><a id="__codelineno-119-27" name="__codelineno-119-27" href="#__codelineno-119-27"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-119-28"><a id="__codelineno-119-28" name="__codelineno-119-28" href="#__codelineno-119-28"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-119-29"><a id="__codelineno-119-29" name="__codelineno-119-29" href="#__codelineno-119-29"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="cansavedata">CanSaveData</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if entity data can be saved</p>
<p><strong>When Called</strong></p>
<p>When attempting to save entity data to the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The entity being saved</li>
<li><code>inventory</code> (<em>Inventory</em>): The inventory associated with the entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if data can be saved, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="c1">-- Simple: Allow all data saving</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanSaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="c1">-- Medium: Check entity validity</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanSaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DataSaveCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="c1">-- Check if entity is valid</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="c1">-- Check if entity is persistent</span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;persistent&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-121-11"><a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-121-12"><a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="c1">-- High: Complex data save validation</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CanSaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="c1">-- Check if entity is valid</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="c1">-- Check if entity is persistent</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;persistent&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="c1">-- Check if entity has owner</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="c1">-- Check if owner is online</span>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ownerPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetBySteamID</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ownerPlayer</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="c1">-- Check if entity is in valid location</span>
</span><span id="__span-122-22"><a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-122-23"><a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="kr">if</span><span class="w"> </span><span class="nv">pos</span><span class="p">.</span><span class="py">z</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1000</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">pos</span><span class="p">.</span><span class="py">z</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-122-24"><a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-122-25"><a id="__codelineno-122-25" name="__codelineno-122-25" href="#__codelineno-122-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-122-26"><a id="__codelineno-122-26" name="__codelineno-122-26" href="#__codelineno-122-26"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-122-27"><a id="__codelineno-122-27" name="__codelineno-122-27" href="#__codelineno-122-27"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charcleanup">CharCleanUp</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is cleaned up</p>
<p><strong>When Called</strong></p>
<p>When a character is being removed from memory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character being cleaned up</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="c1">-- Simple: Log character cleanup</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharCleanUp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character cleaned up: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="c1">-- Medium: Clean up character data</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharCleanUp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharDataCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="c1">-- Clear temporary data</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;tempData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;cachedData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character data cleaned up: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="c1">-- High: Complex character cleanup system</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharCleanUp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="c1">-- Clear temporary data</span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;tempData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;cachedData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="c1">-- Clear active effects</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="c1">-- Clear active quests</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="c1">-- Clear recognition data</span>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="c1">-- Clear inventory cache</span>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;cachedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-125-18"><a id="__codelineno-125-18" name="__codelineno-125-18" href="#__codelineno-125-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-125-19"><a id="__codelineno-125-19" name="__codelineno-125-19" href="#__codelineno-125-19"></a><span class="c1">-- Clear position data</span>
</span><span id="__span-125-20"><a id="__codelineno-125-20" name="__codelineno-125-20" href="#__codelineno-125-20"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-125-21"><a id="__codelineno-125-21" name="__codelineno-125-21" href="#__codelineno-125-21"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-125-22"><a id="__codelineno-125-22" name="__codelineno-125-22" href="#__codelineno-125-22"></a><span class="c1">-- Log cleanup</span>
</span><span id="__span-125-23"><a id="__codelineno-125-23" name="__codelineno-125-23" href="#__codelineno-125-23"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Character %s (ID: %d) cleaned up&quot;</span><span class="p">,</span>
</span><span id="__span-125-24"><a id="__codelineno-125-24" name="__codelineno-125-24" href="#__codelineno-125-24"></a><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">()))</span>
</span><span id="__span-125-25"><a id="__codelineno-125-25" name="__codelineno-125-25" href="#__codelineno-125-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="chardeleted">CharDeleted</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is deleted</p>
<p><strong>When Called</strong></p>
<p>When a character is successfully deleted</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose character was deleted</li>
<li><code>character</code> (<em>Character</em>): The character that was deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="c1">-- Simple: Log character deletion</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="c1">-- Medium: Handle character deletion effects</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharDeletionEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;deletionTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was deleted&quot;</span><span class="p">)</span>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-127-11"><a id="__codelineno-127-11" name="__codelineno-127-11" href="#__codelineno-127-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-127-12"><a id="__codelineno-127-12" name="__codelineno-127-12" href="#__codelineno-127-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="c1">-- High: Complex character deletion system</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="c1">-- Set deletion data</span>
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;deletionTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="c1">-- Clear character inventory</span>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-128-11"><a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">remove</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-128-12"><a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-128-13"><a id="__codelineno-128-13" name="__codelineno-128-13" href="#__codelineno-128-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-128-14"><a id="__codelineno-128-14" name="__codelineno-128-14" href="#__codelineno-128-14"></a><span class="c1">-- Clear character money</span>
</span><span id="__span-128-15"><a id="__codelineno-128-15" name="__codelineno-128-15" href="#__codelineno-128-15"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-128-16"><a id="__codelineno-128-16" name="__codelineno-128-16" href="#__codelineno-128-16"></a><span class="c1">-- Clear character attributes</span>
</span><span id="__span-128-17"><a id="__codelineno-128-17" name="__codelineno-128-17" href="#__codelineno-128-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getAttribs</span><span class="p">()</span>
</span><span id="__span-128-18"><a id="__codelineno-128-18" name="__codelineno-128-18" href="#__codelineno-128-18"></a><span class="kr">for</span><span class="w"> </span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">attributes</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-128-19"><a id="__codelineno-128-19" name="__codelineno-128-19" href="#__codelineno-128-19"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-128-20"><a id="__codelineno-128-20" name="__codelineno-128-20" href="#__codelineno-128-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-128-21"><a id="__codelineno-128-21" name="__codelineno-128-21" href="#__codelineno-128-21"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-128-22"><a id="__codelineno-128-22" name="__codelineno-128-22" href="#__codelineno-128-22"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-128-23"><a id="__codelineno-128-23" name="__codelineno-128-23" href="#__codelineno-128-23"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;experience&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-128-24"><a id="__codelineno-128-24" name="__codelineno-128-24" href="#__codelineno-128-24"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-128-25"><a id="__codelineno-128-25" name="__codelineno-128-25" href="#__codelineno-128-25"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-128-26"><a id="__codelineno-128-26" name="__codelineno-128-26" href="#__codelineno-128-26"></a><span class="c1">-- Check for faction-specific effects</span>
</span><span id="__span-128-27"><a id="__codelineno-128-27" name="__codelineno-128-27" href="#__codelineno-128-27"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-128-28"><a id="__codelineno-128-28" name="__codelineno-128-28" href="#__codelineno-128-28"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-29"><a id="__codelineno-128-29" name="__codelineno-128-29" href="#__codelineno-128-29"></a><span class="w">    </span><span class="c1">-- Police character deleted</span>
</span><span id="__span-128-30"><a id="__codelineno-128-30" name="__codelineno-128-30" href="#__codelineno-128-30"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-128-31"><a id="__codelineno-128-31" name="__codelineno-128-31" href="#__codelineno-128-31"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-128-32"><a id="__codelineno-128-32" name="__codelineno-128-32" href="#__codelineno-128-32"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-33"><a id="__codelineno-128-33" name="__codelineno-128-33" href="#__codelineno-128-33"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[POLICE] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was deleted&quot;</span><span class="p">)</span>
</span><span id="__span-128-34"><a id="__codelineno-128-34" name="__codelineno-128-34" href="#__codelineno-128-34"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-128-35"><a id="__codelineno-128-35" name="__codelineno-128-35" href="#__codelineno-128-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-128-36"><a id="__codelineno-128-36" name="__codelineno-128-36" href="#__codelineno-128-36"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-37"><a id="__codelineno-128-37" name="__codelineno-128-37" href="#__codelineno-128-37"></a><span class="w">    </span><span class="c1">-- Medic character deleted</span>
</span><span id="__span-128-38"><a id="__codelineno-128-38" name="__codelineno-128-38" href="#__codelineno-128-38"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-128-39"><a id="__codelineno-128-39" name="__codelineno-128-39" href="#__codelineno-128-39"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-128-40"><a id="__codelineno-128-40" name="__codelineno-128-40" href="#__codelineno-128-40"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-41"><a id="__codelineno-128-41" name="__codelineno-128-41" href="#__codelineno-128-41"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[MEDICAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was deleted&quot;</span><span class="p">)</span>
</span><span id="__span-128-42"><a id="__codelineno-128-42" name="__codelineno-128-42" href="#__codelineno-128-42"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-128-43"><a id="__codelineno-128-43" name="__codelineno-128-43" href="#__codelineno-128-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-128-44"><a id="__codelineno-128-44" name="__codelineno-128-44" href="#__codelineno-128-44"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-128-45"><a id="__codelineno-128-45" name="__codelineno-128-45" href="#__codelineno-128-45"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-128-46"><a id="__codelineno-128-46" name="__codelineno-128-46" href="#__codelineno-128-46"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-128-47"><a id="__codelineno-128-47" name="__codelineno-128-47" href="#__codelineno-128-47"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-128-48"><a id="__codelineno-128-48" name="__codelineno-128-48" href="#__codelineno-128-48"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was deleted&quot;</span><span class="p">)</span>
</span><span id="__span-128-49"><a id="__codelineno-128-49" name="__codelineno-128-49" href="#__codelineno-128-49"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-128-50"><a id="__codelineno-128-50" name="__codelineno-128-50" href="#__codelineno-128-50"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-128-51"><a id="__codelineno-128-51" name="__codelineno-128-51" href="#__codelineno-128-51"></a><span class="c1">-- Log deletion</span>
</span><span id="__span-128-52"><a id="__codelineno-128-52" name="__codelineno-128-52" href="#__codelineno-128-52"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s deleted character %s (Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-128-53"><a id="__codelineno-128-53" name="__codelineno-128-53" href="#__codelineno-128-53"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">))</span>
</span><span id="__span-128-54"><a id="__codelineno-128-54" name="__codelineno-128-54" href="#__codelineno-128-54"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charforcerecognized">CharForceRecognized</h3>
<p><strong>Purpose</strong></p>
<p>Called to force character recognition</p>
<p><strong>When Called</strong></p>
<p>When a character is forced to be recognized</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ply</code> (<em>Player</em>): The player being recognized</li>
<li><code>range</code> (<em>number</em>): The recognition range</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="c1">-- Simple: Log forced recognition</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharForceRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was force recognized&quot;</span><span class="p">)</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="c1">-- Medium: Handle forced recognition effects</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharForceRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ForceRecognitionEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="w">    </span><span class="c1">-- Set recognition data</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;forceRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been force recognized&quot;</span><span class="p">)</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="c1">-- High: Complex force recognition system</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharForceRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedForceRecognition&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="w">    </span><span class="c1">-- Set recognition data</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;forceRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a><span class="w">    </span><span class="c1">-- Check for faction-specific effects</span>
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-12"><a id="__codelineno-131-12" name="__codelineno-131-12" href="#__codelineno-131-12"></a><span class="w">        </span><span class="c1">-- Police force recognition</span>
</span><span id="__span-131-13"><a id="__codelineno-131-13" name="__codelineno-131-13" href="#__codelineno-131-13"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-131-14"><a id="__codelineno-131-14" name="__codelineno-131-14" href="#__codelineno-131-14"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-15"><a id="__codelineno-131-15" name="__codelineno-131-15" href="#__codelineno-131-15"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-131-16"><a id="__codelineno-131-16" name="__codelineno-131-16" href="#__codelineno-131-16"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-17"><a id="__codelineno-131-17" name="__codelineno-131-17" href="#__codelineno-131-17"></a><span class="w">                    </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[POLICE] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was force recognized&quot;</span><span class="p">)</span>
</span><span id="__span-131-18"><a id="__codelineno-131-18" name="__codelineno-131-18" href="#__codelineno-131-18"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-131-19"><a id="__codelineno-131-19" name="__codelineno-131-19" href="#__codelineno-131-19"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-131-20"><a id="__codelineno-131-20" name="__codelineno-131-20" href="#__codelineno-131-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-131-21"><a id="__codelineno-131-21" name="__codelineno-131-21" href="#__codelineno-131-21"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-22"><a id="__codelineno-131-22" name="__codelineno-131-22" href="#__codelineno-131-22"></a><span class="w">        </span><span class="c1">-- Medic force recognition</span>
</span><span id="__span-131-23"><a id="__codelineno-131-23" name="__codelineno-131-23" href="#__codelineno-131-23"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-131-24"><a id="__codelineno-131-24" name="__codelineno-131-24" href="#__codelineno-131-24"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-25"><a id="__codelineno-131-25" name="__codelineno-131-25" href="#__codelineno-131-25"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-131-26"><a id="__codelineno-131-26" name="__codelineno-131-26" href="#__codelineno-131-26"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-131-27"><a id="__codelineno-131-27" name="__codelineno-131-27" href="#__codelineno-131-27"></a><span class="w">                    </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[MEDICAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was force recognized&quot;</span><span class="p">)</span>
</span><span id="__span-131-28"><a id="__codelineno-131-28" name="__codelineno-131-28" href="#__codelineno-131-28"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-131-29"><a id="__codelineno-131-29" name="__codelineno-131-29" href="#__codelineno-131-29"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-131-30"><a id="__codelineno-131-30" name="__codelineno-131-30" href="#__codelineno-131-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-131-31"><a id="__codelineno-131-31" name="__codelineno-131-31" href="#__codelineno-131-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-131-32"><a id="__codelineno-131-32" name="__codelineno-131-32" href="#__codelineno-131-32"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-131-33"><a id="__codelineno-131-33" name="__codelineno-131-33" href="#__codelineno-131-33"></a><span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been force recognized&quot;</span><span class="p">)</span>
</span><span id="__span-131-34"><a id="__codelineno-131-34" name="__codelineno-131-34" href="#__codelineno-131-34"></a><span class="w">    </span><span class="c1">-- Log force recognition</span>
</span><span id="__span-131-35"><a id="__codelineno-131-35" name="__codelineno-131-35" href="#__codelineno-131-35"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s was force recognized (Faction: %s, Range: %d)&quot;</span><span class="p">,</span>
</span><span id="__span-131-36"><a id="__codelineno-131-36" name="__codelineno-131-36" href="#__codelineno-131-36"></a><span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">))</span>
</span><span id="__span-131-37"><a id="__codelineno-131-37" name="__codelineno-131-37" href="#__codelineno-131-37"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charhasflags">CharHasFlags</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a character has specific flags</p>
<p><strong>When Called</strong></p>
<p>When checking if a character has certain permissions</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Character</em>): The character being checked</li>
<li><code>flags</code> (<em>string</em>): The flags to check for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if character has flags, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="c1">-- Simple: Check basic flags</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharHasFlags&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="p">)</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">):</span><span class="nf">find</span><span class="p">(</span><span class="nv">flags</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="c1">-- Medium: Check faction-based flags</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharHasFlags&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionFlags&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="p">)</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="p">}</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">hasFactionFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionFlags</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a><span class="kr">return</span><span class="w"> </span><span class="nv">hasFactionFlags</span><span class="p">:</span><span class="nf">find</span><span class="p">(</span><span class="nv">flags</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="c1">-- High: Complex flag checking system</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharHasFlags&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFlagCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="p">)</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="c1">-- Check basic flags</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charFlags</span><span class="p">:</span><span class="nf">find</span><span class="p">(</span><span class="nv">flags</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="c1">-- Check faction-based flags</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a><span class="p">}</span>
</span><span id="__span-134-15"><a id="__codelineno-134-15" name="__codelineno-134-15" href="#__codelineno-134-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">hasFactionFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionFlags</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-134-16"><a id="__codelineno-134-16" name="__codelineno-134-16" href="#__codelineno-134-16"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hasFactionFlags</span><span class="p">:</span><span class="nf">find</span><span class="p">(</span><span class="nv">flags</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-134-17"><a id="__codelineno-134-17" name="__codelineno-134-17" href="#__codelineno-134-17"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-134-18"><a id="__codelineno-134-18" name="__codelineno-134-18" href="#__codelineno-134-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-134-19"><a id="__codelineno-134-19" name="__codelineno-134-19" href="#__codelineno-134-19"></a><span class="c1">-- Check level-based flags</span>
</span><span id="__span-134-20"><a id="__codelineno-134-20" name="__codelineno-134-20" href="#__codelineno-134-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-134-21"><a id="__codelineno-134-21" name="__codelineno-134-21" href="#__codelineno-134-21"></a><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;v&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-134-22"><a id="__codelineno-134-22" name="__codelineno-134-22" href="#__codelineno-134-22"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-134-23"><a id="__codelineno-134-23" name="__codelineno-134-23" href="#__codelineno-134-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-134-24"><a id="__codelineno-134-24" name="__codelineno-134-24" href="#__codelineno-134-24"></a><span class="c1">-- Check admin flags</span>
</span><span id="__span-134-25"><a id="__codelineno-134-25" name="__codelineno-134-25" href="#__codelineno-134-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-134-26"><a id="__codelineno-134-26" name="__codelineno-134-26" href="#__codelineno-134-26"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-134-27"><a id="__codelineno-134-27" name="__codelineno-134-27" href="#__codelineno-134-27"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-134-28"><a id="__codelineno-134-28" name="__codelineno-134-28" href="#__codelineno-134-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-134-29"><a id="__codelineno-134-29" name="__codelineno-134-29" href="#__codelineno-134-29"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-134-30"><a id="__codelineno-134-30" name="__codelineno-134-30" href="#__codelineno-134-30"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charloaded">CharLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is loaded</p>
<p><strong>When Called</strong></p>
<p>When a character is successfully loaded from the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>id</code> (<em>number</em>): The ID of the character that was loaded</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="c1">-- Simple: Log character loading</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character loaded: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c1">-- Medium: Handle character loading effects</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharLoadingEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="w">    </span><span class="c1">-- Set loading data</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loadTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; loaded successfully&quot;</span><span class="p">)</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="c1">-- High: Complex character loading system</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">character</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="w">    </span><span class="c1">-- Set loading data</span>
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loadTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a><span class="w">    </span><span class="c1">-- Get character data</span>
</span><span id="__span-137-9"><a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-137-10"><a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-137-11"><a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-137-12"><a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a><span class="w">    </span><span class="c1">-- Check for faction-specific loading effects</span>
</span><span id="__span-137-13"><a id="__codelineno-137-13" name="__codelineno-137-13" href="#__codelineno-137-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-137-14"><a id="__codelineno-137-14" name="__codelineno-137-14" href="#__codelineno-137-14"></a><span class="w">        </span><span class="c1">-- Police character loaded</span>
</span><span id="__span-137-15"><a id="__codelineno-137-15" name="__codelineno-137-15" href="#__codelineno-137-15"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-137-16"><a id="__codelineno-137-16" name="__codelineno-137-16" href="#__codelineno-137-16"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-137-17"><a id="__codelineno-137-17" name="__codelineno-137-17" href="#__codelineno-137-17"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-137-18"><a id="__codelineno-137-18" name="__codelineno-137-18" href="#__codelineno-137-18"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[POLICE] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has joined the force&quot;</span><span class="p">)</span>
</span><span id="__span-137-19"><a id="__codelineno-137-19" name="__codelineno-137-19" href="#__codelineno-137-19"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-137-20"><a id="__codelineno-137-20" name="__codelineno-137-20" href="#__codelineno-137-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-137-21"><a id="__codelineno-137-21" name="__codelineno-137-21" href="#__codelineno-137-21"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-137-22"><a id="__codelineno-137-22" name="__codelineno-137-22" href="#__codelineno-137-22"></a><span class="w">        </span><span class="c1">-- Medic character loaded</span>
</span><span id="__span-137-23"><a id="__codelineno-137-23" name="__codelineno-137-23" href="#__codelineno-137-23"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-137-24"><a id="__codelineno-137-24" name="__codelineno-137-24" href="#__codelineno-137-24"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-137-25"><a id="__codelineno-137-25" name="__codelineno-137-25" href="#__codelineno-137-25"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-137-26"><a id="__codelineno-137-26" name="__codelineno-137-26" href="#__codelineno-137-26"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[MEDICAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has joined the medical staff&quot;</span><span class="p">)</span>
</span><span id="__span-137-27"><a id="__codelineno-137-27" name="__codelineno-137-27" href="#__codelineno-137-27"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-137-28"><a id="__codelineno-137-28" name="__codelineno-137-28" href="#__codelineno-137-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-137-29"><a id="__codelineno-137-29" name="__codelineno-137-29" href="#__codelineno-137-29"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-137-30"><a id="__codelineno-137-30" name="__codelineno-137-30" href="#__codelineno-137-30"></a><span class="w">    </span><span class="c1">-- Check for level-based effects</span>
</span><span id="__span-137-31"><a id="__codelineno-137-31" name="__codelineno-137-31" href="#__codelineno-137-31"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-137-32"><a id="__codelineno-137-32" name="__codelineno-137-32" href="#__codelineno-137-32"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;High level character loaded: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (Level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-137-33"><a id="__codelineno-137-33" name="__codelineno-137-33" href="#__codelineno-137-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-137-34"><a id="__codelineno-137-34" name="__codelineno-137-34" href="#__codelineno-137-34"></a><span class="w">    </span><span class="c1">-- Log character loading</span>
</span><span id="__span-137-35"><a id="__codelineno-137-35" name="__codelineno-137-35" href="#__codelineno-137-35"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Character %s (ID: %d, Faction: %s, Level: %d) loaded successfully&quot;</span><span class="p">,</span>
</span><span id="__span-137-36"><a id="__codelineno-137-36" name="__codelineno-137-36" href="#__codelineno-137-36"></a><span class="w">    </span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">level</span><span class="p">))</span>
</span><span id="__span-137-37"><a id="__codelineno-137-37" name="__codelineno-137-37" href="#__codelineno-137-37"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charpostsave">CharPostSave</h3>
<p><strong>Purpose</strong></p>
<p>Called after a character is saved</p>
<p><strong>When Called</strong></p>
<p>After character data has been saved to the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Character</em>): The character that was saved</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1">-- Simple: Log character save</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPostSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; saved&quot;</span><span class="p">)</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="c1">-- Medium: Update save timestamp</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPostSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SaveTimestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; saved at &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">))</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="c1">-- High: Complex post-save handling</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPostSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPostSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="c1">-- Update save timestamp</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="c1">-- Increment save count</span>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">saveCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;saveCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;saveCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">saveCount</span><span class="p">)</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="c1">-- Create backup every 10 saves</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">saveCount</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">createBackup</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Backup created for character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Character %s saved (Save #%d)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">saveCount</span><span class="p">))</span>
</span><span id="__span-140-14"><a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charpresave">CharPreSave</h3>
<p><strong>Purpose</strong></p>
<p>Called before a character is saved</p>
<p><strong>When Called</strong></p>
<p>Before character data is saved to the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character being saved</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="c1">-- Simple: Log character save</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPreSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="c1">-- Medium: Validate character data</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPreSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SaveValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="c1">-- Validate money</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixed negative money for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8" href="#__codelineno-142-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-142-9"><a id="__codelineno-142-9" name="__codelineno-142-9" href="#__codelineno-142-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="c1">-- High: Complex pre-save validation</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharPreSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPreSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="c1">-- Validate money</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a><span class="c1">-- Validate attributes</span>
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getAttribs</span><span class="p">()</span>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="kr">for</span><span class="w"> </span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">attributes</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">setAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-143-15"><a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-143-16"><a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">setAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-143-17"><a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-143-18"><a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-143-19"><a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a><span class="c1">-- Update save preparation timestamp</span>
</span><span id="__span-143-20"><a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;preSaveTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-143-21"><a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; validated and ready for save&quot;</span><span class="p">)</span>
</span><span id="__span-143-22"><a id="__codelineno-143-22" name="__codelineno-143-22" href="#__codelineno-143-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="charrestored">CharRestored</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is restored</p>
<p><strong>When Called</strong></p>
<p>When a character is restored from backup or death</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character being restored</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="c1">-- Simple: Log character restoration</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; restored&quot;</span><span class="p">)</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="c1">-- Medium: Handle restoration effects</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RestorationEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;restored&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;restoreTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-145-5"><a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; restored successfully&quot;</span><span class="p">)</span>
</span><span id="__span-145-6"><a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="c1">-- High: Complex character restoration</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CharRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRestoration&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="c1">-- Set restoration data</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;restored&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;restoreTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a><span class="c1">-- Restore health and stamina</span>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-146-9"><a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-146-10"><a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-146-11"><a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-146-12"><a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a><span class="c1">-- Clear negative effects</span>
</span><span id="__span-146-13"><a id="__codelineno-146-13" name="__codelineno-146-13" href="#__codelineno-146-13"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-146-14"><a id="__codelineno-146-14" name="__codelineno-146-14" href="#__codelineno-146-14"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;bleeding&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-146-15"><a id="__codelineno-146-15" name="__codelineno-146-15" href="#__codelineno-146-15"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; fully restored&quot;</span><span class="p">)</span>
</span><span id="__span-146-16"><a id="__codelineno-146-16" name="__codelineno-146-16" href="#__codelineno-146-16"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="chatparsed">ChatParsed</h3>
<p><strong>Purpose</strong></p>
<p>Called when chat is parsed</p>
<p><strong>When Called</strong></p>
<p>When a chat message is processed and parsed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who sent the message</li>
<li><code>chatType</code> (<em>string</em>): The type of chat (ic, ooc, etc)</li>
<li><code>message</code> (<em>string</em>): The message content</li>
<li><code>anonymous</code> (<em>boolean</em>): Whether the message is anonymous</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="c1">-- Simple: Log parsed chat</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ChatParsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; sent &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">chatType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; message: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-147-4"><a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="c1">-- Medium: Filter chat messages</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ChatParsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ChatFilter&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="c1">-- Filter spam</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">message</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-148-5"><a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Message too long&quot;</span><span class="p">)</span>
</span><span id="__span-148-6"><a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-148-7"><a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-148-8"><a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="c1">-- High: Complex chat parsing</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ChatParsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedChatParse&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="w">    </span><span class="c1">-- Check for spam</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastMessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-149-7"><a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">lastMessage</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-149-8"><a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Don&#39;t spam the same message&quot;</span><span class="p">)</span>
</span><span id="__span-149-9"><a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-149-10"><a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-149-11"><a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastMessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-149-12"><a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a><span class="w">    </span><span class="c1">-- Check message length</span>
</span><span id="__span-149-13"><a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">message</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-149-14"><a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Message too long (max 500 characters)&quot;</span><span class="p">)</span>
</span><span id="__span-149-15"><a id="__codelineno-149-15" name="__codelineno-149-15" href="#__codelineno-149-15"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-149-16"><a id="__codelineno-149-16" name="__codelineno-149-16" href="#__codelineno-149-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-149-17"><a id="__codelineno-149-17" name="__codelineno-149-17" href="#__codelineno-149-17"></a><span class="w">    </span><span class="c1">-- Log chat</span>
</span><span id="__span-149-18"><a id="__codelineno-149-18" name="__codelineno-149-18" href="#__codelineno-149-18"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;chat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-149-19"><a id="__codelineno-149-19" name="__codelineno-149-19" href="#__codelineno-149-19"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="checkfactionlimitreached">CheckFactionLimitReached</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a faction limit has been reached</p>
<p><strong>When Called</strong></p>
<p>When checking if more players can join a faction</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>faction</code> (<em>number</em>): The faction ID being checked</li>
<li><code>character</code> (<em>Character</em>): The character attempting to join</li>
<li><code>client</code> (<em>Player</em>): The player attempting to join</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if limit is reached, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="c1">-- Simple: No faction limits</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CheckFactionLimitReached&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="c1">-- Medium: Basic faction limits</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CheckFactionLimitReached&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">factionData</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">factionData</span><span class="p">.</span><span class="py">limit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="w">            </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-151-12"><a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">factionData</span><span class="p">.</span><span class="py">limit</span>
</span><span id="__span-151-13"><a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-151-14"><a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-151-15"><a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="c1">-- High: Complex faction limit system</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CheckFactionLimitReached&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFactionLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">factionData</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="w">    </span><span class="c1">-- Count current faction members</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">            </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="w">    </span><span class="c1">-- Check base limit</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionData</span><span class="p">.</span><span class="py">limit</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nb">math.huge</span>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="w">    </span><span class="c1">-- Adjust limit based on server population</span>
</span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">playerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">playerCount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a><span class="w">        </span><span class="nv">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">limit</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">playerCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-152-20"><a id="__codelineno-152-20" name="__codelineno-152-20" href="#__codelineno-152-20"></a><span class="w">        </span><span class="nv">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">limit</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="__span-152-21"><a id="__codelineno-152-21" name="__codelineno-152-21" href="#__codelineno-152-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-152-22"><a id="__codelineno-152-22" name="__codelineno-152-22" href="#__codelineno-152-22"></a><span class="w">    </span><span class="c1">-- Check if limit is reached</span>
</span><span id="__span-152-23"><a id="__codelineno-152-23" name="__codelineno-152-23" href="#__codelineno-152-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-152-24"><a id="__codelineno-152-24" name="__codelineno-152-24" href="#__codelineno-152-24"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Faction limit reached (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-152-25"><a id="__codelineno-152-25" name="__codelineno-152-25" href="#__codelineno-152-25"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-152-26"><a id="__codelineno-152-26" name="__codelineno-152-26" href="#__codelineno-152-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-152-27"><a id="__codelineno-152-27" name="__codelineno-152-27" href="#__codelineno-152-27"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-152-28"><a id="__codelineno-152-28" name="__codelineno-152-28" href="#__codelineno-152-28"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="commandran">CommandRan</h3>
<p><strong>Purpose</strong></p>
<p>Called when a command is executed</p>
<p><strong>When Called</strong></p>
<p>After a command has been run by a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who ran the command</li>
<li><code>command</code> (<em>string</em>): The command that was executed</li>
<li><code>arguments</code> (<em>table</em>): The arguments passed to the command</li>
<li><code>results</code> (<em>any</em>): The results returned by the command</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="c1">-- Simple: Log command execution</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CommandRan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="nv">arguments</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; ran command: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">command</span><span class="p">)</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="c1">-- Medium: Track command usage</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CommandRan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CommandUsageTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="nv">arguments</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">commandCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;commandCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;commandCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">commandCount</span><span class="p">)</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="c1">-- High: Complex command execution tracking</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CommandRan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCommandTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="nv">arguments</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a><span class="w">    </span><span class="c1">-- Track command usage</span>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">commandCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;commandCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;commandCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">commandCount</span><span class="p">)</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a><span class="w">    </span><span class="c1">-- Track command history</span>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">commandHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;commandHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-155-10"><a id="__codelineno-155-10" name="__codelineno-155-10" href="#__codelineno-155-10"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">commandHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-155-11"><a id="__codelineno-155-11" name="__codelineno-155-11" href="#__codelineno-155-11"></a><span class="w">    </span><span class="nv">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span>
</span><span id="__span-155-12"><a id="__codelineno-155-12" name="__codelineno-155-12" href="#__codelineno-155-12"></a><span class="w">    </span><span class="nv">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">arguments</span><span class="p">,</span>
</span><span id="__span-155-13"><a id="__codelineno-155-13" name="__codelineno-155-13" href="#__codelineno-155-13"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-155-14"><a id="__codelineno-155-14" name="__codelineno-155-14" href="#__codelineno-155-14"></a><span class="w">    </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">results</span>
</span><span id="__span-155-15"><a id="__codelineno-155-15" name="__codelineno-155-15" href="#__codelineno-155-15"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-155-16"><a id="__codelineno-155-16" name="__codelineno-155-16" href="#__codelineno-155-16"></a><span class="w">    </span><span class="c1">-- Keep only last 50 commands</span>
</span><span id="__span-155-17"><a id="__codelineno-155-17" name="__codelineno-155-17" href="#__codelineno-155-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">commandHistory</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-155-18"><a id="__codelineno-155-18" name="__codelineno-155-18" href="#__codelineno-155-18"></a><span class="w">        </span><span class="nb">table.remove</span><span class="p">(</span><span class="nv">commandHistory</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-155-19"><a id="__codelineno-155-19" name="__codelineno-155-19" href="#__codelineno-155-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-155-20"><a id="__codelineno-155-20" name="__codelineno-155-20" href="#__codelineno-155-20"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;commandHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">commandHistory</span><span class="p">)</span>
</span><span id="__span-155-21"><a id="__codelineno-155-21" name="__codelineno-155-21" href="#__codelineno-155-21"></a><span class="w">    </span><span class="c1">-- Log command execution</span>
</span><span id="__span-155-22"><a id="__codelineno-155-22" name="__codelineno-155-22" href="#__codelineno-155-22"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;command&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="nb">table.concat</span><span class="p">(</span><span class="nv">arguments</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-155-23"><a id="__codelineno-155-23" name="__codelineno-155-23" href="#__codelineno-155-23"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s ran command: %s (Args: %d, Success: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-155-24"><a id="__codelineno-155-24" name="__codelineno-155-24" href="#__codelineno-155-24"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">command</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="nv">arguments</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">results</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="kc">false</span><span class="p">)))</span>
</span><span id="__span-155-25"><a id="__codelineno-155-25" name="__codelineno-155-25" href="#__codelineno-155-25"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="configchanged">ConfigChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a configuration value changes</p>
<p><strong>When Called</strong></p>
<p>When a config option is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>key</code> (<em>string</em>): The configuration key that changed</li>
<li><code>value</code> (<em>any</em>): The new value</li>
<li><code>oldValue</code> (<em>any</em>): The previous value</li>
<li><code>client</code> (<em>Player</em>): The player who changed the config (if applicable)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="c1">-- Simple: Log config changes</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ConfigChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">oldValue</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config changed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="c1">-- Medium: Handle specific config changes</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ConfigChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ConfigHandling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">oldValue</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;maxPlayers&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="w">    </span><span class="nv">game</span><span class="p">.</span><span class="py">MaxPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;serverName&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="w">    </span><span class="nf">RunConsoleCommand</span><span class="p">(</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="c1">-- High: Complex config change handling</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ConfigChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedConfigChange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">oldValue</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="c1">-- Log config change</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;config&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">oldValue</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; -&gt; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="c1">-- Handle specific config changes</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;maxPlayers&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="w">    </span><span class="nv">game</span><span class="p">.</span><span class="py">MaxPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max players updated to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;serverName&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="w">    </span><span class="nf">RunConsoleCommand</span><span class="p">(</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server name updated to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w">        </span><span class="nf">RunConsoleCommand</span><span class="p">(</span><span class="s2">&quot;sv_password&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server password set&quot;</span><span class="p">)</span>
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="w">        </span><span class="nf">RunConsoleCommand</span><span class="p">(</span><span class="s2">&quot;sv_password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server password removed&quot;</span><span class="p">)</span>
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[CONFIG] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; changed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-158-28"><a id="__codelineno-158-28" name="__codelineno-158-28" href="#__codelineno-158-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-158-29"><a id="__codelineno-158-29" name="__codelineno-158-29" href="#__codelineno-158-29"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="createcharacter">CreateCharacter</h3>
<p><strong>Purpose</strong></p>
<p>Called when creating a character</p>
<p><strong>When Called</strong></p>
<p>When a new character is being created</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>data</code> (<em>table</em>): The character creation data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="c1">-- Simple: Log character creation</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="c1">-- Medium: Add default items</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DefaultItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span><span class="p">)</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">)</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="c1">-- High: Complex character creation</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="c1">-- Add default items</span>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span><span class="p">)</span>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">)</span>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="c1">-- Add faction-specific items</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">},</span>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">}</span>
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a><span class="p">}</span>
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12" href="#__codelineno-161-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionItems</span><span class="p">[</span><span class="nv">data</span><span class="p">.</span><span class="py">faction</span><span class="p">]</span>
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13" href="#__codelineno-161-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-161-14"><a id="__codelineno-161-14" name="__codelineno-161-14" href="#__codelineno-161-14"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-161-15"><a id="__codelineno-161-15" name="__codelineno-161-15" href="#__codelineno-161-15"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-161-16"><a id="__codelineno-161-16" name="__codelineno-161-16" href="#__codelineno-161-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-161-17"><a id="__codelineno-161-17" name="__codelineno-161-17" href="#__codelineno-161-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-161-18"><a id="__codelineno-161-18" name="__codelineno-161-18" href="#__codelineno-161-18"></a><span class="c1">-- Set creation timestamp</span>
</span><span id="__span-161-19"><a id="__codelineno-161-19" name="__codelineno-161-19" href="#__codelineno-161-19"></a><span class="nv">data</span><span class="p">.</span><span class="py">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-161-20"><a id="__codelineno-161-20" name="__codelineno-161-20" href="#__codelineno-161-20"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; created with &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">#</span><span class="nv">data</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; items&quot;</span><span class="p">)</span>
</span><span id="__span-161-21"><a id="__codelineno-161-21" name="__codelineno-161-21" href="#__codelineno-161-21"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="createdefaultinventory">CreateDefaultInventory</h3>
<p><strong>Purpose</strong></p>
<p>Called to create a character's default inventory</p>
<p><strong>When Called</strong></p>
<p>When a new character needs an inventory created</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character receiving the inventory</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="c1">-- Simple: Log inventory creation</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateDefaultInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating inventory for: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="c1">-- Medium: Set inventory size based on faction</span>
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateDefaultInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
</span><span id="__span-163-6"><a id="__codelineno-163-6" name="__codelineno-163-6" href="#__codelineno-163-6"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
</span><span id="__span-163-7"><a id="__codelineno-163-7" name="__codelineno-163-7" href="#__codelineno-163-7"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-163-8"><a id="__codelineno-163-8" name="__codelineno-163-8" href="#__codelineno-163-8"></a><span class="p">}</span>
</span><span id="__span-163-9"><a id="__codelineno-163-9" name="__codelineno-163-9" href="#__codelineno-163-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sizes</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-163-10"><a id="__codelineno-163-10" name="__codelineno-163-10" href="#__codelineno-163-10"></a><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">setSize</span><span class="p">(</span><span class="nv">size</span><span class="p">.</span><span class="py">w</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="p">.</span><span class="py">h</span><span class="p">)</span>
</span><span id="__span-163-11"><a id="__codelineno-163-11" name="__codelineno-163-11" href="#__codelineno-163-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="c1">-- High: Complex inventory setup</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateDefaultInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInventorySetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="c1">-- Set inventory size based on faction</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sizes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="p">}</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sizes</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a><span class="nv">inv</span><span class="p">:</span><span class="nf">setSize</span><span class="p">(</span><span class="nv">size</span><span class="p">.</span><span class="py">w</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="p">.</span><span class="py">h</span><span class="p">)</span>
</span><span id="__span-164-13"><a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a><span class="c1">-- Set weight limits</span>
</span><span id="__span-164-14"><a id="__codelineno-164-14" name="__codelineno-164-14" href="#__codelineno-164-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-15"><a id="__codelineno-164-15" name="__codelineno-164-15" href="#__codelineno-164-15"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-164-16"><a id="__codelineno-164-16" name="__codelineno-164-16" href="#__codelineno-164-16"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span>
</span><span id="__span-164-17"><a id="__codelineno-164-17" name="__codelineno-164-17" href="#__codelineno-164-17"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-164-18"><a id="__codelineno-164-18" name="__codelineno-164-18" href="#__codelineno-164-18"></a><span class="p">}</span>
</span><span id="__span-164-19"><a id="__codelineno-164-19" name="__codelineno-164-19" href="#__codelineno-164-19"></a><span class="nv">inv</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">weights</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-164-20"><a id="__codelineno-164-20" name="__codelineno-164-20" href="#__codelineno-164-20"></a><span class="c1">-- Add starting items</span>
</span><span id="__span-164-21"><a id="__codelineno-164-21" name="__codelineno-164-21" href="#__codelineno-164-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">startingItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-22"><a id="__codelineno-164-22" name="__codelineno-164-22" href="#__codelineno-164-22"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">},</span>
</span><span id="__span-164-23"><a id="__codelineno-164-23" name="__codelineno-164-23" href="#__codelineno-164-23"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">},</span>
</span><span id="__span-164-24"><a id="__codelineno-164-24" name="__codelineno-164-24" href="#__codelineno-164-24"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wallet&quot;</span><span class="p">}</span>
</span><span id="__span-164-25"><a id="__codelineno-164-25" name="__codelineno-164-25" href="#__codelineno-164-25"></a><span class="p">}</span>
</span><span id="__span-164-26"><a id="__codelineno-164-26" name="__codelineno-164-26" href="#__codelineno-164-26"></a><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">startingItems</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-164-27"><a id="__codelineno-164-27" name="__codelineno-164-27" href="#__codelineno-164-27"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-164-28"><a id="__codelineno-164-28" name="__codelineno-164-28" href="#__codelineno-164-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-164-29"><a id="__codelineno-164-29" name="__codelineno-164-29" href="#__codelineno-164-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-164-30"><a id="__codelineno-164-30" name="__codelineno-164-30" href="#__codelineno-164-30"></a><span class="w">        </span><span class="nv">inv</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-164-31"><a id="__codelineno-164-31" name="__codelineno-164-31" href="#__codelineno-164-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-164-32"><a id="__codelineno-164-32" name="__codelineno-164-32" href="#__codelineno-164-32"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-164-33"><a id="__codelineno-164-33" name="__codelineno-164-33" href="#__codelineno-164-33"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inventory created for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">size</span><span class="p">.</span><span class="py">w</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">size</span><span class="p">.</span><span class="py">h</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-164-34"><a id="__codelineno-164-34" name="__codelineno-164-34" href="#__codelineno-164-34"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="createsalarytimers">CreateSalaryTimers</h3>
<p><strong>Purpose</strong></p>
<p>Called to create salary timers</p>
<p><strong>When Called</strong></p>
<p>When salary system is being initialized</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="c1">-- Simple: Create basic salary timer</span>
</span><span id="__span-165-2"><a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateSalaryTimers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-165-3"><a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;SalaryTimer&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-165-4"><a id="__codelineno-165-4" name="__codelineno-165-4" href="#__codelineno-165-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-165-5"><a id="__codelineno-165-5" name="__codelineno-165-5" href="#__codelineno-165-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-165-6"><a id="__codelineno-165-6" name="__codelineno-165-6" href="#__codelineno-165-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-165-7"><a id="__codelineno-165-7" name="__codelineno-165-7" href="#__codelineno-165-7"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">giveMoney</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-165-8"><a id="__codelineno-165-8" name="__codelineno-165-8" href="#__codelineno-165-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-165-9"><a id="__codelineno-165-9" name="__codelineno-165-9" href="#__codelineno-165-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-165-10"><a id="__codelineno-165-10" name="__codelineno-165-10" href="#__codelineno-165-10"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-165-11"><a id="__codelineno-165-11" name="__codelineno-165-11" href="#__codelineno-165-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="c1">-- Medium: Faction-based salary timers</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateSalaryTimers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionSalaryTimers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;SalaryTimer&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-166-7"><a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-166-8"><a id="__codelineno-166-8" name="__codelineno-166-8" href="#__codelineno-166-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-166-9"><a id="__codelineno-166-9" name="__codelineno-166-9" href="#__codelineno-166-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-166-10"><a id="__codelineno-166-10" name="__codelineno-166-10" href="#__codelineno-166-10"></a><span class="w">            </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span>
</span><span id="__span-166-11"><a id="__codelineno-166-11" name="__codelineno-166-11" href="#__codelineno-166-11"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-166-12"><a id="__codelineno-166-12" name="__codelineno-166-12" href="#__codelineno-166-12"></a><span class="w">            </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150</span>
</span><span id="__span-166-13"><a id="__codelineno-166-13" name="__codelineno-166-13" href="#__codelineno-166-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-166-14"><a id="__codelineno-166-14" name="__codelineno-166-14" href="#__codelineno-166-14"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">giveMoney</span><span class="p">(</span><span class="nv">salary</span><span class="p">)</span>
</span><span id="__span-166-15"><a id="__codelineno-166-15" name="__codelineno-166-15" href="#__codelineno-166-15"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You received $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">salary</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; salary&quot;</span><span class="p">)</span>
</span><span id="__span-166-16"><a id="__codelineno-166-16" name="__codelineno-166-16" href="#__codelineno-166-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-166-17"><a id="__codelineno-166-17" name="__codelineno-166-17" href="#__codelineno-166-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-166-18"><a id="__codelineno-166-18" name="__codelineno-166-18" href="#__codelineno-166-18"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-166-19"><a id="__codelineno-166-19" name="__codelineno-166-19" href="#__codelineno-166-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="c1">-- High: Complex salary timer system</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;CreateSalaryTimers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalaryTimers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;SalaryTimer&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-167-5"><a id="__codelineno-167-5" name="__codelineno-167-5" href="#__codelineno-167-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-167-6"><a id="__codelineno-167-6" name="__codelineno-167-6" href="#__codelineno-167-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">continue</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-167-7"><a id="__codelineno-167-7" name="__codelineno-167-7" href="#__codelineno-167-7"></a><span class="w">        </span><span class="c1">-- Check if player can earn salary</span>
</span><span id="__span-167-8"><a id="__codelineno-167-8" name="__codelineno-167-8" href="#__codelineno-167-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanPlayerEarnSalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-167-9"><a id="__codelineno-167-9" name="__codelineno-167-9" href="#__codelineno-167-9"></a><span class="w">            </span><span class="nv">continue</span>
</span><span id="__span-167-10"><a id="__codelineno-167-10" name="__codelineno-167-10" href="#__codelineno-167-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-167-11"><a id="__codelineno-167-11" name="__codelineno-167-11" href="#__codelineno-167-11"></a><span class="w">        </span><span class="c1">-- Calculate base salary</span>
</span><span id="__span-167-12"><a id="__codelineno-167-12" name="__codelineno-167-12" href="#__codelineno-167-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-167-13"><a id="__codelineno-167-13" name="__codelineno-167-13" href="#__codelineno-167-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseSalary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetSalaryAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-167-14"><a id="__codelineno-167-14" name="__codelineno-167-14" href="#__codelineno-167-14"></a><span class="w">        </span><span class="c1">-- Apply level bonus</span>
</span><span id="__span-167-15"><a id="__codelineno-167-15" name="__codelineno-167-15" href="#__codelineno-167-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-167-16"><a id="__codelineno-167-16" name="__codelineno-167-16" href="#__codelineno-167-16"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-167-17"><a id="__codelineno-167-17" name="__codelineno-167-17" href="#__codelineno-167-17"></a><span class="w">        </span><span class="c1">-- Apply rank bonus</span>
</span><span id="__span-167-18"><a id="__codelineno-167-18" name="__codelineno-167-18" href="#__codelineno-167-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-167-19"><a id="__codelineno-167-19" name="__codelineno-167-19" href="#__codelineno-167-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">rankBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">rank</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-167-20"><a id="__codelineno-167-20" name="__codelineno-167-20" href="#__codelineno-167-20"></a><span class="w">        </span><span class="c1">-- Calculate total salary</span>
</span><span id="__span-167-21"><a id="__codelineno-167-21" name="__codelineno-167-21" href="#__codelineno-167-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">totalSalary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseSalary</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">rankBonus</span>
</span><span id="__span-167-22"><a id="__codelineno-167-22" name="__codelineno-167-22" href="#__codelineno-167-22"></a><span class="w">        </span><span class="c1">-- Give salary</span>
</span><span id="__span-167-23"><a id="__codelineno-167-23" name="__codelineno-167-23" href="#__codelineno-167-23"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">giveMoney</span><span class="p">(</span><span class="nv">totalSalary</span><span class="p">)</span>
</span><span id="__span-167-24"><a id="__codelineno-167-24" name="__codelineno-167-24" href="#__codelineno-167-24"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You received $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">totalSalary</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; salary&quot;</span><span class="p">)</span>
</span><span id="__span-167-25"><a id="__codelineno-167-25" name="__codelineno-167-25" href="#__codelineno-167-25"></a><span class="w">        </span><span class="c1">-- Update statistics</span>
</span><span id="__span-167-26"><a id="__codelineno-167-26" name="__codelineno-167-26" href="#__codelineno-167-26"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">totalEarned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;totalSalaryEarned&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-167-27"><a id="__codelineno-167-27" name="__codelineno-167-27" href="#__codelineno-167-27"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;totalSalaryEarned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">totalEarned</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">totalSalary</span><span class="p">)</span>
</span><span id="__span-167-28"><a id="__codelineno-167-28" name="__codelineno-167-28" href="#__codelineno-167-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-167-29"><a id="__codelineno-167-29" name="__codelineno-167-29" href="#__codelineno-167-29"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-167-30"><a id="__codelineno-167-30" name="__codelineno-167-30" href="#__codelineno-167-30"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="databaseconnected">DatabaseConnected</h3>
<p><strong>Purpose</strong></p>
<p>Called when database is connected</p>
<p><strong>When Called</strong></p>
<p>When the database connection is established</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="c1">-- Simple: Log connection</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DatabaseConnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database connected&quot;</span><span class="p">)</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="c1">-- Medium: Initialize tables</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DatabaseConnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DatabaseInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS custom_data (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">)</span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database connected and tables initialized&quot;</span><span class="p">)</span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="c1">-- High: Complex database initialization</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DatabaseConnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDatabaseInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a><span class="c1">-- Create tables</span>
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4" href="#__codelineno-170-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-170-5"><a id="__codelineno-170-5" name="__codelineno-170-5" href="#__codelineno-170-5"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS custom_data (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">,</span>
</span><span id="__span-170-6"><a id="__codelineno-170-6" name="__codelineno-170-6" href="#__codelineno-170-6"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS player_stats (steamid TEXT PRIMARY KEY, kills INTEGER, deaths INTEGER)&quot;</span><span class="p">,</span>
</span><span id="__span-170-7"><a id="__codelineno-170-7" name="__codelineno-170-7" href="#__codelineno-170-7"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS achievements (id INTEGER PRIMARY KEY, name TEXT, description TEXT)&quot;</span>
</span><span id="__span-170-8"><a id="__codelineno-170-8" name="__codelineno-170-8" href="#__codelineno-170-8"></a><span class="p">}</span>
</span><span id="__span-170-9"><a id="__codelineno-170-9" name="__codelineno-170-9" href="#__codelineno-170-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">tables</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-170-10"><a id="__codelineno-170-10" name="__codelineno-170-10" href="#__codelineno-170-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">query</span><span class="p">)</span>
</span><span id="__span-170-11"><a id="__codelineno-170-11" name="__codelineno-170-11" href="#__codelineno-170-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-170-12"><a id="__codelineno-170-12" name="__codelineno-170-12" href="#__codelineno-170-12"></a><span class="c1">-- Create indexes</span>
</span><span id="__span-170-13"><a id="__codelineno-170-13" name="__codelineno-170-13" href="#__codelineno-170-13"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE INDEX IF NOT EXISTS idx_player_stats_steamid ON player_stats(steamid)&quot;</span><span class="p">)</span>
</span><span id="__span-170-14"><a id="__codelineno-170-14" name="__codelineno-170-14" href="#__codelineno-170-14"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database connected and fully initialized&quot;</span><span class="p">)</span>
</span><span id="__span-170-15"><a id="__codelineno-170-15" name="__codelineno-170-15" href="#__codelineno-170-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="deletecharacter">DeleteCharacter</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is deleted</p>
<p><strong>When Called</strong></p>
<p>When a character deletion is processed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>id</code> (<em>number</em>): The character ID being deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="c1">-- Simple: Log deletion</span>
</span><span id="__span-171-2"><a id="__codelineno-171-2" name="__codelineno-171-2" href="#__codelineno-171-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DeleteCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-171-3"><a id="__codelineno-171-3" name="__codelineno-171-3" href="#__codelineno-171-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted&quot;</span><span class="p">)</span>
</span><span id="__span-171-4"><a id="__codelineno-171-4" name="__codelineno-171-4" href="#__codelineno-171-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="c1">-- Medium: Clean up character data</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DeleteCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharacterCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM character_items WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM character_stats WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted and data cleaned up&quot;</span><span class="p">)</span>
</span><span id="__span-172-6"><a id="__codelineno-172-6" name="__codelineno-172-6" href="#__codelineno-172-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="c1">-- High: Complex character deletion system</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DeleteCharacter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharacterDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a><span class="c1">-- Clean up character data</span>
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM character_items WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM character_stats WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM character_achievements WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a><span class="c1">-- Archive character data</span>
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO character_archive SELECT * FROM characters WHERE id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-173-10"><a id="__codelineno-173-10" name="__codelineno-173-10" href="#__codelineno-173-10"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-173-11"><a id="__codelineno-173-11" name="__codelineno-173-11" href="#__codelineno-173-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-173-12"><a id="__codelineno-173-12" name="__codelineno-173-12" href="#__codelineno-173-12"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been deleted&quot;</span><span class="p">)</span>
</span><span id="__span-173-13"><a id="__codelineno-173-13" name="__codelineno-173-13" href="#__codelineno-173-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-173-14"><a id="__codelineno-173-14" name="__codelineno-173-14" href="#__codelineno-173-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-173-15"><a id="__codelineno-173-15" name="__codelineno-173-15" href="#__codelineno-173-15"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted and archived&quot;</span><span class="p">)</span>
</span><span id="__span-173-16"><a id="__codelineno-173-16" name="__codelineno-173-16" href="#__codelineno-173-16"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="discordrelaysend">DiscordRelaySend</h3>
<p><strong>Purpose</strong></p>
<p>Called to send a Discord relay message</p>
<p><strong>When Called</strong></p>
<p>When sending a message to Discord</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>embed</code> (<em>table</em>): The Discord embed data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="c1">-- Simple: Log Discord send</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelaySend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending Discord message: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;No title&quot;</span><span class="p">))</span>
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="c1">-- Medium: Add server info to embed</span>
</span><span id="__span-175-2"><a id="__codelineno-175-2" name="__codelineno-175-2" href="#__codelineno-175-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelaySend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DiscordServerInfo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-175-3"><a id="__codelineno-175-3" name="__codelineno-175-3" href="#__codelineno-175-3"></a><span class="nv">embed</span><span class="p">.</span><span class="py">footer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-175-4"><a id="__codelineno-175-4" name="__codelineno-175-4" href="#__codelineno-175-4"></a><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Server: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nf">GetHostName</span><span class="p">()</span>
</span><span id="__span-175-5"><a id="__codelineno-175-5" name="__codelineno-175-5" href="#__codelineno-175-5"></a><span class="p">}</span>
</span><span id="__span-175-6"><a id="__codelineno-175-6" name="__codelineno-175-6" href="#__codelineno-175-6"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending Discord message with server info&quot;</span><span class="p">)</span>
</span><span id="__span-175-7"><a id="__codelineno-175-7" name="__codelineno-175-7" href="#__codelineno-175-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="c1">-- High: Complex Discord relay system</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelaySend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDiscordRelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="c1">-- Add server info</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="nv">embed</span><span class="p">.</span><span class="py">footer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Server: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nf">GetHostName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; | Players: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">#</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-176-6"><a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a><span class="p">}</span>
</span><span id="__span-176-7"><a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="c1">-- Add timestamp if not present</span>
</span><span id="__span-176-8"><a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">embed</span><span class="p">.</span><span class="py">timestamp</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-176-9"><a id="__codelineno-176-9" name="__codelineno-176-9" href="#__codelineno-176-9"></a><span class="w">    </span><span class="nv">embed</span><span class="p">.</span><span class="py">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;!%Y-%m-%dT%H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="__span-176-10"><a id="__codelineno-176-10" name="__codelineno-176-10" href="#__codelineno-176-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-176-11"><a id="__codelineno-176-11" name="__codelineno-176-11" href="#__codelineno-176-11"></a><span class="c1">-- Add color based on type</span>
</span><span id="__span-176-12"><a id="__codelineno-176-12" name="__codelineno-176-12" href="#__codelineno-176-12"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">embed</span><span class="p">.</span><span class="py">color</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-176-13"><a id="__codelineno-176-13" name="__codelineno-176-13" href="#__codelineno-176-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Error&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-176-14"><a id="__codelineno-176-14" name="__codelineno-176-14" href="#__codelineno-176-14"></a><span class="w">        </span><span class="nv">embed</span><span class="p">.</span><span class="py">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16711680</span><span class="w"> </span><span class="c1">-- Red</span>
</span><span id="__span-176-15"><a id="__codelineno-176-15" name="__codelineno-176-15" href="#__codelineno-176-15"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-176-16"><a id="__codelineno-176-16" name="__codelineno-176-16" href="#__codelineno-176-16"></a><span class="w">        </span><span class="nv">embed</span><span class="p">.</span><span class="py">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16776960</span><span class="w"> </span><span class="c1">-- Yellow</span>
</span><span id="__span-176-17"><a id="__codelineno-176-17" name="__codelineno-176-17" href="#__codelineno-176-17"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-176-18"><a id="__codelineno-176-18" name="__codelineno-176-18" href="#__codelineno-176-18"></a><span class="w">        </span><span class="nv">embed</span><span class="p">.</span><span class="py">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65280</span><span class="w"> </span><span class="c1">-- Green</span>
</span><span id="__span-176-19"><a id="__codelineno-176-19" name="__codelineno-176-19" href="#__codelineno-176-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-176-20"><a id="__codelineno-176-20" name="__codelineno-176-20" href="#__codelineno-176-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-176-21"><a id="__codelineno-176-21" name="__codelineno-176-21" href="#__codelineno-176-21"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending Discord message: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;No title&quot;</span><span class="p">))</span>
</span><span id="__span-176-22"><a id="__codelineno-176-22" name="__codelineno-176-22" href="#__codelineno-176-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="discordrelayunavailable">DiscordRelayUnavailable</h3>
<p><strong>Purpose</strong></p>
<p>Called when Discord relay is unavailable</p>
<p><strong>When Called</strong></p>
<p>When Discord relay connection fails</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="c1">-- Simple: Log unavailability</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayUnavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-177-3"><a id="__codelineno-177-3" name="__codelineno-177-3" href="#__codelineno-177-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Discord relay is unavailable&quot;</span><span class="p">)</span>
</span><span id="__span-177-4"><a id="__codelineno-177-4" name="__codelineno-177-4" href="#__codelineno-177-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="c1">-- Medium: Notify admins</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayUnavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DiscordNotify&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4" href="#__codelineno-178-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5" href="#__codelineno-178-5"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Discord relay is unavailable&quot;</span><span class="p">)</span>
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6" href="#__codelineno-178-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7" href="#__codelineno-178-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8" href="#__codelineno-178-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="c1">-- High: Complex Discord failover system</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayUnavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDiscordFailover&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3" href="#__codelineno-179-3"></a><span class="c1">-- Log to file</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4" href="#__codelineno-179-4"></a><span class="nv">file</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s2">&quot;discord_errors.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.date</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: Discord relay unavailable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-179-5"><a id="__codelineno-179-5" name="__codelineno-179-5" href="#__codelineno-179-5"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-179-6"><a id="__codelineno-179-6" name="__codelineno-179-6" href="#__codelineno-179-6"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-179-7"><a id="__codelineno-179-7" name="__codelineno-179-7" href="#__codelineno-179-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-179-8"><a id="__codelineno-179-8" name="__codelineno-179-8" href="#__codelineno-179-8"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ERROR] Discord relay is unavailable&quot;</span><span class="p">)</span>
</span><span id="__span-179-9"><a id="__codelineno-179-9" name="__codelineno-179-9" href="#__codelineno-179-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-179-10"><a id="__codelineno-179-10" name="__codelineno-179-10" href="#__codelineno-179-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-179-11"><a id="__codelineno-179-11" name="__codelineno-179-11" href="#__codelineno-179-11"></a><span class="c1">-- Attempt reconnection</span>
</span><span id="__span-179-12"><a id="__codelineno-179-12" name="__codelineno-179-12" href="#__codelineno-179-12"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-179-13"><a id="__codelineno-179-13" name="__codelineno-179-13" href="#__codelineno-179-13"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Attempting to reconnect Discord relay...&quot;</span><span class="p">)</span>
</span><span id="__span-179-14"><a id="__codelineno-179-14" name="__codelineno-179-14" href="#__codelineno-179-14"></a><span class="c1">-- Reconnection logic here</span>
</span><span id="__span-179-15"><a id="__codelineno-179-15" name="__codelineno-179-15" href="#__codelineno-179-15"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-179-16"><a id="__codelineno-179-16" name="__codelineno-179-16" href="#__codelineno-179-16"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="discordrelayed">DiscordRelayed</h3>
<p><strong>Purpose</strong></p>
<p>Called when a message is relayed to Discord</p>
<p><strong>When Called</strong></p>
<p>After a message is successfully sent to Discord</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>embed</code> (<em>table</em>): The Discord embed that was sent</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="c1">-- Simple: Log successful relay</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-180-3"><a id="__codelineno-180-3" name="__codelineno-180-3" href="#__codelineno-180-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message relayed to Discord&quot;</span><span class="p">)</span>
</span><span id="__span-180-4"><a id="__codelineno-180-4" name="__codelineno-180-4" href="#__codelineno-180-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="c1">-- Medium: Track relay statistics</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DiscordStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">relayCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;discordRelayCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-181-4"><a id="__codelineno-181-4" name="__codelineno-181-4" href="#__codelineno-181-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;discordRelayCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">relayCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-181-5"><a id="__codelineno-181-5" name="__codelineno-181-5" href="#__codelineno-181-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message relayed to Discord (Total: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">relayCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-181-6"><a id="__codelineno-181-6" name="__codelineno-181-6" href="#__codelineno-181-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="c1">-- High: Complex Discord relay tracking</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DiscordRelayed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDiscordTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">embed</span><span class="p">)</span>
</span><span id="__span-182-3"><a id="__codelineno-182-3" name="__codelineno-182-3" href="#__codelineno-182-3"></a><span class="c1">-- Update statistics</span>
</span><span id="__span-182-4"><a id="__codelineno-182-4" name="__codelineno-182-4" href="#__codelineno-182-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">relayCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;discordRelayCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-182-5"><a id="__codelineno-182-5" name="__codelineno-182-5" href="#__codelineno-182-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;discordRelayCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">relayCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-182-6"><a id="__codelineno-182-6" name="__codelineno-182-6" href="#__codelineno-182-6"></a><span class="c1">-- Log to database</span>
</span><span id="__span-182-7"><a id="__codelineno-182-7" name="__codelineno-182-7" href="#__codelineno-182-7"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO discord_logs (timestamp, title, description) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-182-8"><a id="__codelineno-182-8" name="__codelineno-182-8" href="#__codelineno-182-8"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;No title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">embed</span><span class="p">.</span><span class="py">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;No description&quot;</span><span class="p">)</span>
</span><span id="__span-182-9"><a id="__codelineno-182-9" name="__codelineno-182-9" href="#__codelineno-182-9"></a><span class="c1">-- Track relay types</span>
</span><span id="__span-182-10"><a id="__codelineno-182-10" name="__codelineno-182-10" href="#__codelineno-182-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">relayTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;discordRelayTypes&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-182-11"><a id="__codelineno-182-11" name="__codelineno-182-11" href="#__codelineno-182-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">msgType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">embed</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span>
</span><span id="__span-182-12"><a id="__codelineno-182-12" name="__codelineno-182-12" href="#__codelineno-182-12"></a><span class="nv">relayTypes</span><span class="p">[</span><span class="nv">msgType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">relayTypes</span><span class="p">[</span><span class="nv">msgType</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-182-13"><a id="__codelineno-182-13" name="__codelineno-182-13" href="#__codelineno-182-13"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;discordRelayTypes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">relayTypes</span><span class="p">)</span>
</span><span id="__span-182-14"><a id="__codelineno-182-14" name="__codelineno-182-14" href="#__codelineno-182-14"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message relayed to Discord: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">msgType</span><span class="p">)</span>
</span><span id="__span-182-15"><a id="__codelineno-182-15" name="__codelineno-182-15" href="#__codelineno-182-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doorenabledtoggled">DoorEnabledToggled</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's enabled state is toggled</p>
<p><strong>When Called</strong></p>
<p>When a door is enabled or disabled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player toggling the state</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>newState</code> (<em>boolean</em>): The new enabled state</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a><span class="c1">-- Simple: Log door state change</span>
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2" href="#__codelineno-183-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorEnabledToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3" href="#__codelineno-183-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set door to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;disabled&quot;</span><span class="p">))</span>
</span><span id="__span-183-4"><a id="__codelineno-183-4" name="__codelineno-183-4" href="#__codelineno-183-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="c1">-- Medium: Notify nearby players</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorEnabledToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorStateNotify&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-184-6"><a id="__codelineno-184-6" name="__codelineno-184-6" href="#__codelineno-184-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door has been &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;disabled&quot;</span><span class="p">))</span>
</span><span id="__span-184-7"><a id="__codelineno-184-7" name="__codelineno-184-7" href="#__codelineno-184-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-184-8"><a id="__codelineno-184-8" name="__codelineno-184-8" href="#__codelineno-184-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-184-9"><a id="__codelineno-184-9" name="__codelineno-184-9" href="#__codelineno-184-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a><span class="c1">-- High: Complex door state management</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorEnabledToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorState&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3" href="#__codelineno-185-3"></a><span class="c1">-- Log the change</span>
</span><span id="__span-185-4"><a id="__codelineno-185-4" name="__codelineno-185-4" href="#__codelineno-185-4"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set door to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;disabled&quot;</span><span class="p">))</span>
</span><span id="__span-185-5"><a id="__codelineno-185-5" name="__codelineno-185-5" href="#__codelineno-185-5"></a><span class="c1">-- Update door data</span>
</span><span id="__span-185-6"><a id="__codelineno-185-6" name="__codelineno-185-6" href="#__codelineno-185-6"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-185-7"><a id="__codelineno-185-7" name="__codelineno-185-7" href="#__codelineno-185-7"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-185-8"><a id="__codelineno-185-8" name="__codelineno-185-8" href="#__codelineno-185-8"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastToggledBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-185-9"><a id="__codelineno-185-9" name="__codelineno-185-9" href="#__codelineno-185-9"></a><span class="c1">-- Notify nearby players</span>
</span><span id="__span-185-10"><a id="__codelineno-185-10" name="__codelineno-185-10" href="#__codelineno-185-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-185-11"><a id="__codelineno-185-11" name="__codelineno-185-11" href="#__codelineno-185-11"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-185-12"><a id="__codelineno-185-12" name="__codelineno-185-12" href="#__codelineno-185-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-185-13"><a id="__codelineno-185-13" name="__codelineno-185-13" href="#__codelineno-185-13"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; a door&quot;</span><span class="p">)</span>
</span><span id="__span-185-14"><a id="__codelineno-185-14" name="__codelineno-185-14" href="#__codelineno-185-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-185-15"><a id="__codelineno-185-15" name="__codelineno-185-15" href="#__codelineno-185-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-185-16"><a id="__codelineno-185-16" name="__codelineno-185-16" href="#__codelineno-185-16"></a><span class="c1">-- Log to database</span>
</span><span id="__span-185-17"><a id="__codelineno-185-17" name="__codelineno-185-17" href="#__codelineno-185-17"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_logs (timestamp, steamid, doorid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-185-18"><a id="__codelineno-185-18" name="__codelineno-185-18" href="#__codelineno-185-18"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">MapCreationID</span><span class="p">(),</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>
</span><span id="__span-185-19"><a id="__codelineno-185-19" name="__codelineno-185-19" href="#__codelineno-185-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doorhiddentoggled">DoorHiddenToggled</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's hidden state is toggled</p>
<p><strong>When Called</strong></p>
<p>When a door is made hidden or visible</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player toggling the door visibility</li>
<li><code>entity</code> (<em>Entity</em>): The door entity</li>
<li><code>newState</code> (<em>boolean</em>): The new hidden state</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="c1">-- Simple: Log door visibility change</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorHiddenToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; toggled door visibility to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">newState</span><span class="p">))</span>
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a><span class="c1">-- Medium: Notify nearby players</span>
</span><span id="__span-187-2"><a id="__codelineno-187-2" name="__codelineno-187-2" href="#__codelineno-187-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorHiddenToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyDoorVisibility&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-187-3"><a id="__codelineno-187-3" name="__codelineno-187-3" href="#__codelineno-187-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-187-4"><a id="__codelineno-187-4" name="__codelineno-187-4" href="#__codelineno-187-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-187-5"><a id="__codelineno-187-5" name="__codelineno-187-5" href="#__codelineno-187-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-187-6"><a id="__codelineno-187-6" name="__codelineno-187-6" href="#__codelineno-187-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door has been &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;hidden&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;made visible&quot;</span><span class="p">))</span>
</span><span id="__span-187-7"><a id="__codelineno-187-7" name="__codelineno-187-7" href="#__codelineno-187-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-187-8"><a id="__codelineno-187-8" name="__codelineno-187-8" href="#__codelineno-187-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-187-9"><a id="__codelineno-187-9" name="__codelineno-187-9" href="#__codelineno-187-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="c1">-- High: Complex door visibility system</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorHiddenToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorVisibility&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="c1">-- Update door data</span>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastToggledBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a><span class="c1">-- Log to database</span>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_logs (timestamp, steamid, doorid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">MapCreationID</span><span class="p">(),</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;hidden&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unhidden&quot;</span><span class="p">)</span>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="c1">-- Notify nearby players</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-188-14"><a id="__codelineno-188-14" name="__codelineno-188-14" href="#__codelineno-188-14"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;hid&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unhid&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; a door&quot;</span><span class="p">)</span>
</span><span id="__span-188-15"><a id="__codelineno-188-15" name="__codelineno-188-15" href="#__codelineno-188-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-188-16"><a id="__codelineno-188-16" name="__codelineno-188-16" href="#__codelineno-188-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-188-17"><a id="__codelineno-188-17" name="__codelineno-188-17" href="#__codelineno-188-17"></a><span class="c1">-- Update door physics</span>
</span><span id="__span-188-18"><a id="__codelineno-188-18" name="__codelineno-188-18" href="#__codelineno-188-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-188-19"><a id="__codelineno-188-19" name="__codelineno-188-19" href="#__codelineno-188-19"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-188-20"><a id="__codelineno-188-20" name="__codelineno-188-20" href="#__codelineno-188-20"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetCollisionGroup</span><span class="p">(</span><span class="nv">COLLISION_GROUP_IN_VEHICLE</span><span class="p">)</span>
</span><span id="__span-188-21"><a id="__codelineno-188-21" name="__codelineno-188-21" href="#__codelineno-188-21"></a><span class="kr">else</span>
</span><span id="__span-188-22"><a id="__codelineno-188-22" name="__codelineno-188-22" href="#__codelineno-188-22"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-188-23"><a id="__codelineno-188-23" name="__codelineno-188-23" href="#__codelineno-188-23"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetCollisionGroup</span><span class="p">(</span><span class="nv">COLLISION_GROUP_NONE</span><span class="p">)</span>
</span><span id="__span-188-24"><a id="__codelineno-188-24" name="__codelineno-188-24" href="#__codelineno-188-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-188-25"><a id="__codelineno-188-25" name="__codelineno-188-25" href="#__codelineno-188-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doorlocktoggled">DoorLockToggled</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's lock state is toggled</p>
<p><strong>When Called</strong></p>
<p>When a door is locked or unlocked</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player toggling the door lock</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>state</code> (<em>boolean</em>): True if locked, false if unlocked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a><span class="c1">-- Simple: Log door lock changes</span>
</span><span id="__span-189-2"><a id="__codelineno-189-2" name="__codelineno-189-2" href="#__codelineno-189-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorLockToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-189-3"><a id="__codelineno-189-3" name="__codelineno-189-3" href="#__codelineno-189-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span>
</span><span id="__span-189-4"><a id="__codelineno-189-4" name="__codelineno-189-4" href="#__codelineno-189-4"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; door &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-189-5"><a id="__codelineno-189-5" name="__codelineno-189-5" href="#__codelineno-189-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="c1">-- Medium: Track door lock statistics</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorLockToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="nv">doorData</span><span class="p">.</span><span class="py">lockCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">doorData</span><span class="p">.</span><span class="py">lockCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-190-5"><a id="__codelineno-190-5" name="__codelineno-190-5" href="#__codelineno-190-5"></a><span class="nv">doorData</span><span class="p">.</span><span class="py">lastLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-190-6"><a id="__codelineno-190-6" name="__codelineno-190-6" href="#__codelineno-190-6"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-190-7"><a id="__codelineno-190-7" name="__codelineno-190-7" href="#__codelineno-190-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-190-8"><a id="__codelineno-190-8" name="__codelineno-190-8" href="#__codelineno-190-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-190-9"><a id="__codelineno-190-9" name="__codelineno-190-9" href="#__codelineno-190-9"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-190-10"><a id="__codelineno-190-10" name="__codelineno-190-10" href="#__codelineno-190-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-190-11"><a id="__codelineno-190-11" name="__codelineno-190-11" href="#__codelineno-190-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="c1">-- High: Complex door locking system</span>
</span><span id="__span-191-2"><a id="__codelineno-191-2" name="__codelineno-191-2" href="#__codelineno-191-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorLockToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorLocking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-191-3"><a id="__codelineno-191-3" name="__codelineno-191-3" href="#__codelineno-191-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-191-4"><a id="__codelineno-191-4" name="__codelineno-191-4" href="#__codelineno-191-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-191-5"><a id="__codelineno-191-5" name="__codelineno-191-5" href="#__codelineno-191-5"></a><span class="w">    </span><span class="c1">-- Check if player has permission to lock doors</span>
</span><span id="__span-191-6"><a id="__codelineno-191-6" name="__codelineno-191-6" href="#__codelineno-191-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-191-7"><a id="__codelineno-191-7" name="__codelineno-191-7" href="#__codelineno-191-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to lock doors&quot;</span><span class="p">)</span>
</span><span id="__span-191-8"><a id="__codelineno-191-8" name="__codelineno-191-8" href="#__codelineno-191-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-191-9"><a id="__codelineno-191-9" name="__codelineno-191-9" href="#__codelineno-191-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-191-10"><a id="__codelineno-191-10" name="__codelineno-191-10" href="#__codelineno-191-10"></a><span class="w">    </span><span class="c1">-- Check if door is owned by player</span>
</span><span id="__span-191-11"><a id="__codelineno-191-11" name="__codelineno-191-11" href="#__codelineno-191-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-191-12"><a id="__codelineno-191-12" name="__codelineno-191-12" href="#__codelineno-191-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-191-13"><a id="__codelineno-191-13" name="__codelineno-191-13" href="#__codelineno-191-13"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this door&quot;</span><span class="p">)</span>
</span><span id="__span-191-14"><a id="__codelineno-191-14" name="__codelineno-191-14" href="#__codelineno-191-14"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-191-15"><a id="__codelineno-191-15" name="__codelineno-191-15" href="#__codelineno-191-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-191-16"><a id="__codelineno-191-16" name="__codelineno-191-16" href="#__codelineno-191-16"></a><span class="w">    </span><span class="c1">-- Check for lock cooldown</span>
</span><span id="__span-191-17"><a id="__codelineno-191-17" name="__codelineno-191-17" href="#__codelineno-191-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastDoorLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-191-18"><a id="__codelineno-191-18" name="__codelineno-191-18" href="#__codelineno-191-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lockCooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1">-- 5 seconds</span>
</span><span id="__span-191-19"><a id="__codelineno-191-19" name="__codelineno-191-19" href="#__codelineno-191-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastLock</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">lockCooldown</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-191-20"><a id="__codelineno-191-20" name="__codelineno-191-20" href="#__codelineno-191-20"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before locking another door&quot;</span><span class="p">)</span>
</span><span id="__span-191-21"><a id="__codelineno-191-21" name="__codelineno-191-21" href="#__codelineno-191-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-191-22"><a id="__codelineno-191-22" name="__codelineno-191-22" href="#__codelineno-191-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-191-23"><a id="__codelineno-191-23" name="__codelineno-191-23" href="#__codelineno-191-23"></a><span class="w">    </span><span class="c1">-- Update door data</span>
</span><span id="__span-191-24"><a id="__codelineno-191-24" name="__codelineno-191-24" href="#__codelineno-191-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-191-25"><a id="__codelineno-191-25" name="__codelineno-191-25" href="#__codelineno-191-25"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">lockCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">doorData</span><span class="p">.</span><span class="py">lockCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-191-26"><a id="__codelineno-191-26" name="__codelineno-191-26" href="#__codelineno-191-26"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">lastLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-191-27"><a id="__codelineno-191-27" name="__codelineno-191-27" href="#__codelineno-191-27"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">lockedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span>
</span><span id="__span-191-28"><a id="__codelineno-191-28" name="__codelineno-191-28" href="#__codelineno-191-28"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-191-29"><a id="__codelineno-191-29" name="__codelineno-191-29" href="#__codelineno-191-29"></a><span class="w">    </span><span class="c1">-- Update character statistics</span>
</span><span id="__span-191-30"><a id="__codelineno-191-30" name="__codelineno-191-30" href="#__codelineno-191-30"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-191-31"><a id="__codelineno-191-31" name="__codelineno-191-31" href="#__codelineno-191-31"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastDoorLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-191-32"><a id="__codelineno-191-32" name="__codelineno-191-32" href="#__codelineno-191-32"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-191-33"><a id="__codelineno-191-33" name="__codelineno-191-33" href="#__codelineno-191-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorsLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-191-34"><a id="__codelineno-191-34" name="__codelineno-191-34" href="#__codelineno-191-34"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorsLocked</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_locksmith&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-191-35"><a id="__codelineno-191-35" name="__codelineno-191-35" href="#__codelineno-191-35"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_locksmith&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-191-36"><a id="__codelineno-191-36" name="__codelineno-191-36" href="#__codelineno-191-36"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Locksmith!&quot;</span><span class="p">)</span>
</span><span id="__span-191-37"><a id="__codelineno-191-37" name="__codelineno-191-37" href="#__codelineno-191-37"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-191-38"><a id="__codelineno-191-38" name="__codelineno-191-38" href="#__codelineno-191-38"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-191-39"><a id="__codelineno-191-39" name="__codelineno-191-39" href="#__codelineno-191-39"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-191-40"><a id="__codelineno-191-40" name="__codelineno-191-40" href="#__codelineno-191-40"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-191-41"><a id="__codelineno-191-41" name="__codelineno-191-41" href="#__codelineno-191-41"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span>
</span><span id="__span-191-42"><a id="__codelineno-191-42" name="__codelineno-191-42" href="#__codelineno-191-42"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; a door&quot;</span><span class="p">)</span>
</span><span id="__span-191-43"><a id="__codelineno-191-43" name="__codelineno-191-43" href="#__codelineno-191-43"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-191-44"><a id="__codelineno-191-44" name="__codelineno-191-44" href="#__codelineno-191-44"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-191-45"><a id="__codelineno-191-45" name="__codelineno-191-45" href="#__codelineno-191-45"></a><span class="w">    </span><span class="c1">-- Log door lock</span>
</span><span id="__span-191-46"><a id="__codelineno-191-46" name="__codelineno-191-46" href="#__codelineno-191-46"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s %s door %s at %s&quot;</span><span class="p">,</span>
</span><span id="__span-191-47"><a id="__codelineno-191-47" name="__codelineno-191-47" href="#__codelineno-191-47"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="__span-191-48"><a id="__codelineno-191-48" name="__codelineno-191-48" href="#__codelineno-191-48"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doorownabletoggled">DoorOwnableToggled</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's ownable status is toggled</p>
<p><strong>When Called</strong></p>
<p>When a door is set to be ownable or not ownable</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player toggling the ownable status</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>newState</code> (<em>boolean</em>): The new ownable state (true = ownable, false = not ownable)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a><span class="c1">-- Simple: Log ownable toggle</span>
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2" href="#__codelineno-192-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorOwnableToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3" href="#__codelineno-192-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set door ownable to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">newState</span><span class="p">))</span>
</span><span id="__span-192-4"><a id="__codelineno-192-4" name="__codelineno-192-4" href="#__codelineno-192-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a><span class="c1">-- Medium: Handle ownable state changes</span>
</span><span id="__span-193-2"><a id="__codelineno-193-2" name="__codelineno-193-2" href="#__codelineno-193-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorOwnableToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;OwnableHandling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-193-3"><a id="__codelineno-193-3" name="__codelineno-193-3" href="#__codelineno-193-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">doorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-193-4"><a id="__codelineno-193-4" name="__codelineno-193-4" href="#__codelineno-193-4"></a><span class="nv">doorData</span><span class="p">.</span><span class="py">ownable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newState</span>
</span><span id="__span-193-5"><a id="__codelineno-193-5" name="__codelineno-193-5" href="#__codelineno-193-5"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-193-6"><a id="__codelineno-193-6" name="__codelineno-193-6" href="#__codelineno-193-6"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-193-7"><a id="__codelineno-193-7" name="__codelineno-193-7" href="#__codelineno-193-7"></a><span class="w">    </span><span class="c1">-- Clear owner when door becomes non-ownable</span>
</span><span id="__span-193-8"><a id="__codelineno-193-8" name="__codelineno-193-8" href="#__codelineno-193-8"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-193-9"><a id="__codelineno-193-9" name="__codelineno-193-9" href="#__codelineno-193-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-193-10"><a id="__codelineno-193-10" name="__codelineno-193-10" href="#__codelineno-193-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a><span class="c1">-- High: Complex ownable toggle system</span>
</span><span id="__span-194-2"><a id="__codelineno-194-2" name="__codelineno-194-2" href="#__codelineno-194-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorOwnableToggled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedOwnableToggle&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">newState</span><span class="p">)</span>
</span><span id="__span-194-3"><a id="__codelineno-194-3" name="__codelineno-194-3" href="#__codelineno-194-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-194-4"><a id="__codelineno-194-4" name="__codelineno-194-4" href="#__codelineno-194-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-194-5"><a id="__codelineno-194-5" name="__codelineno-194-5" href="#__codelineno-194-5"></a><span class="w">    </span><span class="c1">-- Update door data</span>
</span><span id="__span-194-6"><a id="__codelineno-194-6" name="__codelineno-194-6" href="#__codelineno-194-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-194-7"><a id="__codelineno-194-7" name="__codelineno-194-7" href="#__codelineno-194-7"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">ownable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newState</span>
</span><span id="__span-194-8"><a id="__codelineno-194-8" name="__codelineno-194-8" href="#__codelineno-194-8"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">ownableChangedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span>
</span><span id="__span-194-9"><a id="__codelineno-194-9" name="__codelineno-194-9" href="#__codelineno-194-9"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">ownableChangedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-194-10"><a id="__codelineno-194-10" name="__codelineno-194-10" href="#__codelineno-194-10"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-194-11"><a id="__codelineno-194-11" name="__codelineno-194-11" href="#__codelineno-194-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">newState</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-194-12"><a id="__codelineno-194-12" name="__codelineno-194-12" href="#__codelineno-194-12"></a><span class="w">        </span><span class="c1">-- Clear owner and related data</span>
</span><span id="__span-194-13"><a id="__codelineno-194-13" name="__codelineno-194-13" href="#__codelineno-194-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-194-14"><a id="__codelineno-194-14" name="__codelineno-194-14" href="#__codelineno-194-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-194-15"><a id="__codelineno-194-15" name="__codelineno-194-15" href="#__codelineno-194-15"></a><span class="w">            </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-194-16"><a id="__codelineno-194-16" name="__codelineno-194-16" href="#__codelineno-194-16"></a><span class="w">            </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-194-17"><a id="__codelineno-194-17" name="__codelineno-194-17" href="#__codelineno-194-17"></a><span class="w">            </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;sharedWith&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-194-18"><a id="__codelineno-194-18" name="__codelineno-194-18" href="#__codelineno-194-18"></a><span class="w">            </span><span class="c1">-- Notify previous owner</span>
</span><span id="__span-194-19"><a id="__codelineno-194-19" name="__codelineno-194-19" href="#__codelineno-194-19"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-194-20"><a id="__codelineno-194-20" name="__codelineno-194-20" href="#__codelineno-194-20"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-194-21"><a id="__codelineno-194-21" name="__codelineno-194-21" href="#__codelineno-194-21"></a><span class="w">                    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your door has been set to non-ownable&quot;</span><span class="p">)</span>
</span><span id="__span-194-22"><a id="__codelineno-194-22" name="__codelineno-194-22" href="#__codelineno-194-22"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-194-23"><a id="__codelineno-194-23" name="__codelineno-194-23" href="#__codelineno-194-23"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-194-24"><a id="__codelineno-194-24" name="__codelineno-194-24" href="#__codelineno-194-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-194-25"><a id="__codelineno-194-25" name="__codelineno-194-25" href="#__codelineno-194-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-194-26"><a id="__codelineno-194-26" name="__codelineno-194-26" href="#__codelineno-194-26"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-194-27"><a id="__codelineno-194-27" name="__codelineno-194-27" href="#__codelineno-194-27"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-194-28"><a id="__codelineno-194-28" name="__codelineno-194-28" href="#__codelineno-194-28"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-194-29"><a id="__codelineno-194-29" name="__codelineno-194-29" href="#__codelineno-194-29"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is now &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">newState</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;ownable&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;not ownable&quot;</span><span class="p">))</span>
</span><span id="__span-194-30"><a id="__codelineno-194-30" name="__codelineno-194-30" href="#__codelineno-194-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-194-31"><a id="__codelineno-194-31" name="__codelineno-194-31" href="#__codelineno-194-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-194-32"><a id="__codelineno-194-32" name="__codelineno-194-32" href="#__codelineno-194-32"></a><span class="w">    </span><span class="c1">-- Log ownable toggle</span>
</span><span id="__span-194-33"><a id="__codelineno-194-33" name="__codelineno-194-33" href="#__codelineno-194-33"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s set door %s ownable to: %s&quot;</span><span class="p">,</span>
</span><span id="__span-194-34"><a id="__codelineno-194-34" name="__codelineno-194-34" href="#__codelineno-194-34"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">newState</span><span class="p">)))</span>
</span><span id="__span-194-35"><a id="__codelineno-194-35" name="__codelineno-194-35" href="#__codelineno-194-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doorpriceset">DoorPriceSet</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's price is set</p>
<p><strong>When Called</strong></p>
<p>When a door's purchase/rent price is changed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player setting the price</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>price</code> (<em>number</em>): The new price</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a><span class="c1">-- Simple: Log price change</span>
</span><span id="__span-195-2"><a id="__codelineno-195-2" name="__codelineno-195-2" href="#__codelineno-195-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorPriceSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-195-3"><a id="__codelineno-195-3" name="__codelineno-195-3" href="#__codelineno-195-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set door price to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-195-4"><a id="__codelineno-195-4" name="__codelineno-195-4" href="#__codelineno-195-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a><span class="c1">-- Medium: Validate price range</span>
</span><span id="__span-196-2"><a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorPriceSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorPriceValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-196-3"><a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-196-4"><a id="__codelineno-196-4" name="__codelineno-196-4" href="#__codelineno-196-4"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price must be between $0 and $10000&quot;</span><span class="p">)</span>
</span><span id="__span-196-5"><a id="__codelineno-196-5" name="__codelineno-196-5" href="#__codelineno-196-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-196-6"><a id="__codelineno-196-6" name="__codelineno-196-6" href="#__codelineno-196-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-196-7"><a id="__codelineno-196-7" name="__codelineno-196-7" href="#__codelineno-196-7"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-196-8"><a id="__codelineno-196-8" name="__codelineno-196-8" href="#__codelineno-196-8"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door price set to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-196-9"><a id="__codelineno-196-9" name="__codelineno-196-9" href="#__codelineno-196-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a><span class="c1">-- High: Complex door pricing system</span>
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2" href="#__codelineno-197-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorPriceSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorPricing&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-197-3"><a id="__codelineno-197-3" name="__codelineno-197-3" href="#__codelineno-197-3"></a><span class="c1">-- Validate price range</span>
</span><span id="__span-197-4"><a id="__codelineno-197-4" name="__codelineno-197-4" href="#__codelineno-197-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-197-5"><a id="__codelineno-197-5" name="__codelineno-197-5" href="#__codelineno-197-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price must be between $0 and $10000&quot;</span><span class="p">)</span>
</span><span id="__span-197-6"><a id="__codelineno-197-6" name="__codelineno-197-6" href="#__codelineno-197-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-197-7"><a id="__codelineno-197-7" name="__codelineno-197-7" href="#__codelineno-197-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-197-8"><a id="__codelineno-197-8" name="__codelineno-197-8" href="#__codelineno-197-8"></a><span class="c1">-- Check admin override</span>
</span><span id="__span-197-9"><a id="__codelineno-197-9" name="__codelineno-197-9" href="#__codelineno-197-9"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-197-10"><a id="__codelineno-197-10" name="__codelineno-197-10" href="#__codelineno-197-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-197-11"><a id="__codelineno-197-11" name="__codelineno-197-11" href="#__codelineno-197-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-197-12"><a id="__codelineno-197-12" name="__codelineno-197-12" href="#__codelineno-197-12"></a><span class="w">        </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-197-13"><a id="__codelineno-197-13" name="__codelineno-197-13" href="#__codelineno-197-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-197-14"><a id="__codelineno-197-14" name="__codelineno-197-14" href="#__codelineno-197-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-197-15"><a id="__codelineno-197-15" name="__codelineno-197-15" href="#__codelineno-197-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this door&quot;</span><span class="p">)</span>
</span><span id="__span-197-16"><a id="__codelineno-197-16" name="__codelineno-197-16" href="#__codelineno-197-16"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-197-17"><a id="__codelineno-197-17" name="__codelineno-197-17" href="#__codelineno-197-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-197-18"><a id="__codelineno-197-18" name="__codelineno-197-18" href="#__codelineno-197-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-197-19"><a id="__codelineno-197-19" name="__codelineno-197-19" href="#__codelineno-197-19"></a><span class="w">    </span><span class="c1">-- Set price</span>
</span><span id="__span-197-20"><a id="__codelineno-197-20" name="__codelineno-197-20" href="#__codelineno-197-20"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-197-21"><a id="__codelineno-197-21" name="__codelineno-197-21" href="#__codelineno-197-21"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;priceSetBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-197-22"><a id="__codelineno-197-22" name="__codelineno-197-22" href="#__codelineno-197-22"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;priceSetTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-197-23"><a id="__codelineno-197-23" name="__codelineno-197-23" href="#__codelineno-197-23"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-197-24"><a id="__codelineno-197-24" name="__codelineno-197-24" href="#__codelineno-197-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-197-25"><a id="__codelineno-197-25" name="__codelineno-197-25" href="#__codelineno-197-25"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-197-26"><a id="__codelineno-197-26" name="__codelineno-197-26" href="#__codelineno-197-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-197-27"><a id="__codelineno-197-27" name="__codelineno-197-27" href="#__codelineno-197-27"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door&#39;s price was set to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-197-28"><a id="__codelineno-197-28" name="__codelineno-197-28" href="#__codelineno-197-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-197-29"><a id="__codelineno-197-29" name="__codelineno-197-29" href="#__codelineno-197-29"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-197-30"><a id="__codelineno-197-30" name="__codelineno-197-30" href="#__codelineno-197-30"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door price set to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-197-31"><a id="__codelineno-197-31" name="__codelineno-197-31" href="#__codelineno-197-31"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-197-32"><a id="__codelineno-197-32" name="__codelineno-197-32" href="#__codelineno-197-32"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_logs (timestamp, steamid, doorid, action, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-197-33"><a id="__codelineno-197-33" name="__codelineno-197-33" href="#__codelineno-197-33"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">MapCreationID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;price_set&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-197-34"><a id="__codelineno-197-34" name="__codelineno-197-34" href="#__codelineno-197-34"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="doortitleset">DoorTitleSet</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door's title is set</p>
<p><strong>When Called</strong></p>
<p>When a door's display name is changed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player setting the title</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>name</code> (<em>string</em>): The new door title</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a><span class="c1">-- Simple: Log title change</span>
</span><span id="__span-198-2"><a id="__codelineno-198-2" name="__codelineno-198-2" href="#__codelineno-198-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorTitleSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-198-3"><a id="__codelineno-198-3" name="__codelineno-198-3" href="#__codelineno-198-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set door title to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-198-4"><a id="__codelineno-198-4" name="__codelineno-198-4" href="#__codelineno-198-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a><span class="c1">-- Medium: Validate title length</span>
</span><span id="__span-199-2"><a id="__codelineno-199-2" name="__codelineno-199-2" href="#__codelineno-199-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorTitleSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorTitleValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-199-3"><a id="__codelineno-199-3" name="__codelineno-199-3" href="#__codelineno-199-3"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-199-4"><a id="__codelineno-199-4" name="__codelineno-199-4" href="#__codelineno-199-4"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door title must be 50 characters or less&quot;</span><span class="p">)</span>
</span><span id="__span-199-5"><a id="__codelineno-199-5" name="__codelineno-199-5" href="#__codelineno-199-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-199-6"><a id="__codelineno-199-6" name="__codelineno-199-6" href="#__codelineno-199-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-199-7"><a id="__codelineno-199-7" name="__codelineno-199-7" href="#__codelineno-199-7"></a><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-199-8"><a id="__codelineno-199-8" name="__codelineno-199-8" href="#__codelineno-199-8"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door title set to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-199-9"><a id="__codelineno-199-9" name="__codelineno-199-9" href="#__codelineno-199-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a><span class="c1">-- High: Complex door title system</span>
</span><span id="__span-200-2"><a id="__codelineno-200-2" name="__codelineno-200-2" href="#__codelineno-200-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DoorTitleSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-200-3"><a id="__codelineno-200-3" name="__codelineno-200-3" href="#__codelineno-200-3"></a><span class="c1">-- Validate title length</span>
</span><span id="__span-200-4"><a id="__codelineno-200-4" name="__codelineno-200-4" href="#__codelineno-200-4"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-200-5"><a id="__codelineno-200-5" name="__codelineno-200-5" href="#__codelineno-200-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door title must be 50 characters or less&quot;</span><span class="p">)</span>
</span><span id="__span-200-6"><a id="__codelineno-200-6" name="__codelineno-200-6" href="#__codelineno-200-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-200-7"><a id="__codelineno-200-7" name="__codelineno-200-7" href="#__codelineno-200-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-200-8"><a id="__codelineno-200-8" name="__codelineno-200-8" href="#__codelineno-200-8"></a><span class="c1">-- Filter inappropriate content</span>
</span><span id="__span-200-9"><a id="__codelineno-200-9" name="__codelineno-200-9" href="#__codelineno-200-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bannedWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cheat&quot;</span><span class="p">}</span>
</span><span id="__span-200-10"><a id="__codelineno-200-10" name="__codelineno-200-10" href="#__codelineno-200-10"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bannedWords</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-200-11"><a id="__codelineno-200-11" name="__codelineno-200-11" href="#__codelineno-200-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">name</span><span class="p">),</span><span class="w"> </span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">word</span><span class="p">))</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-200-12"><a id="__codelineno-200-12" name="__codelineno-200-12" href="#__codelineno-200-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door title contains inappropriate content&quot;</span><span class="p">)</span>
</span><span id="__span-200-13"><a id="__codelineno-200-13" name="__codelineno-200-13" href="#__codelineno-200-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-200-14"><a id="__codelineno-200-14" name="__codelineno-200-14" href="#__codelineno-200-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-200-15"><a id="__codelineno-200-15" name="__codelineno-200-15" href="#__codelineno-200-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-200-16"><a id="__codelineno-200-16" name="__codelineno-200-16" href="#__codelineno-200-16"></a><span class="c1">-- Check admin override</span>
</span><span id="__span-200-17"><a id="__codelineno-200-17" name="__codelineno-200-17" href="#__codelineno-200-17"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-200-18"><a id="__codelineno-200-18" name="__codelineno-200-18" href="#__codelineno-200-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-200-19"><a id="__codelineno-200-19" name="__codelineno-200-19" href="#__codelineno-200-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-200-20"><a id="__codelineno-200-20" name="__codelineno-200-20" href="#__codelineno-200-20"></a><span class="w">        </span><span class="c1">-- Check door ownership</span>
</span><span id="__span-200-21"><a id="__codelineno-200-21" name="__codelineno-200-21" href="#__codelineno-200-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-200-22"><a id="__codelineno-200-22" name="__codelineno-200-22" href="#__codelineno-200-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-200-23"><a id="__codelineno-200-23" name="__codelineno-200-23" href="#__codelineno-200-23"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this door&quot;</span><span class="p">)</span>
</span><span id="__span-200-24"><a id="__codelineno-200-24" name="__codelineno-200-24" href="#__codelineno-200-24"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-200-25"><a id="__codelineno-200-25" name="__codelineno-200-25" href="#__codelineno-200-25"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-200-26"><a id="__codelineno-200-26" name="__codelineno-200-26" href="#__codelineno-200-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-200-27"><a id="__codelineno-200-27" name="__codelineno-200-27" href="#__codelineno-200-27"></a><span class="w">    </span><span class="c1">-- Set title</span>
</span><span id="__span-200-28"><a id="__codelineno-200-28" name="__codelineno-200-28" href="#__codelineno-200-28"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-200-29"><a id="__codelineno-200-29" name="__codelineno-200-29" href="#__codelineno-200-29"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;titleSetBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-200-30"><a id="__codelineno-200-30" name="__codelineno-200-30" href="#__codelineno-200-30"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;titleSetTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-200-31"><a id="__codelineno-200-31" name="__codelineno-200-31" href="#__codelineno-200-31"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-200-32"><a id="__codelineno-200-32" name="__codelineno-200-32" href="#__codelineno-200-32"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-200-33"><a id="__codelineno-200-33" name="__codelineno-200-33" href="#__codelineno-200-33"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-200-34"><a id="__codelineno-200-34" name="__codelineno-200-34" href="#__codelineno-200-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">doorPos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-200-35"><a id="__codelineno-200-35" name="__codelineno-200-35" href="#__codelineno-200-35"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door&#39;s title was changed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-200-36"><a id="__codelineno-200-36" name="__codelineno-200-36" href="#__codelineno-200-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-200-37"><a id="__codelineno-200-37" name="__codelineno-200-37" href="#__codelineno-200-37"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-200-38"><a id="__codelineno-200-38" name="__codelineno-200-38" href="#__codelineno-200-38"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door title set to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-200-39"><a id="__codelineno-200-39" name="__codelineno-200-39" href="#__codelineno-200-39"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-200-40"><a id="__codelineno-200-40" name="__codelineno-200-40" href="#__codelineno-200-40"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_logs (timestamp, steamid, doorid, action, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-200-41"><a id="__codelineno-200-41" name="__codelineno-200-41" href="#__codelineno-200-41"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">MapCreationID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;title_set&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
</span><span id="__span-200-42"><a id="__codelineno-200-42" name="__codelineno-200-42" href="#__codelineno-200-42"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="fetchspawns">FetchSpawns</h3>
<p><strong>Purpose</strong></p>
<p>Called to fetch spawn points</p>
<p><strong>When Called</strong></p>
<p>When spawn points need to be loaded or refreshed</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a><span class="c1">-- Simple: Log spawn fetching</span>
</span><span id="__span-201-2"><a id="__codelineno-201-2" name="__codelineno-201-2" href="#__codelineno-201-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;FetchSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-201-3"><a id="__codelineno-201-3" name="__codelineno-201-3" href="#__codelineno-201-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching spawn points&quot;</span><span class="p">)</span>
</span><span id="__span-201-4"><a id="__codelineno-201-4" name="__codelineno-201-4" href="#__codelineno-201-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a><span class="c1">-- Medium: Load spawn points from database</span>
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2" href="#__codelineno-202-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;FetchSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SpawnLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3" href="#__codelineno-202-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM spawns&quot;</span><span class="p">)</span>
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4" href="#__codelineno-202-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawns</span>
</span><span id="__span-202-5"><a id="__codelineno-202-5" name="__codelineno-202-5" href="#__codelineno-202-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">#</span><span class="nv">spawns</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; spawn points&quot;</span><span class="p">)</span>
</span><span id="__span-202-6"><a id="__codelineno-202-6" name="__codelineno-202-6" href="#__codelineno-202-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a><span class="c1">-- High: Complex spawn point system</span>
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2" href="#__codelineno-203-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;FetchSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSpawnSystem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-203-3"><a id="__codelineno-203-3" name="__codelineno-203-3" href="#__codelineno-203-3"></a><span class="c1">-- Load spawns from database</span>
</span><span id="__span-203-4"><a id="__codelineno-203-4" name="__codelineno-203-4" href="#__codelineno-203-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM spawns WHERE active = 1&quot;</span><span class="p">)</span>
</span><span id="__span-203-5"><a id="__codelineno-203-5" name="__codelineno-203-5" href="#__codelineno-203-5"></a><span class="c1">-- Categorize spawns by faction</span>
</span><span id="__span-203-6"><a id="__codelineno-203-6" name="__codelineno-203-6" href="#__codelineno-203-6"></a><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-203-7"><a id="__codelineno-203-7" name="__codelineno-203-7" href="#__codelineno-203-7"></a><span class="nv">police</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-203-8"><a id="__codelineno-203-8" name="__codelineno-203-8" href="#__codelineno-203-8"></a><span class="nv">medic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-203-9"><a id="__codelineno-203-9" name="__codelineno-203-9" href="#__codelineno-203-9"></a><span class="nv">citizen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-203-10"><a id="__codelineno-203-10" name="__codelineno-203-10" href="#__codelineno-203-10"></a><span class="nv">criminal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-203-11"><a id="__codelineno-203-11" name="__codelineno-203-11" href="#__codelineno-203-11"></a><span class="p">}</span>
</span><span id="__span-203-12"><a id="__codelineno-203-12" name="__codelineno-203-12" href="#__codelineno-203-12"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-203-13"><a id="__codelineno-203-13" name="__codelineno-203-13" href="#__codelineno-203-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span>
</span><span id="__span-203-14"><a id="__codelineno-203-14" name="__codelineno-203-14" href="#__codelineno-203-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-203-15"><a id="__codelineno-203-15" name="__codelineno-203-15" href="#__codelineno-203-15"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="p">[</span><span class="nv">faction</span><span class="p">],</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-203-16"><a id="__codelineno-203-16" name="__codelineno-203-16" href="#__codelineno-203-16"></a><span class="w">        </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Vector</span><span class="p">(</span><span class="nv">spawn</span><span class="p">.</span><span class="py">x</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">y</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">z</span><span class="p">),</span>
</span><span id="__span-203-17"><a id="__codelineno-203-17" name="__codelineno-203-17" href="#__codelineno-203-17"></a><span class="w">        </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Angle</span><span class="p">(</span><span class="nv">spawn</span><span class="p">.</span><span class="py">pitch</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">yaw</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">roll</span><span class="p">),</span>
</span><span id="__span-203-18"><a id="__codelineno-203-18" name="__codelineno-203-18" href="#__codelineno-203-18"></a><span class="w">        </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">name</span>
</span><span id="__span-203-19"><a id="__codelineno-203-19" name="__codelineno-203-19" href="#__codelineno-203-19"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-203-20"><a id="__codelineno-203-20" name="__codelineno-203-20" href="#__codelineno-203-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-203-21"><a id="__codelineno-203-21" name="__codelineno-203-21" href="#__codelineno-203-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-203-22"><a id="__codelineno-203-22" name="__codelineno-203-22" href="#__codelineno-203-22"></a><span class="c1">-- Log spawn counts</span>
</span><span id="__span-203-23"><a id="__codelineno-203-23" name="__codelineno-203-23" href="#__codelineno-203-23"></a><span class="kr">for</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">factionSpawns</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-203-24"><a id="__codelineno-203-24" name="__codelineno-203-24" href="#__codelineno-203-24"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">faction</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; spawns: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">#</span><span class="nv">factionSpawns</span><span class="p">)</span>
</span><span id="__span-203-25"><a id="__codelineno-203-25" name="__codelineno-203-25" href="#__codelineno-203-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-203-26"><a id="__codelineno-203-26" name="__codelineno-203-26" href="#__codelineno-203-26"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="forcerecognizerange">ForceRecognizeRange</h3>
<p><strong>Purpose</strong></p>
<p>Called to force recognition range</p>
<p><strong>When Called</strong></p>
<p>When setting the recognition range for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ply</code> (<em>Player</em>): The player to set recognition range for</li>
<li><code>range</code> (<em>number</em>): The recognition range</li>
<li><code>fakeName</code> (<em>string</em>): The fake name to use (optional)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a><span class="c1">-- Simple: Log recognition range setting</span>
</span><span id="__span-204-2"><a id="__codelineno-204-2" name="__codelineno-204-2" href="#__codelineno-204-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ForceRecognizeRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-204-3"><a id="__codelineno-204-3" name="__codelineno-204-3" href="#__codelineno-204-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Set recognition range for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-204-4"><a id="__codelineno-204-4" name="__codelineno-204-4" href="#__codelineno-204-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a><span class="c1">-- Medium: Set recognition data</span>
</span><span id="__span-205-2"><a id="__codelineno-205-2" name="__codelineno-205-2" href="#__codelineno-205-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ForceRecognizeRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RecognitionRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-205-3"><a id="__codelineno-205-3" name="__codelineno-205-3" href="#__codelineno-205-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-205-4"><a id="__codelineno-205-4" name="__codelineno-205-4" href="#__codelineno-205-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-205-5"><a id="__codelineno-205-5" name="__codelineno-205-5" href="#__codelineno-205-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-205-6"><a id="__codelineno-205-6" name="__codelineno-205-6" href="#__codelineno-205-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">fakeName</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-205-7"><a id="__codelineno-205-7" name="__codelineno-205-7" href="#__codelineno-205-7"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;fakeName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-205-8"><a id="__codelineno-205-8" name="__codelineno-205-8" href="#__codelineno-205-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-205-9"><a id="__codelineno-205-9" name="__codelineno-205-9" href="#__codelineno-205-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-205-10"><a id="__codelineno-205-10" name="__codelineno-205-10" href="#__codelineno-205-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a><span class="c1">-- High: Complex recognition range system</span>
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2" href="#__codelineno-206-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ForceRecognizeRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRecognitionRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3" href="#__codelineno-206-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4" href="#__codelineno-206-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-206-5"><a id="__codelineno-206-5" name="__codelineno-206-5" href="#__codelineno-206-5"></a><span class="w">    </span><span class="c1">-- Set recognition range</span>
</span><span id="__span-206-6"><a id="__codelineno-206-6" name="__codelineno-206-6" href="#__codelineno-206-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionRange&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">range</span><span class="p">)</span>
</span><span id="__span-206-7"><a id="__codelineno-206-7" name="__codelineno-206-7" href="#__codelineno-206-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionRangeSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-206-8"><a id="__codelineno-206-8" name="__codelineno-206-8" href="#__codelineno-206-8"></a><span class="w">    </span><span class="c1">-- Set fake name if provided</span>
</span><span id="__span-206-9"><a id="__codelineno-206-9" name="__codelineno-206-9" href="#__codelineno-206-9"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">fakeName</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">fakeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-206-10"><a id="__codelineno-206-10" name="__codelineno-206-10" href="#__codelineno-206-10"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;fakeName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-206-11"><a id="__codelineno-206-11" name="__codelineno-206-11" href="#__codelineno-206-11"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;usingFakeName&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-206-12"><a id="__codelineno-206-12" name="__codelineno-206-12" href="#__codelineno-206-12"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-206-13"><a id="__codelineno-206-13" name="__codelineno-206-13" href="#__codelineno-206-13"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;fakeName&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-206-14"><a id="__codelineno-206-14" name="__codelineno-206-14" href="#__codelineno-206-14"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;usingFakeName&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-206-15"><a id="__codelineno-206-15" name="__codelineno-206-15" href="#__codelineno-206-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-206-16"><a id="__codelineno-206-16" name="__codelineno-206-16" href="#__codelineno-206-16"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-206-17"><a id="__codelineno-206-17" name="__codelineno-206-17" href="#__codelineno-206-17"></a><span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Recognition range set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; units&quot;</span><span class="p">)</span>
</span><span id="__span-206-18"><a id="__codelineno-206-18" name="__codelineno-206-18" href="#__codelineno-206-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">fakeName</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-206-19"><a id="__codelineno-206-19" name="__codelineno-206-19" href="#__codelineno-206-19"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Fake name set to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">fakeName</span><span class="p">)</span>
</span><span id="__span-206-20"><a id="__codelineno-206-20" name="__codelineno-206-20" href="#__codelineno-206-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-206-21"><a id="__codelineno-206-21" name="__codelineno-206-21" href="#__codelineno-206-21"></a><span class="w">    </span><span class="c1">-- Log recognition range change</span>
</span><span id="__span-206-22"><a id="__codelineno-206-22" name="__codelineno-206-22" href="#__codelineno-206-22"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Recognition range set for %s: %d units (Fake name: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-206-23"><a id="__codelineno-206-23" name="__codelineno-206-23" href="#__codelineno-206-23"></a><span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">range</span><span class="p">,</span><span class="w"> </span><span class="nv">fakeName</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">))</span>
</span><span id="__span-206-24"><a id="__codelineno-206-24" name="__codelineno-206-24" href="#__codelineno-206-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getallcaseclaims">GetAllCaseClaims</h3>
<p><strong>Purpose</strong></p>
<p>Called to get all case claims</p>
<p><strong>When Called</strong></p>
<p>When retrieving all active case claims</p>
<p><strong>Returns</strong></p>
<ul>
<li>table - Table of all case claims</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a><span class="c1">-- Simple: Return empty claims table</span>
</span><span id="__span-207-2"><a id="__codelineno-207-2" name="__codelineno-207-2" href="#__codelineno-207-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAllCaseClaims&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-207-3"><a id="__codelineno-207-3" name="__codelineno-207-3" href="#__codelineno-207-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-207-4"><a id="__codelineno-207-4" name="__codelineno-207-4" href="#__codelineno-207-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a><span class="c1">-- Medium: Load claims from database</span>
</span><span id="__span-208-2"><a id="__codelineno-208-2" name="__codelineno-208-2" href="#__codelineno-208-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAllCaseClaims&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ClaimsLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-208-3"><a id="__codelineno-208-3" name="__codelineno-208-3" href="#__codelineno-208-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM case_claims WHERE active = 1&quot;</span><span class="p">)</span>
</span><span id="__span-208-4"><a id="__codelineno-208-4" name="__codelineno-208-4" href="#__codelineno-208-4"></a><span class="kr">return</span><span class="w"> </span><span class="nv">claims</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-208-5"><a id="__codelineno-208-5" name="__codelineno-208-5" href="#__codelineno-208-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a><span class="c1">-- High: Complex case claims system</span>
</span><span id="__span-209-2"><a id="__codelineno-209-2" name="__codelineno-209-2" href="#__codelineno-209-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAllCaseClaims&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCaseClaims&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-209-3"><a id="__codelineno-209-3" name="__codelineno-209-3" href="#__codelineno-209-3"></a><span class="c1">-- Load claims from database</span>
</span><span id="__span-209-4"><a id="__codelineno-209-4" name="__codelineno-209-4" href="#__codelineno-209-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM case_claims WHERE active = 1&quot;</span><span class="p">)</span>
</span><span id="__span-209-5"><a id="__codelineno-209-5" name="__codelineno-209-5" href="#__codelineno-209-5"></a><span class="c1">-- Process and format claims</span>
</span><span id="__span-209-6"><a id="__codelineno-209-6" name="__codelineno-209-6" href="#__codelineno-209-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">processedClaims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-209-7"><a id="__codelineno-209-7" name="__codelineno-209-7" href="#__codelineno-209-7"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">claim</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">claims</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-209-8"><a id="__codelineno-209-8" name="__codelineno-209-8" href="#__codelineno-209-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedClaim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-209-9"><a id="__codelineno-209-9" name="__codelineno-209-9" href="#__codelineno-209-9"></a><span class="w">    </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">id</span><span class="p">,</span>
</span><span id="__span-209-10"><a id="__codelineno-209-10" name="__codelineno-209-10" href="#__codelineno-209-10"></a><span class="w">    </span><span class="nv">caseNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">case_number</span><span class="p">,</span>
</span><span id="__span-209-11"><a id="__codelineno-209-11" name="__codelineno-209-11" href="#__codelineno-209-11"></a><span class="w">    </span><span class="nv">claimant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">claimant</span><span class="p">,</span>
</span><span id="__span-209-12"><a id="__codelineno-209-12" name="__codelineno-209-12" href="#__codelineno-209-12"></a><span class="w">    </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">amount</span><span class="p">,</span>
</span><span id="__span-209-13"><a id="__codelineno-209-13" name="__codelineno-209-13" href="#__codelineno-209-13"></a><span class="w">    </span><span class="nv">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">status</span><span class="p">,</span>
</span><span id="__span-209-14"><a id="__codelineno-209-14" name="__codelineno-209-14" href="#__codelineno-209-14"></a><span class="w">    </span><span class="nv">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">created_at</span><span class="p">,</span>
</span><span id="__span-209-15"><a id="__codelineno-209-15" name="__codelineno-209-15" href="#__codelineno-209-15"></a><span class="w">    </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">claim</span><span class="p">.</span><span class="py">description</span>
</span><span id="__span-209-16"><a id="__codelineno-209-16" name="__codelineno-209-16" href="#__codelineno-209-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-209-17"><a id="__codelineno-209-17" name="__codelineno-209-17" href="#__codelineno-209-17"></a><span class="w">    </span><span class="c1">-- Add claimant character info</span>
</span><span id="__span-209-18"><a id="__codelineno-209-18" name="__codelineno-209-18" href="#__codelineno-209-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">claim</span><span class="p">.</span><span class="py">claimant</span><span class="p">)</span>
</span><span id="__span-209-19"><a id="__codelineno-209-19" name="__codelineno-209-19" href="#__codelineno-209-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-209-20"><a id="__codelineno-209-20" name="__codelineno-209-20" href="#__codelineno-209-20"></a><span class="w">        </span><span class="nv">processedClaim</span><span class="p">.</span><span class="py">claimantName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-209-21"><a id="__codelineno-209-21" name="__codelineno-209-21" href="#__codelineno-209-21"></a><span class="w">        </span><span class="nv">processedClaim</span><span class="p">.</span><span class="py">claimantFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-209-22"><a id="__codelineno-209-22" name="__codelineno-209-22" href="#__codelineno-209-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-209-23"><a id="__codelineno-209-23" name="__codelineno-209-23" href="#__codelineno-209-23"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">processedClaims</span><span class="p">,</span><span class="w"> </span><span class="nv">processedClaim</span><span class="p">)</span>
</span><span id="__span-209-24"><a id="__codelineno-209-24" name="__codelineno-209-24" href="#__codelineno-209-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-209-25"><a id="__codelineno-209-25" name="__codelineno-209-25" href="#__codelineno-209-25"></a><span class="c1">-- Sort by creation date</span>
</span><span id="__span-209-26"><a id="__codelineno-209-26" name="__codelineno-209-26" href="#__codelineno-209-26"></a><span class="nb">table.sort</span><span class="p">(</span><span class="nv">processedClaims</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span>
</span><span id="__span-209-27"><a id="__codelineno-209-27" name="__codelineno-209-27" href="#__codelineno-209-27"></a><span class="kr">return</span><span class="w"> </span><span class="nv">a</span><span class="p">.</span><span class="py">createdAt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">b</span><span class="p">.</span><span class="py">createdAt</span>
</span><span id="__span-209-28"><a id="__codelineno-209-28" name="__codelineno-209-28" href="#__codelineno-209-28"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-209-29"><a id="__codelineno-209-29" name="__codelineno-209-29" href="#__codelineno-209-29"></a><span class="kr">return</span><span class="w"> </span><span class="nv">processedClaims</span>
</span><span id="__span-209-30"><a id="__codelineno-209-30" name="__codelineno-209-30" href="#__codelineno-209-30"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getattributemax">GetAttributeMax</h3>
<p><strong>Purpose</strong></p>
<p>Called to get the maximum value for an attribute</p>
<p><strong>When Called</strong></p>
<p>When calculating attribute limits</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player whose attribute max is being checked</li>
<li><code>attrKey</code> (<em>string</em>): The attribute key</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The maximum attribute value</li>
</ul>
<p><strong>Realm</strong></p>
<p>Shared</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a><span class="c1">-- Simple: Return default max</span>
</span><span id="__span-210-2"><a id="__codelineno-210-2" name="__codelineno-210-2" href="#__codelineno-210-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">attrKey</span><span class="p">)</span>
</span><span id="__span-210-3"><a id="__codelineno-210-3" name="__codelineno-210-3" href="#__codelineno-210-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-210-4"><a id="__codelineno-210-4" name="__codelineno-210-4" href="#__codelineno-210-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a><span class="c1">-- Medium: Attribute-specific maxes</span>
</span><span id="__span-211-2"><a id="__codelineno-211-2" name="__codelineno-211-2" href="#__codelineno-211-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AttributeMaxes&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">attrKey</span><span class="p">)</span>
</span><span id="__span-211-3"><a id="__codelineno-211-3" name="__codelineno-211-3" href="#__codelineno-211-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">maxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-211-4"><a id="__codelineno-211-4" name="__codelineno-211-4" href="#__codelineno-211-4"></a><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
</span><span id="__span-211-5"><a id="__codelineno-211-5" name="__codelineno-211-5" href="#__codelineno-211-5"></a><span class="p">[</span><span class="s2">&quot;dex&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
</span><span id="__span-211-6"><a id="__codelineno-211-6" name="__codelineno-211-6" href="#__codelineno-211-6"></a><span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">120</span>
</span><span id="__span-211-7"><a id="__codelineno-211-7" name="__codelineno-211-7" href="#__codelineno-211-7"></a><span class="p">}</span>
</span><span id="__span-211-8"><a id="__codelineno-211-8" name="__codelineno-211-8" href="#__codelineno-211-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">maxes</span><span class="p">[</span><span class="nv">attrKey</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-211-9"><a id="__codelineno-211-9" name="__codelineno-211-9" href="#__codelineno-211-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a><span class="c1">-- High: Complex attribute max system</span>
</span><span id="__span-212-2"><a id="__codelineno-212-2" name="__codelineno-212-2" href="#__codelineno-212-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAttributeMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">attrKey</span><span class="p">)</span>
</span><span id="__span-212-3"><a id="__codelineno-212-3" name="__codelineno-212-3" href="#__codelineno-212-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-212-4"><a id="__codelineno-212-4" name="__codelineno-212-4" href="#__codelineno-212-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-212-5"><a id="__codelineno-212-5" name="__codelineno-212-5" href="#__codelineno-212-5"></a><span class="w">    </span><span class="c1">-- Base max</span>
</span><span id="__span-212-6"><a id="__codelineno-212-6" name="__codelineno-212-6" href="#__codelineno-212-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-212-7"><a id="__codelineno-212-7" name="__codelineno-212-7" href="#__codelineno-212-7"></a><span class="w">    </span><span class="c1">-- Faction bonuses</span>
</span><span id="__span-212-8"><a id="__codelineno-212-8" name="__codelineno-212-8" href="#__codelineno-212-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-212-9"><a id="__codelineno-212-9" name="__codelineno-212-9" href="#__codelineno-212-9"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;warrior&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attrKey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;str&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-212-10"><a id="__codelineno-212-10" name="__codelineno-212-10" href="#__codelineno-212-10"></a><span class="w">        </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-212-11"><a id="__codelineno-212-11" name="__codelineno-212-11" href="#__codelineno-212-11"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;mage&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attrKey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;int&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-212-12"><a id="__codelineno-212-12" name="__codelineno-212-12" href="#__codelineno-212-12"></a><span class="w">        </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-212-13"><a id="__codelineno-212-13" name="__codelineno-212-13" href="#__codelineno-212-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-212-14"><a id="__codelineno-212-14" name="__codelineno-212-14" href="#__codelineno-212-14"></a><span class="w">    </span><span class="c1">-- Level bonuses</span>
</span><span id="__span-212-15"><a id="__codelineno-212-15" name="__codelineno-212-15" href="#__codelineno-212-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-212-16"><a id="__codelineno-212-16" name="__codelineno-212-16" href="#__codelineno-212-16"></a><span class="w">    </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-212-17"><a id="__codelineno-212-17" name="__codelineno-212-17" href="#__codelineno-212-17"></a><span class="w">    </span><span class="c1">-- Item bonuses</span>
</span><span id="__span-212-18"><a id="__codelineno-212-18" name="__codelineno-212-18" href="#__codelineno-212-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-212-19"><a id="__codelineno-212-19" name="__codelineno-212-19" href="#__codelineno-212-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-212-20"><a id="__codelineno-212-20" name="__codelineno-212-20" href="#__codelineno-212-20"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-212-21"><a id="__codelineno-212-21" name="__codelineno-212-21" href="#__codelineno-212-21"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-212-22"><a id="__codelineno-212-22" name="__codelineno-212-22" href="#__codelineno-212-22"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">attrBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">attrBonus</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-212-23"><a id="__codelineno-212-23" name="__codelineno-212-23" href="#__codelineno-212-23"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">attrBonus</span><span class="p">[</span><span class="nv">attrKey</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-212-24"><a id="__codelineno-212-24" name="__codelineno-212-24" href="#__codelineno-212-24"></a><span class="w">                    </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">attrBonus</span><span class="p">[</span><span class="nv">attrKey</span><span class="p">]</span>
</span><span id="__span-212-25"><a id="__codelineno-212-25" name="__codelineno-212-25" href="#__codelineno-212-25"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-212-26"><a id="__codelineno-212-26" name="__codelineno-212-26" href="#__codelineno-212-26"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-212-27"><a id="__codelineno-212-27" name="__codelineno-212-27" href="#__codelineno-212-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-212-28"><a id="__codelineno-212-28" name="__codelineno-212-28" href="#__codelineno-212-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-212-29"><a id="__codelineno-212-29" name="__codelineno-212-29" href="#__codelineno-212-29"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">baseMax</span>
</span><span id="__span-212-30"><a id="__codelineno-212-30" name="__codelineno-212-30" href="#__codelineno-212-30"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getattributestartingmax">GetAttributeStartingMax</h3>
<p><strong>Purpose</strong></p>
<p>Called to get the starting maximum for an attribute</p>
<p><strong>When Called</strong></p>
<p>When a character is created</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>k</code> (<em>string</em>): The attribute key</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The starting maximum attribute value</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a><span class="c1">-- Simple: Return default starting max</span>
</span><span id="__span-213-2"><a id="__codelineno-213-2" name="__codelineno-213-2" href="#__codelineno-213-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeStartingMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-213-3"><a id="__codelineno-213-3" name="__codelineno-213-3" href="#__codelineno-213-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-213-4"><a id="__codelineno-213-4" name="__codelineno-213-4" href="#__codelineno-213-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a><span class="c1">-- Medium: Attribute-specific starting maxes</span>
</span><span id="__span-214-2"><a id="__codelineno-214-2" name="__codelineno-214-2" href="#__codelineno-214-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeStartingMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AttributeStartingMaxes&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-214-3"><a id="__codelineno-214-3" name="__codelineno-214-3" href="#__codelineno-214-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">startingMaxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-214-4"><a id="__codelineno-214-4" name="__codelineno-214-4" href="#__codelineno-214-4"></a><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-214-5"><a id="__codelineno-214-5" name="__codelineno-214-5" href="#__codelineno-214-5"></a><span class="p">[</span><span class="s2">&quot;dex&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span>
</span><span id="__span-214-6"><a id="__codelineno-214-6" name="__codelineno-214-6" href="#__codelineno-214-6"></a><span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span>
</span><span id="__span-214-7"><a id="__codelineno-214-7" name="__codelineno-214-7" href="#__codelineno-214-7"></a><span class="p">}</span>
</span><span id="__span-214-8"><a id="__codelineno-214-8" name="__codelineno-214-8" href="#__codelineno-214-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">startingMaxes</span><span class="p">[</span><span class="nv">k</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-214-9"><a id="__codelineno-214-9" name="__codelineno-214-9" href="#__codelineno-214-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a><span class="c1">-- High: Complex starting attribute system</span>
</span><span id="__span-215-2"><a id="__codelineno-215-2" name="__codelineno-215-2" href="#__codelineno-215-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetAttributeStartingMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStartingAttributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">k</span><span class="p">)</span>
</span><span id="__span-215-3"><a id="__codelineno-215-3" name="__codelineno-215-3" href="#__codelineno-215-3"></a><span class="c1">-- Base starting max</span>
</span><span id="__span-215-4"><a id="__codelineno-215-4" name="__codelineno-215-4" href="#__codelineno-215-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-215-5"><a id="__codelineno-215-5" name="__codelineno-215-5" href="#__codelineno-215-5"></a><span class="c1">-- Check if player has played before</span>
</span><span id="__span-215-6"><a id="__codelineno-215-6" name="__codelineno-215-6" href="#__codelineno-215-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-215-7"><a id="__codelineno-215-7" name="__codelineno-215-7" href="#__codelineno-215-7"></a><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">36000</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 10 hours</span>
</span><span id="__span-215-8"><a id="__codelineno-215-8" name="__codelineno-215-8" href="#__codelineno-215-8"></a><span class="w">    </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-215-9"><a id="__codelineno-215-9" name="__codelineno-215-9" href="#__codelineno-215-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-215-10"><a id="__codelineno-215-10" name="__codelineno-215-10" href="#__codelineno-215-10"></a><span class="c1">-- Check for donator status</span>
</span><span id="__span-215-11"><a id="__codelineno-215-11" name="__codelineno-215-11" href="#__codelineno-215-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;donator&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-215-12"><a id="__codelineno-215-12" name="__codelineno-215-12" href="#__codelineno-215-12"></a><span class="w">    </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-215-13"><a id="__codelineno-215-13" name="__codelineno-215-13" href="#__codelineno-215-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-215-14"><a id="__codelineno-215-14" name="__codelineno-215-14" href="#__codelineno-215-14"></a><span class="c1">-- Attribute-specific bonuses</span>
</span><span id="__span-215-15"><a id="__codelineno-215-15" name="__codelineno-215-15" href="#__codelineno-215-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attrBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-215-16"><a id="__codelineno-215-16" name="__codelineno-215-16" href="#__codelineno-215-16"></a><span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-215-17"><a id="__codelineno-215-17" name="__codelineno-215-17" href="#__codelineno-215-17"></a><span class="p">[</span><span class="s2">&quot;dex&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-215-18"><a id="__codelineno-215-18" name="__codelineno-215-18" href="#__codelineno-215-18"></a><span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-215-19"><a id="__codelineno-215-19" name="__codelineno-215-19" href="#__codelineno-215-19"></a><span class="p">}</span>
</span><span id="__span-215-20"><a id="__codelineno-215-20" name="__codelineno-215-20" href="#__codelineno-215-20"></a><span class="nv">baseMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">attrBonuses</span><span class="p">[</span><span class="nv">k</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-215-21"><a id="__codelineno-215-21" name="__codelineno-215-21" href="#__codelineno-215-21"></a><span class="kr">return</span><span class="w"> </span><span class="nv">baseMax</span>
</span><span id="__span-215-22"><a id="__codelineno-215-22" name="__codelineno-215-22" href="#__codelineno-215-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getcharmaxstamina">GetCharMaxStamina</h3>
<p><strong>Purpose</strong></p>
<p>Gets the maximum stamina for a character</p>
<p><strong>When Called</strong></p>
<p>When calculating character stamina limits</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>char</code> (<em>Character</em>): The character to get max stamina for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The maximum stamina value</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a><span class="c1">-- Simple: Return default max stamina</span>
</span><span id="__span-216-2"><a id="__codelineno-216-2" name="__codelineno-216-2" href="#__codelineno-216-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetCharMaxStamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-216-3"><a id="__codelineno-216-3" name="__codelineno-216-3" href="#__codelineno-216-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-216-4"><a id="__codelineno-216-4" name="__codelineno-216-4" href="#__codelineno-216-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a><span class="c1">-- Medium: Base stamina on constitution</span>
</span><span id="__span-217-2"><a id="__codelineno-217-2" name="__codelineno-217-2" href="#__codelineno-217-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetCharMaxStamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ConstitutionStamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-217-3"><a id="__codelineno-217-3" name="__codelineno-217-3" href="#__codelineno-217-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-217-4"><a id="__codelineno-217-4" name="__codelineno-217-4" href="#__codelineno-217-4"></a><span class="kr">return</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">con</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-217-5"><a id="__codelineno-217-5" name="__codelineno-217-5" href="#__codelineno-217-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a><span class="c1">-- High: Complex stamina system</span>
</span><span id="__span-218-2"><a id="__codelineno-218-2" name="__codelineno-218-2" href="#__codelineno-218-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetCharMaxStamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-218-3"><a id="__codelineno-218-3" name="__codelineno-218-3" href="#__codelineno-218-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-218-4"><a id="__codelineno-218-4" name="__codelineno-218-4" href="#__codelineno-218-4"></a><span class="c1">-- Constitution bonus</span>
</span><span id="__span-218-5"><a id="__codelineno-218-5" name="__codelineno-218-5" href="#__codelineno-218-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-218-6"><a id="__codelineno-218-6" name="__codelineno-218-6" href="#__codelineno-218-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">conBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-218-7"><a id="__codelineno-218-7" name="__codelineno-218-7" href="#__codelineno-218-7"></a><span class="c1">-- Level bonus</span>
</span><span id="__span-218-8"><a id="__codelineno-218-8" name="__codelineno-218-8" href="#__codelineno-218-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-218-9"><a id="__codelineno-218-9" name="__codelineno-218-9" href="#__codelineno-218-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-218-10"><a id="__codelineno-218-10" name="__codelineno-218-10" href="#__codelineno-218-10"></a><span class="c1">-- Faction bonus</span>
</span><span id="__span-218-11"><a id="__codelineno-218-11" name="__codelineno-218-11" href="#__codelineno-218-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-218-12"><a id="__codelineno-218-12" name="__codelineno-218-12" href="#__codelineno-218-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-218-13"><a id="__codelineno-218-13" name="__codelineno-218-13" href="#__codelineno-218-13"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-218-14"><a id="__codelineno-218-14" name="__codelineno-218-14" href="#__codelineno-218-14"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
</span><span id="__span-218-15"><a id="__codelineno-218-15" name="__codelineno-218-15" href="#__codelineno-218-15"></a><span class="p">[</span><span class="s2">&quot;athlete&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-218-16"><a id="__codelineno-218-16" name="__codelineno-218-16" href="#__codelineno-218-16"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-218-17"><a id="__codelineno-218-17" name="__codelineno-218-17" href="#__codelineno-218-17"></a><span class="p">}</span>
</span><span id="__span-218-18"><a id="__codelineno-218-18" name="__codelineno-218-18" href="#__codelineno-218-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-218-19"><a id="__codelineno-218-19" name="__codelineno-218-19" href="#__codelineno-218-19"></a><span class="c1">-- Equipment bonuses</span>
</span><span id="__span-218-20"><a id="__codelineno-218-20" name="__codelineno-218-20" href="#__codelineno-218-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-218-21"><a id="__codelineno-218-21" name="__codelineno-218-21" href="#__codelineno-218-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-218-22"><a id="__codelineno-218-22" name="__codelineno-218-22" href="#__codelineno-218-22"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-218-23"><a id="__codelineno-218-23" name="__codelineno-218-23" href="#__codelineno-218-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-218-24"><a id="__codelineno-218-24" name="__codelineno-218-24" href="#__codelineno-218-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">staminaBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;staminaBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-218-25"><a id="__codelineno-218-25" name="__codelineno-218-25" href="#__codelineno-218-25"></a><span class="w">        </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">staminaBonus</span>
</span><span id="__span-218-26"><a id="__codelineno-218-26" name="__codelineno-218-26" href="#__codelineno-218-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-218-27"><a id="__codelineno-218-27" name="__codelineno-218-27" href="#__codelineno-218-27"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-218-28"><a id="__codelineno-218-28" name="__codelineno-218-28" href="#__codelineno-218-28"></a><span class="c1">-- Perk bonuses</span>
</span><span id="__span-218-29"><a id="__codelineno-218-29" name="__codelineno-218-29" href="#__codelineno-218-29"></a><span class="kd">local</span><span class="w"> </span><span class="nv">perks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;perks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-218-30"><a id="__codelineno-218-30" name="__codelineno-218-30" href="#__codelineno-218-30"></a><span class="kd">local</span><span class="w"> </span><span class="nv">perkBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-218-31"><a id="__codelineno-218-31" name="__codelineno-218-31" href="#__codelineno-218-31"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">perk</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">perks</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-218-32"><a id="__codelineno-218-32" name="__codelineno-218-32" href="#__codelineno-218-32"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">perk</span><span class="p">.</span><span class="py">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stamina&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-218-33"><a id="__codelineno-218-33" name="__codelineno-218-33" href="#__codelineno-218-33"></a><span class="w">        </span><span class="nv">perkBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">perkBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">perk</span><span class="p">.</span><span class="py">value</span>
</span><span id="__span-218-34"><a id="__codelineno-218-34" name="__codelineno-218-34" href="#__codelineno-218-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-218-35"><a id="__codelineno-218-35" name="__codelineno-218-35" href="#__codelineno-218-35"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-218-36"><a id="__codelineno-218-36" name="__codelineno-218-36" href="#__codelineno-218-36"></a><span class="c1">-- Calculate final stamina</span>
</span><span id="__span-218-37"><a id="__codelineno-218-37" name="__codelineno-218-37" href="#__codelineno-218-37"></a><span class="kd">local</span><span class="w"> </span><span class="nv">finalStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseStamina</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">conBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">perkBonus</span>
</span><span id="__span-218-38"><a id="__codelineno-218-38" name="__codelineno-218-38" href="#__codelineno-218-38"></a><span class="c1">-- Apply debuffs</span>
</span><span id="__span-218-39"><a id="__codelineno-218-39" name="__codelineno-218-39" href="#__codelineno-218-39"></a><span class="kd">local</span><span class="w"> </span><span class="nv">debuffs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;debuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-218-40"><a id="__codelineno-218-40" name="__codelineno-218-40" href="#__codelineno-218-40"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">debuff</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">debuffs</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-218-41"><a id="__codelineno-218-41" name="__codelineno-218-41" href="#__codelineno-218-41"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">debuff</span><span class="p">.</span><span class="py">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stamina&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-218-42"><a id="__codelineno-218-42" name="__codelineno-218-42" href="#__codelineno-218-42"></a><span class="w">        </span><span class="nv">finalStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalStamina</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">debuff</span><span class="p">.</span><span class="py">value</span><span class="p">)</span>
</span><span id="__span-218-43"><a id="__codelineno-218-43" name="__codelineno-218-43" href="#__codelineno-218-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-218-44"><a id="__codelineno-218-44" name="__codelineno-218-44" href="#__codelineno-218-44"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-218-45"><a id="__codelineno-218-45" name="__codelineno-218-45" href="#__codelineno-218-45"></a><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">finalStamina</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Minimum of 10</span>
</span><span id="__span-218-46"><a id="__codelineno-218-46" name="__codelineno-218-46" href="#__codelineno-218-46"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getdamagescale">GetDamageScale</h3>
<p><strong>Purpose</strong></p>
<p>Called to get damage scale for a hitgroup</p>
<p><strong>When Called</strong></p>
<p>When calculating damage to a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>hitgroup</code> (<em>number</em>): The hitgroup that was hit</li>
<li><code>dmgInfo</code> (<em>CTakeDamageInfo</em>): The damage info</li>
<li><code>damageScale</code> (<em>number</em>): The current damage scale</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The modified damage scale</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a><span class="c1">-- Simple: Return default scale</span>
</span><span id="__span-219-2"><a id="__codelineno-219-2" name="__codelineno-219-2" href="#__codelineno-219-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDamageScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-219-3"><a id="__codelineno-219-3" name="__codelineno-219-3" href="#__codelineno-219-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">damageScale</span>
</span><span id="__span-219-4"><a id="__codelineno-219-4" name="__codelineno-219-4" href="#__codelineno-219-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a><span class="c1">-- Medium: Hitgroup-specific scaling</span>
</span><span id="__span-220-2"><a id="__codelineno-220-2" name="__codelineno-220-2" href="#__codelineno-220-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDamageScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HitgroupScaling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-220-3"><a id="__codelineno-220-3" name="__codelineno-220-3" href="#__codelineno-220-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_HEAD</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-220-4"><a id="__codelineno-220-4" name="__codelineno-220-4" href="#__codelineno-220-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-220-5"><a id="__codelineno-220-5" name="__codelineno-220-5" href="#__codelineno-220-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_LEFTLEG</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_RIGHTLEG</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-220-6"><a id="__codelineno-220-6" name="__codelineno-220-6" href="#__codelineno-220-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-220-7"><a id="__codelineno-220-7" name="__codelineno-220-7" href="#__codelineno-220-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-220-8"><a id="__codelineno-220-8" name="__codelineno-220-8" href="#__codelineno-220-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">damageScale</span>
</span><span id="__span-220-9"><a id="__codelineno-220-9" name="__codelineno-220-9" href="#__codelineno-220-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a><span class="c1">-- High: Complex damage scaling system</span>
</span><span id="__span-221-2"><a id="__codelineno-221-2" name="__codelineno-221-2" href="#__codelineno-221-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDamageScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDamageScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-221-3"><a id="__codelineno-221-3" name="__codelineno-221-3" href="#__codelineno-221-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-221-4"><a id="__codelineno-221-4" name="__codelineno-221-4" href="#__codelineno-221-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetInflictor</span><span class="p">()</span>
</span><span id="__span-221-5"><a id="__codelineno-221-5" name="__codelineno-221-5" href="#__codelineno-221-5"></a><span class="c1">-- Hitgroup scaling</span>
</span><span id="__span-221-6"><a id="__codelineno-221-6" name="__codelineno-221-6" href="#__codelineno-221-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_HEAD</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-7"><a id="__codelineno-221-7" name="__codelineno-221-7" href="#__codelineno-221-7"></a><span class="w">    </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-221-8"><a id="__codelineno-221-8" name="__codelineno-221-8" href="#__codelineno-221-8"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_CHEST</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-9"><a id="__codelineno-221-9" name="__codelineno-221-9" href="#__codelineno-221-9"></a><span class="w">    </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span>
</span><span id="__span-221-10"><a id="__codelineno-221-10" name="__codelineno-221-10" href="#__codelineno-221-10"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_LEFTLEG</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_RIGHTLEG</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-11"><a id="__codelineno-221-11" name="__codelineno-221-11" href="#__codelineno-221-11"></a><span class="w">    </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-221-12"><a id="__codelineno-221-12" name="__codelineno-221-12" href="#__codelineno-221-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-221-13"><a id="__codelineno-221-13" name="__codelineno-221-13" href="#__codelineno-221-13"></a><span class="c1">-- Armor scaling</span>
</span><span id="__span-221-14"><a id="__codelineno-221-14" name="__codelineno-221-14" href="#__codelineno-221-14"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">victim</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">victim</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-15"><a id="__codelineno-221-15" name="__codelineno-221-15" href="#__codelineno-221-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">victim</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-221-16"><a id="__codelineno-221-16" name="__codelineno-221-16" href="#__codelineno-221-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-17"><a id="__codelineno-221-17" name="__codelineno-221-17" href="#__codelineno-221-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;armor&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-221-18"><a id="__codelineno-221-18" name="__codelineno-221-18" href="#__codelineno-221-18"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-221-19"><a id="__codelineno-221-19" name="__codelineno-221-19" href="#__codelineno-221-19"></a><span class="w">            </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">armor</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">200</span><span class="p">))</span>
</span><span id="__span-221-20"><a id="__codelineno-221-20" name="__codelineno-221-20" href="#__codelineno-221-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-221-21"><a id="__codelineno-221-21" name="__codelineno-221-21" href="#__codelineno-221-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-221-22"><a id="__codelineno-221-22" name="__codelineno-221-22" href="#__codelineno-221-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-221-23"><a id="__codelineno-221-23" name="__codelineno-221-23" href="#__codelineno-221-23"></a><span class="kr">return</span><span class="w"> </span><span class="nv">damageScale</span>
</span><span id="__span-221-24"><a id="__codelineno-221-24" name="__codelineno-221-24" href="#__codelineno-221-24"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getdefaultchardesc">GetDefaultCharDesc</h3>
<p><strong>Purpose</strong></p>
<p>Called to get default character description</p>
<p><strong>When Called</strong></p>
<p>When creating a new character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>factionIndex</code> (<em>number</em>): The faction index</li>
<li><code>context</code> (<em>table</em>): Additional context data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The default description</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a><span class="c1">-- Simple: Return generic description</span>
</span><span id="__span-222-2"><a id="__codelineno-222-2" name="__codelineno-222-2" href="#__codelineno-222-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharDesc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-222-3"><a id="__codelineno-222-3" name="__codelineno-222-3" href="#__codelineno-222-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;A new character&quot;</span>
</span><span id="__span-222-4"><a id="__codelineno-222-4" name="__codelineno-222-4" href="#__codelineno-222-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a><span class="c1">-- Medium: Faction-specific descriptions</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2" href="#__codelineno-223-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharDesc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionDescriptions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3" href="#__codelineno-223-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionDescs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-223-4"><a id="__codelineno-223-4" name="__codelineno-223-4" href="#__codelineno-223-4"></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A citizen of the city&quot;</span><span class="p">,</span>
</span><span id="__span-223-5"><a id="__codelineno-223-5" name="__codelineno-223-5" href="#__codelineno-223-5"></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A police officer&quot;</span><span class="p">,</span>
</span><span id="__span-223-6"><a id="__codelineno-223-6" name="__codelineno-223-6" href="#__codelineno-223-6"></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A medical professional&quot;</span>
</span><span id="__span-223-7"><a id="__codelineno-223-7" name="__codelineno-223-7" href="#__codelineno-223-7"></a><span class="p">}</span>
</span><span id="__span-223-8"><a id="__codelineno-223-8" name="__codelineno-223-8" href="#__codelineno-223-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">factionDescs</span><span class="p">[</span><span class="nv">factionIndex</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;A new character&quot;</span>
</span><span id="__span-223-9"><a id="__codelineno-223-9" name="__codelineno-223-9" href="#__codelineno-223-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a><span class="c1">-- High: Complex description generation</span>
</span><span id="__span-224-2"><a id="__codelineno-224-2" name="__codelineno-224-2" href="#__codelineno-224-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharDesc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharDesc&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-224-3"><a id="__codelineno-224-3" name="__codelineno-224-3" href="#__codelineno-224-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">factionIndex</span><span class="p">]</span>
</span><span id="__span-224-4"><a id="__codelineno-224-4" name="__codelineno-224-4" href="#__codelineno-224-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;A new character&quot;</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-224-5"><a id="__codelineno-224-5" name="__codelineno-224-5" href="#__codelineno-224-5"></a><span class="w">    </span><span class="c1">-- Generate description based on faction and context</span>
</span><span id="__span-224-6"><a id="__codelineno-224-6" name="__codelineno-224-6" href="#__codelineno-224-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">faction</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;character&quot;</span><span class="p">)</span>
</span><span id="__span-224-7"><a id="__codelineno-224-7" name="__codelineno-224-7" href="#__codelineno-224-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-224-8"><a id="__codelineno-224-8" name="__codelineno-224-8" href="#__codelineno-224-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetModelGender&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">model</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;person&quot;</span>
</span><span id="__span-224-9"><a id="__codelineno-224-9" name="__codelineno-224-9" href="#__codelineno-224-9"></a><span class="w">        </span><span class="nv">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; working as a &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">faction</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;character&quot;</span><span class="p">)</span>
</span><span id="__span-224-10"><a id="__codelineno-224-10" name="__codelineno-224-10" href="#__codelineno-224-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-224-11"><a id="__codelineno-224-11" name="__codelineno-224-11" href="#__codelineno-224-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">desc</span>
</span><span id="__span-224-12"><a id="__codelineno-224-12" name="__codelineno-224-12" href="#__codelineno-224-12"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getdefaultcharname">GetDefaultCharName</h3>
<p><strong>Purpose</strong></p>
<p>Called to get default character name</p>
<p><strong>When Called</strong></p>
<p>When creating a new character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>factionIndex</code> (<em>number</em>): The faction index</li>
<li><code>context</code> (<em>table</em>): Additional context data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The default name</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a><span class="c1">-- Simple: Return generic name</span>
</span><span id="__span-225-2"><a id="__codelineno-225-2" name="__codelineno-225-2" href="#__codelineno-225-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-225-3"><a id="__codelineno-225-3" name="__codelineno-225-3" href="#__codelineno-225-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span>
</span><span id="__span-225-4"><a id="__codelineno-225-4" name="__codelineno-225-4" href="#__codelineno-225-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-226-1"><a id="__codelineno-226-1" name="__codelineno-226-1" href="#__codelineno-226-1"></a><span class="c1">-- Medium: Faction-specific names</span>
</span><span id="__span-226-2"><a id="__codelineno-226-2" name="__codelineno-226-2" href="#__codelineno-226-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionNames&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-226-3"><a id="__codelineno-226-3" name="__codelineno-226-3" href="#__codelineno-226-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-226-4"><a id="__codelineno-226-4" name="__codelineno-226-4" href="#__codelineno-226-4"></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Citizen #&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">),</span>
</span><span id="__span-226-5"><a id="__codelineno-226-5" name="__codelineno-226-5" href="#__codelineno-226-5"></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Officer &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-226-6"><a id="__codelineno-226-6" name="__codelineno-226-6" href="#__codelineno-226-6"></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dr. &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span>
</span><span id="__span-226-7"><a id="__codelineno-226-7" name="__codelineno-226-7" href="#__codelineno-226-7"></a><span class="p">}</span>
</span><span id="__span-226-8"><a id="__codelineno-226-8" name="__codelineno-226-8" href="#__codelineno-226-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">factionNames</span><span class="p">[</span><span class="nv">factionIndex</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span>
</span><span id="__span-226-9"><a id="__codelineno-226-9" name="__codelineno-226-9" href="#__codelineno-226-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-227-1"><a id="__codelineno-227-1" name="__codelineno-227-1" href="#__codelineno-227-1"></a><span class="c1">-- High: Complex name generation</span>
</span><span id="__span-227-2"><a id="__codelineno-227-2" name="__codelineno-227-2" href="#__codelineno-227-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultCharName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharName&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">factionIndex</span><span class="p">,</span><span class="w"> </span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-227-3"><a id="__codelineno-227-3" name="__codelineno-227-3" href="#__codelineno-227-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">factionIndex</span><span class="p">]</span>
</span><span id="__span-227-4"><a id="__codelineno-227-4" name="__codelineno-227-4" href="#__codelineno-227-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-227-5"><a id="__codelineno-227-5" name="__codelineno-227-5" href="#__codelineno-227-5"></a><span class="w">    </span><span class="c1">-- Generate name based on faction</span>
</span><span id="__span-227-6"><a id="__codelineno-227-6" name="__codelineno-227-6" href="#__codelineno-227-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span>
</span><span id="__span-227-7"><a id="__codelineno-227-7" name="__codelineno-227-7" href="#__codelineno-227-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span>
</span><span id="__span-227-8"><a id="__codelineno-227-8" name="__codelineno-227-8" href="#__codelineno-227-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-227-9"><a id="__codelineno-227-9" name="__codelineno-227-9" href="#__codelineno-227-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;Officer &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">firstName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lastName</span>
</span><span id="__span-227-10"><a id="__codelineno-227-10" name="__codelineno-227-10" href="#__codelineno-227-10"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-227-11"><a id="__codelineno-227-11" name="__codelineno-227-11" href="#__codelineno-227-11"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;Dr. &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">firstName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lastName</span>
</span><span id="__span-227-12"><a id="__codelineno-227-12" name="__codelineno-227-12" href="#__codelineno-227-12"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-227-13"><a id="__codelineno-227-13" name="__codelineno-227-13" href="#__codelineno-227-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">firstName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lastName</span>
</span><span id="__span-227-14"><a id="__codelineno-227-14" name="__codelineno-227-14" href="#__codelineno-227-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-227-15"><a id="__codelineno-227-15" name="__codelineno-227-15" href="#__codelineno-227-15"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">firstName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lastName</span>
</span><span id="__span-227-16"><a id="__codelineno-227-16" name="__codelineno-227-16" href="#__codelineno-227-16"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getdefaultinventorysize">GetDefaultInventorySize</h3>
<p><strong>Purpose</strong></p>
<p>Called to get default inventory size</p>
<p><strong>When Called</strong></p>
<p>When creating a character's inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>char</code> (<em>Character</em>): The character</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - {width, height} inventory size</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-228-1"><a id="__codelineno-228-1" name="__codelineno-228-1" href="#__codelineno-228-1"></a><span class="c1">-- Simple: Return default size</span>
</span><span id="__span-228-2"><a id="__codelineno-228-2" name="__codelineno-228-2" href="#__codelineno-228-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-228-3"><a id="__codelineno-228-3" name="__codelineno-228-3" href="#__codelineno-228-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-228-4"><a id="__codelineno-228-4" name="__codelineno-228-4" href="#__codelineno-228-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-229-1"><a id="__codelineno-229-1" name="__codelineno-229-1" href="#__codelineno-229-1"></a><span class="c1">-- Medium: Faction-based sizes</span>
</span><span id="__span-229-2"><a id="__codelineno-229-2" name="__codelineno-229-2" href="#__codelineno-229-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionInventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-229-3"><a id="__codelineno-229-3" name="__codelineno-229-3" href="#__codelineno-229-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-229-4"><a id="__codelineno-229-4" name="__codelineno-229-4" href="#__codelineno-229-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-229-5"><a id="__codelineno-229-5" name="__codelineno-229-5" href="#__codelineno-229-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span>
</span><span id="__span-229-6"><a id="__codelineno-229-6" name="__codelineno-229-6" href="#__codelineno-229-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-229-7"><a id="__codelineno-229-7" name="__codelineno-229-7" href="#__codelineno-229-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
</span><span id="__span-229-8"><a id="__codelineno-229-8" name="__codelineno-229-8" href="#__codelineno-229-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-229-9"><a id="__codelineno-229-9" name="__codelineno-229-9" href="#__codelineno-229-9"></a><span class="kr">return</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-229-10"><a id="__codelineno-229-10" name="__codelineno-229-10" href="#__codelineno-229-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-230-1"><a id="__codelineno-230-1" name="__codelineno-230-1" href="#__codelineno-230-1"></a><span class="c1">-- High: Complex inventory sizing</span>
</span><span id="__span-230-2"><a id="__codelineno-230-2" name="__codelineno-230-2" href="#__codelineno-230-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-230-3"><a id="__codelineno-230-3" name="__codelineno-230-3" href="#__codelineno-230-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-230-4"><a id="__codelineno-230-4" name="__codelineno-230-4" href="#__codelineno-230-4"></a><span class="c1">-- Faction bonuses</span>
</span><span id="__span-230-5"><a id="__codelineno-230-5" name="__codelineno-230-5" href="#__codelineno-230-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-230-6"><a id="__codelineno-230-6" name="__codelineno-230-6" href="#__codelineno-230-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-230-7"><a id="__codelineno-230-7" name="__codelineno-230-7" href="#__codelineno-230-7"></a><span class="w">    </span><span class="nv">baseSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span>
</span><span id="__span-230-8"><a id="__codelineno-230-8" name="__codelineno-230-8" href="#__codelineno-230-8"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-230-9"><a id="__codelineno-230-9" name="__codelineno-230-9" href="#__codelineno-230-9"></a><span class="w">    </span><span class="nv">baseSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
</span><span id="__span-230-10"><a id="__codelineno-230-10" name="__codelineno-230-10" href="#__codelineno-230-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-230-11"><a id="__codelineno-230-11" name="__codelineno-230-11" href="#__codelineno-230-11"></a><span class="c1">-- Donator bonus</span>
</span><span id="__span-230-12"><a id="__codelineno-230-12" name="__codelineno-230-12" href="#__codelineno-230-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;donator&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-230-13"><a id="__codelineno-230-13" name="__codelineno-230-13" href="#__codelineno-230-13"></a><span class="w">    </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-230-14"><a id="__codelineno-230-14" name="__codelineno-230-14" href="#__codelineno-230-14"></a><span class="w">    </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-230-15"><a id="__codelineno-230-15" name="__codelineno-230-15" href="#__codelineno-230-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-230-16"><a id="__codelineno-230-16" name="__codelineno-230-16" href="#__codelineno-230-16"></a><span class="c1">-- Level bonus</span>
</span><span id="__span-230-17"><a id="__codelineno-230-17" name="__codelineno-230-17" href="#__codelineno-230-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-230-18"><a id="__codelineno-230-18" name="__codelineno-230-18" href="#__codelineno-230-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-230-19"><a id="__codelineno-230-19" name="__codelineno-230-19" href="#__codelineno-230-19"></a><span class="w">    </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-230-20"><a id="__codelineno-230-20" name="__codelineno-230-20" href="#__codelineno-230-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-230-21"><a id="__codelineno-230-21" name="__codelineno-230-21" href="#__codelineno-230-21"></a><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-230-22"><a id="__codelineno-230-22" name="__codelineno-230-22" href="#__codelineno-230-22"></a><span class="w">    </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-230-23"><a id="__codelineno-230-23" name="__codelineno-230-23" href="#__codelineno-230-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-230-24"><a id="__codelineno-230-24" name="__codelineno-230-24" href="#__codelineno-230-24"></a><span class="kr">return</span><span class="w"> </span><span class="nv">baseSize</span>
</span><span id="__span-230-25"><a id="__codelineno-230-25" name="__codelineno-230-25" href="#__codelineno-230-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getdefaultinventorytype">GetDefaultInventoryType</h3>
<p><strong>Purpose</strong></p>
<p>Called to get default inventory type</p>
<p><strong>When Called</strong></p>
<p>When creating a character's inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The inventory type</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-231-1"><a id="__codelineno-231-1" name="__codelineno-231-1" href="#__codelineno-231-1"></a><span class="c1">-- Simple: Return default type</span>
</span><span id="__span-231-2"><a id="__codelineno-231-2" name="__codelineno-231-2" href="#__codelineno-231-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventoryType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-231-3"><a id="__codelineno-231-3" name="__codelineno-231-3" href="#__codelineno-231-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;grid&quot;</span>
</span><span id="__span-231-4"><a id="__codelineno-231-4" name="__codelineno-231-4" href="#__codelineno-231-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-232-1"><a id="__codelineno-232-1" name="__codelineno-232-1" href="#__codelineno-232-1"></a><span class="c1">-- Medium: Faction-based types</span>
</span><span id="__span-232-2"><a id="__codelineno-232-2" name="__codelineno-232-2" href="#__codelineno-232-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventoryType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionInventoryType&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-232-3"><a id="__codelineno-232-3" name="__codelineno-232-3" href="#__codelineno-232-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-232-4"><a id="__codelineno-232-4" name="__codelineno-232-4" href="#__codelineno-232-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-232-5"><a id="__codelineno-232-5" name="__codelineno-232-5" href="#__codelineno-232-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;police_grid&quot;</span>
</span><span id="__span-232-6"><a id="__codelineno-232-6" name="__codelineno-232-6" href="#__codelineno-232-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-232-7"><a id="__codelineno-232-7" name="__codelineno-232-7" href="#__codelineno-232-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;medical_grid&quot;</span>
</span><span id="__span-232-8"><a id="__codelineno-232-8" name="__codelineno-232-8" href="#__codelineno-232-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-232-9"><a id="__codelineno-232-9" name="__codelineno-232-9" href="#__codelineno-232-9"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;grid&quot;</span>
</span><span id="__span-232-10"><a id="__codelineno-232-10" name="__codelineno-232-10" href="#__codelineno-232-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-233-1"><a id="__codelineno-233-1" name="__codelineno-233-1" href="#__codelineno-233-1"></a><span class="c1">-- High: Complex inventory type system</span>
</span><span id="__span-233-2"><a id="__codelineno-233-2" name="__codelineno-233-2" href="#__codelineno-233-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetDefaultInventoryType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInventoryType&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-233-3"><a id="__codelineno-233-3" name="__codelineno-233-3" href="#__codelineno-233-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-233-4"><a id="__codelineno-233-4" name="__codelineno-233-4" href="#__codelineno-233-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-233-5"><a id="__codelineno-233-5" name="__codelineno-233-5" href="#__codelineno-233-5"></a><span class="c1">-- Faction-specific types</span>
</span><span id="__span-233-6"><a id="__codelineno-233-6" name="__codelineno-233-6" href="#__codelineno-233-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-233-7"><a id="__codelineno-233-7" name="__codelineno-233-7" href="#__codelineno-233-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-233-8"><a id="__codelineno-233-8" name="__codelineno-233-8" href="#__codelineno-233-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;police_advanced_grid&quot;</span>
</span><span id="__span-233-9"><a id="__codelineno-233-9" name="__codelineno-233-9" href="#__codelineno-233-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-233-10"><a id="__codelineno-233-10" name="__codelineno-233-10" href="#__codelineno-233-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;police_grid&quot;</span>
</span><span id="__span-233-11"><a id="__codelineno-233-11" name="__codelineno-233-11" href="#__codelineno-233-11"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-233-12"><a id="__codelineno-233-12" name="__codelineno-233-12" href="#__codelineno-233-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-233-13"><a id="__codelineno-233-13" name="__codelineno-233-13" href="#__codelineno-233-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;medical_advanced_grid&quot;</span>
</span><span id="__span-233-14"><a id="__codelineno-233-14" name="__codelineno-233-14" href="#__codelineno-233-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-233-15"><a id="__codelineno-233-15" name="__codelineno-233-15" href="#__codelineno-233-15"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;medical_grid&quot;</span>
</span><span id="__span-233-16"><a id="__codelineno-233-16" name="__codelineno-233-16" href="#__codelineno-233-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-233-17"><a id="__codelineno-233-17" name="__codelineno-233-17" href="#__codelineno-233-17"></a><span class="c1">-- Default type with level progression</span>
</span><span id="__span-233-18"><a id="__codelineno-233-18" name="__codelineno-233-18" href="#__codelineno-233-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-233-19"><a id="__codelineno-233-19" name="__codelineno-233-19" href="#__codelineno-233-19"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;advanced_grid&quot;</span>
</span><span id="__span-233-20"><a id="__codelineno-233-20" name="__codelineno-233-20" href="#__codelineno-233-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-233-21"><a id="__codelineno-233-21" name="__codelineno-233-21" href="#__codelineno-233-21"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;grid&quot;</span>
</span><span id="__span-233-22"><a id="__codelineno-233-22" name="__codelineno-233-22" href="#__codelineno-233-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getentitysavedata">GetEntitySaveData</h3>
<p><strong>Purpose</strong></p>
<p>Called to get entity save data</p>
<p><strong>When Called</strong></p>
<p>When saving entity data to the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The entity to get save data for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - The save data for the entity</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-234-1"><a id="__codelineno-234-1" name="__codelineno-234-1" href="#__codelineno-234-1"></a><span class="c1">-- Simple: Return basic save data</span>
</span><span id="__span-234-2"><a id="__codelineno-234-2" name="__codelineno-234-2" href="#__codelineno-234-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetEntitySaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-234-3"><a id="__codelineno-234-3" name="__codelineno-234-3" href="#__codelineno-234-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-234-4"><a id="__codelineno-234-4" name="__codelineno-234-4" href="#__codelineno-234-4"></a><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-234-5"><a id="__codelineno-234-5" name="__codelineno-234-5" href="#__codelineno-234-5"></a><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">(),</span>
</span><span id="__span-234-6"><a id="__codelineno-234-6" name="__codelineno-234-6" href="#__codelineno-234-6"></a><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">()</span>
</span><span id="__span-234-7"><a id="__codelineno-234-7" name="__codelineno-234-7" href="#__codelineno-234-7"></a><span class="p">}</span>
</span><span id="__span-234-8"><a id="__codelineno-234-8" name="__codelineno-234-8" href="#__codelineno-234-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-235-1"><a id="__codelineno-235-1" name="__codelineno-235-1" href="#__codelineno-235-1"></a><span class="c1">-- Medium: Add custom entity data</span>
</span><span id="__span-235-2"><a id="__codelineno-235-2" name="__codelineno-235-2" href="#__codelineno-235-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetEntitySaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;EntityData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-235-3"><a id="__codelineno-235-3" name="__codelineno-235-3" href="#__codelineno-235-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-235-4"><a id="__codelineno-235-4" name="__codelineno-235-4" href="#__codelineno-235-4"></a><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-235-5"><a id="__codelineno-235-5" name="__codelineno-235-5" href="#__codelineno-235-5"></a><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">(),</span>
</span><span id="__span-235-6"><a id="__codelineno-235-6" name="__codelineno-235-6" href="#__codelineno-235-6"></a><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">(),</span>
</span><span id="__span-235-7"><a id="__codelineno-235-7" name="__codelineno-235-7" href="#__codelineno-235-7"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span>
</span><span id="__span-235-8"><a id="__codelineno-235-8" name="__codelineno-235-8" href="#__codelineno-235-8"></a><span class="p">}</span>
</span><span id="__span-235-9"><a id="__codelineno-235-9" name="__codelineno-235-9" href="#__codelineno-235-9"></a><span class="c1">-- Add custom data</span>
</span><span id="__span-235-10"><a id="__codelineno-235-10" name="__codelineno-235-10" href="#__codelineno-235-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-235-11"><a id="__codelineno-235-11" name="__codelineno-235-11" href="#__codelineno-235-11"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">customData</span>
</span><span id="__span-235-12"><a id="__codelineno-235-12" name="__codelineno-235-12" href="#__codelineno-235-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-235-13"><a id="__codelineno-235-13" name="__codelineno-235-13" href="#__codelineno-235-13"></a><span class="kr">return</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-235-14"><a id="__codelineno-235-14" name="__codelineno-235-14" href="#__codelineno-235-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-236-1"><a id="__codelineno-236-1" name="__codelineno-236-1" href="#__codelineno-236-1"></a><span class="c1">-- High: Complex entity save data system</span>
</span><span id="__span-236-2"><a id="__codelineno-236-2" name="__codelineno-236-2" href="#__codelineno-236-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetEntitySaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEntitySave&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-236-3"><a id="__codelineno-236-3" name="__codelineno-236-3" href="#__codelineno-236-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-236-4"><a id="__codelineno-236-4" name="__codelineno-236-4" href="#__codelineno-236-4"></a><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-236-5"><a id="__codelineno-236-5" name="__codelineno-236-5" href="#__codelineno-236-5"></a><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">(),</span>
</span><span id="__span-236-6"><a id="__codelineno-236-6" name="__codelineno-236-6" href="#__codelineno-236-6"></a><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">(),</span>
</span><span id="__span-236-7"><a id="__codelineno-236-7" name="__codelineno-236-7" href="#__codelineno-236-7"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-236-8"><a id="__codelineno-236-8" name="__codelineno-236-8" href="#__codelineno-236-8"></a><span class="nv">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">Health</span><span class="p">(),</span>
</span><span id="__span-236-9"><a id="__codelineno-236-9" name="__codelineno-236-9" href="#__codelineno-236-9"></a><span class="nv">maxHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()</span>
</span><span id="__span-236-10"><a id="__codelineno-236-10" name="__codelineno-236-10" href="#__codelineno-236-10"></a><span class="p">}</span>
</span><span id="__span-236-11"><a id="__codelineno-236-11" name="__codelineno-236-11" href="#__codelineno-236-11"></a><span class="c1">-- Add networked variables</span>
</span><span id="__span-236-12"><a id="__codelineno-236-12" name="__codelineno-236-12" href="#__codelineno-236-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">netVars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;saveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-236-13"><a id="__codelineno-236-13" name="__codelineno-236-13" href="#__codelineno-236-13"></a><span class="kr">for</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">netVars</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-236-14"><a id="__codelineno-236-14" name="__codelineno-236-14" href="#__codelineno-236-14"></a><span class="w">    </span><span class="nv">data</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-236-15"><a id="__codelineno-236-15" name="__codelineno-236-15" href="#__codelineno-236-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-236-16"><a id="__codelineno-236-16" name="__codelineno-236-16" href="#__codelineno-236-16"></a><span class="c1">-- Add custom entity data</span>
</span><span id="__span-236-17"><a id="__codelineno-236-17" name="__codelineno-236-17" href="#__codelineno-236-17"></a><span class="kr">if</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-236-18"><a id="__codelineno-236-18" name="__codelineno-236-18" href="#__codelineno-236-18"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">customData</span>
</span><span id="__span-236-19"><a id="__codelineno-236-19" name="__codelineno-236-19" href="#__codelineno-236-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-236-20"><a id="__codelineno-236-20" name="__codelineno-236-20" href="#__codelineno-236-20"></a><span class="c1">-- Add owner information</span>
</span><span id="__span-236-21"><a id="__codelineno-236-21" name="__codelineno-236-21" href="#__codelineno-236-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-236-22"><a id="__codelineno-236-22" name="__codelineno-236-22" href="#__codelineno-236-22"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-236-23"><a id="__codelineno-236-23" name="__codelineno-236-23" href="#__codelineno-236-23"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span>
</span><span id="__span-236-24"><a id="__codelineno-236-24" name="__codelineno-236-24" href="#__codelineno-236-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-236-25"><a id="__codelineno-236-25" name="__codelineno-236-25" href="#__codelineno-236-25"></a><span class="c1">-- Add creation timestamp</span>
</span><span id="__span-236-26"><a id="__codelineno-236-26" name="__codelineno-236-26" href="#__codelineno-236-26"></a><span class="nv">data</span><span class="p">.</span><span class="py">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;createdAt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-236-27"><a id="__codelineno-236-27" name="__codelineno-236-27" href="#__codelineno-236-27"></a><span class="kr">return</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-236-28"><a id="__codelineno-236-28" name="__codelineno-236-28" href="#__codelineno-236-28"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="gethandsattackspeed">GetHandsAttackSpeed</h3>
<p><strong>Purpose</strong></p>
<p>Called to get hands attack speed</p>
<p><strong>When Called</strong></p>
<p>When calculating unarmed attack speed for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose attack speed is being calculated</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The attack speed multiplier</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-237-1"><a id="__codelineno-237-1" name="__codelineno-237-1" href="#__codelineno-237-1"></a><span class="c1">-- Simple: Return default attack speed</span>
</span><span id="__span-237-2"><a id="__codelineno-237-2" name="__codelineno-237-2" href="#__codelineno-237-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetHandsAttackSpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-237-3"><a id="__codelineno-237-3" name="__codelineno-237-3" href="#__codelineno-237-3"></a><span class="kr">return</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-237-4"><a id="__codelineno-237-4" name="__codelineno-237-4" href="#__codelineno-237-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-238-1"><a id="__codelineno-238-1" name="__codelineno-238-1" href="#__codelineno-238-1"></a><span class="c1">-- Medium: Base speed on dexterity</span>
</span><span id="__span-238-2"><a id="__codelineno-238-2" name="__codelineno-238-2" href="#__codelineno-238-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetHandsAttackSpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DexteritySpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-238-3"><a id="__codelineno-238-3" name="__codelineno-238-3" href="#__codelineno-238-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-238-4"><a id="__codelineno-238-4" name="__codelineno-238-4" href="#__codelineno-238-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-238-5"><a id="__codelineno-238-5" name="__codelineno-238-5" href="#__codelineno-238-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;dex&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-238-6"><a id="__codelineno-238-6" name="__codelineno-238-6" href="#__codelineno-238-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">dex</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-238-7"><a id="__codelineno-238-7" name="__codelineno-238-7" href="#__codelineno-238-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-239-1"><a id="__codelineno-239-1" name="__codelineno-239-1" href="#__codelineno-239-1"></a><span class="c1">-- High: Complex attack speed system</span>
</span><span id="__span-239-2"><a id="__codelineno-239-2" name="__codelineno-239-2" href="#__codelineno-239-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetHandsAttackSpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAttackSpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-239-3"><a id="__codelineno-239-3" name="__codelineno-239-3" href="#__codelineno-239-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-239-4"><a id="__codelineno-239-4" name="__codelineno-239-4" href="#__codelineno-239-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-239-5"><a id="__codelineno-239-5" name="__codelineno-239-5" href="#__codelineno-239-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-239-6"><a id="__codelineno-239-6" name="__codelineno-239-6" href="#__codelineno-239-6"></a><span class="w">    </span><span class="c1">-- Dexterity bonus</span>
</span><span id="__span-239-7"><a id="__codelineno-239-7" name="__codelineno-239-7" href="#__codelineno-239-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;dex&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-239-8"><a id="__codelineno-239-8" name="__codelineno-239-8" href="#__codelineno-239-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">dexBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dex</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span>
</span><span id="__span-239-9"><a id="__codelineno-239-9" name="__codelineno-239-9" href="#__codelineno-239-9"></a><span class="w">    </span><span class="c1">-- Level bonus</span>
</span><span id="__span-239-10"><a id="__codelineno-239-10" name="__codelineno-239-10" href="#__codelineno-239-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-239-11"><a id="__codelineno-239-11" name="__codelineno-239-11" href="#__codelineno-239-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span>
</span><span id="__span-239-12"><a id="__codelineno-239-12" name="__codelineno-239-12" href="#__codelineno-239-12"></a><span class="w">    </span><span class="c1">-- Faction bonus</span>
</span><span id="__span-239-13"><a id="__codelineno-239-13" name="__codelineno-239-13" href="#__codelineno-239-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-239-14"><a id="__codelineno-239-14" name="__codelineno-239-14" href="#__codelineno-239-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-239-15"><a id="__codelineno-239-15" name="__codelineno-239-15" href="#__codelineno-239-15"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;athlete&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="__span-239-16"><a id="__codelineno-239-16" name="__codelineno-239-16" href="#__codelineno-239-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-239-17"><a id="__codelineno-239-17" name="__codelineno-239-17" href="#__codelineno-239-17"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
</span><span id="__span-239-18"><a id="__codelineno-239-18" name="__codelineno-239-18" href="#__codelineno-239-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-239-19"><a id="__codelineno-239-19" name="__codelineno-239-19" href="#__codelineno-239-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mf">0.0</span>
</span><span id="__span-239-20"><a id="__codelineno-239-20" name="__codelineno-239-20" href="#__codelineno-239-20"></a><span class="w">    </span><span class="c1">-- Equipment bonus</span>
</span><span id="__span-239-21"><a id="__codelineno-239-21" name="__codelineno-239-21" href="#__codelineno-239-21"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span>
</span><span id="__span-239-22"><a id="__codelineno-239-22" name="__codelineno-239-22" href="#__codelineno-239-22"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-239-23"><a id="__codelineno-239-23" name="__codelineno-239-23" href="#__codelineno-239-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-239-24"><a id="__codelineno-239-24" name="__codelineno-239-24" href="#__codelineno-239-24"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-239-25"><a id="__codelineno-239-25" name="__codelineno-239-25" href="#__codelineno-239-25"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;boxing_gloves&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-239-26"><a id="__codelineno-239-26" name="__codelineno-239-26" href="#__codelineno-239-26"></a><span class="w">                </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.2</span>
</span><span id="__span-239-27"><a id="__codelineno-239-27" name="__codelineno-239-27" href="#__codelineno-239-27"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-239-28"><a id="__codelineno-239-28" name="__codelineno-239-28" href="#__codelineno-239-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-239-29"><a id="__codelineno-239-29" name="__codelineno-239-29" href="#__codelineno-239-29"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-239-30"><a id="__codelineno-239-30" name="__codelineno-239-30" href="#__codelineno-239-30"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">baseSpeed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">dexBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">equipmentBonus</span>
</span><span id="__span-239-31"><a id="__codelineno-239-31" name="__codelineno-239-31" href="#__codelineno-239-31"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getitemdropmodel">GetItemDropModel</h3>
<p><strong>Purpose</strong></p>
<p>Called to get item drop model</p>
<p><strong>When Called</strong></p>
<p>When determining the model for a dropped item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>itemTable</code> (<em>table</em>): The item table</li>
<li><code>self</code> (<em>Item</em>): The item instance</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The model path for the dropped item</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-240-1"><a id="__codelineno-240-1" name="__codelineno-240-1" href="#__codelineno-240-1"></a><span class="c1">-- Simple: Return default model</span>
</span><span id="__span-240-2"><a id="__codelineno-240-2" name="__codelineno-240-2" href="#__codelineno-240-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemDropModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-240-3"><a id="__codelineno-240-3" name="__codelineno-240-3" href="#__codelineno-240-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box004a.mdl&quot;</span>
</span><span id="__span-240-4"><a id="__codelineno-240-4" name="__codelineno-240-4" href="#__codelineno-240-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-241-1"><a id="__codelineno-241-1" name="__codelineno-241-1" href="#__codelineno-241-1"></a><span class="c1">-- Medium: Use item-specific models</span>
</span><span id="__span-241-2"><a id="__codelineno-241-2" name="__codelineno-241-2" href="#__codelineno-241-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemDropModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemModels&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-241-3"><a id="__codelineno-241-3" name="__codelineno-241-3" href="#__codelineno-241-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-241-4"><a id="__codelineno-241-4" name="__codelineno-241-4" href="#__codelineno-241-4"></a><span class="p">[</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/weapons/w_pistol.mdl&quot;</span><span class="p">,</span>
</span><span id="__span-241-5"><a id="__codelineno-241-5" name="__codelineno-241-5" href="#__codelineno-241-5"></a><span class="p">[</span><span class="s2">&quot;medkit&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/items/medkit.mdl&quot;</span><span class="p">,</span>
</span><span id="__span-241-6"><a id="__codelineno-241-6" name="__codelineno-241-6" href="#__codelineno-241-6"></a><span class="p">[</span><span class="s2">&quot;money&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/props/cs_assault/money.mdl&quot;</span>
</span><span id="__span-241-7"><a id="__codelineno-241-7" name="__codelineno-241-7" href="#__codelineno-241-7"></a><span class="p">}</span>
</span><span id="__span-241-8"><a id="__codelineno-241-8" name="__codelineno-241-8" href="#__codelineno-241-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">models</span><span class="p">[</span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box004a.mdl&quot;</span>
</span><span id="__span-241-9"><a id="__codelineno-241-9" name="__codelineno-241-9" href="#__codelineno-241-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-242-1"><a id="__codelineno-242-1" name="__codelineno-242-1" href="#__codelineno-242-1"></a><span class="c1">-- High: Complex item model system</span>
</span><span id="__span-242-2"><a id="__codelineno-242-2" name="__codelineno-242-2" href="#__codelineno-242-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemDropModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemModels&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-242-3"><a id="__codelineno-242-3" name="__codelineno-242-3" href="#__codelineno-242-3"></a><span class="c1">-- Check for custom model in item data</span>
</span><span id="__span-242-4"><a id="__codelineno-242-4" name="__codelineno-242-4" href="#__codelineno-242-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">customModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;dropModel&quot;</span><span class="p">)</span>
</span><span id="__span-242-5"><a id="__codelineno-242-5" name="__codelineno-242-5" href="#__codelineno-242-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">customModel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-242-6"><a id="__codelineno-242-6" name="__codelineno-242-6" href="#__codelineno-242-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">customModel</span>
</span><span id="__span-242-7"><a id="__codelineno-242-7" name="__codelineno-242-7" href="#__codelineno-242-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-242-8"><a id="__codelineno-242-8" name="__codelineno-242-8" href="#__codelineno-242-8"></a><span class="c1">-- Check for faction-specific models</span>
</span><span id="__span-242-9"><a id="__codelineno-242-9" name="__codelineno-242-9" href="#__codelineno-242-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-242-10"><a id="__codelineno-242-10" name="__codelineno-242-10" href="#__codelineno-242-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-242-11"><a id="__codelineno-242-11" name="__codelineno-242-11" href="#__codelineno-242-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-242-12"><a id="__codelineno-242-12" name="__codelineno-242-12" href="#__codelineno-242-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-242-13"><a id="__codelineno-242-13" name="__codelineno-242-13" href="#__codelineno-242-13"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-242-14"><a id="__codelineno-242-14" name="__codelineno-242-14" href="#__codelineno-242-14"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/weapons/w_pistol_police.mdl&quot;</span>
</span><span id="__span-242-15"><a id="__codelineno-242-15" name="__codelineno-242-15" href="#__codelineno-242-15"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-242-16"><a id="__codelineno-242-16" name="__codelineno-242-16" href="#__codelineno-242-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-242-17"><a id="__codelineno-242-17" name="__codelineno-242-17" href="#__codelineno-242-17"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medkit&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/items/medkit_advanced.mdl&quot;</span>
</span><span id="__span-242-18"><a id="__codelineno-242-18" name="__codelineno-242-18" href="#__codelineno-242-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-242-19"><a id="__codelineno-242-19" name="__codelineno-242-19" href="#__codelineno-242-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-242-20"><a id="__codelineno-242-20" name="__codelineno-242-20" href="#__codelineno-242-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionModels</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">factionModels</span><span class="p">[</span><span class="nv">faction</span><span class="p">][</span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span>
</span><span id="__span-242-21"><a id="__codelineno-242-21" name="__codelineno-242-21" href="#__codelineno-242-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">factionModel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-242-22"><a id="__codelineno-242-22" name="__codelineno-242-22" href="#__codelineno-242-22"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">factionModel</span>
</span><span id="__span-242-23"><a id="__codelineno-242-23" name="__codelineno-242-23" href="#__codelineno-242-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-242-24"><a id="__codelineno-242-24" name="__codelineno-242-24" href="#__codelineno-242-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-242-25"><a id="__codelineno-242-25" name="__codelineno-242-25" href="#__codelineno-242-25"></a><span class="c1">-- Check for quality-based models</span>
</span><span id="__span-242-26"><a id="__codelineno-242-26" name="__codelineno-242-26" href="#__codelineno-242-26"></a><span class="kd">local</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="p">)</span>
</span><span id="__span-242-27"><a id="__codelineno-242-27" name="__codelineno-242-27" href="#__codelineno-242-27"></a><span class="kd">local</span><span class="w"> </span><span class="nv">qualityModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-242-28"><a id="__codelineno-242-28" name="__codelineno-242-28" href="#__codelineno-242-28"></a><span class="p">[</span><span class="s2">&quot;rare&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">rareModel</span><span class="p">,</span>
</span><span id="__span-242-29"><a id="__codelineno-242-29" name="__codelineno-242-29" href="#__codelineno-242-29"></a><span class="p">[</span><span class="s2">&quot;epic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">epicModel</span><span class="p">,</span>
</span><span id="__span-242-30"><a id="__codelineno-242-30" name="__codelineno-242-30" href="#__codelineno-242-30"></a><span class="p">[</span><span class="s2">&quot;legendary&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">legendaryModel</span>
</span><span id="__span-242-31"><a id="__codelineno-242-31" name="__codelineno-242-31" href="#__codelineno-242-31"></a><span class="p">}</span>
</span><span id="__span-242-32"><a id="__codelineno-242-32" name="__codelineno-242-32" href="#__codelineno-242-32"></a><span class="kd">local</span><span class="w"> </span><span class="nv">qualityModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">qualityModels</span><span class="p">[</span><span class="nv">quality</span><span class="p">]</span>
</span><span id="__span-242-33"><a id="__codelineno-242-33" name="__codelineno-242-33" href="#__codelineno-242-33"></a><span class="kr">if</span><span class="w"> </span><span class="nv">qualityModel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-242-34"><a id="__codelineno-242-34" name="__codelineno-242-34" href="#__codelineno-242-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">qualityModel</span>
</span><span id="__span-242-35"><a id="__codelineno-242-35" name="__codelineno-242-35" href="#__codelineno-242-35"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-242-36"><a id="__codelineno-242-36" name="__codelineno-242-36" href="#__codelineno-242-36"></a><span class="c1">-- Return default model</span>
</span><span id="__span-242-37"><a id="__codelineno-242-37" name="__codelineno-242-37" href="#__codelineno-242-37"></a><span class="kr">return</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box004a.mdl&quot;</span>
</span><span id="__span-242-38"><a id="__codelineno-242-38" name="__codelineno-242-38" href="#__codelineno-242-38"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getitemstackkey">GetItemStackKey</h3>
<p><strong>Purpose</strong></p>
<p>Called to get item stack key</p>
<p><strong>When Called</strong></p>
<p>When determining how items should be stacked together</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>item</code> (<em>Item</em>): The item to get stack key for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The stack key for grouping items</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-243-1"><a id="__codelineno-243-1" name="__codelineno-243-1" href="#__codelineno-243-1"></a><span class="c1">-- Simple: Use item ID as stack key</span>
</span><span id="__span-243-2"><a id="__codelineno-243-2" name="__codelineno-243-2" href="#__codelineno-243-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStackKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-243-3"><a id="__codelineno-243-3" name="__codelineno-243-3" href="#__codelineno-243-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-243-4"><a id="__codelineno-243-4" name="__codelineno-243-4" href="#__codelineno-243-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-244-1"><a id="__codelineno-244-1" name="__codelineno-244-1" href="#__codelineno-244-1"></a><span class="c1">-- Medium: Include item data in stack key</span>
</span><span id="__span-244-2"><a id="__codelineno-244-2" name="__codelineno-244-2" href="#__codelineno-244-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStackKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemDataStacking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-244-3"><a id="__codelineno-244-3" name="__codelineno-244-3" href="#__codelineno-244-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-244-4"><a id="__codelineno-244-4" name="__codelineno-244-4" href="#__codelineno-244-4"></a><span class="c1">-- Include quality in stack key</span>
</span><span id="__span-244-5"><a id="__codelineno-244-5" name="__codelineno-244-5" href="#__codelineno-244-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="p">)</span>
</span><span id="__span-244-6"><a id="__codelineno-244-6" name="__codelineno-244-6" href="#__codelineno-244-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-244-7"><a id="__codelineno-244-7" name="__codelineno-244-7" href="#__codelineno-244-7"></a><span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">quality</span>
</span><span id="__span-244-8"><a id="__codelineno-244-8" name="__codelineno-244-8" href="#__codelineno-244-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-244-9"><a id="__codelineno-244-9" name="__codelineno-244-9" href="#__codelineno-244-9"></a><span class="kr">return</span><span class="w"> </span><span class="nv">key</span>
</span><span id="__span-244-10"><a id="__codelineno-244-10" name="__codelineno-244-10" href="#__codelineno-244-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-245-1"><a id="__codelineno-245-1" name="__codelineno-245-1" href="#__codelineno-245-1"></a><span class="c1">-- High: Complex item stacking system</span>
</span><span id="__span-245-2"><a id="__codelineno-245-2" name="__codelineno-245-2" href="#__codelineno-245-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStackKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemStacking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-245-3"><a id="__codelineno-245-3" name="__codelineno-245-3" href="#__codelineno-245-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-245-4"><a id="__codelineno-245-4" name="__codelineno-245-4" href="#__codelineno-245-4"></a><span class="c1">-- Include quality in stack key</span>
</span><span id="__span-245-5"><a id="__codelineno-245-5" name="__codelineno-245-5" href="#__codelineno-245-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="p">)</span>
</span><span id="__span-245-6"><a id="__codelineno-245-6" name="__codelineno-245-6" href="#__codelineno-245-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-245-7"><a id="__codelineno-245-7" name="__codelineno-245-7" href="#__codelineno-245-7"></a><span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">quality</span>
</span><span id="__span-245-8"><a id="__codelineno-245-8" name="__codelineno-245-8" href="#__codelineno-245-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-245-9"><a id="__codelineno-245-9" name="__codelineno-245-9" href="#__codelineno-245-9"></a><span class="c1">-- Include durability for stackable items</span>
</span><span id="__span-245-10"><a id="__codelineno-245-10" name="__codelineno-245-10" href="#__codelineno-245-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">)</span>
</span><span id="__span-245-11"><a id="__codelineno-245-11" name="__codelineno-245-11" href="#__codelineno-245-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-245-12"><a id="__codelineno-245-12" name="__codelineno-245-12" href="#__codelineno-245-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">durabilityTier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">durability</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-245-13"><a id="__codelineno-245-13" name="__codelineno-245-13" href="#__codelineno-245-13"></a><span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;_dur&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">durabilityTier</span>
</span><span id="__span-245-14"><a id="__codelineno-245-14" name="__codelineno-245-14" href="#__codelineno-245-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-245-15"><a id="__codelineno-245-15" name="__codelineno-245-15" href="#__codelineno-245-15"></a><span class="c1">-- Include enchantments</span>
</span><span id="__span-245-16"><a id="__codelineno-245-16" name="__codelineno-245-16" href="#__codelineno-245-16"></a><span class="kd">local</span><span class="w"> </span><span class="nv">enchantments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;enchantments&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-245-17"><a id="__codelineno-245-17" name="__codelineno-245-17" href="#__codelineno-245-17"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">enchantments</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-245-18"><a id="__codelineno-245-18" name="__codelineno-245-18" href="#__codelineno-245-18"></a><span class="w">    </span><span class="nb">table.sort</span><span class="p">(</span><span class="nv">enchantments</span><span class="p">)</span>
</span><span id="__span-245-19"><a id="__codelineno-245-19" name="__codelineno-245-19" href="#__codelineno-245-19"></a><span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;_ench&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">table.concat</span><span class="p">(</span><span class="nv">enchantments</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="__span-245-20"><a id="__codelineno-245-20" name="__codelineno-245-20" href="#__codelineno-245-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-245-21"><a id="__codelineno-245-21" name="__codelineno-245-21" href="#__codelineno-245-21"></a><span class="c1">-- Include custom data</span>
</span><span id="__span-245-22"><a id="__codelineno-245-22" name="__codelineno-245-22" href="#__codelineno-245-22"></a><span class="kd">local</span><span class="w"> </span><span class="nv">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;stackData&quot;</span><span class="p">)</span>
</span><span id="__span-245-23"><a id="__codelineno-245-23" name="__codelineno-245-23" href="#__codelineno-245-23"></a><span class="kr">if</span><span class="w"> </span><span class="nv">customData</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-245-24"><a id="__codelineno-245-24" name="__codelineno-245-24" href="#__codelineno-245-24"></a><span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">customData</span>
</span><span id="__span-245-25"><a id="__codelineno-245-25" name="__codelineno-245-25" href="#__codelineno-245-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-245-26"><a id="__codelineno-245-26" name="__codelineno-245-26" href="#__codelineno-245-26"></a><span class="kr">return</span><span class="w"> </span><span class="nv">key</span>
</span><span id="__span-245-27"><a id="__codelineno-245-27" name="__codelineno-245-27" href="#__codelineno-245-27"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getitemstacks">GetItemStacks</h3>
<p><strong>Purpose</strong></p>
<p>Called to get item stacks in an inventory</p>
<p><strong>When Called</strong></p>
<p>When retrieving stacked items from an inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>inventory</code> (<em>Inventory</em>): The inventory to get stacks from</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - Table of item stacks</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-246-1"><a id="__codelineno-246-1" name="__codelineno-246-1" href="#__codelineno-246-1"></a><span class="c1">-- Simple: Return empty stacks</span>
</span><span id="__span-246-2"><a id="__codelineno-246-2" name="__codelineno-246-2" href="#__codelineno-246-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-246-3"><a id="__codelineno-246-3" name="__codelineno-246-3" href="#__codelineno-246-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-246-4"><a id="__codelineno-246-4" name="__codelineno-246-4" href="#__codelineno-246-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-247-1"><a id="__codelineno-247-1" name="__codelineno-247-1" href="#__codelineno-247-1"></a><span class="c1">-- Medium: Group items by ID</span>
</span><span id="__span-247-2"><a id="__codelineno-247-2" name="__codelineno-247-2" href="#__codelineno-247-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BasicStacking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-247-3"><a id="__codelineno-247-3" name="__codelineno-247-3" href="#__codelineno-247-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-247-4"><a id="__codelineno-247-4" name="__codelineno-247-4" href="#__codelineno-247-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-247-5"><a id="__codelineno-247-5" name="__codelineno-247-5" href="#__codelineno-247-5"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-247-6"><a id="__codelineno-247-6" name="__codelineno-247-6" href="#__codelineno-247-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-247-7"><a id="__codelineno-247-7" name="__codelineno-247-7" href="#__codelineno-247-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-247-8"><a id="__codelineno-247-8" name="__codelineno-247-8" href="#__codelineno-247-8"></a><span class="w">        </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-247-9"><a id="__codelineno-247-9" name="__codelineno-247-9" href="#__codelineno-247-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-247-10"><a id="__codelineno-247-10" name="__codelineno-247-10" href="#__codelineno-247-10"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">],</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-247-11"><a id="__codelineno-247-11" name="__codelineno-247-11" href="#__codelineno-247-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-247-12"><a id="__codelineno-247-12" name="__codelineno-247-12" href="#__codelineno-247-12"></a><span class="kr">return</span><span class="w"> </span><span class="nv">stacks</span>
</span><span id="__span-247-13"><a id="__codelineno-247-13" name="__codelineno-247-13" href="#__codelineno-247-13"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-248-1"><a id="__codelineno-248-1" name="__codelineno-248-1" href="#__codelineno-248-1"></a><span class="c1">-- High: Complex item stacking system</span>
</span><span id="__span-248-2"><a id="__codelineno-248-2" name="__codelineno-248-2" href="#__codelineno-248-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetItemStacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStacking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-248-3"><a id="__codelineno-248-3" name="__codelineno-248-3" href="#__codelineno-248-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-248-4"><a id="__codelineno-248-4" name="__codelineno-248-4" href="#__codelineno-248-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-248-5"><a id="__codelineno-248-5" name="__codelineno-248-5" href="#__codelineno-248-5"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-248-6"><a id="__codelineno-248-6" name="__codelineno-248-6" href="#__codelineno-248-6"></a><span class="w">    </span><span class="c1">-- Get stack key using the hook</span>
</span><span id="__span-248-7"><a id="__codelineno-248-7" name="__codelineno-248-7" href="#__codelineno-248-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetItemStackKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-248-8"><a id="__codelineno-248-8" name="__codelineno-248-8" href="#__codelineno-248-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-248-9"><a id="__codelineno-248-9" name="__codelineno-248-9" href="#__codelineno-248-9"></a><span class="w">        </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-248-10"><a id="__codelineno-248-10" name="__codelineno-248-10" href="#__codelineno-248-10"></a><span class="w">        </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-248-11"><a id="__codelineno-248-11" name="__codelineno-248-11" href="#__codelineno-248-11"></a><span class="w">        </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-248-12"><a id="__codelineno-248-12" name="__codelineno-248-12" href="#__codelineno-248-12"></a><span class="w">        </span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-248-13"><a id="__codelineno-248-13" name="__codelineno-248-13" href="#__codelineno-248-13"></a><span class="w">        </span><span class="nv">stackData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-248-14"><a id="__codelineno-248-14" name="__codelineno-248-14" href="#__codelineno-248-14"></a><span class="w">        </span><span class="nv">uniqueID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span>
</span><span id="__span-248-15"><a id="__codelineno-248-15" name="__codelineno-248-15" href="#__codelineno-248-15"></a><span class="w">        </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">name</span><span class="p">,</span>
</span><span id="__span-248-16"><a id="__codelineno-248-16" name="__codelineno-248-16" href="#__codelineno-248-16"></a><span class="w">        </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">model</span>
</span><span id="__span-248-17"><a id="__codelineno-248-17" name="__codelineno-248-17" href="#__codelineno-248-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-248-18"><a id="__codelineno-248-18" name="__codelineno-248-18" href="#__codelineno-248-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-248-19"><a id="__codelineno-248-19" name="__codelineno-248-19" href="#__codelineno-248-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-248-20"><a id="__codelineno-248-20" name="__codelineno-248-20" href="#__codelineno-248-20"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">].</span><span class="nv">items</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-248-21"><a id="__codelineno-248-21" name="__codelineno-248-21" href="#__codelineno-248-21"></a><span class="w">    </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">].</span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">].</span><span class="nv">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-248-22"><a id="__codelineno-248-22" name="__codelineno-248-22" href="#__codelineno-248-22"></a><span class="w">    </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">].</span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stacks</span><span class="p">[</span><span class="nv">key</span><span class="p">].</span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-248-23"><a id="__codelineno-248-23" name="__codelineno-248-23" href="#__codelineno-248-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-248-24"><a id="__codelineno-248-24" name="__codelineno-248-24" href="#__codelineno-248-24"></a><span class="c1">-- Sort stacks by count</span>
</span><span id="__span-248-25"><a id="__codelineno-248-25" name="__codelineno-248-25" href="#__codelineno-248-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sortedStacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-248-26"><a id="__codelineno-248-26" name="__codelineno-248-26" href="#__codelineno-248-26"></a><span class="kr">for</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">stack</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">stacks</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-248-27"><a id="__codelineno-248-27" name="__codelineno-248-27" href="#__codelineno-248-27"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">sortedStacks</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stack</span><span class="p">})</span>
</span><span id="__span-248-28"><a id="__codelineno-248-28" name="__codelineno-248-28" href="#__codelineno-248-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-248-29"><a id="__codelineno-248-29" name="__codelineno-248-29" href="#__codelineno-248-29"></a><span class="nb">table.sort</span><span class="p">(</span><span class="nv">sortedStacks</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span>
</span><span id="__span-248-30"><a id="__codelineno-248-30" name="__codelineno-248-30" href="#__codelineno-248-30"></a><span class="kr">return</span><span class="w"> </span><span class="nv">a</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="py">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">b</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="py">count</span>
</span><span id="__span-248-31"><a id="__codelineno-248-31" name="__codelineno-248-31" href="#__codelineno-248-31"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-248-32"><a id="__codelineno-248-32" name="__codelineno-248-32" href="#__codelineno-248-32"></a><span class="kr">return</span><span class="w"> </span><span class="nv">sortedStacks</span>
</span><span id="__span-248-33"><a id="__codelineno-248-33" name="__codelineno-248-33" href="#__codelineno-248-33"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getmaxplayerchar">GetMaxPlayerChar</h3>
<p><strong>Purpose</strong></p>
<p>Called to get maximum character count for a player</p>
<p><strong>When Called</strong></p>
<p>When checking how many characters a player can have</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player to check character limit for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The maximum number of characters allowed</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-249-1"><a id="__codelineno-249-1" name="__codelineno-249-1" href="#__codelineno-249-1"></a><span class="c1">-- Simple: Return default limit</span>
</span><span id="__span-249-2"><a id="__codelineno-249-2" name="__codelineno-249-2" href="#__codelineno-249-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxPlayerChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-249-3"><a id="__codelineno-249-3" name="__codelineno-249-3" href="#__codelineno-249-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-249-4"><a id="__codelineno-249-4" name="__codelineno-249-4" href="#__codelineno-249-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-250-1"><a id="__codelineno-250-1" name="__codelineno-250-1" href="#__codelineno-250-1"></a><span class="c1">-- Medium: Different limits for different players</span>
</span><span id="__span-250-2"><a id="__codelineno-250-2" name="__codelineno-250-2" href="#__codelineno-250-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxPlayerChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PlayerLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-250-3"><a id="__codelineno-250-3" name="__codelineno-250-3" href="#__codelineno-250-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-250-4"><a id="__codelineno-250-4" name="__codelineno-250-4" href="#__codelineno-250-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-250-5"><a id="__codelineno-250-5" name="__codelineno-250-5" href="#__codelineno-250-5"></a><span class="kr">else</span>
</span><span id="__span-250-6"><a id="__codelineno-250-6" name="__codelineno-250-6" href="#__codelineno-250-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-250-7"><a id="__codelineno-250-7" name="__codelineno-250-7" href="#__codelineno-250-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-250-8"><a id="__codelineno-250-8" name="__codelineno-250-8" href="#__codelineno-250-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-251-1"><a id="__codelineno-251-1" name="__codelineno-251-1" href="#__codelineno-251-1"></a><span class="c1">-- High: Complex character limit system</span>
</span><span id="__span-251-2"><a id="__codelineno-251-2" name="__codelineno-251-2" href="#__codelineno-251-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxPlayerChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-251-3"><a id="__codelineno-251-3" name="__codelineno-251-3" href="#__codelineno-251-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-251-4"><a id="__codelineno-251-4" name="__codelineno-251-4" href="#__codelineno-251-4"></a><span class="c1">-- Admin bonus</span>
</span><span id="__span-251-5"><a id="__codelineno-251-5" name="__codelineno-251-5" href="#__codelineno-251-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-6"><a id="__codelineno-251-6" name="__codelineno-251-6" href="#__codelineno-251-6"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-251-7"><a id="__codelineno-251-7" name="__codelineno-251-7" href="#__codelineno-251-7"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-8"><a id="__codelineno-251-8" name="__codelineno-251-8" href="#__codelineno-251-8"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-251-9"><a id="__codelineno-251-9" name="__codelineno-251-9" href="#__codelineno-251-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-251-10"><a id="__codelineno-251-10" name="__codelineno-251-10" href="#__codelineno-251-10"></a><span class="c1">-- Donator bonus</span>
</span><span id="__span-251-11"><a id="__codelineno-251-11" name="__codelineno-251-11" href="#__codelineno-251-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-251-12"><a id="__codelineno-251-12" name="__codelineno-251-12" href="#__codelineno-251-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-13"><a id="__codelineno-251-13" name="__codelineno-251-13" href="#__codelineno-251-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;donatorLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-251-14"><a id="__codelineno-251-14" name="__codelineno-251-14" href="#__codelineno-251-14"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">donatorLevel</span>
</span><span id="__span-251-15"><a id="__codelineno-251-15" name="__codelineno-251-15" href="#__codelineno-251-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-251-16"><a id="__codelineno-251-16" name="__codelineno-251-16" href="#__codelineno-251-16"></a><span class="c1">-- Play time bonus</span>
</span><span id="__span-251-17"><a id="__codelineno-251-17" name="__codelineno-251-17" href="#__codelineno-251-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetTotalPlayTime</span><span class="p">()</span>
</span><span id="__span-251-18"><a id="__codelineno-251-18" name="__codelineno-251-18" href="#__codelineno-251-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">hours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-251-19"><a id="__codelineno-251-19" name="__codelineno-251-19" href="#__codelineno-251-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hours</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-20"><a id="__codelineno-251-20" name="__codelineno-251-20" href="#__codelineno-251-20"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-251-21"><a id="__codelineno-251-21" name="__codelineno-251-21" href="#__codelineno-251-21"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">hours</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-22"><a id="__codelineno-251-22" name="__codelineno-251-22" href="#__codelineno-251-22"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-251-23"><a id="__codelineno-251-23" name="__codelineno-251-23" href="#__codelineno-251-23"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">hours</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-24"><a id="__codelineno-251-24" name="__codelineno-251-24" href="#__codelineno-251-24"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-251-25"><a id="__codelineno-251-25" name="__codelineno-251-25" href="#__codelineno-251-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-251-26"><a id="__codelineno-251-26" name="__codelineno-251-26" href="#__codelineno-251-26"></a><span class="c1">-- Faction bonus</span>
</span><span id="__span-251-27"><a id="__codelineno-251-27" name="__codelineno-251-27" href="#__codelineno-251-27"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-251-28"><a id="__codelineno-251-28" name="__codelineno-251-28" href="#__codelineno-251-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-251-29"><a id="__codelineno-251-29" name="__codelineno-251-29" href="#__codelineno-251-29"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-251-30"><a id="__codelineno-251-30" name="__codelineno-251-30" href="#__codelineno-251-30"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-251-31"><a id="__codelineno-251-31" name="__codelineno-251-31" href="#__codelineno-251-31"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-251-32"><a id="__codelineno-251-32" name="__codelineno-251-32" href="#__codelineno-251-32"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-251-33"><a id="__codelineno-251-33" name="__codelineno-251-33" href="#__codelineno-251-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-251-34"><a id="__codelineno-251-34" name="__codelineno-251-34" href="#__codelineno-251-34"></a><span class="w">    </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">baseLimit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-251-35"><a id="__codelineno-251-35" name="__codelineno-251-35" href="#__codelineno-251-35"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-251-36"><a id="__codelineno-251-36" name="__codelineno-251-36" href="#__codelineno-251-36"></a><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">baseLimit</span><span class="p">)</span>
</span><span id="__span-251-37"><a id="__codelineno-251-37" name="__codelineno-251-37" href="#__codelineno-251-37"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getmaxstartingattributepoints">GetMaxStartingAttributePoints</h3>
<p><strong>Purpose</strong></p>
<p>Called to get maximum starting attribute points</p>
<p><strong>When Called</strong></p>
<p>During character creation</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player creating the character</li>
<li><code>count</code> (<em>number</em>): The current count</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The maximum starting attribute points</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-252-1"><a id="__codelineno-252-1" name="__codelineno-252-1" href="#__codelineno-252-1"></a><span class="c1">-- Simple: Return default count</span>
</span><span id="__span-252-2"><a id="__codelineno-252-2" name="__codelineno-252-2" href="#__codelineno-252-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxStartingAttributePoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-252-3"><a id="__codelineno-252-3" name="__codelineno-252-3" href="#__codelineno-252-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-252-4"><a id="__codelineno-252-4" name="__codelineno-252-4" href="#__codelineno-252-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-253-1"><a id="__codelineno-253-1" name="__codelineno-253-1" href="#__codelineno-253-1"></a><span class="c1">-- Medium: Playtime-based points</span>
</span><span id="__span-253-2"><a id="__codelineno-253-2" name="__codelineno-253-2" href="#__codelineno-253-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxStartingAttributePoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PlaytimePoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-253-3"><a id="__codelineno-253-3" name="__codelineno-253-3" href="#__codelineno-253-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-253-4"><a id="__codelineno-253-4" name="__codelineno-253-4" href="#__codelineno-253-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">36000</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 10 hours</span>
</span><span id="__span-253-5"><a id="__codelineno-253-5" name="__codelineno-253-5" href="#__codelineno-253-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">15</span>
</span><span id="__span-253-6"><a id="__codelineno-253-6" name="__codelineno-253-6" href="#__codelineno-253-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-253-7"><a id="__codelineno-253-7" name="__codelineno-253-7" href="#__codelineno-253-7"></a><span class="kr">return</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-253-8"><a id="__codelineno-253-8" name="__codelineno-253-8" href="#__codelineno-253-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-254-1"><a id="__codelineno-254-1" name="__codelineno-254-1" href="#__codelineno-254-1"></a><span class="c1">-- High: Complex starting points system</span>
</span><span id="__span-254-2"><a id="__codelineno-254-2" name="__codelineno-254-2" href="#__codelineno-254-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMaxStartingAttributePoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStartingPoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-254-3"><a id="__codelineno-254-3" name="__codelineno-254-3" href="#__codelineno-254-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-254-4"><a id="__codelineno-254-4" name="__codelineno-254-4" href="#__codelineno-254-4"></a><span class="c1">-- Playtime bonus</span>
</span><span id="__span-254-5"><a id="__codelineno-254-5" name="__codelineno-254-5" href="#__codelineno-254-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-254-6"><a id="__codelineno-254-6" name="__codelineno-254-6" href="#__codelineno-254-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">36000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-254-7"><a id="__codelineno-254-7" name="__codelineno-254-7" href="#__codelineno-254-7"></a><span class="w">    </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-254-8"><a id="__codelineno-254-8" name="__codelineno-254-8" href="#__codelineno-254-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-254-9"><a id="__codelineno-254-9" name="__codelineno-254-9" href="#__codelineno-254-9"></a><span class="c1">-- Donator bonus</span>
</span><span id="__span-254-10"><a id="__codelineno-254-10" name="__codelineno-254-10" href="#__codelineno-254-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;donator&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-254-11"><a id="__codelineno-254-11" name="__codelineno-254-11" href="#__codelineno-254-11"></a><span class="w">    </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-254-12"><a id="__codelineno-254-12" name="__codelineno-254-12" href="#__codelineno-254-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-254-13"><a id="__codelineno-254-13" name="__codelineno-254-13" href="#__codelineno-254-13"></a><span class="c1">-- Achievement bonus</span>
</span><span id="__span-254-14"><a id="__codelineno-254-14" name="__codelineno-254-14" href="#__codelineno-254-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">achievements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;achievements&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-254-15"><a id="__codelineno-254-15" name="__codelineno-254-15" href="#__codelineno-254-15"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">achievements</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-254-16"><a id="__codelineno-254-16" name="__codelineno-254-16" href="#__codelineno-254-16"></a><span class="w">    </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">basePoints</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-254-17"><a id="__codelineno-254-17" name="__codelineno-254-17" href="#__codelineno-254-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-254-18"><a id="__codelineno-254-18" name="__codelineno-254-18" href="#__codelineno-254-18"></a><span class="kr">return</span><span class="w"> </span><span class="nv">basePoints</span>
</span><span id="__span-254-19"><a id="__codelineno-254-19" name="__codelineno-254-19" href="#__codelineno-254-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getmoneymodel">GetMoneyModel</h3>
<p><strong>Purpose</strong></p>
<p>Called to get money model</p>
<p><strong>When Called</strong></p>
<p>When spawning money entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>amount</code> (<em>number</em>): The money amount</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The model path</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-255-1"><a id="__codelineno-255-1" name="__codelineno-255-1" href="#__codelineno-255-1"></a><span class="c1">-- Simple: Return default model</span>
</span><span id="__span-255-2"><a id="__codelineno-255-2" name="__codelineno-255-2" href="#__codelineno-255-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMoneyModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">amount</span><span class="p">)</span>
</span><span id="__span-255-3"><a id="__codelineno-255-3" name="__codelineno-255-3" href="#__codelineno-255-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_lab/box01a.mdl&quot;</span>
</span><span id="__span-255-4"><a id="__codelineno-255-4" name="__codelineno-255-4" href="#__codelineno-255-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-256-1"><a id="__codelineno-256-1" name="__codelineno-256-1" href="#__codelineno-256-1"></a><span class="c1">-- Medium: Amount-based models</span>
</span><span id="__span-256-2"><a id="__codelineno-256-2" name="__codelineno-256-2" href="#__codelineno-256-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMoneyModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AmountBasedModels&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">amount</span><span class="p">)</span>
</span><span id="__span-256-3"><a id="__codelineno-256-3" name="__codelineno-256-3" href="#__codelineno-256-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-256-4"><a id="__codelineno-256-4" name="__codelineno-256-4" href="#__codelineno-256-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props/cs_office/briefcase.mdl&quot;</span>
</span><span id="__span-256-5"><a id="__codelineno-256-5" name="__codelineno-256-5" href="#__codelineno-256-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-256-6"><a id="__codelineno-256-6" name="__codelineno-256-6" href="#__codelineno-256-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_lab/box01a.mdl&quot;</span>
</span><span id="__span-256-7"><a id="__codelineno-256-7" name="__codelineno-256-7" href="#__codelineno-256-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-256-8"><a id="__codelineno-256-8" name="__codelineno-256-8" href="#__codelineno-256-8"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box001a.mdl&quot;</span>
</span><span id="__span-256-9"><a id="__codelineno-256-9" name="__codelineno-256-9" href="#__codelineno-256-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-257-1"><a id="__codelineno-257-1" name="__codelineno-257-1" href="#__codelineno-257-1"></a><span class="c1">-- High: Complex money model system</span>
</span><span id="__span-257-2"><a id="__codelineno-257-2" name="__codelineno-257-2" href="#__codelineno-257-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetMoneyModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedMoneyModels&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">amount</span><span class="p">)</span>
</span><span id="__span-257-3"><a id="__codelineno-257-3" name="__codelineno-257-3" href="#__codelineno-257-3"></a><span class="c1">-- Different models based on amount tiers</span>
</span><span id="__span-257-4"><a id="__codelineno-257-4" name="__codelineno-257-4" href="#__codelineno-257-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-257-5"><a id="__codelineno-257-5" name="__codelineno-257-5" href="#__codelineno-257-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props/cs_office/briefcase.mdl&quot;</span>
</span><span id="__span-257-6"><a id="__codelineno-257-6" name="__codelineno-257-6" href="#__codelineno-257-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-257-7"><a id="__codelineno-257-7" name="__codelineno-257-7" href="#__codelineno-257-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_c17/suitcase001a.mdl&quot;</span>
</span><span id="__span-257-8"><a id="__codelineno-257-8" name="__codelineno-257-8" href="#__codelineno-257-8"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-257-9"><a id="__codelineno-257-9" name="__codelineno-257-9" href="#__codelineno-257-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_lab/box01a.mdl&quot;</span>
</span><span id="__span-257-10"><a id="__codelineno-257-10" name="__codelineno-257-10" href="#__codelineno-257-10"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-257-11"><a id="__codelineno-257-11" name="__codelineno-257-11" href="#__codelineno-257-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box002a.mdl&quot;</span>
</span><span id="__span-257-12"><a id="__codelineno-257-12" name="__codelineno-257-12" href="#__codelineno-257-12"></a><span class="kr">else</span>
</span><span id="__span-257-13"><a id="__codelineno-257-13" name="__codelineno-257-13" href="#__codelineno-257-13"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/props_junk/cardboard_box001a.mdl&quot;</span>
</span><span id="__span-257-14"><a id="__codelineno-257-14" name="__codelineno-257-14" href="#__codelineno-257-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-257-15"><a id="__codelineno-257-15" name="__codelineno-257-15" href="#__codelineno-257-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getoocdelay">GetOOCDelay</h3>
<p><strong>Purpose</strong></p>
<p>Called to get OOC chat delay</p>
<p><strong>When Called</strong></p>
<p>When checking OOC chat cooldown</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>speaker</code> (<em>Player</em>): The player speaking</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The delay in seconds</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-258-1"><a id="__codelineno-258-1" name="__codelineno-258-1" href="#__codelineno-258-1"></a><span class="c1">-- Simple: Return default delay</span>
</span><span id="__span-258-2"><a id="__codelineno-258-2" name="__codelineno-258-2" href="#__codelineno-258-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetOOCDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">)</span>
</span><span id="__span-258-3"><a id="__codelineno-258-3" name="__codelineno-258-3" href="#__codelineno-258-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-258-4"><a id="__codelineno-258-4" name="__codelineno-258-4" href="#__codelineno-258-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-259-1"><a id="__codelineno-259-1" name="__codelineno-259-1" href="#__codelineno-259-1"></a><span class="c1">-- Medium: Admin bypass</span>
</span><span id="__span-259-2"><a id="__codelineno-259-2" name="__codelineno-259-2" href="#__codelineno-259-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetOOCDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdminOOCBypass&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">)</span>
</span><span id="__span-259-3"><a id="__codelineno-259-3" name="__codelineno-259-3" href="#__codelineno-259-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-259-4"><a id="__codelineno-259-4" name="__codelineno-259-4" href="#__codelineno-259-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-259-5"><a id="__codelineno-259-5" name="__codelineno-259-5" href="#__codelineno-259-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-259-6"><a id="__codelineno-259-6" name="__codelineno-259-6" href="#__codelineno-259-6"></a><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-259-7"><a id="__codelineno-259-7" name="__codelineno-259-7" href="#__codelineno-259-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-260-1"><a id="__codelineno-260-1" name="__codelineno-260-1" href="#__codelineno-260-1"></a><span class="c1">-- High: Complex OOC delay system</span>
</span><span id="__span-260-2"><a id="__codelineno-260-2" name="__codelineno-260-2" href="#__codelineno-260-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetOOCDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedOOCDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">)</span>
</span><span id="__span-260-3"><a id="__codelineno-260-3" name="__codelineno-260-3" href="#__codelineno-260-3"></a><span class="c1">-- Admins have no delay</span>
</span><span id="__span-260-4"><a id="__codelineno-260-4" name="__codelineno-260-4" href="#__codelineno-260-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-260-5"><a id="__codelineno-260-5" name="__codelineno-260-5" href="#__codelineno-260-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-260-6"><a id="__codelineno-260-6" name="__codelineno-260-6" href="#__codelineno-260-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-260-7"><a id="__codelineno-260-7" name="__codelineno-260-7" href="#__codelineno-260-7"></a><span class="c1">-- Donators have reduced delay</span>
</span><span id="__span-260-8"><a id="__codelineno-260-8" name="__codelineno-260-8" href="#__codelineno-260-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;donator&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-260-9"><a id="__codelineno-260-9" name="__codelineno-260-9" href="#__codelineno-260-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-260-10"><a id="__codelineno-260-10" name="__codelineno-260-10" href="#__codelineno-260-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-260-11"><a id="__codelineno-260-11" name="__codelineno-260-11" href="#__codelineno-260-11"></a><span class="c1">-- New players have longer delay</span>
</span><span id="__span-260-12"><a id="__codelineno-260-12" name="__codelineno-260-12" href="#__codelineno-260-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-260-13"><a id="__codelineno-260-13" name="__codelineno-260-13" href="#__codelineno-260-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- Less than 1 hour</span>
</span><span id="__span-260-14"><a id="__codelineno-260-14" name="__codelineno-260-14" href="#__codelineno-260-14"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-260-15"><a id="__codelineno-260-15" name="__codelineno-260-15" href="#__codelineno-260-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-260-16"><a id="__codelineno-260-16" name="__codelineno-260-16" href="#__codelineno-260-16"></a><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-260-17"><a id="__codelineno-260-17" name="__codelineno-260-17" href="#__codelineno-260-17"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getplaytime">GetPlayTime</h3>
<p><strong>Purpose</strong></p>
<p>Called to get player playtime</p>
<p><strong>When Called</strong></p>
<p>When retrieving player playtime</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The playtime in seconds</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-261-1"><a id="__codelineno-261-1" name="__codelineno-261-1" href="#__codelineno-261-1"></a><span class="c1">-- Simple: Return UTime playtime</span>
</span><span id="__span-261-2"><a id="__codelineno-261-2" name="__codelineno-261-2" href="#__codelineno-261-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-261-3"><a id="__codelineno-261-3" name="__codelineno-261-3" href="#__codelineno-261-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-261-4"><a id="__codelineno-261-4" name="__codelineno-261-4" href="#__codelineno-261-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-262-1"><a id="__codelineno-262-1" name="__codelineno-262-1" href="#__codelineno-262-1"></a><span class="c1">-- Medium: Add session time</span>
</span><span id="__span-262-2"><a id="__codelineno-262-2" name="__codelineno-262-2" href="#__codelineno-262-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PlayTimeWithSession&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-262-3"><a id="__codelineno-262-3" name="__codelineno-262-3" href="#__codelineno-262-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">totalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-262-4"><a id="__codelineno-262-4" name="__codelineno-262-4" href="#__codelineno-262-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sessionTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeSessionTime</span><span class="p">()</span>
</span><span id="__span-262-5"><a id="__codelineno-262-5" name="__codelineno-262-5" href="#__codelineno-262-5"></a><span class="kr">return</span><span class="w"> </span><span class="nv">totalTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">sessionTime</span>
</span><span id="__span-262-6"><a id="__codelineno-262-6" name="__codelineno-262-6" href="#__codelineno-262-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-263-1"><a id="__codelineno-263-1" name="__codelineno-263-1" href="#__codelineno-263-1"></a><span class="c1">-- High: Complex playtime tracking</span>
</span><span id="__span-263-2"><a id="__codelineno-263-2" name="__codelineno-263-2" href="#__codelineno-263-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPlayTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-263-3"><a id="__codelineno-263-3" name="__codelineno-263-3" href="#__codelineno-263-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-263-4"><a id="__codelineno-263-4" name="__codelineno-263-4" href="#__codelineno-263-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-263-5"><a id="__codelineno-263-5" name="__codelineno-263-5" href="#__codelineno-263-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-263-6"><a id="__codelineno-263-6" name="__codelineno-263-6" href="#__codelineno-263-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-263-7"><a id="__codelineno-263-7" name="__codelineno-263-7" href="#__codelineno-263-7"></a><span class="c1">-- Get character-specific playtime</span>
</span><span id="__span-263-8"><a id="__codelineno-263-8" name="__codelineno-263-8" href="#__codelineno-263-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charPlayTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;playTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-263-9"><a id="__codelineno-263-9" name="__codelineno-263-9" href="#__codelineno-263-9"></a><span class="c1">-- Add current session time</span>
</span><span id="__span-263-10"><a id="__codelineno-263-10" name="__codelineno-263-10" href="#__codelineno-263-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sessionStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sessionStart&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-263-11"><a id="__codelineno-263-11" name="__codelineno-263-11" href="#__codelineno-263-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">sessionTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">sessionStart</span>
</span><span id="__span-263-12"><a id="__codelineno-263-12" name="__codelineno-263-12" href="#__codelineno-263-12"></a><span class="kr">return</span><span class="w"> </span><span class="nv">charPlayTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">sessionTime</span>
</span><span id="__span-263-13"><a id="__codelineno-263-13" name="__codelineno-263-13" href="#__codelineno-263-13"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getplayerdeathsound">GetPlayerDeathSound</h3>
<p><strong>Purpose</strong></p>
<p>Called to get player death sound</p>
<p><strong>When Called</strong></p>
<p>When a player dies</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The dying player</li>
<li><code>isFemale</code> (<em>boolean</em>): Whether the player is female</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The death sound path</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-264-1"><a id="__codelineno-264-1" name="__codelineno-264-1" href="#__codelineno-264-1"></a><span class="c1">-- Simple: Return default sound</span>
</span><span id="__span-264-2"><a id="__codelineno-264-2" name="__codelineno-264-2" href="#__codelineno-264-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerDeathSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-264-3"><a id="__codelineno-264-3" name="__codelineno-264-3" href="#__codelineno-264-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain09.wav&quot;</span>
</span><span id="__span-264-4"><a id="__codelineno-264-4" name="__codelineno-264-4" href="#__codelineno-264-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-265-1"><a id="__codelineno-265-1" name="__codelineno-265-1" href="#__codelineno-265-1"></a><span class="c1">-- Medium: Gender-based sounds</span>
</span><span id="__span-265-2"><a id="__codelineno-265-2" name="__codelineno-265-2" href="#__codelineno-265-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerDeathSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GenderDeathSounds&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-265-3"><a id="__codelineno-265-3" name="__codelineno-265-3" href="#__codelineno-265-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-265-4"><a id="__codelineno-265-4" name="__codelineno-265-4" href="#__codelineno-265-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain09.wav&quot;</span>
</span><span id="__span-265-5"><a id="__codelineno-265-5" name="__codelineno-265-5" href="#__codelineno-265-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-265-6"><a id="__codelineno-265-6" name="__codelineno-265-6" href="#__codelineno-265-6"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain09.wav&quot;</span>
</span><span id="__span-265-7"><a id="__codelineno-265-7" name="__codelineno-265-7" href="#__codelineno-265-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-266-1"><a id="__codelineno-266-1" name="__codelineno-266-1" href="#__codelineno-266-1"></a><span class="c1">-- High: Complex death sound system</span>
</span><span id="__span-266-2"><a id="__codelineno-266-2" name="__codelineno-266-2" href="#__codelineno-266-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerDeathSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDeathSounds&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-266-3"><a id="__codelineno-266-3" name="__codelineno-266-3" href="#__codelineno-266-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-266-4"><a id="__codelineno-266-4" name="__codelineno-266-4" href="#__codelineno-266-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-266-5"><a id="__codelineno-266-5" name="__codelineno-266-5" href="#__codelineno-266-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain09.wav&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain09.wav&quot;</span>
</span><span id="__span-266-6"><a id="__codelineno-266-6" name="__codelineno-266-6" href="#__codelineno-266-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-266-7"><a id="__codelineno-266-7" name="__codelineno-266-7" href="#__codelineno-266-7"></a><span class="c1">-- Faction-specific sounds</span>
</span><span id="__span-266-8"><a id="__codelineno-266-8" name="__codelineno-266-8" href="#__codelineno-266-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-266-9"><a id="__codelineno-266-9" name="__codelineno-266-9" href="#__codelineno-266-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;combine&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-266-10"><a id="__codelineno-266-10" name="__codelineno-266-10" href="#__codelineno-266-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;npc/combine_soldier/die&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-266-11"><a id="__codelineno-266-11" name="__codelineno-266-11" href="#__codelineno-266-11"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;zombie&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-266-12"><a id="__codelineno-266-12" name="__codelineno-266-12" href="#__codelineno-266-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;npc/zombie/zombie_die&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-266-13"><a id="__codelineno-266-13" name="__codelineno-266-13" href="#__codelineno-266-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-266-14"><a id="__codelineno-266-14" name="__codelineno-266-14" href="#__codelineno-266-14"></a><span class="c1">-- Gender-based sounds</span>
</span><span id="__span-266-15"><a id="__codelineno-266-15" name="__codelineno-266-15" href="#__codelineno-266-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-266-16"><a id="__codelineno-266-16" name="__codelineno-266-16" href="#__codelineno-266-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-266-17"><a id="__codelineno-266-17" name="__codelineno-266-17" href="#__codelineno-266-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-266-18"><a id="__codelineno-266-18" name="__codelineno-266-18" href="#__codelineno-266-18"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-266-19"><a id="__codelineno-266-19" name="__codelineno-266-19" href="#__codelineno-266-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getplayerpainsound">GetPlayerPainSound</h3>
<p><strong>Purpose</strong></p>
<p>Called to get player pain sound</p>
<p><strong>When Called</strong></p>
<p>When a player takes damage</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player taking damage</li>
<li><code>paintype</code> (<em>number</em>): The type of pain</li>
<li><code>isFemale</code> (<em>boolean</em>): Whether the player is female</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The pain sound path</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-267-1"><a id="__codelineno-267-1" name="__codelineno-267-1" href="#__codelineno-267-1"></a><span class="c1">-- Simple: Return default sound</span>
</span><span id="__span-267-2"><a id="__codelineno-267-2" name="__codelineno-267-2" href="#__codelineno-267-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPainSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">paintype</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-267-3"><a id="__codelineno-267-3" name="__codelineno-267-3" href="#__codelineno-267-3"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain01.wav&quot;</span>
</span><span id="__span-267-4"><a id="__codelineno-267-4" name="__codelineno-267-4" href="#__codelineno-267-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-268-1"><a id="__codelineno-268-1" name="__codelineno-268-1" href="#__codelineno-268-1"></a><span class="c1">-- Medium: Gender-based pain sounds</span>
</span><span id="__span-268-2"><a id="__codelineno-268-2" name="__codelineno-268-2" href="#__codelineno-268-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPainSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GenderPainSounds&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">paintype</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-268-3"><a id="__codelineno-268-3" name="__codelineno-268-3" href="#__codelineno-268-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-268-4"><a id="__codelineno-268-4" name="__codelineno-268-4" href="#__codelineno-268-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-268-5"><a id="__codelineno-268-5" name="__codelineno-268-5" href="#__codelineno-268-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-268-6"><a id="__codelineno-268-6" name="__codelineno-268-6" href="#__codelineno-268-6"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-268-7"><a id="__codelineno-268-7" name="__codelineno-268-7" href="#__codelineno-268-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-269-1"><a id="__codelineno-269-1" name="__codelineno-269-1" href="#__codelineno-269-1"></a><span class="c1">-- High: Complex pain sound system</span>
</span><span id="__span-269-2"><a id="__codelineno-269-2" name="__codelineno-269-2" href="#__codelineno-269-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPainSound&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPainSounds&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">paintype</span><span class="p">,</span><span class="w"> </span><span class="nv">isFemale</span><span class="p">)</span>
</span><span id="__span-269-3"><a id="__codelineno-269-3" name="__codelineno-269-3" href="#__codelineno-269-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-269-4"><a id="__codelineno-269-4" name="__codelineno-269-4" href="#__codelineno-269-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-269-5"><a id="__codelineno-269-5" name="__codelineno-269-5" href="#__codelineno-269-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain01.wav&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain01.wav&quot;</span>
</span><span id="__span-269-6"><a id="__codelineno-269-6" name="__codelineno-269-6" href="#__codelineno-269-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-269-7"><a id="__codelineno-269-7" name="__codelineno-269-7" href="#__codelineno-269-7"></a><span class="c1">-- Faction-specific sounds</span>
</span><span id="__span-269-8"><a id="__codelineno-269-8" name="__codelineno-269-8" href="#__codelineno-269-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-269-9"><a id="__codelineno-269-9" name="__codelineno-269-9" href="#__codelineno-269-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;combine&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-269-10"><a id="__codelineno-269-10" name="__codelineno-269-10" href="#__codelineno-269-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;npc/combine_soldier/pain&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-269-11"><a id="__codelineno-269-11" name="__codelineno-269-11" href="#__codelineno-269-11"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;zombie&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-269-12"><a id="__codelineno-269-12" name="__codelineno-269-12" href="#__codelineno-269-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;npc/zombie/zombie_pain&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-269-13"><a id="__codelineno-269-13" name="__codelineno-269-13" href="#__codelineno-269-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-269-14"><a id="__codelineno-269-14" name="__codelineno-269-14" href="#__codelineno-269-14"></a><span class="c1">-- Pain type-based sounds</span>
</span><span id="__span-269-15"><a id="__codelineno-269-15" name="__codelineno-269-15" href="#__codelineno-269-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-269-16"><a id="__codelineno-269-16" name="__codelineno-269-16" href="#__codelineno-269-16"></a><span class="kr">if</span><span class="w"> </span><span class="nv">paintype</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- Light damage</span>
</span><span id="__span-269-17"><a id="__codelineno-269-17" name="__codelineno-269-17" href="#__codelineno-269-17"></a><span class="w">    </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-269-18"><a id="__codelineno-269-18" name="__codelineno-269-18" href="#__codelineno-269-18"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">paintype</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- Medium damage</span>
</span><span id="__span-269-19"><a id="__codelineno-269-19" name="__codelineno-269-19" href="#__codelineno-269-19"></a><span class="w">    </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-269-20"><a id="__codelineno-269-20" name="__codelineno-269-20" href="#__codelineno-269-20"></a><span class="kr">else</span><span class="w"> </span><span class="c1">-- Heavy damage</span>
</span><span id="__span-269-21"><a id="__codelineno-269-21" name="__codelineno-269-21" href="#__codelineno-269-21"></a><span class="w">    </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.random</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
</span><span id="__span-269-22"><a id="__codelineno-269-22" name="__codelineno-269-22" href="#__codelineno-269-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-269-23"><a id="__codelineno-269-23" name="__codelineno-269-23" href="#__codelineno-269-23"></a><span class="c1">-- Gender-based sounds</span>
</span><span id="__span-269-24"><a id="__codelineno-269-24" name="__codelineno-269-24" href="#__codelineno-269-24"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isFemale</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-269-25"><a id="__codelineno-269-25" name="__codelineno-269-25" href="#__codelineno-269-25"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/female01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-269-26"><a id="__codelineno-269-26" name="__codelineno-269-26" href="#__codelineno-269-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-269-27"><a id="__codelineno-269-27" name="__codelineno-269-27" href="#__codelineno-269-27"></a><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;vo/npc/male01/pain0&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">soundNum</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;.wav&quot;</span>
</span><span id="__span-269-28"><a id="__codelineno-269-28" name="__codelineno-269-28" href="#__codelineno-269-28"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getplayerpunchdamage">GetPlayerPunchDamage</h3>
<p><strong>Purpose</strong></p>
<p>Called to get player punch damage</p>
<p><strong>When Called</strong></p>
<p>When calculating unarmed punch damage for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose punch damage is being calculated</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The punch damage amount</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-270-1"><a id="__codelineno-270-1" name="__codelineno-270-1" href="#__codelineno-270-1"></a><span class="c1">-- Simple: Return default punch damage</span>
</span><span id="__span-270-2"><a id="__codelineno-270-2" name="__codelineno-270-2" href="#__codelineno-270-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-270-3"><a id="__codelineno-270-3" name="__codelineno-270-3" href="#__codelineno-270-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-270-4"><a id="__codelineno-270-4" name="__codelineno-270-4" href="#__codelineno-270-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-271-1"><a id="__codelineno-271-1" name="__codelineno-271-1" href="#__codelineno-271-1"></a><span class="c1">-- Medium: Base damage on strength</span>
</span><span id="__span-271-2"><a id="__codelineno-271-2" name="__codelineno-271-2" href="#__codelineno-271-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;StrengthDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-271-3"><a id="__codelineno-271-3" name="__codelineno-271-3" href="#__codelineno-271-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-271-4"><a id="__codelineno-271-4" name="__codelineno-271-4" href="#__codelineno-271-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-271-5"><a id="__codelineno-271-5" name="__codelineno-271-5" href="#__codelineno-271-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-271-6"><a id="__codelineno-271-6" name="__codelineno-271-6" href="#__codelineno-271-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">str</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-271-7"><a id="__codelineno-271-7" name="__codelineno-271-7" href="#__codelineno-271-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-272-1"><a id="__codelineno-272-1" name="__codelineno-272-1" href="#__codelineno-272-1"></a><span class="c1">-- High: Complex punch damage system</span>
</span><span id="__span-272-2"><a id="__codelineno-272-2" name="__codelineno-272-2" href="#__codelineno-272-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPunchDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-272-3"><a id="__codelineno-272-3" name="__codelineno-272-3" href="#__codelineno-272-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-272-4"><a id="__codelineno-272-4" name="__codelineno-272-4" href="#__codelineno-272-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-272-5"><a id="__codelineno-272-5" name="__codelineno-272-5" href="#__codelineno-272-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-272-6"><a id="__codelineno-272-6" name="__codelineno-272-6" href="#__codelineno-272-6"></a><span class="w">    </span><span class="c1">-- Strength bonus</span>
</span><span id="__span-272-7"><a id="__codelineno-272-7" name="__codelineno-272-7" href="#__codelineno-272-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-272-8"><a id="__codelineno-272-8" name="__codelineno-272-8" href="#__codelineno-272-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">strBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-272-9"><a id="__codelineno-272-9" name="__codelineno-272-9" href="#__codelineno-272-9"></a><span class="w">    </span><span class="c1">-- Level bonus</span>
</span><span id="__span-272-10"><a id="__codelineno-272-10" name="__codelineno-272-10" href="#__codelineno-272-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-272-11"><a id="__codelineno-272-11" name="__codelineno-272-11" href="#__codelineno-272-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-272-12"><a id="__codelineno-272-12" name="__codelineno-272-12" href="#__codelineno-272-12"></a><span class="w">    </span><span class="c1">-- Faction bonus</span>
</span><span id="__span-272-13"><a id="__codelineno-272-13" name="__codelineno-272-13" href="#__codelineno-272-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-272-14"><a id="__codelineno-272-14" name="__codelineno-272-14" href="#__codelineno-272-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-272-15"><a id="__codelineno-272-15" name="__codelineno-272-15" href="#__codelineno-272-15"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;athlete&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-272-16"><a id="__codelineno-272-16" name="__codelineno-272-16" href="#__codelineno-272-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-272-17"><a id="__codelineno-272-17" name="__codelineno-272-17" href="#__codelineno-272-17"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-272-18"><a id="__codelineno-272-18" name="__codelineno-272-18" href="#__codelineno-272-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-272-19"><a id="__codelineno-272-19" name="__codelineno-272-19" href="#__codelineno-272-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-272-20"><a id="__codelineno-272-20" name="__codelineno-272-20" href="#__codelineno-272-20"></a><span class="w">    </span><span class="c1">-- Equipment bonus</span>
</span><span id="__span-272-21"><a id="__codelineno-272-21" name="__codelineno-272-21" href="#__codelineno-272-21"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-272-22"><a id="__codelineno-272-22" name="__codelineno-272-22" href="#__codelineno-272-22"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-272-23"><a id="__codelineno-272-23" name="__codelineno-272-23" href="#__codelineno-272-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-272-24"><a id="__codelineno-272-24" name="__codelineno-272-24" href="#__codelineno-272-24"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-272-25"><a id="__codelineno-272-25" name="__codelineno-272-25" href="#__codelineno-272-25"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-272-26"><a id="__codelineno-272-26" name="__codelineno-272-26" href="#__codelineno-272-26"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;boxing_gloves&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-272-27"><a id="__codelineno-272-27" name="__codelineno-272-27" href="#__codelineno-272-27"></a><span class="w">                    </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-272-28"><a id="__codelineno-272-28" name="__codelineno-272-28" href="#__codelineno-272-28"></a><span class="w">                </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;brass_knuckles&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-272-29"><a id="__codelineno-272-29" name="__codelineno-272-29" href="#__codelineno-272-29"></a><span class="w">                    </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span>
</span><span id="__span-272-30"><a id="__codelineno-272-30" name="__codelineno-272-30" href="#__codelineno-272-30"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-272-31"><a id="__codelineno-272-31" name="__codelineno-272-31" href="#__codelineno-272-31"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-272-32"><a id="__codelineno-272-32" name="__codelineno-272-32" href="#__codelineno-272-32"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-272-33"><a id="__codelineno-272-33" name="__codelineno-272-33" href="#__codelineno-272-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-272-34"><a id="__codelineno-272-34" name="__codelineno-272-34" href="#__codelineno-272-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">baseDamage</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">strBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">factionBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">equipmentBonus</span>
</span><span id="__span-272-35"><a id="__codelineno-272-35" name="__codelineno-272-35" href="#__codelineno-272-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getplayerpunchragdolltime">GetPlayerPunchRagdollTime</h3>
<p><strong>Purpose</strong></p>
<p>Called to get player punch ragdoll time</p>
<p><strong>When Called</strong></p>
<p>When calculating how long a player stays ragdolled from a punch</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player being punched</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The ragdoll time in seconds</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-273-1"><a id="__codelineno-273-1" name="__codelineno-273-1" href="#__codelineno-273-1"></a><span class="c1">-- Simple: Return default ragdoll time</span>
</span><span id="__span-273-2"><a id="__codelineno-273-2" name="__codelineno-273-2" href="#__codelineno-273-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-273-3"><a id="__codelineno-273-3" name="__codelineno-273-3" href="#__codelineno-273-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-273-4"><a id="__codelineno-273-4" name="__codelineno-273-4" href="#__codelineno-273-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-274-1"><a id="__codelineno-274-1" name="__codelineno-274-1" href="#__codelineno-274-1"></a><span class="c1">-- Medium: Base time on constitution</span>
</span><span id="__span-274-2"><a id="__codelineno-274-2" name="__codelineno-274-2" href="#__codelineno-274-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ConstitutionRagdoll&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-274-3"><a id="__codelineno-274-3" name="__codelineno-274-3" href="#__codelineno-274-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-274-4"><a id="__codelineno-274-4" name="__codelineno-274-4" href="#__codelineno-274-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-274-5"><a id="__codelineno-274-5" name="__codelineno-274-5" href="#__codelineno-274-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-274-6"><a id="__codelineno-274-6" name="__codelineno-274-6" href="#__codelineno-274-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">con</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">))</span>
</span><span id="__span-274-7"><a id="__codelineno-274-7" name="__codelineno-274-7" href="#__codelineno-274-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-275-1"><a id="__codelineno-275-1" name="__codelineno-275-1" href="#__codelineno-275-1"></a><span class="c1">-- High: Complex ragdoll time system</span>
</span><span id="__span-275-2"><a id="__codelineno-275-2" name="__codelineno-275-2" href="#__codelineno-275-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPlayerPunchRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-275-3"><a id="__codelineno-275-3" name="__codelineno-275-3" href="#__codelineno-275-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-275-4"><a id="__codelineno-275-4" name="__codelineno-275-4" href="#__codelineno-275-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-275-5"><a id="__codelineno-275-5" name="__codelineno-275-5" href="#__codelineno-275-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-275-6"><a id="__codelineno-275-6" name="__codelineno-275-6" href="#__codelineno-275-6"></a><span class="w">    </span><span class="c1">-- Constitution reduces ragdoll time</span>
</span><span id="__span-275-7"><a id="__codelineno-275-7" name="__codelineno-275-7" href="#__codelineno-275-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-275-8"><a id="__codelineno-275-8" name="__codelineno-275-8" href="#__codelineno-275-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">conReduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span>
</span><span id="__span-275-9"><a id="__codelineno-275-9" name="__codelineno-275-9" href="#__codelineno-275-9"></a><span class="w">    </span><span class="c1">-- Level reduces ragdoll time</span>
</span><span id="__span-275-10"><a id="__codelineno-275-10" name="__codelineno-275-10" href="#__codelineno-275-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-275-11"><a id="__codelineno-275-11" name="__codelineno-275-11" href="#__codelineno-275-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelReduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span>
</span><span id="__span-275-12"><a id="__codelineno-275-12" name="__codelineno-275-12" href="#__codelineno-275-12"></a><span class="w">    </span><span class="c1">-- Faction affects ragdoll time</span>
</span><span id="__span-275-13"><a id="__codelineno-275-13" name="__codelineno-275-13" href="#__codelineno-275-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-275-14"><a id="__codelineno-275-14" name="__codelineno-275-14" href="#__codelineno-275-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-275-15"><a id="__codelineno-275-15" name="__codelineno-275-15" href="#__codelineno-275-15"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;athlete&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-275-16"><a id="__codelineno-275-16" name="__codelineno-275-16" href="#__codelineno-275-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-275-17"><a id="__codelineno-275-17" name="__codelineno-275-17" href="#__codelineno-275-17"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-275-18"><a id="__codelineno-275-18" name="__codelineno-275-18" href="#__codelineno-275-18"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;elderly&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-275-19"><a id="__codelineno-275-19" name="__codelineno-275-19" href="#__codelineno-275-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-275-20"><a id="__codelineno-275-20" name="__codelineno-275-20" href="#__codelineno-275-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionModifiers</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-275-21"><a id="__codelineno-275-21" name="__codelineno-275-21" href="#__codelineno-275-21"></a><span class="w">    </span><span class="c1">-- Equipment affects ragdoll time</span>
</span><span id="__span-275-22"><a id="__codelineno-275-22" name="__codelineno-275-22" href="#__codelineno-275-22"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">equipmentModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-275-23"><a id="__codelineno-275-23" name="__codelineno-275-23" href="#__codelineno-275-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-275-24"><a id="__codelineno-275-24" name="__codelineno-275-24" href="#__codelineno-275-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-275-25"><a id="__codelineno-275-25" name="__codelineno-275-25" href="#__codelineno-275-25"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-275-26"><a id="__codelineno-275-26" name="__codelineno-275-26" href="#__codelineno-275-26"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-275-27"><a id="__codelineno-275-27" name="__codelineno-275-27" href="#__codelineno-275-27"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;armor_vest&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-275-28"><a id="__codelineno-275-28" name="__codelineno-275-28" href="#__codelineno-275-28"></a><span class="w">                    </span><span class="nv">equipmentModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentModifier</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.3</span>
</span><span id="__span-275-29"><a id="__codelineno-275-29" name="__codelineno-275-29" href="#__codelineno-275-29"></a><span class="w">                </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;helmet&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-275-30"><a id="__codelineno-275-30" name="__codelineno-275-30" href="#__codelineno-275-30"></a><span class="w">                    </span><span class="nv">equipmentModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">equipmentModifier</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.2</span>
</span><span id="__span-275-31"><a id="__codelineno-275-31" name="__codelineno-275-31" href="#__codelineno-275-31"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-275-32"><a id="__codelineno-275-32" name="__codelineno-275-32" href="#__codelineno-275-32"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-275-33"><a id="__codelineno-275-33" name="__codelineno-275-33" href="#__codelineno-275-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-275-34"><a id="__codelineno-275-34" name="__codelineno-275-34" href="#__codelineno-275-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-275-35"><a id="__codelineno-275-35" name="__codelineno-275-35" href="#__codelineno-275-35"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="nv">baseTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">conReduction</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">levelReduction</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">factionModifier</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">equipmentModifier</span><span class="p">)</span>
</span><span id="__span-275-36"><a id="__codelineno-275-36" name="__codelineno-275-36" href="#__codelineno-275-36"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getpriceoverride">GetPriceOverride</h3>
<p><strong>Purpose</strong></p>
<p>Called to get price override for items</p>
<p><strong>When Called</strong></p>
<p>When calculating item prices in vendors or trading</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The vendor or trading entity</li>
<li><code>uniqueID</code> (<em>string</em>): The item unique ID</li>
<li><code>price</code> (<em>number</em>): The base price</li>
<li><code>isSellingToVendor</code> (<em>boolean</em>): Whether the player is selling to vendor</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The overridden price</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-276-1"><a id="__codelineno-276-1" name="__codelineno-276-1" href="#__codelineno-276-1"></a><span class="c1">-- Simple: Return original price</span>
</span><span id="__span-276-2"><a id="__codelineno-276-2" name="__codelineno-276-2" href="#__codelineno-276-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPriceOverride&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-276-3"><a id="__codelineno-276-3" name="__codelineno-276-3" href="#__codelineno-276-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">price</span>
</span><span id="__span-276-4"><a id="__codelineno-276-4" name="__codelineno-276-4" href="#__codelineno-276-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-277-1"><a id="__codelineno-277-1" name="__codelineno-277-1" href="#__codelineno-277-1"></a><span class="c1">-- Medium: Apply faction discounts</span>
</span><span id="__span-277-2"><a id="__codelineno-277-2" name="__codelineno-277-2" href="#__codelineno-277-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPriceOverride&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionDiscounts&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-277-3"><a id="__codelineno-277-3" name="__codelineno-277-3" href="#__codelineno-277-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
</span><span id="__span-277-4"><a id="__codelineno-277-4" name="__codelineno-277-4" href="#__codelineno-277-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-277-5"><a id="__codelineno-277-5" name="__codelineno-277-5" href="#__codelineno-277-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-277-6"><a id="__codelineno-277-6" name="__codelineno-277-6" href="#__codelineno-277-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-277-7"><a id="__codelineno-277-7" name="__codelineno-277-7" href="#__codelineno-277-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-277-8"><a id="__codelineno-277-8" name="__codelineno-277-8" href="#__codelineno-277-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-277-9"><a id="__codelineno-277-9" name="__codelineno-277-9" href="#__codelineno-277-9"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.8</span><span class="w"> </span><span class="c1">-- 20% discount</span>
</span><span id="__span-277-10"><a id="__codelineno-277-10" name="__codelineno-277-10" href="#__codelineno-277-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-277-11"><a id="__codelineno-277-11" name="__codelineno-277-11" href="#__codelineno-277-11"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span>
</span><span id="__span-277-12"><a id="__codelineno-277-12" name="__codelineno-277-12" href="#__codelineno-277-12"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-278-1"><a id="__codelineno-278-1" name="__codelineno-278-1" href="#__codelineno-278-1"></a><span class="c1">-- High: Complex price override system</span>
</span><span id="__span-278-2"><a id="__codelineno-278-2" name="__codelineno-278-2" href="#__codelineno-278-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetPriceOverride&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPriceOverride&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-278-3"><a id="__codelineno-278-3" name="__codelineno-278-3" href="#__codelineno-278-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
</span><span id="__span-278-4"><a id="__codelineno-278-4" name="__codelineno-278-4" href="#__codelineno-278-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-278-5"><a id="__codelineno-278-5" name="__codelineno-278-5" href="#__codelineno-278-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-278-6"><a id="__codelineno-278-6" name="__codelineno-278-6" href="#__codelineno-278-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">price</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-278-7"><a id="__codelineno-278-7" name="__codelineno-278-7" href="#__codelineno-278-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">price</span>
</span><span id="__span-278-8"><a id="__codelineno-278-8" name="__codelineno-278-8" href="#__codelineno-278-8"></a><span class="w">        </span><span class="c1">-- Faction discounts</span>
</span><span id="__span-278-9"><a id="__codelineno-278-9" name="__codelineno-278-9" href="#__codelineno-278-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-278-10"><a id="__codelineno-278-10" name="__codelineno-278-10" href="#__codelineno-278-10"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionDiscounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-278-11"><a id="__codelineno-278-11" name="__codelineno-278-11" href="#__codelineno-278-11"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-278-12"><a id="__codelineno-278-12" name="__codelineno-278-12" href="#__codelineno-278-12"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span>
</span><span id="__span-278-13"><a id="__codelineno-278-13" name="__codelineno-278-13" href="#__codelineno-278-13"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;handcuffs&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-278-14"><a id="__codelineno-278-14" name="__codelineno-278-14" href="#__codelineno-278-14"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-278-15"><a id="__codelineno-278-15" name="__codelineno-278-15" href="#__codelineno-278-15"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-278-16"><a id="__codelineno-278-16" name="__codelineno-278-16" href="#__codelineno-278-16"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;medkit&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="__span-278-17"><a id="__codelineno-278-17" name="__codelineno-278-17" href="#__codelineno-278-17"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;bandage&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span>
</span><span id="__span-278-18"><a id="__codelineno-278-18" name="__codelineno-278-18" href="#__codelineno-278-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-278-19"><a id="__codelineno-278-19" name="__codelineno-278-19" href="#__codelineno-278-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-278-20"><a id="__codelineno-278-20" name="__codelineno-278-20" href="#__codelineno-278-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">discounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionDiscounts</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-278-21"><a id="__codelineno-278-21" name="__codelineno-278-21" href="#__codelineno-278-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">discounts</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">discounts</span><span class="p">[</span><span class="nv">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-278-22"><a id="__codelineno-278-22" name="__codelineno-278-22" href="#__codelineno-278-22"></a><span class="w">            </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">discounts</span><span class="p">[</span><span class="nv">uniqueID</span><span class="p">]</span>
</span><span id="__span-278-23"><a id="__codelineno-278-23" name="__codelineno-278-23" href="#__codelineno-278-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-278-24"><a id="__codelineno-278-24" name="__codelineno-278-24" href="#__codelineno-278-24"></a><span class="w">        </span><span class="c1">-- Level discounts</span>
</span><span id="__span-278-25"><a id="__codelineno-278-25" name="__codelineno-278-25" href="#__codelineno-278-25"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-278-26"><a id="__codelineno-278-26" name="__codelineno-278-26" href="#__codelineno-278-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-278-27"><a id="__codelineno-278-27" name="__codelineno-278-27" href="#__codelineno-278-27"></a><span class="w">            </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.95</span><span class="w"> </span><span class="c1">-- 5% discount</span>
</span><span id="__span-278-28"><a id="__codelineno-278-28" name="__codelineno-278-28" href="#__codelineno-278-28"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-278-29"><a id="__codelineno-278-29" name="__codelineno-278-29" href="#__codelineno-278-29"></a><span class="w">            </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.9</span><span class="w"> </span><span class="c1">-- 10% discount</span>
</span><span id="__span-278-30"><a id="__codelineno-278-30" name="__codelineno-278-30" href="#__codelineno-278-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-278-31"><a id="__codelineno-278-31" name="__codelineno-278-31" href="#__codelineno-278-31"></a><span class="w">        </span><span class="c1">-- Donator discounts</span>
</span><span id="__span-278-32"><a id="__codelineno-278-32" name="__codelineno-278-32" href="#__codelineno-278-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;donatorLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-278-33"><a id="__codelineno-278-33" name="__codelineno-278-33" href="#__codelineno-278-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-278-34"><a id="__codelineno-278-34" name="__codelineno-278-34" href="#__codelineno-278-34"></a><span class="w">            </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">))</span>
</span><span id="__span-278-35"><a id="__codelineno-278-35" name="__codelineno-278-35" href="#__codelineno-278-35"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-278-36"><a id="__codelineno-278-36" name="__codelineno-278-36" href="#__codelineno-278-36"></a><span class="w">        </span><span class="c1">-- Selling to vendor penalty</span>
</span><span id="__span-278-37"><a id="__codelineno-278-37" name="__codelineno-278-37" href="#__codelineno-278-37"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-278-38"><a id="__codelineno-278-38" name="__codelineno-278-38" href="#__codelineno-278-38"></a><span class="w">            </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="c1">-- 50% of original price when selling</span>
</span><span id="__span-278-39"><a id="__codelineno-278-39" name="__codelineno-278-39" href="#__codelineno-278-39"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-278-40"><a id="__codelineno-278-40" name="__codelineno-278-40" href="#__codelineno-278-40"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nv">finalPrice</span><span class="p">)</span>
</span><span id="__span-278-41"><a id="__codelineno-278-41" name="__codelineno-278-41" href="#__codelineno-278-41"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getragdolltime">GetRagdollTime</h3>
<p><strong>Purpose</strong></p>
<p>Called to get ragdoll time</p>
<p><strong>When Called</strong></p>
<p>When calculating how long an entity stays ragdolled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The ragdoll entity</li>
<li><code>time</code> (<em>number</em>): The base ragdoll time</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The modified ragdoll time</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-279-1"><a id="__codelineno-279-1" name="__codelineno-279-1" href="#__codelineno-279-1"></a><span class="c1">-- Simple: Return original time</span>
</span><span id="__span-279-2"><a id="__codelineno-279-2" name="__codelineno-279-2" href="#__codelineno-279-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-279-3"><a id="__codelineno-279-3" name="__codelineno-279-3" href="#__codelineno-279-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">time</span>
</span><span id="__span-279-4"><a id="__codelineno-279-4" name="__codelineno-279-4" href="#__codelineno-279-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-280-1"><a id="__codelineno-280-1" name="__codelineno-280-1" href="#__codelineno-280-1"></a><span class="c1">-- Medium: Extend ragdoll time for certain entities</span>
</span><span id="__span-280-2"><a id="__codelineno-280-2" name="__codelineno-280-2" href="#__codelineno-280-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ExtendedRagdoll&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-280-3"><a id="__codelineno-280-3" name="__codelineno-280-3" href="#__codelineno-280-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prop_ragdoll&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-280-4"><a id="__codelineno-280-4" name="__codelineno-280-4" href="#__codelineno-280-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span>
</span><span id="__span-280-5"><a id="__codelineno-280-5" name="__codelineno-280-5" href="#__codelineno-280-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-280-6"><a id="__codelineno-280-6" name="__codelineno-280-6" href="#__codelineno-280-6"></a><span class="kr">return</span><span class="w"> </span><span class="nv">time</span>
</span><span id="__span-280-7"><a id="__codelineno-280-7" name="__codelineno-280-7" href="#__codelineno-280-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-281-1"><a id="__codelineno-281-1" name="__codelineno-281-1" href="#__codelineno-281-1"></a><span class="c1">-- High: Complex ragdoll time system</span>
</span><span id="__span-281-2"><a id="__codelineno-281-2" name="__codelineno-281-2" href="#__codelineno-281-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRagdollTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-281-3"><a id="__codelineno-281-3" name="__codelineno-281-3" href="#__codelineno-281-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">time</span>
</span><span id="__span-281-4"><a id="__codelineno-281-4" name="__codelineno-281-4" href="#__codelineno-281-4"></a><span class="c1">-- Check if it&#39;s a player ragdoll</span>
</span><span id="__span-281-5"><a id="__codelineno-281-5" name="__codelineno-281-5" href="#__codelineno-281-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-281-6"><a id="__codelineno-281-6" name="__codelineno-281-6" href="#__codelineno-281-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-281-7"><a id="__codelineno-281-7" name="__codelineno-281-7" href="#__codelineno-281-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetBySteamID</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span>
</span><span id="__span-281-8"><a id="__codelineno-281-8" name="__codelineno-281-8" href="#__codelineno-281-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-281-9"><a id="__codelineno-281-9" name="__codelineno-281-9" href="#__codelineno-281-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-281-10"><a id="__codelineno-281-10" name="__codelineno-281-10" href="#__codelineno-281-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-281-11"><a id="__codelineno-281-11" name="__codelineno-281-11" href="#__codelineno-281-11"></a><span class="w">            </span><span class="c1">-- Constitution affects ragdoll time</span>
</span><span id="__span-281-12"><a id="__codelineno-281-12" name="__codelineno-281-12" href="#__codelineno-281-12"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getAttrib</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-281-13"><a id="__codelineno-281-13" name="__codelineno-281-13" href="#__codelineno-281-13"></a><span class="w">            </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">con</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-281-14"><a id="__codelineno-281-14" name="__codelineno-281-14" href="#__codelineno-281-14"></a><span class="w">            </span><span class="c1">-- Level affects ragdoll time</span>
</span><span id="__span-281-15"><a id="__codelineno-281-15" name="__codelineno-281-15" href="#__codelineno-281-15"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-281-16"><a id="__codelineno-281-16" name="__codelineno-281-16" href="#__codelineno-281-16"></a><span class="w">            </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-281-17"><a id="__codelineno-281-17" name="__codelineno-281-17" href="#__codelineno-281-17"></a><span class="w">            </span><span class="c1">-- Faction affects ragdoll time</span>
</span><span id="__span-281-18"><a id="__codelineno-281-18" name="__codelineno-281-18" href="#__codelineno-281-18"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-281-19"><a id="__codelineno-281-19" name="__codelineno-281-19" href="#__codelineno-281-19"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-281-20"><a id="__codelineno-281-20" name="__codelineno-281-20" href="#__codelineno-281-20"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;athlete&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-281-21"><a id="__codelineno-281-21" name="__codelineno-281-21" href="#__codelineno-281-21"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-281-22"><a id="__codelineno-281-22" name="__codelineno-281-22" href="#__codelineno-281-22"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-281-23"><a id="__codelineno-281-23" name="__codelineno-281-23" href="#__codelineno-281-23"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;elderly&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-281-24"><a id="__codelineno-281-24" name="__codelineno-281-24" href="#__codelineno-281-24"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-281-25"><a id="__codelineno-281-25" name="__codelineno-281-25" href="#__codelineno-281-25"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionModifiers</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-281-26"><a id="__codelineno-281-26" name="__codelineno-281-26" href="#__codelineno-281-26"></a><span class="w">            </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">factionModifier</span>
</span><span id="__span-281-27"><a id="__codelineno-281-27" name="__codelineno-281-27" href="#__codelineno-281-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-281-28"><a id="__codelineno-281-28" name="__codelineno-281-28" href="#__codelineno-281-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-281-29"><a id="__codelineno-281-29" name="__codelineno-281-29" href="#__codelineno-281-29"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-281-30"><a id="__codelineno-281-30" name="__codelineno-281-30" href="#__codelineno-281-30"></a><span class="c1">-- Weather affects ragdoll time</span>
</span><span id="__span-281-31"><a id="__codelineno-281-31" name="__codelineno-281-31" href="#__codelineno-281-31"></a><span class="kr">if</span><span class="w"> </span><span class="nf">GetConVar</span><span class="p">(</span><span class="s2">&quot;sv_weather&quot;</span><span class="p">):</span><span class="nf">GetBool</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-281-32"><a id="__codelineno-281-32" name="__codelineno-281-32" href="#__codelineno-281-32"></a><span class="w">    </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">finalTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span>
</span><span id="__span-281-33"><a id="__codelineno-281-33" name="__codelineno-281-33" href="#__codelineno-281-33"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-281-34"><a id="__codelineno-281-34" name="__codelineno-281-34" href="#__codelineno-281-34"></a><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="nv">finalTime</span><span class="p">)</span>
</span><span id="__span-281-35"><a id="__codelineno-281-35" name="__codelineno-281-35" href="#__codelineno-281-35"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getsalaryamount">GetSalaryAmount</h3>
<p><strong>Purpose</strong></p>
<p>Called to get salary amount for a player</p>
<p><strong>When Called</strong></p>
<p>When calculating salary payment for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player receiving salary</li>
<li><code>faction</code> (<em>string</em>): The player's faction</li>
<li><code>class</code> (<em>string</em>): The player's class</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The salary amount</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-282-1"><a id="__codelineno-282-1" name="__codelineno-282-1" href="#__codelineno-282-1"></a><span class="c1">-- Simple: Return base salary</span>
</span><span id="__span-282-2"><a id="__codelineno-282-2" name="__codelineno-282-2" href="#__codelineno-282-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetSalaryAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-282-3"><a id="__codelineno-282-3" name="__codelineno-282-3" href="#__codelineno-282-3"></a><span class="kr">return</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-282-4"><a id="__codelineno-282-4" name="__codelineno-282-4" href="#__codelineno-282-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-283-1"><a id="__codelineno-283-1" name="__codelineno-283-1" href="#__codelineno-283-1"></a><span class="c1">-- Medium: Different salaries by faction</span>
</span><span id="__span-283-2"><a id="__codelineno-283-2" name="__codelineno-283-2" href="#__codelineno-283-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetSalaryAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionSalaries&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-283-3"><a id="__codelineno-283-3" name="__codelineno-283-3" href="#__codelineno-283-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">salaries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-283-4"><a id="__codelineno-283-4" name="__codelineno-283-4" href="#__codelineno-283-4"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-283-5"><a id="__codelineno-283-5" name="__codelineno-283-5" href="#__codelineno-283-5"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span>
</span><span id="__span-283-6"><a id="__codelineno-283-6" name="__codelineno-283-6" href="#__codelineno-283-6"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-283-7"><a id="__codelineno-283-7" name="__codelineno-283-7" href="#__codelineno-283-7"></a><span class="p">}</span>
</span><span id="__span-283-8"><a id="__codelineno-283-8" name="__codelineno-283-8" href="#__codelineno-283-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">salaries</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-283-9"><a id="__codelineno-283-9" name="__codelineno-283-9" href="#__codelineno-283-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-284-1"><a id="__codelineno-284-1" name="__codelineno-284-1" href="#__codelineno-284-1"></a><span class="c1">-- High: Complex salary system</span>
</span><span id="__span-284-2"><a id="__codelineno-284-2" name="__codelineno-284-2" href="#__codelineno-284-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetSalaryAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-284-3"><a id="__codelineno-284-3" name="__codelineno-284-3" href="#__codelineno-284-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-284-4"><a id="__codelineno-284-4" name="__codelineno-284-4" href="#__codelineno-284-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-284-5"><a id="__codelineno-284-5" name="__codelineno-284-5" href="#__codelineno-284-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseSalary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-284-6"><a id="__codelineno-284-6" name="__codelineno-284-6" href="#__codelineno-284-6"></a><span class="w">    </span><span class="c1">-- Faction base salaries</span>
</span><span id="__span-284-7"><a id="__codelineno-284-7" name="__codelineno-284-7" href="#__codelineno-284-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionSalaries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-284-8"><a id="__codelineno-284-8" name="__codelineno-284-8" href="#__codelineno-284-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-284-9"><a id="__codelineno-284-9" name="__codelineno-284-9" href="#__codelineno-284-9"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span>
</span><span id="__span-284-10"><a id="__codelineno-284-10" name="__codelineno-284-10" href="#__codelineno-284-10"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-284-11"><a id="__codelineno-284-11" name="__codelineno-284-11" href="#__codelineno-284-11"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;criminal&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-284-12"><a id="__codelineno-284-12" name="__codelineno-284-12" href="#__codelineno-284-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-284-13"><a id="__codelineno-284-13" name="__codelineno-284-13" href="#__codelineno-284-13"></a><span class="w">    </span><span class="nv">baseSalary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionSalaries</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-284-14"><a id="__codelineno-284-14" name="__codelineno-284-14" href="#__codelineno-284-14"></a><span class="w">    </span><span class="c1">-- Class bonuses</span>
</span><span id="__span-284-15"><a id="__codelineno-284-15" name="__codelineno-284-15" href="#__codelineno-284-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">classBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-284-16"><a id="__codelineno-284-16" name="__codelineno-284-16" href="#__codelineno-284-16"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;officer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-284-17"><a id="__codelineno-284-17" name="__codelineno-284-17" href="#__codelineno-284-17"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;sergeant&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
</span><span id="__span-284-18"><a id="__codelineno-284-18" name="__codelineno-284-18" href="#__codelineno-284-18"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;lieutenant&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span>
</span><span id="__span-284-19"><a id="__codelineno-284-19" name="__codelineno-284-19" href="#__codelineno-284-19"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;nurse&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
</span><span id="__span-284-20"><a id="__codelineno-284-20" name="__codelineno-284-20" href="#__codelineno-284-20"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;doctor&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">75</span>
</span><span id="__span-284-21"><a id="__codelineno-284-21" name="__codelineno-284-21" href="#__codelineno-284-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-284-22"><a id="__codelineno-284-22" name="__codelineno-284-22" href="#__codelineno-284-22"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">classBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">classBonuses</span><span class="p">[</span><span class="nv">class</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-284-23"><a id="__codelineno-284-23" name="__codelineno-284-23" href="#__codelineno-284-23"></a><span class="w">    </span><span class="c1">-- Level bonus</span>
</span><span id="__span-284-24"><a id="__codelineno-284-24" name="__codelineno-284-24" href="#__codelineno-284-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-284-25"><a id="__codelineno-284-25" name="__codelineno-284-25" href="#__codelineno-284-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-284-26"><a id="__codelineno-284-26" name="__codelineno-284-26" href="#__codelineno-284-26"></a><span class="w">    </span><span class="c1">-- Performance bonus</span>
</span><span id="__span-284-27"><a id="__codelineno-284-27" name="__codelineno-284-27" href="#__codelineno-284-27"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">performance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;performance&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-284-28"><a id="__codelineno-284-28" name="__codelineno-284-28" href="#__codelineno-284-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">performanceBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">performance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-284-29"><a id="__codelineno-284-29" name="__codelineno-284-29" href="#__codelineno-284-29"></a><span class="w">    </span><span class="c1">-- Donator bonus</span>
</span><span id="__span-284-30"><a id="__codelineno-284-30" name="__codelineno-284-30" href="#__codelineno-284-30"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;donatorLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-284-31"><a id="__codelineno-284-31" name="__codelineno-284-31" href="#__codelineno-284-31"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">donatorBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">donatorLevel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-284-32"><a id="__codelineno-284-32" name="__codelineno-284-32" href="#__codelineno-284-32"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">baseSalary</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">classBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">performanceBonus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">donatorBonus</span>
</span><span id="__span-284-33"><a id="__codelineno-284-33" name="__codelineno-284-33" href="#__codelineno-284-33"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getticketsbyrequester">GetTicketsByRequester</h3>
<p><strong>Purpose</strong></p>
<p>Called to get tickets by requester</p>
<p><strong>When Called</strong></p>
<p>When retrieving tickets created by a specific player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>steamID</code> (<em>string</em>): The Steam ID of the requester</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - Table of tickets created by the requester</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-285-1"><a id="__codelineno-285-1" name="__codelineno-285-1" href="#__codelineno-285-1"></a><span class="c1">-- Simple: Return empty tickets</span>
</span><span id="__span-285-2"><a id="__codelineno-285-2" name="__codelineno-285-2" href="#__codelineno-285-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetTicketsByRequester&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-285-3"><a id="__codelineno-285-3" name="__codelineno-285-3" href="#__codelineno-285-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-285-4"><a id="__codelineno-285-4" name="__codelineno-285-4" href="#__codelineno-285-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-286-1"><a id="__codelineno-286-1" name="__codelineno-286-1" href="#__codelineno-286-1"></a><span class="c1">-- Medium: Load tickets from database</span>
</span><span id="__span-286-2"><a id="__codelineno-286-2" name="__codelineno-286-2" href="#__codelineno-286-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetTicketsByRequester&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TicketLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-286-3"><a id="__codelineno-286-3" name="__codelineno-286-3" href="#__codelineno-286-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">tickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM tickets WHERE requester = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-286-4"><a id="__codelineno-286-4" name="__codelineno-286-4" href="#__codelineno-286-4"></a><span class="kr">return</span><span class="w"> </span><span class="nv">tickets</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-286-5"><a id="__codelineno-286-5" name="__codelineno-286-5" href="#__codelineno-286-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-287-1"><a id="__codelineno-287-1" name="__codelineno-287-1" href="#__codelineno-287-1"></a><span class="c1">-- High: Complex ticket retrieval system</span>
</span><span id="__span-287-2"><a id="__codelineno-287-2" name="__codelineno-287-2" href="#__codelineno-287-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetTicketsByRequester&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketRetrieval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-287-3"><a id="__codelineno-287-3" name="__codelineno-287-3" href="#__codelineno-287-3"></a><span class="c1">-- Load tickets from database</span>
</span><span id="__span-287-4"><a id="__codelineno-287-4" name="__codelineno-287-4" href="#__codelineno-287-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">tickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM tickets WHERE requester = ? ORDER BY created_at DESC&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-287-5"><a id="__codelineno-287-5" name="__codelineno-287-5" href="#__codelineno-287-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">tickets</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-287-6"><a id="__codelineno-287-6" name="__codelineno-287-6" href="#__codelineno-287-6"></a><span class="w">    </span><span class="c1">-- Process tickets</span>
</span><span id="__span-287-7"><a id="__codelineno-287-7" name="__codelineno-287-7" href="#__codelineno-287-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedTickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-287-8"><a id="__codelineno-287-8" name="__codelineno-287-8" href="#__codelineno-287-8"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ticket</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">tickets</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-287-9"><a id="__codelineno-287-9" name="__codelineno-287-9" href="#__codelineno-287-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedTicket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-287-10"><a id="__codelineno-287-10" name="__codelineno-287-10" href="#__codelineno-287-10"></a><span class="w">        </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">id</span><span class="p">,</span>
</span><span id="__span-287-11"><a id="__codelineno-287-11" name="__codelineno-287-11" href="#__codelineno-287-11"></a><span class="w">        </span><span class="nv">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">title</span><span class="p">,</span>
</span><span id="__span-287-12"><a id="__codelineno-287-12" name="__codelineno-287-12" href="#__codelineno-287-12"></a><span class="w">        </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">description</span><span class="p">,</span>
</span><span id="__span-287-13"><a id="__codelineno-287-13" name="__codelineno-287-13" href="#__codelineno-287-13"></a><span class="w">        </span><span class="nv">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">status</span><span class="p">,</span>
</span><span id="__span-287-14"><a id="__codelineno-287-14" name="__codelineno-287-14" href="#__codelineno-287-14"></a><span class="w">        </span><span class="nv">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">priority</span><span class="p">,</span>
</span><span id="__span-287-15"><a id="__codelineno-287-15" name="__codelineno-287-15" href="#__codelineno-287-15"></a><span class="w">        </span><span class="nv">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">created_at</span><span class="p">,</span>
</span><span id="__span-287-16"><a id="__codelineno-287-16" name="__codelineno-287-16" href="#__codelineno-287-16"></a><span class="w">        </span><span class="nv">updatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">updated_at</span><span class="p">,</span>
</span><span id="__span-287-17"><a id="__codelineno-287-17" name="__codelineno-287-17" href="#__codelineno-287-17"></a><span class="w">        </span><span class="nv">assignedTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">assigned_to</span>
</span><span id="__span-287-18"><a id="__codelineno-287-18" name="__codelineno-287-18" href="#__codelineno-287-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-287-19"><a id="__codelineno-287-19" name="__codelineno-287-19" href="#__codelineno-287-19"></a><span class="w">        </span><span class="c1">-- Add requester character info</span>
</span><span id="__span-287-20"><a id="__codelineno-287-20" name="__codelineno-287-20" href="#__codelineno-287-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">requesterChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">ticket</span><span class="p">.</span><span class="py">requester</span><span class="p">)</span>
</span><span id="__span-287-21"><a id="__codelineno-287-21" name="__codelineno-287-21" href="#__codelineno-287-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">requesterChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-287-22"><a id="__codelineno-287-22" name="__codelineno-287-22" href="#__codelineno-287-22"></a><span class="w">            </span><span class="nv">processedTicket</span><span class="p">.</span><span class="py">requesterName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">requesterChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-287-23"><a id="__codelineno-287-23" name="__codelineno-287-23" href="#__codelineno-287-23"></a><span class="w">            </span><span class="nv">processedTicket</span><span class="p">.</span><span class="py">requesterFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">requesterChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-287-24"><a id="__codelineno-287-24" name="__codelineno-287-24" href="#__codelineno-287-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-287-25"><a id="__codelineno-287-25" name="__codelineno-287-25" href="#__codelineno-287-25"></a><span class="w">        </span><span class="c1">-- Add assignee character info</span>
</span><span id="__span-287-26"><a id="__codelineno-287-26" name="__codelineno-287-26" href="#__codelineno-287-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ticket</span><span class="p">.</span><span class="py">assigned_to</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-287-27"><a id="__codelineno-287-27" name="__codelineno-287-27" href="#__codelineno-287-27"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">assigneeChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">ticket</span><span class="p">.</span><span class="py">assigned_to</span><span class="p">)</span>
</span><span id="__span-287-28"><a id="__codelineno-287-28" name="__codelineno-287-28" href="#__codelineno-287-28"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">assigneeChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-287-29"><a id="__codelineno-287-29" name="__codelineno-287-29" href="#__codelineno-287-29"></a><span class="w">                </span><span class="nv">processedTicket</span><span class="p">.</span><span class="py">assigneeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">assigneeChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-287-30"><a id="__codelineno-287-30" name="__codelineno-287-30" href="#__codelineno-287-30"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-287-31"><a id="__codelineno-287-31" name="__codelineno-287-31" href="#__codelineno-287-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-287-32"><a id="__codelineno-287-32" name="__codelineno-287-32" href="#__codelineno-287-32"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">processedTickets</span><span class="p">,</span><span class="w"> </span><span class="nv">processedTicket</span><span class="p">)</span>
</span><span id="__span-287-33"><a id="__codelineno-287-33" name="__codelineno-287-33" href="#__codelineno-287-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-287-34"><a id="__codelineno-287-34" name="__codelineno-287-34" href="#__codelineno-287-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">processedTickets</span>
</span><span id="__span-287-35"><a id="__codelineno-287-35" name="__codelineno-287-35" href="#__codelineno-287-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getvendorsalescale">GetVendorSaleScale</h3>
<p><strong>Purpose</strong></p>
<p>Called to get vendor sale scale</p>
<p><strong>When Called</strong></p>
<p>When calculating the sale price multiplier for a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The vendor entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The sale scale multiplier</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-288-1"><a id="__codelineno-288-1" name="__codelineno-288-1" href="#__codelineno-288-1"></a><span class="c1">-- Simple: Return default scale</span>
</span><span id="__span-288-2"><a id="__codelineno-288-2" name="__codelineno-288-2" href="#__codelineno-288-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetVendorSaleScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-288-3"><a id="__codelineno-288-3" name="__codelineno-288-3" href="#__codelineno-288-3"></a><span class="kr">return</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-288-4"><a id="__codelineno-288-4" name="__codelineno-288-4" href="#__codelineno-288-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-289-1"><a id="__codelineno-289-1" name="__codelineno-289-1" href="#__codelineno-289-1"></a><span class="c1">-- Medium: Different scales for different vendors</span>
</span><span id="__span-289-2"><a id="__codelineno-289-2" name="__codelineno-289-2" href="#__codelineno-289-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetVendorSaleScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorScales&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-289-3"><a id="__codelineno-289-3" name="__codelineno-289-3" href="#__codelineno-289-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">vendorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="__span-289-4"><a id="__codelineno-289-4" name="__codelineno-289-4" href="#__codelineno-289-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-289-5"><a id="__codelineno-289-5" name="__codelineno-289-5" href="#__codelineno-289-5"></a><span class="p">[</span><span class="s2">&quot;weapon&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span>
</span><span id="__span-289-6"><a id="__codelineno-289-6" name="__codelineno-289-6" href="#__codelineno-289-6"></a><span class="p">[</span><span class="s2">&quot;medical&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span>
</span><span id="__span-289-7"><a id="__codelineno-289-7" name="__codelineno-289-7" href="#__codelineno-289-7"></a><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-289-8"><a id="__codelineno-289-8" name="__codelineno-289-8" href="#__codelineno-289-8"></a><span class="p">}</span>
</span><span id="__span-289-9"><a id="__codelineno-289-9" name="__codelineno-289-9" href="#__codelineno-289-9"></a><span class="kr">return</span><span class="w"> </span><span class="nv">scales</span><span class="p">[</span><span class="nv">vendorType</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-289-10"><a id="__codelineno-289-10" name="__codelineno-289-10" href="#__codelineno-289-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-290-1"><a id="__codelineno-290-1" name="__codelineno-290-1" href="#__codelineno-290-1"></a><span class="c1">-- High: Complex vendor sale scale system</span>
</span><span id="__span-290-2"><a id="__codelineno-290-2" name="__codelineno-290-2" href="#__codelineno-290-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetVendorSaleScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-290-3"><a id="__codelineno-290-3" name="__codelineno-290-3" href="#__codelineno-290-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-290-4"><a id="__codelineno-290-4" name="__codelineno-290-4" href="#__codelineno-290-4"></a><span class="c1">-- Vendor type affects scale</span>
</span><span id="__span-290-5"><a id="__codelineno-290-5" name="__codelineno-290-5" href="#__codelineno-290-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">vendorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="__span-290-6"><a id="__codelineno-290-6" name="__codelineno-290-6" href="#__codelineno-290-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">typeScales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-290-7"><a id="__codelineno-290-7" name="__codelineno-290-7" href="#__codelineno-290-7"></a><span class="p">[</span><span class="s2">&quot;weapon&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">,</span>
</span><span id="__span-290-8"><a id="__codelineno-290-8" name="__codelineno-290-8" href="#__codelineno-290-8"></a><span class="p">[</span><span class="s2">&quot;medical&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span>
</span><span id="__span-290-9"><a id="__codelineno-290-9" name="__codelineno-290-9" href="#__codelineno-290-9"></a><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.1</span><span class="p">,</span>
</span><span id="__span-290-10"><a id="__codelineno-290-10" name="__codelineno-290-10" href="#__codelineno-290-10"></a><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-290-11"><a id="__codelineno-290-11" name="__codelineno-290-11" href="#__codelineno-290-11"></a><span class="p">}</span>
</span><span id="__span-290-12"><a id="__codelineno-290-12" name="__codelineno-290-12" href="#__codelineno-290-12"></a><span class="nv">baseScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">typeScales</span><span class="p">[</span><span class="nv">vendorType</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-290-13"><a id="__codelineno-290-13" name="__codelineno-290-13" href="#__codelineno-290-13"></a><span class="c1">-- Vendor level affects scale</span>
</span><span id="__span-290-14"><a id="__codelineno-290-14" name="__codelineno-290-14" href="#__codelineno-290-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">vendorLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-290-15"><a id="__codelineno-290-15" name="__codelineno-290-15" href="#__codelineno-290-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">levelModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">vendorLevel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-290-16"><a id="__codelineno-290-16" name="__codelineno-290-16" href="#__codelineno-290-16"></a><span class="c1">-- Vendor reputation affects scale</span>
</span><span id="__span-290-17"><a id="__codelineno-290-17" name="__codelineno-290-17" href="#__codelineno-290-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">reputation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;reputation&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-290-18"><a id="__codelineno-290-18" name="__codelineno-290-18" href="#__codelineno-290-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">reputationModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">reputation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-290-19"><a id="__codelineno-290-19" name="__codelineno-290-19" href="#__codelineno-290-19"></a><span class="c1">-- Time of day affects scale</span>
</span><span id="__span-290-20"><a id="__codelineno-290-20" name="__codelineno-290-20" href="#__codelineno-290-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">hour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">tonumber</span><span class="p">(</span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">))</span>
</span><span id="__span-290-21"><a id="__codelineno-290-21" name="__codelineno-290-21" href="#__codelineno-290-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">timeModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-290-22"><a id="__codelineno-290-22" name="__codelineno-290-22" href="#__codelineno-290-22"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">hour</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-290-23"><a id="__codelineno-290-23" name="__codelineno-290-23" href="#__codelineno-290-23"></a><span class="w">    </span><span class="nv">timeModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.1</span><span class="w"> </span><span class="c1">-- Daytime bonus</span>
</span><span id="__span-290-24"><a id="__codelineno-290-24" name="__codelineno-290-24" href="#__codelineno-290-24"></a><span class="kr">else</span>
</span><span id="__span-290-25"><a id="__codelineno-290-25" name="__codelineno-290-25" href="#__codelineno-290-25"></a><span class="w">    </span><span class="nv">timeModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.9</span><span class="w"> </span><span class="c1">-- Nighttime penalty</span>
</span><span id="__span-290-26"><a id="__codelineno-290-26" name="__codelineno-290-26" href="#__codelineno-290-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-290-27"><a id="__codelineno-290-27" name="__codelineno-290-27" href="#__codelineno-290-27"></a><span class="c1">-- Server population affects scale</span>
</span><span id="__span-290-28"><a id="__codelineno-290-28" name="__codelineno-290-28" href="#__codelineno-290-28"></a><span class="kd">local</span><span class="w"> </span><span class="nv">playerCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-290-29"><a id="__codelineno-290-29" name="__codelineno-290-29" href="#__codelineno-290-29"></a><span class="kd">local</span><span class="w"> </span><span class="nv">populationModifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">playerCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="__span-290-30"><a id="__codelineno-290-30" name="__codelineno-290-30" href="#__codelineno-290-30"></a><span class="kr">return</span><span class="w"> </span><span class="nv">baseScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">levelModifier</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">reputationModifier</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">timeModifier</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">populationModifier</span>
</span><span id="__span-290-31"><a id="__codelineno-290-31" name="__codelineno-290-31" href="#__codelineno-290-31"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getwarnings">GetWarnings</h3>
<p><strong>Purpose</strong></p>
<p>Called to get warnings for a character</p>
<p><strong>When Called</strong></p>
<p>When retrieving warnings for a specific character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>charID</code> (<em>number</em>): The character ID to get warnings for</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - Table of warnings for the character</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-291-1"><a id="__codelineno-291-1" name="__codelineno-291-1" href="#__codelineno-291-1"></a><span class="c1">-- Simple: Return empty warnings</span>
</span><span id="__span-291-2"><a id="__codelineno-291-2" name="__codelineno-291-2" href="#__codelineno-291-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-291-3"><a id="__codelineno-291-3" name="__codelineno-291-3" href="#__codelineno-291-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-291-4"><a id="__codelineno-291-4" name="__codelineno-291-4" href="#__codelineno-291-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-292-1"><a id="__codelineno-292-1" name="__codelineno-292-1" href="#__codelineno-292-1"></a><span class="c1">-- Medium: Load warnings from database</span>
</span><span id="__span-292-2"><a id="__codelineno-292-2" name="__codelineno-292-2" href="#__codelineno-292-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WarningLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-292-3"><a id="__codelineno-292-3" name="__codelineno-292-3" href="#__codelineno-292-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM warnings WHERE char_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-292-4"><a id="__codelineno-292-4" name="__codelineno-292-4" href="#__codelineno-292-4"></a><span class="kr">return</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-292-5"><a id="__codelineno-292-5" name="__codelineno-292-5" href="#__codelineno-292-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-293-1"><a id="__codelineno-293-1" name="__codelineno-293-1" href="#__codelineno-293-1"></a><span class="c1">-- High: Complex warning retrieval system</span>
</span><span id="__span-293-2"><a id="__codelineno-293-2" name="__codelineno-293-2" href="#__codelineno-293-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWarningRetrieval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-293-3"><a id="__codelineno-293-3" name="__codelineno-293-3" href="#__codelineno-293-3"></a><span class="c1">-- Load warnings from database</span>
</span><span id="__span-293-4"><a id="__codelineno-293-4" name="__codelineno-293-4" href="#__codelineno-293-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM warnings WHERE char_id = ? ORDER BY created_at DESC&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-293-5"><a id="__codelineno-293-5" name="__codelineno-293-5" href="#__codelineno-293-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-293-6"><a id="__codelineno-293-6" name="__codelineno-293-6" href="#__codelineno-293-6"></a><span class="w">    </span><span class="c1">-- Process warnings</span>
</span><span id="__span-293-7"><a id="__codelineno-293-7" name="__codelineno-293-7" href="#__codelineno-293-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-293-8"><a id="__codelineno-293-8" name="__codelineno-293-8" href="#__codelineno-293-8"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">warning</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">warnings</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-293-9"><a id="__codelineno-293-9" name="__codelineno-293-9" href="#__codelineno-293-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedWarning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-293-10"><a id="__codelineno-293-10" name="__codelineno-293-10" href="#__codelineno-293-10"></a><span class="w">        </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">id</span><span class="p">,</span>
</span><span id="__span-293-11"><a id="__codelineno-293-11" name="__codelineno-293-11" href="#__codelineno-293-11"></a><span class="w">        </span><span class="nv">charID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">char_id</span><span class="p">,</span>
</span><span id="__span-293-12"><a id="__codelineno-293-12" name="__codelineno-293-12" href="#__codelineno-293-12"></a><span class="w">        </span><span class="nv">warned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warned</span><span class="p">,</span>
</span><span id="__span-293-13"><a id="__codelineno-293-13" name="__codelineno-293-13" href="#__codelineno-293-13"></a><span class="w">        </span><span class="nv">warnedSteamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warned_steamid</span><span class="p">,</span>
</span><span id="__span-293-14"><a id="__codelineno-293-14" name="__codelineno-293-14" href="#__codelineno-293-14"></a><span class="w">        </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">message</span><span class="p">,</span>
</span><span id="__span-293-15"><a id="__codelineno-293-15" name="__codelineno-293-15" href="#__codelineno-293-15"></a><span class="w">        </span><span class="nv">warner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warner</span><span class="p">,</span>
</span><span id="__span-293-16"><a id="__codelineno-293-16" name="__codelineno-293-16" href="#__codelineno-293-16"></a><span class="w">        </span><span class="nv">warnerSteamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warner_steamid</span><span class="p">,</span>
</span><span id="__span-293-17"><a id="__codelineno-293-17" name="__codelineno-293-17" href="#__codelineno-293-17"></a><span class="w">        </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">created_at</span><span class="p">,</span>
</span><span id="__span-293-18"><a id="__codelineno-293-18" name="__codelineno-293-18" href="#__codelineno-293-18"></a><span class="w">        </span><span class="nv">severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">severity</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span>
</span><span id="__span-293-19"><a id="__codelineno-293-19" name="__codelineno-293-19" href="#__codelineno-293-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-293-20"><a id="__codelineno-293-20" name="__codelineno-293-20" href="#__codelineno-293-20"></a><span class="w">        </span><span class="c1">-- Add character names</span>
</span><span id="__span-293-21"><a id="__codelineno-293-21" name="__codelineno-293-21" href="#__codelineno-293-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">warnedChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">warning</span><span class="p">.</span><span class="py">char_id</span><span class="p">)</span>
</span><span id="__span-293-22"><a id="__codelineno-293-22" name="__codelineno-293-22" href="#__codelineno-293-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">warnedChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-293-23"><a id="__codelineno-293-23" name="__codelineno-293-23" href="#__codelineno-293-23"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">warnedName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warnedChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-293-24"><a id="__codelineno-293-24" name="__codelineno-293-24" href="#__codelineno-293-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-293-25"><a id="__codelineno-293-25" name="__codelineno-293-25" href="#__codelineno-293-25"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">warnerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">warning</span><span class="p">.</span><span class="py">warner</span><span class="p">)</span>
</span><span id="__span-293-26"><a id="__codelineno-293-26" name="__codelineno-293-26" href="#__codelineno-293-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">warnerChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-293-27"><a id="__codelineno-293-27" name="__codelineno-293-27" href="#__codelineno-293-27"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">warnerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warnerChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-293-28"><a id="__codelineno-293-28" name="__codelineno-293-28" href="#__codelineno-293-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-293-29"><a id="__codelineno-293-29" name="__codelineno-293-29" href="#__codelineno-293-29"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">processedWarnings</span><span class="p">,</span><span class="w"> </span><span class="nv">processedWarning</span><span class="p">)</span>
</span><span id="__span-293-30"><a id="__codelineno-293-30" name="__codelineno-293-30" href="#__codelineno-293-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-293-31"><a id="__codelineno-293-31" name="__codelineno-293-31" href="#__codelineno-293-31"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">processedWarnings</span>
</span><span id="__span-293-32"><a id="__codelineno-293-32" name="__codelineno-293-32" href="#__codelineno-293-32"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="getwarningsbyissuer">GetWarningsByIssuer</h3>
<p><strong>Purpose</strong></p>
<p>Called to get warnings by issuer</p>
<p><strong>When Called</strong></p>
<p>When retrieving warnings issued by a specific player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>steamID</code> (<em>string</em>): The Steam ID of the issuer</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>table - Table of warnings issued by the player</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-294-1"><a id="__codelineno-294-1" name="__codelineno-294-1" href="#__codelineno-294-1"></a><span class="c1">-- Simple: Return empty warnings</span>
</span><span id="__span-294-2"><a id="__codelineno-294-2" name="__codelineno-294-2" href="#__codelineno-294-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarningsByIssuer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-294-3"><a id="__codelineno-294-3" name="__codelineno-294-3" href="#__codelineno-294-3"></a><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-294-4"><a id="__codelineno-294-4" name="__codelineno-294-4" href="#__codelineno-294-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-295-1"><a id="__codelineno-295-1" name="__codelineno-295-1" href="#__codelineno-295-1"></a><span class="c1">-- Medium: Load warnings from database</span>
</span><span id="__span-295-2"><a id="__codelineno-295-2" name="__codelineno-295-2" href="#__codelineno-295-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarningsByIssuer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IssuerWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-295-3"><a id="__codelineno-295-3" name="__codelineno-295-3" href="#__codelineno-295-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM warnings WHERE warner_steamid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-295-4"><a id="__codelineno-295-4" name="__codelineno-295-4" href="#__codelineno-295-4"></a><span class="kr">return</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-295-5"><a id="__codelineno-295-5" name="__codelineno-295-5" href="#__codelineno-295-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-296-1"><a id="__codelineno-296-1" name="__codelineno-296-1" href="#__codelineno-296-1"></a><span class="c1">-- High: Complex warning retrieval by issuer</span>
</span><span id="__span-296-2"><a id="__codelineno-296-2" name="__codelineno-296-2" href="#__codelineno-296-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;GetWarningsByIssuer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedIssuerWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-296-3"><a id="__codelineno-296-3" name="__codelineno-296-3" href="#__codelineno-296-3"></a><span class="c1">-- Load warnings from database</span>
</span><span id="__span-296-4"><a id="__codelineno-296-4" name="__codelineno-296-4" href="#__codelineno-296-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM warnings WHERE warner_steamid = ? ORDER BY created_at DESC&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-296-5"><a id="__codelineno-296-5" name="__codelineno-296-5" href="#__codelineno-296-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-296-6"><a id="__codelineno-296-6" name="__codelineno-296-6" href="#__codelineno-296-6"></a><span class="w">    </span><span class="c1">-- Process warnings</span>
</span><span id="__span-296-7"><a id="__codelineno-296-7" name="__codelineno-296-7" href="#__codelineno-296-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-296-8"><a id="__codelineno-296-8" name="__codelineno-296-8" href="#__codelineno-296-8"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">warning</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">warnings</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-296-9"><a id="__codelineno-296-9" name="__codelineno-296-9" href="#__codelineno-296-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">processedWarning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-296-10"><a id="__codelineno-296-10" name="__codelineno-296-10" href="#__codelineno-296-10"></a><span class="w">        </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">id</span><span class="p">,</span>
</span><span id="__span-296-11"><a id="__codelineno-296-11" name="__codelineno-296-11" href="#__codelineno-296-11"></a><span class="w">        </span><span class="nv">charID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">char_id</span><span class="p">,</span>
</span><span id="__span-296-12"><a id="__codelineno-296-12" name="__codelineno-296-12" href="#__codelineno-296-12"></a><span class="w">        </span><span class="nv">warned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warned</span><span class="p">,</span>
</span><span id="__span-296-13"><a id="__codelineno-296-13" name="__codelineno-296-13" href="#__codelineno-296-13"></a><span class="w">        </span><span class="nv">warnedSteamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warned_steamid</span><span class="p">,</span>
</span><span id="__span-296-14"><a id="__codelineno-296-14" name="__codelineno-296-14" href="#__codelineno-296-14"></a><span class="w">        </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">message</span><span class="p">,</span>
</span><span id="__span-296-15"><a id="__codelineno-296-15" name="__codelineno-296-15" href="#__codelineno-296-15"></a><span class="w">        </span><span class="nv">warner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warner</span><span class="p">,</span>
</span><span id="__span-296-16"><a id="__codelineno-296-16" name="__codelineno-296-16" href="#__codelineno-296-16"></a><span class="w">        </span><span class="nv">warnerSteamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">warner_steamid</span><span class="p">,</span>
</span><span id="__span-296-17"><a id="__codelineno-296-17" name="__codelineno-296-17" href="#__codelineno-296-17"></a><span class="w">        </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">created_at</span><span class="p">,</span>
</span><span id="__span-296-18"><a id="__codelineno-296-18" name="__codelineno-296-18" href="#__codelineno-296-18"></a><span class="w">        </span><span class="nv">severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">severity</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span>
</span><span id="__span-296-19"><a id="__codelineno-296-19" name="__codelineno-296-19" href="#__codelineno-296-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-296-20"><a id="__codelineno-296-20" name="__codelineno-296-20" href="#__codelineno-296-20"></a><span class="w">        </span><span class="c1">-- Add character names</span>
</span><span id="__span-296-21"><a id="__codelineno-296-21" name="__codelineno-296-21" href="#__codelineno-296-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">warnedChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">warning</span><span class="p">.</span><span class="py">char_id</span><span class="p">)</span>
</span><span id="__span-296-22"><a id="__codelineno-296-22" name="__codelineno-296-22" href="#__codelineno-296-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">warnedChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-296-23"><a id="__codelineno-296-23" name="__codelineno-296-23" href="#__codelineno-296-23"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">warnedName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warnedChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-296-24"><a id="__codelineno-296-24" name="__codelineno-296-24" href="#__codelineno-296-24"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">warnedFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">warnedChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-296-25"><a id="__codelineno-296-25" name="__codelineno-296-25" href="#__codelineno-296-25"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-296-26"><a id="__codelineno-296-26" name="__codelineno-296-26" href="#__codelineno-296-26"></a><span class="w">        </span><span class="c1">-- Add issuer character info</span>
</span><span id="__span-296-27"><a id="__codelineno-296-27" name="__codelineno-296-27" href="#__codelineno-296-27"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">issuerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">warning</span><span class="p">.</span><span class="py">warner</span><span class="p">)</span>
</span><span id="__span-296-28"><a id="__codelineno-296-28" name="__codelineno-296-28" href="#__codelineno-296-28"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">issuerChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-296-29"><a id="__codelineno-296-29" name="__codelineno-296-29" href="#__codelineno-296-29"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">issuerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">issuerChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span>
</span><span id="__span-296-30"><a id="__codelineno-296-30" name="__codelineno-296-30" href="#__codelineno-296-30"></a><span class="w">            </span><span class="nv">processedWarning</span><span class="p">.</span><span class="py">issuerFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">issuerChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-296-31"><a id="__codelineno-296-31" name="__codelineno-296-31" href="#__codelineno-296-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-296-32"><a id="__codelineno-296-32" name="__codelineno-296-32" href="#__codelineno-296-32"></a><span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">processedWarnings</span><span class="p">,</span><span class="w"> </span><span class="nv">processedWarning</span><span class="p">)</span>
</span><span id="__span-296-33"><a id="__codelineno-296-33" name="__codelineno-296-33" href="#__codelineno-296-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-296-34"><a id="__codelineno-296-34" name="__codelineno-296-34" href="#__codelineno-296-34"></a><span class="w">    </span><span class="c1">-- Calculate issuer statistics</span>
</span><span id="__span-296-35"><a id="__codelineno-296-35" name="__codelineno-296-35" href="#__codelineno-296-35"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-296-36"><a id="__codelineno-296-36" name="__codelineno-296-36" href="#__codelineno-296-36"></a><span class="w">    </span><span class="nv">totalWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">processedWarnings</span><span class="p">,</span>
</span><span id="__span-296-37"><a id="__codelineno-296-37" name="__codelineno-296-37" href="#__codelineno-296-37"></a><span class="w">    </span><span class="nv">recentWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-296-38"><a id="__codelineno-296-38" name="__codelineno-296-38" href="#__codelineno-296-38"></a><span class="w">    </span><span class="nv">severityCounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-296-39"><a id="__codelineno-296-39" name="__codelineno-296-39" href="#__codelineno-296-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-296-40"><a id="__codelineno-296-40" name="__codelineno-296-40" href="#__codelineno-296-40"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">oneWeekAgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span>
</span><span id="__span-296-41"><a id="__codelineno-296-41" name="__codelineno-296-41" href="#__codelineno-296-41"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">warning</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">processedWarnings</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-296-42"><a id="__codelineno-296-42" name="__codelineno-296-42" href="#__codelineno-296-42"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">warning</span><span class="p">.</span><span class="py">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">oneWeekAgo</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-296-43"><a id="__codelineno-296-43" name="__codelineno-296-43" href="#__codelineno-296-43"></a><span class="w">            </span><span class="nv">stats</span><span class="p">.</span><span class="py">recentWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">recentWarnings</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-296-44"><a id="__codelineno-296-44" name="__codelineno-296-44" href="#__codelineno-296-44"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-296-45"><a id="__codelineno-296-45" name="__codelineno-296-45" href="#__codelineno-296-45"></a><span class="w">        </span><span class="nv">stats</span><span class="p">.</span><span class="py">severityCounts</span><span class="p">[</span><span class="nv">warning</span><span class="p">.</span><span class="py">severity</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">stats</span><span class="p">.</span><span class="py">severityCounts</span><span class="p">[</span><span class="nv">warning</span><span class="p">.</span><span class="py">severity</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-296-46"><a id="__codelineno-296-46" name="__codelineno-296-46" href="#__codelineno-296-46"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-296-47"><a id="__codelineno-296-47" name="__codelineno-296-47" href="#__codelineno-296-47"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">processedWarnings</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span>
</span><span id="__span-296-48"><a id="__codelineno-296-48" name="__codelineno-296-48" href="#__codelineno-296-48"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="handleitemtransferrequest">HandleItemTransferRequest</h3>
<p><strong>Purpose</strong></p>
<p>Called to handle item transfer requests</p>
<p><strong>When Called</strong></p>
<p>When a player requests to transfer an item</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player making the request</li>
<li><code>itemID</code> (<em>string</em>): The ID of the item to transfer</li>
<li><code>x</code> (<em>number</em>): The X position in the inventory</li>
<li><code>y</code> (<em>number</em>): The Y position in the inventory</li>
<li><code>invID</code> (<em>string</em>): The destination inventory ID</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-297-1"><a id="__codelineno-297-1" name="__codelineno-297-1" href="#__codelineno-297-1"></a><span class="c1">-- Simple: Log transfer request</span>
</span><span id="__span-297-2"><a id="__codelineno-297-2" name="__codelineno-297-2" href="#__codelineno-297-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HandleItemTransferRequest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">,</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-297-3"><a id="__codelineno-297-3" name="__codelineno-297-3" href="#__codelineno-297-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; wants to transfer &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-297-4"><a id="__codelineno-297-4" name="__codelineno-297-4" href="#__codelineno-297-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-298-1"><a id="__codelineno-298-1" name="__codelineno-298-1" href="#__codelineno-298-1"></a><span class="c1">-- Medium: Validate transfer request</span>
</span><span id="__span-298-2"><a id="__codelineno-298-2" name="__codelineno-298-2" href="#__codelineno-298-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HandleItemTransferRequest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TransferValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">,</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-298-3"><a id="__codelineno-298-3" name="__codelineno-298-3" href="#__codelineno-298-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-298-4"><a id="__codelineno-298-4" name="__codelineno-298-4" href="#__codelineno-298-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-298-5"><a id="__codelineno-298-5" name="__codelineno-298-5" href="#__codelineno-298-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-298-6"><a id="__codelineno-298-6" name="__codelineno-298-6" href="#__codelineno-298-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-298-7"><a id="__codelineno-298-7" name="__codelineno-298-7" href="#__codelineno-298-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Invalid item&quot;</span><span class="p">)</span>
</span><span id="__span-298-8"><a id="__codelineno-298-8" name="__codelineno-298-8" href="#__codelineno-298-8"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-298-9"><a id="__codelineno-298-9" name="__codelineno-298-9" href="#__codelineno-298-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-298-10"><a id="__codelineno-298-10" name="__codelineno-298-10" href="#__codelineno-298-10"></a><span class="w">    </span><span class="c1">-- Check if player owns the item</span>
</span><span id="__span-298-11"><a id="__codelineno-298-11" name="__codelineno-298-11" href="#__codelineno-298-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-298-12"><a id="__codelineno-298-12" name="__codelineno-298-12" href="#__codelineno-298-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">hasItem</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-298-13"><a id="__codelineno-298-13" name="__codelineno-298-13" href="#__codelineno-298-13"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this item&quot;</span><span class="p">)</span>
</span><span id="__span-298-14"><a id="__codelineno-298-14" name="__codelineno-298-14" href="#__codelineno-298-14"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-298-15"><a id="__codelineno-298-15" name="__codelineno-298-15" href="#__codelineno-298-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-298-16"><a id="__codelineno-298-16" name="__codelineno-298-16" href="#__codelineno-298-16"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-299-1"><a id="__codelineno-299-1" name="__codelineno-299-1" href="#__codelineno-299-1"></a><span class="c1">-- High: Complex item transfer system</span>
</span><span id="__span-299-2"><a id="__codelineno-299-2" name="__codelineno-299-2" href="#__codelineno-299-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HandleItemTransferRequest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">,</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-299-3"><a id="__codelineno-299-3" name="__codelineno-299-3" href="#__codelineno-299-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-299-4"><a id="__codelineno-299-4" name="__codelineno-299-4" href="#__codelineno-299-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-299-5"><a id="__codelineno-299-5" name="__codelineno-299-5" href="#__codelineno-299-5"></a><span class="w">    </span><span class="c1">-- Get source inventory</span>
</span><span id="__span-299-6"><a id="__codelineno-299-6" name="__codelineno-299-6" href="#__codelineno-299-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sourceInventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-299-7"><a id="__codelineno-299-7" name="__codelineno-299-7" href="#__codelineno-299-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">sourceInventory</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-299-8"><a id="__codelineno-299-8" name="__codelineno-299-8" href="#__codelineno-299-8"></a><span class="w">        </span><span class="c1">-- Get destination inventory</span>
</span><span id="__span-299-9"><a id="__codelineno-299-9" name="__codelineno-299-9" href="#__codelineno-299-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">destInventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">inventory</span><span class="p">.</span><span class="nf">getByID</span><span class="p">(</span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-299-10"><a id="__codelineno-299-10" name="__codelineno-299-10" href="#__codelineno-299-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">destInventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-299-11"><a id="__codelineno-299-11" name="__codelineno-299-11" href="#__codelineno-299-11"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Invalid destination inventory&quot;</span><span class="p">)</span>
</span><span id="__span-299-12"><a id="__codelineno-299-12" name="__codelineno-299-12" href="#__codelineno-299-12"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-299-13"><a id="__codelineno-299-13" name="__codelineno-299-13" href="#__codelineno-299-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-299-14"><a id="__codelineno-299-14" name="__codelineno-299-14" href="#__codelineno-299-14"></a><span class="w">        </span><span class="c1">-- Get item</span>
</span><span id="__span-299-15"><a id="__codelineno-299-15" name="__codelineno-299-15" href="#__codelineno-299-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-299-16"><a id="__codelineno-299-16" name="__codelineno-299-16" href="#__codelineno-299-16"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-299-17"><a id="__codelineno-299-17" name="__codelineno-299-17" href="#__codelineno-299-17"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Invalid item&quot;</span><span class="p">)</span>
</span><span id="__span-299-18"><a id="__codelineno-299-18" name="__codelineno-299-18" href="#__codelineno-299-18"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-299-19"><a id="__codelineno-299-19" name="__codelineno-299-19" href="#__codelineno-299-19"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-299-20"><a id="__codelineno-299-20" name="__codelineno-299-20" href="#__codelineno-299-20"></a><span class="w">        </span><span class="c1">-- Check if player owns the item</span>
</span><span id="__span-299-21"><a id="__codelineno-299-21" name="__codelineno-299-21" href="#__codelineno-299-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">sourceInventory</span><span class="p">:</span><span class="nf">hasItem</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-299-22"><a id="__codelineno-299-22" name="__codelineno-299-22" href="#__codelineno-299-22"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t own this item&quot;</span><span class="p">)</span>
</span><span id="__span-299-23"><a id="__codelineno-299-23" name="__codelineno-299-23" href="#__codelineno-299-23"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-299-24"><a id="__codelineno-299-24" name="__codelineno-299-24" href="#__codelineno-299-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-299-25"><a id="__codelineno-299-25" name="__codelineno-299-25" href="#__codelineno-299-25"></a><span class="w">        </span><span class="c1">-- Check transfer permissions</span>
</span><span id="__span-299-26"><a id="__codelineno-299-26" name="__codelineno-299-26" href="#__codelineno-299-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanItemBeTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">sourceInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">destInventory</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-299-27"><a id="__codelineno-299-27" name="__codelineno-299-27" href="#__codelineno-299-27"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-299-28"><a id="__codelineno-299-28" name="__codelineno-299-28" href="#__codelineno-299-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-299-29"><a id="__codelineno-299-29" name="__codelineno-299-29" href="#__codelineno-299-29"></a><span class="w">        </span><span class="c1">-- Check destination space</span>
</span><span id="__span-299-30"><a id="__codelineno-299-30" name="__codelineno-299-30" href="#__codelineno-299-30"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">destInventory</span><span class="p">:</span><span class="nf">canFit</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-299-31"><a id="__codelineno-299-31" name="__codelineno-299-31" href="#__codelineno-299-31"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Not enough space in destination inventory&quot;</span><span class="p">)</span>
</span><span id="__span-299-32"><a id="__codelineno-299-32" name="__codelineno-299-32" href="#__codelineno-299-32"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-299-33"><a id="__codelineno-299-33" name="__codelineno-299-33" href="#__codelineno-299-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-299-34"><a id="__codelineno-299-34" name="__codelineno-299-34" href="#__codelineno-299-34"></a><span class="w">        </span><span class="c1">-- Perform transfer</span>
</span><span id="__span-299-35"><a id="__codelineno-299-35" name="__codelineno-299-35" href="#__codelineno-299-35"></a><span class="w">        </span><span class="nv">sourceInventory</span><span class="p">:</span><span class="nf">remove</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-299-36"><a id="__codelineno-299-36" name="__codelineno-299-36" href="#__codelineno-299-36"></a><span class="w">        </span><span class="nv">destInventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span>
</span><span id="__span-299-37"><a id="__codelineno-299-37" name="__codelineno-299-37" href="#__codelineno-299-37"></a><span class="w">        </span><span class="c1">-- Log transfer</span>
</span><span id="__span-299-38"><a id="__codelineno-299-38" name="__codelineno-299-38" href="#__codelineno-299-38"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;item_transfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Transferred to inventory &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-299-39"><a id="__codelineno-299-39" name="__codelineno-299-39" href="#__codelineno-299-39"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item transferred successfully&quot;</span><span class="p">)</span>
</span><span id="__span-299-40"><a id="__codelineno-299-40" name="__codelineno-299-40" href="#__codelineno-299-40"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="initializestorage">InitializeStorage</h3>
<p><strong>Purpose</strong></p>
<p>Called to initialize storage</p>
<p><strong>When Called</strong></p>
<p>When a storage entity is being initialized</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>entity</code> (<em>Entity</em>): The storage entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-300-1"><a id="__codelineno-300-1" name="__codelineno-300-1" href="#__codelineno-300-1"></a><span class="c1">-- Simple: Log storage initialization</span>
</span><span id="__span-300-2"><a id="__codelineno-300-2" name="__codelineno-300-2" href="#__codelineno-300-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InitializeStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-300-3"><a id="__codelineno-300-3" name="__codelineno-300-3" href="#__codelineno-300-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initializing storage: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-300-4"><a id="__codelineno-300-4" name="__codelineno-300-4" href="#__codelineno-300-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-301-1"><a id="__codelineno-301-1" name="__codelineno-301-1" href="#__codelineno-301-1"></a><span class="c1">-- Medium: Set up basic storage data</span>
</span><span id="__span-301-2"><a id="__codelineno-301-2" name="__codelineno-301-2" href="#__codelineno-301-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InitializeStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;StorageSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-301-3"><a id="__codelineno-301-3" name="__codelineno-301-3" href="#__codelineno-301-3"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="__span-301-4"><a id="__codelineno-301-4" name="__codelineno-301-4" href="#__codelineno-301-4"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-301-5"><a id="__codelineno-301-5" name="__codelineno-301-5" href="#__codelineno-301-5"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;maxItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-301-6"><a id="__codelineno-301-6" name="__codelineno-301-6" href="#__codelineno-301-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-302-1"><a id="__codelineno-302-1" name="__codelineno-302-1" href="#__codelineno-302-1"></a><span class="c1">-- High: Complex storage initialization system</span>
</span><span id="__span-302-2"><a id="__codelineno-302-2" name="__codelineno-302-2" href="#__codelineno-302-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InitializeStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-302-3"><a id="__codelineno-302-3" name="__codelineno-302-3" href="#__codelineno-302-3"></a><span class="c1">-- Set storage type</span>
</span><span id="__span-302-4"><a id="__codelineno-302-4" name="__codelineno-302-4" href="#__codelineno-302-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">storageType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;storageType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;general&quot;</span><span class="p">)</span>
</span><span id="__span-302-5"><a id="__codelineno-302-5" name="__codelineno-302-5" href="#__codelineno-302-5"></a><span class="c1">-- Configure based on storage type</span>
</span><span id="__span-302-6"><a id="__codelineno-302-6" name="__codelineno-302-6" href="#__codelineno-302-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-302-7"><a id="__codelineno-302-7" name="__codelineno-302-7" href="#__codelineno-302-7"></a><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nv">maxItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}},</span>
</span><span id="__span-302-8"><a id="__codelineno-302-8" name="__codelineno-302-8" href="#__codelineno-302-8"></a><span class="p">[</span><span class="s2">&quot;weapon&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nv">maxItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">}},</span>
</span><span id="__span-302-9"><a id="__codelineno-302-9" name="__codelineno-302-9" href="#__codelineno-302-9"></a><span class="p">[</span><span class="s2">&quot;medical&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nv">maxItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">}},</span>
</span><span id="__span-302-10"><a id="__codelineno-302-10" name="__codelineno-302-10" href="#__codelineno-302-10"></a><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nv">maxItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">}}</span>
</span><span id="__span-302-11"><a id="__codelineno-302-11" name="__codelineno-302-11" href="#__codelineno-302-11"></a><span class="p">}</span>
</span><span id="__span-302-12"><a id="__codelineno-302-12" name="__codelineno-302-12" href="#__codelineno-302-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">configs</span><span class="p">[</span><span class="nv">storageType</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">configs</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span>
</span><span id="__span-302-13"><a id="__codelineno-302-13" name="__codelineno-302-13" href="#__codelineno-302-13"></a><span class="c1">-- Set storage properties</span>
</span><span id="__span-302-14"><a id="__codelineno-302-14" name="__codelineno-302-14" href="#__codelineno-302-14"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">config</span><span class="p">.</span><span class="py">maxWeight</span><span class="p">)</span>
</span><span id="__span-302-15"><a id="__codelineno-302-15" name="__codelineno-302-15" href="#__codelineno-302-15"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;maxItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">config</span><span class="p">.</span><span class="py">maxItems</span><span class="p">)</span>
</span><span id="__span-302-16"><a id="__codelineno-302-16" name="__codelineno-302-16" href="#__codelineno-302-16"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;inventorySize&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">config</span><span class="p">.</span><span class="py">size</span><span class="p">)</span>
</span><span id="__span-302-17"><a id="__codelineno-302-17" name="__codelineno-302-17" href="#__codelineno-302-17"></a><span class="c1">-- Set access permissions</span>
</span><span id="__span-302-18"><a id="__codelineno-302-18" name="__codelineno-302-18" href="#__codelineno-302-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-302-19"><a id="__codelineno-302-19" name="__codelineno-302-19" href="#__codelineno-302-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-302-20"><a id="__codelineno-302-20" name="__codelineno-302-20" href="#__codelineno-302-20"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;accessList&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">owner</span><span class="p">})</span>
</span><span id="__span-302-21"><a id="__codelineno-302-21" name="__codelineno-302-21" href="#__codelineno-302-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-302-22"><a id="__codelineno-302-22" name="__codelineno-302-22" href="#__codelineno-302-22"></a><span class="c1">-- Initialize inventory</span>
</span><span id="__span-302-23"><a id="__codelineno-302-23" name="__codelineno-302-23" href="#__codelineno-302-23"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">inventory</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;storage&quot;</span><span class="p">)</span>
</span><span id="__span-302-24"><a id="__codelineno-302-24" name="__codelineno-302-24" href="#__codelineno-302-24"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-302-25"><a id="__codelineno-302-25" name="__codelineno-302-25" href="#__codelineno-302-25"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setSize</span><span class="p">(</span><span class="nv">config</span><span class="p">.</span><span class="py">size</span><span class="p">.</span><span class="py">w</span><span class="p">,</span><span class="w"> </span><span class="nv">config</span><span class="p">.</span><span class="py">size</span><span class="p">.</span><span class="py">h</span><span class="p">)</span>
</span><span id="__span-302-26"><a id="__codelineno-302-26" name="__codelineno-302-26" href="#__codelineno-302-26"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;maxWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">config</span><span class="p">.</span><span class="py">maxWeight</span><span class="p">)</span>
</span><span id="__span-302-27"><a id="__codelineno-302-27" name="__codelineno-302-27" href="#__codelineno-302-27"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;storageType&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">storageType</span><span class="p">)</span>
</span><span id="__span-302-28"><a id="__codelineno-302-28" name="__codelineno-302-28" href="#__codelineno-302-28"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;inventoryID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-302-29"><a id="__codelineno-302-29" name="__codelineno-302-29" href="#__codelineno-302-29"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-302-30"><a id="__codelineno-302-30" name="__codelineno-302-30" href="#__codelineno-302-30"></a><span class="c1">-- Set creation timestamp</span>
</span><span id="__span-302-31"><a id="__codelineno-302-31" name="__codelineno-302-31" href="#__codelineno-302-31"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;createdAt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-302-32"><a id="__codelineno-302-32" name="__codelineno-302-32" href="#__codelineno-302-32"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage initialized: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (Type: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">storageType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-302-33"><a id="__codelineno-302-33" name="__codelineno-302-33" href="#__codelineno-302-33"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="inventorydeleted">InventoryDeleted</h3>
<p><strong>Purpose</strong></p>
<p>Called when an inventory is deleted</p>
<p><strong>When Called</strong></p>
<p>When an inventory is removed from the system</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>instance</code> (<em>Inventory</em>): The inventory being deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-303-1"><a id="__codelineno-303-1" name="__codelineno-303-1" href="#__codelineno-303-1"></a><span class="c1">-- Simple: Log inventory deletion</span>
</span><span id="__span-303-2"><a id="__codelineno-303-2" name="__codelineno-303-2" href="#__codelineno-303-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-303-3"><a id="__codelineno-303-3" name="__codelineno-303-3" href="#__codelineno-303-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inventory deleted: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-303-4"><a id="__codelineno-303-4" name="__codelineno-303-4" href="#__codelineno-303-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-304-1"><a id="__codelineno-304-1" name="__codelineno-304-1" href="#__codelineno-304-1"></a><span class="c1">-- Medium: Clean up inventory data</span>
</span><span id="__span-304-2"><a id="__codelineno-304-2" name="__codelineno-304-2" href="#__codelineno-304-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CleanupInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-304-3"><a id="__codelineno-304-3" name="__codelineno-304-3" href="#__codelineno-304-3"></a><span class="c1">-- Remove from cache</span>
</span><span id="__span-304-4"><a id="__codelineno-304-4" name="__codelineno-304-4" href="#__codelineno-304-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">inventoryCache</span><span class="p">[</span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-304-5"><a id="__codelineno-304-5" name="__codelineno-304-5" href="#__codelineno-304-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inventory deleted and cleaned up: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-304-6"><a id="__codelineno-304-6" name="__codelineno-304-6" href="#__codelineno-304-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-305-1"><a id="__codelineno-305-1" name="__codelineno-305-1" href="#__codelineno-305-1"></a><span class="c1">-- High: Complex inventory deletion handling</span>
</span><span id="__span-305-2"><a id="__codelineno-305-2" name="__codelineno-305-2" href="#__codelineno-305-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedInventoryDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-305-3"><a id="__codelineno-305-3" name="__codelineno-305-3" href="#__codelineno-305-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">invID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span>
</span><span id="__span-305-4"><a id="__codelineno-305-4" name="__codelineno-305-4" href="#__codelineno-305-4"></a><span class="c1">-- Archive inventory data</span>
</span><span id="__span-305-5"><a id="__codelineno-305-5" name="__codelineno-305-5" href="#__codelineno-305-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO inventory_archive SELECT * FROM inventories WHERE id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-305-6"><a id="__codelineno-305-6" name="__codelineno-305-6" href="#__codelineno-305-6"></a><span class="c1">-- Clean up related data</span>
</span><span id="__span-305-7"><a id="__codelineno-305-7" name="__codelineno-305-7" href="#__codelineno-305-7"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM inventory_items WHERE invid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-305-8"><a id="__codelineno-305-8" name="__codelineno-305-8" href="#__codelineno-305-8"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM inventory_logs WHERE invid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-305-9"><a id="__codelineno-305-9" name="__codelineno-305-9" href="#__codelineno-305-9"></a><span class="c1">-- Remove from cache</span>
</span><span id="__span-305-10"><a id="__codelineno-305-10" name="__codelineno-305-10" href="#__codelineno-305-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">inventoryCache</span><span class="p">[</span><span class="nv">invID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-305-11"><a id="__codelineno-305-11" name="__codelineno-305-11" href="#__codelineno-305-11"></a><span class="c1">-- Notify owner</span>
</span><span id="__span-305-12"><a id="__codelineno-305-12" name="__codelineno-305-12" href="#__codelineno-305-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-305-13"><a id="__codelineno-305-13" name="__codelineno-305-13" href="#__codelineno-305-13"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-305-14"><a id="__codelineno-305-14" name="__codelineno-305-14" href="#__codelineno-305-14"></a><span class="w">    </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your inventory has been deleted&quot;</span><span class="p">)</span>
</span><span id="__span-305-15"><a id="__codelineno-305-15" name="__codelineno-305-15" href="#__codelineno-305-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-305-16"><a id="__codelineno-305-16" name="__codelineno-305-16" href="#__codelineno-305-16"></a><span class="c1">-- Log deletion</span>
</span><span id="__span-305-17"><a id="__codelineno-305-17" name="__codelineno-305-17" href="#__codelineno-305-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inventory deleted: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">invID</span><span class="p">)</span>
</span><span id="__span-305-18"><a id="__codelineno-305-18" name="__codelineno-305-18" href="#__codelineno-305-18"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s2">&quot;Inventory &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">invID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;inventory&quot;</span><span class="p">)</span>
</span><span id="__span-305-19"><a id="__codelineno-305-19" name="__codelineno-305-19" href="#__codelineno-305-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="inventoryitemadded">InventoryItemAdded</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is added to an inventory</p>
<p><strong>When Called</strong></p>
<p>When an item is placed into an inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>inventory</code> (<em>Inventory</em>): The inventory receiving the item</li>
<li><code>item</code> (<em>Item</em>): The item being added</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Shared</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-306-1"><a id="__codelineno-306-1" name="__codelineno-306-1" href="#__codelineno-306-1"></a><span class="c1">-- Simple: Log item addition</span>
</span><span id="__span-306-2"><a id="__codelineno-306-2" name="__codelineno-306-2" href="#__codelineno-306-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-306-3"><a id="__codelineno-306-3" name="__codelineno-306-3" href="#__codelineno-306-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item added: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-306-4"><a id="__codelineno-306-4" name="__codelineno-306-4" href="#__codelineno-306-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-307-1"><a id="__codelineno-307-1" name="__codelineno-307-1" href="#__codelineno-307-1"></a><span class="c1">-- Medium: Update inventory weight</span>
</span><span id="__span-307-2"><a id="__codelineno-307-2" name="__codelineno-307-2" href="#__codelineno-307-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UpdateInventoryWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-307-3"><a id="__codelineno-307-3" name="__codelineno-307-3" href="#__codelineno-307-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-307-4"><a id="__codelineno-307-4" name="__codelineno-307-4" href="#__codelineno-307-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">weight</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-307-5"><a id="__codelineno-307-5" name="__codelineno-307-5" href="#__codelineno-307-5"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="p">)</span>
</span><span id="__span-307-6"><a id="__codelineno-307-6" name="__codelineno-307-6" href="#__codelineno-307-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-308-1"><a id="__codelineno-308-1" name="__codelineno-308-1" href="#__codelineno-308-1"></a><span class="c1">-- High: Complex item addition handling</span>
</span><span id="__span-308-2"><a id="__codelineno-308-2" name="__codelineno-308-2" href="#__codelineno-308-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemAddition&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-308-3"><a id="__codelineno-308-3" name="__codelineno-308-3" href="#__codelineno-308-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-308-4"><a id="__codelineno-308-4" name="__codelineno-308-4" href="#__codelineno-308-4"></a><span class="w">    </span><span class="c1">-- Update inventory weight</span>
</span><span id="__span-308-5"><a id="__codelineno-308-5" name="__codelineno-308-5" href="#__codelineno-308-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-308-6"><a id="__codelineno-308-6" name="__codelineno-308-6" href="#__codelineno-308-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">weight</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-308-7"><a id="__codelineno-308-7" name="__codelineno-308-7" href="#__codelineno-308-7"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="p">)</span>
</span><span id="__span-308-8"><a id="__codelineno-308-8" name="__codelineno-308-8" href="#__codelineno-308-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-308-9"><a id="__codelineno-308-9" name="__codelineno-308-9" href="#__codelineno-308-9"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO inventory_logs (timestamp, invid, itemid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-308-10"><a id="__codelineno-308-10" name="__codelineno-308-10" href="#__codelineno-308-10"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;added&quot;</span><span class="p">)</span>
</span><span id="__span-308-11"><a id="__codelineno-308-11" name="__codelineno-308-11" href="#__codelineno-308-11"></a><span class="w">    </span><span class="c1">-- Notify owner</span>
</span><span id="__span-308-12"><a id="__codelineno-308-12" name="__codelineno-308-12" href="#__codelineno-308-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-308-13"><a id="__codelineno-308-13" name="__codelineno-308-13" href="#__codelineno-308-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-308-14"><a id="__codelineno-308-14" name="__codelineno-308-14" href="#__codelineno-308-14"></a><span class="w">        </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Added &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to inventory&quot;</span><span class="p">)</span>
</span><span id="__span-308-15"><a id="__codelineno-308-15" name="__codelineno-308-15" href="#__codelineno-308-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-308-16"><a id="__codelineno-308-16" name="__codelineno-308-16" href="#__codelineno-308-16"></a><span class="w">    </span><span class="c1">-- Check for set bonuses</span>
</span><span id="__span-308-17"><a id="__codelineno-308-17" name="__codelineno-308-17" href="#__codelineno-308-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-308-18"><a id="__codelineno-308-18" name="__codelineno-308-18" href="#__codelineno-308-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-308-19"><a id="__codelineno-308-19" name="__codelineno-308-19" href="#__codelineno-308-19"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">invItem</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-308-20"><a id="__codelineno-308-20" name="__codelineno-308-20" href="#__codelineno-308-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">invItem</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;armor_&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-308-21"><a id="__codelineno-308-21" name="__codelineno-308-21" href="#__codelineno-308-21"></a><span class="w">            </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-308-22"><a id="__codelineno-308-22" name="__codelineno-308-22" href="#__codelineno-308-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-308-23"><a id="__codelineno-308-23" name="__codelineno-308-23" href="#__codelineno-308-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-308-24"><a id="__codelineno-308-24" name="__codelineno-308-24" href="#__codelineno-308-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-308-25"><a id="__codelineno-308-25" name="__codelineno-308-25" href="#__codelineno-308-25"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-308-26"><a id="__codelineno-308-26" name="__codelineno-308-26" href="#__codelineno-308-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-308-27"><a id="__codelineno-308-27" name="__codelineno-308-27" href="#__codelineno-308-27"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;armorSetBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-308-28"><a id="__codelineno-308-28" name="__codelineno-308-28" href="#__codelineno-308-28"></a><span class="w">            </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Armor set bonus activated!&quot;</span><span class="p">)</span>
</span><span id="__span-308-29"><a id="__codelineno-308-29" name="__codelineno-308-29" href="#__codelineno-308-29"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-308-30"><a id="__codelineno-308-30" name="__codelineno-308-30" href="#__codelineno-308-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-308-31"><a id="__codelineno-308-31" name="__codelineno-308-31" href="#__codelineno-308-31"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-308-32"><a id="__codelineno-308-32" name="__codelineno-308-32" href="#__codelineno-308-32"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="inventoryitemremoved">InventoryItemRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is removed from an inventory</p>
<p><strong>When Called</strong></p>
<p>When an item is taken out of an inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Item</em>): The item being removed</li>
<li><code>instance</code> (<em>Inventory</em>): The inventory the item is being removed from</li>
<li><code>preserveItem</code> (<em>boolean</em>): Whether to preserve the item after removal</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Shared</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-309-1"><a id="__codelineno-309-1" name="__codelineno-309-1" href="#__codelineno-309-1"></a><span class="c1">-- Simple: Log item removal</span>
</span><span id="__span-309-2"><a id="__codelineno-309-2" name="__codelineno-309-2" href="#__codelineno-309-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">instance</span><span class="p">,</span><span class="w"> </span><span class="nv">preserveItem</span><span class="p">)</span>
</span><span id="__span-309-3"><a id="__codelineno-309-3" name="__codelineno-309-3" href="#__codelineno-309-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item removed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-309-4"><a id="__codelineno-309-4" name="__codelineno-309-4" href="#__codelineno-309-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-310-1"><a id="__codelineno-310-1" name="__codelineno-310-1" href="#__codelineno-310-1"></a><span class="c1">-- Medium: Update inventory weight</span>
</span><span id="__span-310-2"><a id="__codelineno-310-2" name="__codelineno-310-2" href="#__codelineno-310-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UpdateWeightOnRemove&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">instance</span><span class="p">,</span><span class="w"> </span><span class="nv">preserveItem</span><span class="p">)</span>
</span><span id="__span-310-3"><a id="__codelineno-310-3" name="__codelineno-310-3" href="#__codelineno-310-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-310-4"><a id="__codelineno-310-4" name="__codelineno-310-4" href="#__codelineno-310-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">weight</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-310-5"><a id="__codelineno-310-5" name="__codelineno-310-5" href="#__codelineno-310-5"></a><span class="nv">instance</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">itemWeight</span><span class="p">))</span>
</span><span id="__span-310-6"><a id="__codelineno-310-6" name="__codelineno-310-6" href="#__codelineno-310-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-311-1"><a id="__codelineno-311-1" name="__codelineno-311-1" href="#__codelineno-311-1"></a><span class="c1">-- High: Complex item removal handling</span>
</span><span id="__span-311-2"><a id="__codelineno-311-2" name="__codelineno-311-2" href="#__codelineno-311-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InventoryItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">instance</span><span class="p">,</span><span class="w"> </span><span class="nv">preserveItem</span><span class="p">)</span>
</span><span id="__span-311-3"><a id="__codelineno-311-3" name="__codelineno-311-3" href="#__codelineno-311-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-4"><a id="__codelineno-311-4" name="__codelineno-311-4" href="#__codelineno-311-4"></a><span class="w">    </span><span class="c1">-- Update inventory weight</span>
</span><span id="__span-311-5"><a id="__codelineno-311-5" name="__codelineno-311-5" href="#__codelineno-311-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-311-6"><a id="__codelineno-311-6" name="__codelineno-311-6" href="#__codelineno-311-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">weight</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-311-7"><a id="__codelineno-311-7" name="__codelineno-311-7" href="#__codelineno-311-7"></a><span class="w">    </span><span class="nv">instance</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">itemWeight</span><span class="p">))</span>
</span><span id="__span-311-8"><a id="__codelineno-311-8" name="__codelineno-311-8" href="#__codelineno-311-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-311-9"><a id="__codelineno-311-9" name="__codelineno-311-9" href="#__codelineno-311-9"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO inventory_logs (timestamp, invid, itemid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-311-10"><a id="__codelineno-311-10" name="__codelineno-311-10" href="#__codelineno-311-10"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;removed&quot;</span><span class="p">)</span>
</span><span id="__span-311-11"><a id="__codelineno-311-11" name="__codelineno-311-11" href="#__codelineno-311-11"></a><span class="w">    </span><span class="c1">-- Notify owner</span>
</span><span id="__span-311-12"><a id="__codelineno-311-12" name="__codelineno-311-12" href="#__codelineno-311-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-311-13"><a id="__codelineno-311-13" name="__codelineno-311-13" href="#__codelineno-311-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-14"><a id="__codelineno-311-14" name="__codelineno-311-14" href="#__codelineno-311-14"></a><span class="w">        </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Removed &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; from inventory&quot;</span><span class="p">)</span>
</span><span id="__span-311-15"><a id="__codelineno-311-15" name="__codelineno-311-15" href="#__codelineno-311-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-311-16"><a id="__codelineno-311-16" name="__codelineno-311-16" href="#__codelineno-311-16"></a><span class="w">    </span><span class="c1">-- Check for set bonus removal</span>
</span><span id="__span-311-17"><a id="__codelineno-311-17" name="__codelineno-311-17" href="#__codelineno-311-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;armor_&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-18"><a id="__codelineno-311-18" name="__codelineno-311-18" href="#__codelineno-311-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-311-19"><a id="__codelineno-311-19" name="__codelineno-311-19" href="#__codelineno-311-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-311-20"><a id="__codelineno-311-20" name="__codelineno-311-20" href="#__codelineno-311-20"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">invItem</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-311-21"><a id="__codelineno-311-21" name="__codelineno-311-21" href="#__codelineno-311-21"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">invItem</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;armor_&quot;</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">invItem</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">self</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-22"><a id="__codelineno-311-22" name="__codelineno-311-22" href="#__codelineno-311-22"></a><span class="w">                </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-311-23"><a id="__codelineno-311-23" name="__codelineno-311-23" href="#__codelineno-311-23"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-311-24"><a id="__codelineno-311-24" name="__codelineno-311-24" href="#__codelineno-311-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-311-25"><a id="__codelineno-311-25" name="__codelineno-311-25" href="#__codelineno-311-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-26"><a id="__codelineno-311-26" name="__codelineno-311-26" href="#__codelineno-311-26"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-311-27"><a id="__codelineno-311-27" name="__codelineno-311-27" href="#__codelineno-311-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;armorSetBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-311-28"><a id="__codelineno-311-28" name="__codelineno-311-28" href="#__codelineno-311-28"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;armorSetBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-311-29"><a id="__codelineno-311-29" name="__codelineno-311-29" href="#__codelineno-311-29"></a><span class="w">                </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Armor set bonus deactivated&quot;</span><span class="p">)</span>
</span><span id="__span-311-30"><a id="__codelineno-311-30" name="__codelineno-311-30" href="#__codelineno-311-30"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-311-31"><a id="__codelineno-311-31" name="__codelineno-311-31" href="#__codelineno-311-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-311-32"><a id="__codelineno-311-32" name="__codelineno-311-32" href="#__codelineno-311-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-311-33"><a id="__codelineno-311-33" name="__codelineno-311-33" href="#__codelineno-311-33"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-311-34"><a id="__codelineno-311-34" name="__codelineno-311-34" href="#__codelineno-311-34"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="issuitablefortrunk">IsSuitableForTrunk</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if an entity is suitable for trunk storage</p>
<p><strong>When Called</strong></p>
<p>When determining if an entity can be used as a trunk/storage</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>entity</code> (<em>Entity</em>): The entity being checked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True if suitable, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-312-1"><a id="__codelineno-312-1" name="__codelineno-312-1" href="#__codelineno-312-1"></a><span class="c1">-- Simple: Only vehicles are suitable</span>
</span><span id="__span-312-2"><a id="__codelineno-312-2" name="__codelineno-312-2" href="#__codelineno-312-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;IsSuitableForTrunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-312-3"><a id="__codelineno-312-3" name="__codelineno-312-3" href="#__codelineno-312-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">IsVehicle</span><span class="p">()</span>
</span><span id="__span-312-4"><a id="__codelineno-312-4" name="__codelineno-312-4" href="#__codelineno-312-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-313-1"><a id="__codelineno-313-1" name="__codelineno-313-1" href="#__codelineno-313-1"></a><span class="c1">-- Medium: Specific entity classes</span>
</span><span id="__span-313-2"><a id="__codelineno-313-2" name="__codelineno-313-2" href="#__codelineno-313-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;IsSuitableForTrunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrunkEntityCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-313-3"><a id="__codelineno-313-3" name="__codelineno-313-3" href="#__codelineno-313-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">suitableClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-313-4"><a id="__codelineno-313-4" name="__codelineno-313-4" href="#__codelineno-313-4"></a><span class="p">[</span><span class="s2">&quot;prop_vehicle_jeep&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-313-5"><a id="__codelineno-313-5" name="__codelineno-313-5" href="#__codelineno-313-5"></a><span class="p">[</span><span class="s2">&quot;prop_vehicle_airboat&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-313-6"><a id="__codelineno-313-6" name="__codelineno-313-6" href="#__codelineno-313-6"></a><span class="p">[</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-313-7"><a id="__codelineno-313-7" name="__codelineno-313-7" href="#__codelineno-313-7"></a><span class="p">}</span>
</span><span id="__span-313-8"><a id="__codelineno-313-8" name="__codelineno-313-8" href="#__codelineno-313-8"></a><span class="kr">return</span><span class="w"> </span><span class="nv">suitableClasses</span><span class="p">[</span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-313-9"><a id="__codelineno-313-9" name="__codelineno-313-9" href="#__codelineno-313-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-314-1"><a id="__codelineno-314-1" name="__codelineno-314-1" href="#__codelineno-314-1"></a><span class="c1">-- High: Complex trunk suitability system</span>
</span><span id="__span-314-2"><a id="__codelineno-314-2" name="__codelineno-314-2" href="#__codelineno-314-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;IsSuitableForTrunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTrunkCheck&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-314-3"><a id="__codelineno-314-3" name="__codelineno-314-3" href="#__codelineno-314-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-314-4"><a id="__codelineno-314-4" name="__codelineno-314-4" href="#__codelineno-314-4"></a><span class="w">    </span><span class="c1">-- Check entity class</span>
</span><span id="__span-314-5"><a id="__codelineno-314-5" name="__codelineno-314-5" href="#__codelineno-314-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">suitableClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-314-6"><a id="__codelineno-314-6" name="__codelineno-314-6" href="#__codelineno-314-6"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;prop_vehicle_jeep&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-314-7"><a id="__codelineno-314-7" name="__codelineno-314-7" href="#__codelineno-314-7"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;prop_vehicle_airboat&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-314-8"><a id="__codelineno-314-8" name="__codelineno-314-8" href="#__codelineno-314-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-314-9"><a id="__codelineno-314-9" name="__codelineno-314-9" href="#__codelineno-314-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-314-10"><a id="__codelineno-314-10" name="__codelineno-314-10" href="#__codelineno-314-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">suitableClasses</span><span class="p">[</span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-314-11"><a id="__codelineno-314-11" name="__codelineno-314-11" href="#__codelineno-314-11"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-314-12"><a id="__codelineno-314-12" name="__codelineno-314-12" href="#__codelineno-314-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-314-13"><a id="__codelineno-314-13" name="__codelineno-314-13" href="#__codelineno-314-13"></a><span class="w">    </span><span class="c1">-- Check if entity has trunk flag</span>
</span><span id="__span-314-14"><a id="__codelineno-314-14" name="__codelineno-314-14" href="#__codelineno-314-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;hasTrunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-314-15"><a id="__codelineno-314-15" name="__codelineno-314-15" href="#__codelineno-314-15"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-314-16"><a id="__codelineno-314-16" name="__codelineno-314-16" href="#__codelineno-314-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-314-17"><a id="__codelineno-314-17" name="__codelineno-314-17" href="#__codelineno-314-17"></a><span class="w">    </span><span class="c1">-- Check entity size for props</span>
</span><span id="__span-314-18"><a id="__codelineno-314-18" name="__codelineno-314-18" href="#__codelineno-314-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;prop_physics&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-314-19"><a id="__codelineno-314-19" name="__codelineno-314-19" href="#__codelineno-314-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">mins</span><span class="p">,</span><span class="w"> </span><span class="nv">maxs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetCollisionBounds</span><span class="p">()</span>
</span><span id="__span-314-20"><a id="__codelineno-314-20" name="__codelineno-314-20" href="#__codelineno-314-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">maxs</span><span class="p">.</span><span class="py">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">mins</span><span class="p">.</span><span class="py">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nv">maxs</span><span class="p">.</span><span class="py">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">mins</span><span class="p">.</span><span class="py">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nv">maxs</span><span class="p">.</span><span class="py">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">mins</span><span class="p">.</span><span class="py">z</span><span class="p">)</span>
</span><span id="__span-314-21"><a id="__codelineno-314-21" name="__codelineno-314-21" href="#__codelineno-314-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">volume</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- Too small</span>
</span><span id="__span-314-22"><a id="__codelineno-314-22" name="__codelineno-314-22" href="#__codelineno-314-22"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-314-23"><a id="__codelineno-314-23" name="__codelineno-314-23" href="#__codelineno-314-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-314-24"><a id="__codelineno-314-24" name="__codelineno-314-24" href="#__codelineno-314-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-314-25"><a id="__codelineno-314-25" name="__codelineno-314-25" href="#__codelineno-314-25"></a><span class="w">    </span><span class="c1">-- Check if entity is locked</span>
</span><span id="__span-314-26"><a id="__codelineno-314-26" name="__codelineno-314-26" href="#__codelineno-314-26"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-314-27"><a id="__codelineno-314-27" name="__codelineno-314-27" href="#__codelineno-314-27"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-314-28"><a id="__codelineno-314-28" name="__codelineno-314-28" href="#__codelineno-314-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-314-29"><a id="__codelineno-314-29" name="__codelineno-314-29" href="#__codelineno-314-29"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-314-30"><a id="__codelineno-314-30" name="__codelineno-314-30" href="#__codelineno-314-30"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="itemcombine">ItemCombine</h3>
<p><strong>Purpose</strong></p>
<p>Called when items are combined</p>
<p><strong>When Called</strong></p>
<p>When a player attempts to combine two items</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player combining items</li>
<li><code>item</code> (<em>Item</em>): The first item</li>
<li><code>target</code> (<em>Item</em>): The second item being combined with</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-315-1"><a id="__codelineno-315-1" name="__codelineno-315-1" href="#__codelineno-315-1"></a><span class="c1">-- Simple: Allow all combinations</span>
</span><span id="__span-315-2"><a id="__codelineno-315-2" name="__codelineno-315-2" href="#__codelineno-315-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemCombine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-315-3"><a id="__codelineno-315-3" name="__codelineno-315-3" href="#__codelineno-315-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-315-4"><a id="__codelineno-315-4" name="__codelineno-315-4" href="#__codelineno-315-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-316-1"><a id="__codelineno-316-1" name="__codelineno-316-1" href="#__codelineno-316-1"></a><span class="c1">-- Medium: Specific item combinations</span>
</span><span id="__span-316-2"><a id="__codelineno-316-2" name="__codelineno-316-2" href="#__codelineno-316-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemCombine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemCombinations&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-316-3"><a id="__codelineno-316-3" name="__codelineno-316-3" href="#__codelineno-316-3"></a><span class="c1">-- Allow combining weapon parts</span>
</span><span id="__span-316-4"><a id="__codelineno-316-4" name="__codelineno-316-4" href="#__codelineno-316-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_part_a&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">target</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_part_b&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-316-5"><a id="__codelineno-316-5" name="__codelineno-316-5" href="#__codelineno-316-5"></a><span class="w">    </span><span class="c1">-- Create combined weapon</span>
</span><span id="__span-316-6"><a id="__codelineno-316-6" name="__codelineno-316-6" href="#__codelineno-316-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">newItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="s2">&quot;weapon_combined&quot;</span><span class="p">)</span>
</span><span id="__span-316-7"><a id="__codelineno-316-7" name="__codelineno-316-7" href="#__codelineno-316-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">newItem</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-316-8"><a id="__codelineno-316-8" name="__codelineno-316-8" href="#__codelineno-316-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-316-9"><a id="__codelineno-316-9" name="__codelineno-316-9" href="#__codelineno-316-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-316-10"><a id="__codelineno-316-10" name="__codelineno-316-10" href="#__codelineno-316-10"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">add</span><span class="p">(</span><span class="nv">newItem</span><span class="p">)</span>
</span><span id="__span-316-11"><a id="__codelineno-316-11" name="__codelineno-316-11" href="#__codelineno-316-11"></a><span class="w">            </span><span class="nv">item</span><span class="p">:</span><span class="nf">remove</span><span class="p">()</span>
</span><span id="__span-316-12"><a id="__codelineno-316-12" name="__codelineno-316-12" href="#__codelineno-316-12"></a><span class="w">            </span><span class="nv">target</span><span class="p">:</span><span class="nf">remove</span><span class="p">()</span>
</span><span id="__span-316-13"><a id="__codelineno-316-13" name="__codelineno-316-13" href="#__codelineno-316-13"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Items combined successfully!&quot;</span><span class="p">)</span>
</span><span id="__span-316-14"><a id="__codelineno-316-14" name="__codelineno-316-14" href="#__codelineno-316-14"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-316-15"><a id="__codelineno-316-15" name="__codelineno-316-15" href="#__codelineno-316-15"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-316-16"><a id="__codelineno-316-16" name="__codelineno-316-16" href="#__codelineno-316-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-316-17"><a id="__codelineno-316-17" name="__codelineno-316-17" href="#__codelineno-316-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-316-18"><a id="__codelineno-316-18" name="__codelineno-316-18" href="#__codelineno-316-18"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-316-19"><a id="__codelineno-316-19" name="__codelineno-316-19" href="#__codelineno-316-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-317-1"><a id="__codelineno-317-1" name="__codelineno-317-1" href="#__codelineno-317-1"></a><span class="c1">-- High: Complex item combination system</span>
</span><span id="__span-317-2"><a id="__codelineno-317-2" name="__codelineno-317-2" href="#__codelineno-317-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemCombine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemCombine&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-317-3"><a id="__codelineno-317-3" name="__codelineno-317-3" href="#__codelineno-317-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-317-4"><a id="__codelineno-317-4" name="__codelineno-317-4" href="#__codelineno-317-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-317-5"><a id="__codelineno-317-5" name="__codelineno-317-5" href="#__codelineno-317-5"></a><span class="w">    </span><span class="c1">-- Define combination recipes</span>
</span><span id="__span-317-6"><a id="__codelineno-317-6" name="__codelineno-317-6" href="#__codelineno-317-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">recipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-317-7"><a id="__codelineno-317-7" name="__codelineno-317-7" href="#__codelineno-317-7"></a><span class="w">    </span><span class="p">{</span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_part_a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;weapon_part_b&quot;</span><span class="p">},</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;weapon_combined&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">skill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
</span><span id="__span-317-8"><a id="__codelineno-317-8" name="__codelineno-317-8" href="#__codelineno-317-8"></a><span class="w">    </span><span class="p">{</span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;metal_ore&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;metal_ore&quot;</span><span class="p">},</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metal_bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">skill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
</span><span id="__span-317-9"><a id="__codelineno-317-9" name="__codelineno-317-9" href="#__codelineno-317-9"></a><span class="w">    </span><span class="p">{</span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;herb_a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;herb_b&quot;</span><span class="p">},</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;potion_health&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">skill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span>
</span><span id="__span-317-10"><a id="__codelineno-317-10" name="__codelineno-317-10" href="#__codelineno-317-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-317-11"><a id="__codelineno-317-11" name="__codelineno-317-11" href="#__codelineno-317-11"></a><span class="w">    </span><span class="c1">-- Check each recipe</span>
</span><span id="__span-317-12"><a id="__codelineno-317-12" name="__codelineno-317-12" href="#__codelineno-317-12"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">recipe</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">recipes</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-317-13"><a id="__codelineno-317-13" name="__codelineno-317-13" href="#__codelineno-317-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">hasItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">recipe</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">recipe</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">))</span>
</span><span id="__span-317-14"><a id="__codelineno-317-14" name="__codelineno-317-14" href="#__codelineno-317-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">hasItems</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-317-15"><a id="__codelineno-317-15" name="__codelineno-317-15" href="#__codelineno-317-15"></a><span class="w">            </span><span class="c1">-- Check skill requirement</span>
</span><span id="__span-317-16"><a id="__codelineno-317-16" name="__codelineno-317-16" href="#__codelineno-317-16"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">craftingSkill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;craftingSkill&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-317-17"><a id="__codelineno-317-17" name="__codelineno-317-17" href="#__codelineno-317-17"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">craftingSkill</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">recipe</span><span class="p">.</span><span class="py">skill</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-317-18"><a id="__codelineno-317-18" name="__codelineno-317-18" href="#__codelineno-317-18"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need crafting skill level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">recipe</span><span class="p">.</span><span class="py">skill</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to combine these items&quot;</span><span class="p">)</span>
</span><span id="__span-317-19"><a id="__codelineno-317-19" name="__codelineno-317-19" href="#__codelineno-317-19"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-317-20"><a id="__codelineno-317-20" name="__codelineno-317-20" href="#__codelineno-317-20"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-317-21"><a id="__codelineno-317-21" name="__codelineno-317-21" href="#__codelineno-317-21"></a><span class="w">            </span><span class="c1">-- Create result item</span>
</span><span id="__span-317-22"><a id="__codelineno-317-22" name="__codelineno-317-22" href="#__codelineno-317-22"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">newItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">recipe</span><span class="p">.</span><span class="py">result</span><span class="p">)</span>
</span><span id="__span-317-23"><a id="__codelineno-317-23" name="__codelineno-317-23" href="#__codelineno-317-23"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">newItem</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-317-24"><a id="__codelineno-317-24" name="__codelineno-317-24" href="#__codelineno-317-24"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">add</span><span class="p">(</span><span class="nv">newItem</span><span class="p">)</span>
</span><span id="__span-317-25"><a id="__codelineno-317-25" name="__codelineno-317-25" href="#__codelineno-317-25"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">remove</span><span class="p">()</span>
</span><span id="__span-317-26"><a id="__codelineno-317-26" name="__codelineno-317-26" href="#__codelineno-317-26"></a><span class="w">                </span><span class="nv">target</span><span class="p">:</span><span class="nf">remove</span><span class="p">()</span>
</span><span id="__span-317-27"><a id="__codelineno-317-27" name="__codelineno-317-27" href="#__codelineno-317-27"></a><span class="w">                </span><span class="c1">-- Grant experience</span>
</span><span id="__span-317-28"><a id="__codelineno-317-28" name="__codelineno-317-28" href="#__codelineno-317-28"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentSkill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;craftingSkill&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-317-29"><a id="__codelineno-317-29" name="__codelineno-317-29" href="#__codelineno-317-29"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;craftingSkill&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentSkill</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-317-30"><a id="__codelineno-317-30" name="__codelineno-317-30" href="#__codelineno-317-30"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Items combined successfully! Crafting skill increased.&quot;</span><span class="p">)</span>
</span><span id="__span-317-31"><a id="__codelineno-317-31" name="__codelineno-317-31" href="#__codelineno-317-31"></a><span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-317-32"><a id="__codelineno-317-32" name="__codelineno-317-32" href="#__codelineno-317-32"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-317-33"><a id="__codelineno-317-33" name="__codelineno-317-33" href="#__codelineno-317-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-317-34"><a id="__codelineno-317-34" name="__codelineno-317-34" href="#__codelineno-317-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-317-35"><a id="__codelineno-317-35" name="__codelineno-317-35" href="#__codelineno-317-35"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;These items cannot be combined&quot;</span><span class="p">)</span>
</span><span id="__span-317-36"><a id="__codelineno-317-36" name="__codelineno-317-36" href="#__codelineno-317-36"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-317-37"><a id="__codelineno-317-37" name="__codelineno-317-37" href="#__codelineno-317-37"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="itemdeleted">ItemDeleted</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is deleted</p>
<p><strong>When Called</strong></p>
<p>When an item is removed from the system</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>instance</code> (<em>Item</em>): The item being deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-318-1"><a id="__codelineno-318-1" name="__codelineno-318-1" href="#__codelineno-318-1"></a><span class="c1">-- Simple: Log item deletion</span>
</span><span id="__span-318-2"><a id="__codelineno-318-2" name="__codelineno-318-2" href="#__codelineno-318-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-318-3"><a id="__codelineno-318-3" name="__codelineno-318-3" href="#__codelineno-318-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item deleted: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-318-4"><a id="__codelineno-318-4" name="__codelineno-318-4" href="#__codelineno-318-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-319-1"><a id="__codelineno-319-1" name="__codelineno-319-1" href="#__codelineno-319-1"></a><span class="c1">-- Medium: Clean up item data</span>
</span><span id="__span-319-2"><a id="__codelineno-319-2" name="__codelineno-319-2" href="#__codelineno-319-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CleanupItemData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-319-3"><a id="__codelineno-319-3" name="__codelineno-319-3" href="#__codelineno-319-3"></a><span class="c1">-- Remove from cache</span>
</span><span id="__span-319-4"><a id="__codelineno-319-4" name="__codelineno-319-4" href="#__codelineno-319-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">itemCache</span><span class="p">[</span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-319-5"><a id="__codelineno-319-5" name="__codelineno-319-5" href="#__codelineno-319-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item deleted and cleaned up: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-319-6"><a id="__codelineno-319-6" name="__codelineno-319-6" href="#__codelineno-319-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-320-1"><a id="__codelineno-320-1" name="__codelineno-320-1" href="#__codelineno-320-1"></a><span class="c1">-- High: Complex item deletion handling</span>
</span><span id="__span-320-2"><a id="__codelineno-320-2" name="__codelineno-320-2" href="#__codelineno-320-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">instance</span><span class="p">)</span>
</span><span id="__span-320-3"><a id="__codelineno-320-3" name="__codelineno-320-3" href="#__codelineno-320-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span>
</span><span id="__span-320-4"><a id="__codelineno-320-4" name="__codelineno-320-4" href="#__codelineno-320-4"></a><span class="c1">-- Archive item data</span>
</span><span id="__span-320-5"><a id="__codelineno-320-5" name="__codelineno-320-5" href="#__codelineno-320-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO item_archive SELECT * FROM items WHERE id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-320-6"><a id="__codelineno-320-6" name="__codelineno-320-6" href="#__codelineno-320-6"></a><span class="c1">-- Clean up related data</span>
</span><span id="__span-320-7"><a id="__codelineno-320-7" name="__codelineno-320-7" href="#__codelineno-320-7"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM item_data WHERE itemid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-320-8"><a id="__codelineno-320-8" name="__codelineno-320-8" href="#__codelineno-320-8"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM item_logs WHERE itemid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-320-9"><a id="__codelineno-320-9" name="__codelineno-320-9" href="#__codelineno-320-9"></a><span class="c1">-- Remove from cache</span>
</span><span id="__span-320-10"><a id="__codelineno-320-10" name="__codelineno-320-10" href="#__codelineno-320-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">itemCache</span><span class="p">[</span><span class="nv">itemID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-320-11"><a id="__codelineno-320-11" name="__codelineno-320-11" href="#__codelineno-320-11"></a><span class="c1">-- Notify owner</span>
</span><span id="__span-320-12"><a id="__codelineno-320-12" name="__codelineno-320-12" href="#__codelineno-320-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">instance</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-320-13"><a id="__codelineno-320-13" name="__codelineno-320-13" href="#__codelineno-320-13"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-320-14"><a id="__codelineno-320-14" name="__codelineno-320-14" href="#__codelineno-320-14"></a><span class="w">    </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">instance</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been deleted&quot;</span><span class="p">)</span>
</span><span id="__span-320-15"><a id="__codelineno-320-15" name="__codelineno-320-15" href="#__codelineno-320-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-320-16"><a id="__codelineno-320-16" name="__codelineno-320-16" href="#__codelineno-320-16"></a><span class="c1">-- Log deletion</span>
</span><span id="__span-320-17"><a id="__codelineno-320-17" name="__codelineno-320-17" href="#__codelineno-320-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item deleted: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (ID: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-320-18"><a id="__codelineno-320-18" name="__codelineno-320-18" href="#__codelineno-320-18"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s2">&quot;Item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">instance</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;) was deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;item&quot;</span><span class="p">)</span>
</span><span id="__span-320-19"><a id="__codelineno-320-19" name="__codelineno-320-19" href="#__codelineno-320-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="itemdraggedoutofinventory">ItemDraggedOutOfInventory</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is dragged out of inventory</p>
<p><strong>When Called</strong></p>
<p>When a player drags an item outside the inventory panel</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player dragging the item</li>
<li><code>item</code> (<em>Item</em>): The item being dragged</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-321-1"><a id="__codelineno-321-1" name="__codelineno-321-1" href="#__codelineno-321-1"></a><span class="c1">-- Simple: Allow all drags</span>
</span><span id="__span-321-2"><a id="__codelineno-321-2" name="__codelineno-321-2" href="#__codelineno-321-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDraggedOutOfInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-321-3"><a id="__codelineno-321-3" name="__codelineno-321-3" href="#__codelineno-321-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-321-4"><a id="__codelineno-321-4" name="__codelineno-321-4" href="#__codelineno-321-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-322-1"><a id="__codelineno-322-1" name="__codelineno-322-1" href="#__codelineno-322-1"></a><span class="c1">-- Medium: Prevent dragging equipped items</span>
</span><span id="__span-322-2"><a id="__codelineno-322-2" name="__codelineno-322-2" href="#__codelineno-322-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDraggedOutOfInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PreventEquippedDrag&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-322-3"><a id="__codelineno-322-3" name="__codelineno-322-3" href="#__codelineno-322-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-322-4"><a id="__codelineno-322-4" name="__codelineno-322-4" href="#__codelineno-322-4"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drag equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-322-5"><a id="__codelineno-322-5" name="__codelineno-322-5" href="#__codelineno-322-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-322-6"><a id="__codelineno-322-6" name="__codelineno-322-6" href="#__codelineno-322-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-322-7"><a id="__codelineno-322-7" name="__codelineno-322-7" href="#__codelineno-322-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-322-8"><a id="__codelineno-322-8" name="__codelineno-322-8" href="#__codelineno-322-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-323-1"><a id="__codelineno-323-1" name="__codelineno-323-1" href="#__codelineno-323-1"></a><span class="c1">-- High: Complex drag validation</span>
</span><span id="__span-323-2"><a id="__codelineno-323-2" name="__codelineno-323-2" href="#__codelineno-323-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemDraggedOutOfInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDragValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-323-3"><a id="__codelineno-323-3" name="__codelineno-323-3" href="#__codelineno-323-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-323-4"><a id="__codelineno-323-4" name="__codelineno-323-4" href="#__codelineno-323-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-323-5"><a id="__codelineno-323-5" name="__codelineno-323-5" href="#__codelineno-323-5"></a><span class="w">    </span><span class="c1">-- Prevent dragging equipped items</span>
</span><span id="__span-323-6"><a id="__codelineno-323-6" name="__codelineno-323-6" href="#__codelineno-323-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;equipped&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-323-7"><a id="__codelineno-323-7" name="__codelineno-323-7" href="#__codelineno-323-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Cannot drag equipped items&quot;</span><span class="p">)</span>
</span><span id="__span-323-8"><a id="__codelineno-323-8" name="__codelineno-323-8" href="#__codelineno-323-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-323-9"><a id="__codelineno-323-9" name="__codelineno-323-9" href="#__codelineno-323-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-323-10"><a id="__codelineno-323-10" name="__codelineno-323-10" href="#__codelineno-323-10"></a><span class="w">    </span><span class="c1">-- Prevent dragging bound items</span>
</span><span id="__span-323-11"><a id="__codelineno-323-11" name="__codelineno-323-11" href="#__codelineno-323-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bound&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-323-12"><a id="__codelineno-323-12" name="__codelineno-323-12" href="#__codelineno-323-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;boundTo&quot;</span><span class="p">)</span>
</span><span id="__span-323-13"><a id="__codelineno-323-13" name="__codelineno-323-13" href="#__codelineno-323-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-323-14"><a id="__codelineno-323-14" name="__codelineno-323-14" href="#__codelineno-323-14"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is bound to you and cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-323-15"><a id="__codelineno-323-15" name="__codelineno-323-15" href="#__codelineno-323-15"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-323-16"><a id="__codelineno-323-16" name="__codelineno-323-16" href="#__codelineno-323-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-323-17"><a id="__codelineno-323-17" name="__codelineno-323-17" href="#__codelineno-323-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-323-18"><a id="__codelineno-323-18" name="__codelineno-323-18" href="#__codelineno-323-18"></a><span class="w">    </span><span class="c1">-- Prevent dragging quest items</span>
</span><span id="__span-323-19"><a id="__codelineno-323-19" name="__codelineno-323-19" href="#__codelineno-323-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-323-20"><a id="__codelineno-323-20" name="__codelineno-323-20" href="#__codelineno-323-20"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Quest items cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-323-21"><a id="__codelineno-323-21" name="__codelineno-323-21" href="#__codelineno-323-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-323-22"><a id="__codelineno-323-22" name="__codelineno-323-22" href="#__codelineno-323-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-323-23"><a id="__codelineno-323-23" name="__codelineno-323-23" href="#__codelineno-323-23"></a><span class="w">    </span><span class="c1">-- Check cooldown</span>
</span><span id="__span-323-24"><a id="__codelineno-323-24" name="__codelineno-323-24" href="#__codelineno-323-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastDrag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastItemDrag&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-323-25"><a id="__codelineno-323-25" name="__codelineno-323-25" href="#__codelineno-323-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastDrag</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-323-26"><a id="__codelineno-323-26" name="__codelineno-323-26" href="#__codelineno-323-26"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-323-27"><a id="__codelineno-323-27" name="__codelineno-323-27" href="#__codelineno-323-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-323-28"><a id="__codelineno-323-28" name="__codelineno-323-28" href="#__codelineno-323-28"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastItemDrag&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">())</span>
</span><span id="__span-323-29"><a id="__codelineno-323-29" name="__codelineno-323-29" href="#__codelineno-323-29"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-323-30"><a id="__codelineno-323-30" name="__codelineno-323-30" href="#__codelineno-323-30"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="itemfunctioncalled">ItemFunctionCalled</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item function is called</p>
<p><strong>When Called</strong></p>
<p>When a player uses an item function</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Item</em>): The item whose function was called</li>
<li><code>method</code> (<em>string</em>): The function name that was called</li>
<li><code>client</code> (<em>Player</em>): The player calling the function</li>
<li><code>entity</code> (<em>Entity</em>): The entity involved (if any)</li>
<li><code>results</code> (<em>table</em>): The results from the function</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-324-1"><a id="__codelineno-324-1" name="__codelineno-324-1" href="#__codelineno-324-1"></a><span class="c1">-- Simple: Log function calls</span>
</span><span id="__span-324-2"><a id="__codelineno-324-2" name="__codelineno-324-2" href="#__codelineno-324-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemFunctionCalled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">method</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-324-3"><a id="__codelineno-324-3" name="__codelineno-324-3" href="#__codelineno-324-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; used &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-324-4"><a id="__codelineno-324-4" name="__codelineno-324-4" href="#__codelineno-324-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-325-1"><a id="__codelineno-325-1" name="__codelineno-325-1" href="#__codelineno-325-1"></a><span class="c1">-- Medium: Track function usage</span>
</span><span id="__span-325-2"><a id="__codelineno-325-2" name="__codelineno-325-2" href="#__codelineno-325-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemFunctionCalled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackItemUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">method</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-325-3"><a id="__codelineno-325-3" name="__codelineno-325-3" href="#__codelineno-325-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-325-4"><a id="__codelineno-325-4" name="__codelineno-325-4" href="#__codelineno-325-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-325-5"><a id="__codelineno-325-5" name="__codelineno-325-5" href="#__codelineno-325-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">usageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemUsage_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-325-6"><a id="__codelineno-325-6" name="__codelineno-325-6" href="#__codelineno-325-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemUsage_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">usageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-325-7"><a id="__codelineno-325-7" name="__codelineno-325-7" href="#__codelineno-325-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-325-8"><a id="__codelineno-325-8" name="__codelineno-325-8" href="#__codelineno-325-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-326-1"><a id="__codelineno-326-1" name="__codelineno-326-1" href="#__codelineno-326-1"></a><span class="c1">-- High: Complex function tracking system</span>
</span><span id="__span-326-2"><a id="__codelineno-326-2" name="__codelineno-326-2" href="#__codelineno-326-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemFunctionCalled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFunctionTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">method</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-326-3"><a id="__codelineno-326-3" name="__codelineno-326-3" href="#__codelineno-326-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-326-4"><a id="__codelineno-326-4" name="__codelineno-326-4" href="#__codelineno-326-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-326-5"><a id="__codelineno-326-5" name="__codelineno-326-5" href="#__codelineno-326-5"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-326-6"><a id="__codelineno-326-6" name="__codelineno-326-6" href="#__codelineno-326-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO item_function_logs (timestamp, itemid, method, charid, steamid) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-326-7"><a id="__codelineno-326-7" name="__codelineno-326-7" href="#__codelineno-326-7"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">method</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-326-8"><a id="__codelineno-326-8" name="__codelineno-326-8" href="#__codelineno-326-8"></a><span class="w">    </span><span class="c1">-- Track usage statistics</span>
</span><span id="__span-326-9"><a id="__codelineno-326-9" name="__codelineno-326-9" href="#__codelineno-326-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">usageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemUsage_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-326-10"><a id="__codelineno-326-10" name="__codelineno-326-10" href="#__codelineno-326-10"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemUsage_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">usageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-326-11"><a id="__codelineno-326-11" name="__codelineno-326-11" href="#__codelineno-326-11"></a><span class="w">    </span><span class="c1">-- Check for achievements</span>
</span><span id="__span-326-12"><a id="__codelineno-326-12" name="__codelineno-326-12" href="#__codelineno-326-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">usageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-326-13"><a id="__codelineno-326-13" name="__codelineno-326-13" href="#__codelineno-326-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_itemMaster_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-326-14"><a id="__codelineno-326-14" name="__codelineno-326-14" href="#__codelineno-326-14"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_itemMaster_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-326-15"><a id="__codelineno-326-15" name="__codelineno-326-15" href="#__codelineno-326-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Master of &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-326-16"><a id="__codelineno-326-16" name="__codelineno-326-16" href="#__codelineno-326-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-326-17"><a id="__codelineno-326-17" name="__codelineno-326-17" href="#__codelineno-326-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-326-18"><a id="__codelineno-326-18" name="__codelineno-326-18" href="#__codelineno-326-18"></a><span class="w">    </span><span class="c1">-- Handle specific methods</span>
</span><span id="__span-326-19"><a id="__codelineno-326-19" name="__codelineno-326-19" href="#__codelineno-326-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-326-20"><a id="__codelineno-326-20" name="__codelineno-326-20" href="#__codelineno-326-20"></a><span class="w">        </span><span class="c1">-- Decrease durability</span>
</span><span id="__span-326-21"><a id="__codelineno-326-21" name="__codelineno-326-21" href="#__codelineno-326-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-326-22"><a id="__codelineno-326-22" name="__codelineno-326-22" href="#__codelineno-326-22"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-326-23"><a id="__codelineno-326-23" name="__codelineno-326-23" href="#__codelineno-326-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-326-24"><a id="__codelineno-326-24" name="__codelineno-326-24" href="#__codelineno-326-24"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-326-25"><a id="__codelineno-326-25" name="__codelineno-326-25" href="#__codelineno-326-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;equip&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-326-26"><a id="__codelineno-326-26" name="__codelineno-326-26" href="#__codelineno-326-26"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-326-27"><a id="__codelineno-326-27" name="__codelineno-326-27" href="#__codelineno-326-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-326-28"><a id="__codelineno-326-28" name="__codelineno-326-28" href="#__codelineno-326-28"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; used &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-326-29"><a id="__codelineno-326-29" name="__codelineno-326-29" href="#__codelineno-326-29"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-326-30"><a id="__codelineno-326-30" name="__codelineno-326-30" href="#__codelineno-326-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-326-31"><a id="__codelineno-326-31" name="__codelineno-326-31" href="#__codelineno-326-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-326-32"><a id="__codelineno-326-32" name="__codelineno-326-32" href="#__codelineno-326-32"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="itemtransfered">ItemTransfered</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is transferred between inventories</p>
<p><strong>When Called</strong></p>
<p>When an item is successfully moved from one inventory to another</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>context</code> (<em>table</em>): The transfer context containing source, destination, item, etc.</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-327-1"><a id="__codelineno-327-1" name="__codelineno-327-1" href="#__codelineno-327-1"></a><span class="c1">-- Simple: Log item transfers</span>
</span><span id="__span-327-2"><a id="__codelineno-327-2" name="__codelineno-327-2" href="#__codelineno-327-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-327-3"><a id="__codelineno-327-3" name="__codelineno-327-3" href="#__codelineno-327-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; transferred&quot;</span><span class="p">)</span>
</span><span id="__span-327-4"><a id="__codelineno-327-4" name="__codelineno-327-4" href="#__codelineno-327-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-328-1"><a id="__codelineno-328-1" name="__codelineno-328-1" href="#__codelineno-328-1"></a><span class="c1">-- Medium: Track transfer statistics</span>
</span><span id="__span-328-2"><a id="__codelineno-328-2" name="__codelineno-328-2" href="#__codelineno-328-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TransferTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-328-3"><a id="__codelineno-328-3" name="__codelineno-328-3" href="#__codelineno-328-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">fromChar</span>
</span><span id="__span-328-4"><a id="__codelineno-328-4" name="__codelineno-328-4" href="#__codelineno-328-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">toChar</span>
</span><span id="__span-328-5"><a id="__codelineno-328-5" name="__codelineno-328-5" href="#__codelineno-328-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-328-6"><a id="__codelineno-328-6" name="__codelineno-328-6" href="#__codelineno-328-6"></a><span class="w">    </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-328-7"><a id="__codelineno-328-7" name="__codelineno-328-7" href="#__codelineno-328-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-328-8"><a id="__codelineno-328-8" name="__codelineno-328-8" href="#__codelineno-328-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-328-9"><a id="__codelineno-328-9" name="__codelineno-328-9" href="#__codelineno-328-9"></a><span class="w">    </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-328-10"><a id="__codelineno-328-10" name="__codelineno-328-10" href="#__codelineno-328-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-328-11"><a id="__codelineno-328-11" name="__codelineno-328-11" href="#__codelineno-328-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-329-1"><a id="__codelineno-329-1" name="__codelineno-329-1" href="#__codelineno-329-1"></a><span class="c1">-- High: Complex item transfer system</span>
</span><span id="__span-329-2"><a id="__codelineno-329-2" name="__codelineno-329-2" href="#__codelineno-329-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ItemTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTransfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">context</span><span class="p">)</span>
</span><span id="__span-329-3"><a id="__codelineno-329-3" name="__codelineno-329-3" href="#__codelineno-329-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">fromChar</span>
</span><span id="__span-329-4"><a id="__codelineno-329-4" name="__codelineno-329-4" href="#__codelineno-329-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">toChar</span>
</span><span id="__span-329-5"><a id="__codelineno-329-5" name="__codelineno-329-5" href="#__codelineno-329-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">item</span>
</span><span id="__span-329-6"><a id="__codelineno-329-6" name="__codelineno-329-6" href="#__codelineno-329-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">fromInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">fromInventory</span>
</span><span id="__span-329-7"><a id="__codelineno-329-7" name="__codelineno-329-7" href="#__codelineno-329-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">toInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context</span><span class="p">.</span><span class="py">toInventory</span>
</span><span id="__span-329-8"><a id="__codelineno-329-8" name="__codelineno-329-8" href="#__codelineno-329-8"></a><span class="c1">-- Update transfer statistics</span>
</span><span id="__span-329-9"><a id="__codelineno-329-9" name="__codelineno-329-9" href="#__codelineno-329-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-10"><a id="__codelineno-329-10" name="__codelineno-329-10" href="#__codelineno-329-10"></a><span class="w">    </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-329-11"><a id="__codelineno-329-11" name="__codelineno-329-11" href="#__codelineno-329-11"></a><span class="w">    </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastTransferOut&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-329-12"><a id="__codelineno-329-12" name="__codelineno-329-12" href="#__codelineno-329-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-13"><a id="__codelineno-329-13" name="__codelineno-329-13" href="#__codelineno-329-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-14"><a id="__codelineno-329-14" name="__codelineno-329-14" href="#__codelineno-329-14"></a><span class="w">    </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;itemsTransferredIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-329-15"><a id="__codelineno-329-15" name="__codelineno-329-15" href="#__codelineno-329-15"></a><span class="w">    </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastTransferIn&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-329-16"><a id="__codelineno-329-16" name="__codelineno-329-16" href="#__codelineno-329-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-17"><a id="__codelineno-329-17" name="__codelineno-329-17" href="#__codelineno-329-17"></a><span class="c1">-- Check for transfer limits</span>
</span><span id="__span-329-18"><a id="__codelineno-329-18" name="__codelineno-329-18" href="#__codelineno-329-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">transferLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="c1">-- Max transfers per hour</span>
</span><span id="__span-329-19"><a id="__codelineno-329-19" name="__codelineno-329-19" href="#__codelineno-329-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-20"><a id="__codelineno-329-20" name="__codelineno-329-20" href="#__codelineno-329-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">transfersThisHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transfersThisHour&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-329-21"><a id="__codelineno-329-21" name="__codelineno-329-21" href="#__codelineno-329-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">transfersThisHour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">transferLimit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-22"><a id="__codelineno-329-22" name="__codelineno-329-22" href="#__codelineno-329-22"></a><span class="w">        </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Transfer limit reached for this hour&quot;</span><span class="p">)</span>
</span><span id="__span-329-23"><a id="__codelineno-329-23" name="__codelineno-329-23" href="#__codelineno-329-23"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-329-24"><a id="__codelineno-329-24" name="__codelineno-329-24" href="#__codelineno-329-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-329-25"><a id="__codelineno-329-25" name="__codelineno-329-25" href="#__codelineno-329-25"></a><span class="w">    </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transfersThisHour&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">transfersThisHour</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-329-26"><a id="__codelineno-329-26" name="__codelineno-329-26" href="#__codelineno-329-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-27"><a id="__codelineno-329-27" name="__codelineno-329-27" href="#__codelineno-329-27"></a><span class="c1">-- Check for valuable item transfers</span>
</span><span id="__span-329-28"><a id="__codelineno-329-28" name="__codelineno-329-28" href="#__codelineno-329-28"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-329-29"><a id="__codelineno-329-29" name="__codelineno-329-29" href="#__codelineno-329-29"></a><span class="kr">if</span><span class="w"> </span><span class="nv">itemValue</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-30"><a id="__codelineno-329-30" name="__codelineno-329-30" href="#__codelineno-329-30"></a><span class="w">    </span><span class="c1">-- Log valuable transfers</span>
</span><span id="__span-329-31"><a id="__codelineno-329-31" name="__codelineno-329-31" href="#__codelineno-329-31"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Valuable item %s transferred from %s to %s (Value: $%d)&quot;</span><span class="p">,</span>
</span><span id="__span-329-32"><a id="__codelineno-329-32" name="__codelineno-329-32" href="#__codelineno-329-32"></a><span class="w">    </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="__span-329-33"><a id="__codelineno-329-33" name="__codelineno-329-33" href="#__codelineno-329-33"></a><span class="w">    </span><span class="nv">toChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemValue</span><span class="p">))</span>
</span><span id="__span-329-34"><a id="__codelineno-329-34" name="__codelineno-329-34" href="#__codelineno-329-34"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-35"><a id="__codelineno-329-35" name="__codelineno-329-35" href="#__codelineno-329-35"></a><span class="c1">-- Check for faction restrictions</span>
</span><span id="__span-329-36"><a id="__codelineno-329-36" name="__codelineno-329-36" href="#__codelineno-329-36"></a><span class="kr">if</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-37"><a id="__codelineno-329-37" name="__codelineno-329-37" href="#__codelineno-329-37"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">fromFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-329-38"><a id="__codelineno-329-38" name="__codelineno-329-38" href="#__codelineno-329-38"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">toFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-329-39"><a id="__codelineno-329-39" name="__codelineno-329-39" href="#__codelineno-329-39"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">fromFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-40"><a id="__codelineno-329-40" name="__codelineno-329-40" href="#__codelineno-329-40"></a><span class="w">        </span><span class="c1">-- Police transferring to criminals - log this</span>
</span><span id="__span-329-41"><a id="__codelineno-329-41" name="__codelineno-329-41" href="#__codelineno-329-41"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Suspicious transfer: %s (Police) to %s (Criminal)&quot;</span><span class="p">,</span>
</span><span id="__span-329-42"><a id="__codelineno-329-42" name="__codelineno-329-42" href="#__codelineno-329-42"></a><span class="w">        </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()))</span>
</span><span id="__span-329-43"><a id="__codelineno-329-43" name="__codelineno-329-43" href="#__codelineno-329-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-329-44"><a id="__codelineno-329-44" name="__codelineno-329-44" href="#__codelineno-329-44"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-45"><a id="__codelineno-329-45" name="__codelineno-329-45" href="#__codelineno-329-45"></a><span class="c1">-- Check for quest items</span>
</span><span id="__span-329-46"><a id="__codelineno-329-46" name="__codelineno-329-46" href="#__codelineno-329-46"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-47"><a id="__codelineno-329-47" name="__codelineno-329-47" href="#__codelineno-329-47"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">questID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questID&quot;</span><span class="p">)</span>
</span><span id="__span-329-48"><a id="__codelineno-329-48" name="__codelineno-329-48" href="#__codelineno-329-48"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">questID</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-49"><a id="__codelineno-329-49" name="__codelineno-329-49" href="#__codelineno-329-49"></a><span class="w">        </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;questProgress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questProgress&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})[</span><span class="nv">questID</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-329-50"><a id="__codelineno-329-50" name="__codelineno-329-50" href="#__codelineno-329-50"></a><span class="w">        </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Quest progress updated!&quot;</span><span class="p">)</span>
</span><span id="__span-329-51"><a id="__codelineno-329-51" name="__codelineno-329-51" href="#__codelineno-329-51"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-329-52"><a id="__codelineno-329-52" name="__codelineno-329-52" href="#__codelineno-329-52"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-53"><a id="__codelineno-329-53" name="__codelineno-329-53" href="#__codelineno-329-53"></a><span class="c1">-- Check for bound items</span>
</span><span id="__span-329-54"><a id="__codelineno-329-54" name="__codelineno-329-54" href="#__codelineno-329-54"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bound&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-55"><a id="__codelineno-329-55" name="__codelineno-329-55" href="#__codelineno-329-55"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;boundTo&quot;</span><span class="p">)</span>
</span><span id="__span-329-56"><a id="__codelineno-329-56" name="__codelineno-329-56" href="#__codelineno-329-56"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-329-57"><a id="__codelineno-329-57" name="__codelineno-329-57" href="#__codelineno-329-57"></a><span class="w">        </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is bound to another character&quot;</span><span class="p">)</span>
</span><span id="__span-329-58"><a id="__codelineno-329-58" name="__codelineno-329-58" href="#__codelineno-329-58"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-329-59"><a id="__codelineno-329-59" name="__codelineno-329-59" href="#__codelineno-329-59"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-329-60"><a id="__codelineno-329-60" name="__codelineno-329-60" href="#__codelineno-329-60"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-329-61"><a id="__codelineno-329-61" name="__codelineno-329-61" href="#__codelineno-329-61"></a><span class="c1">-- Log transfer</span>
</span><span id="__span-329-62"><a id="__codelineno-329-62" name="__codelineno-329-62" href="#__codelineno-329-62"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Item %s transferred from %s to %s&quot;</span><span class="p">,</span>
</span><span id="__span-329-63"><a id="__codelineno-329-63" name="__codelineno-329-63" href="#__codelineno-329-63"></a><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="__span-329-64"><a id="__codelineno-329-64" name="__codelineno-329-64" href="#__codelineno-329-64"></a><span class="nv">toChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">))</span>
</span><span id="__span-329-65"><a id="__codelineno-329-65" name="__codelineno-329-65" href="#__codelineno-329-65"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="keylock">KeyLock</h3>
<p><strong>Purpose</strong></p>
<p>Called when a key locks an entity</p>
<p><strong>When Called</strong></p>
<p>When a key is used to lock a door or entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>owner</code> (<em>Player</em>): The player using the key</li>
<li><code>entity</code> (<em>Entity</em>): The entity being locked</li>
<li><code>time</code> (<em>number</em>): The time taken to lock</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-330-1"><a id="__codelineno-330-1" name="__codelineno-330-1" href="#__codelineno-330-1"></a><span class="c1">-- Simple: Log key lock</span>
</span><span id="__span-330-2"><a id="__codelineno-330-2" name="__codelineno-330-2" href="#__codelineno-330-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-330-3"><a id="__codelineno-330-3" name="__codelineno-330-3" href="#__codelineno-330-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">owner</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; locked &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">entity</span><span class="p">))</span>
</span><span id="__span-330-4"><a id="__codelineno-330-4" name="__codelineno-330-4" href="#__codelineno-330-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-331-1"><a id="__codelineno-331-1" name="__codelineno-331-1" href="#__codelineno-331-1"></a><span class="c1">-- Medium: Track lock usage</span>
</span><span id="__span-331-2"><a id="__codelineno-331-2" name="__codelineno-331-2" href="#__codelineno-331-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackLocks&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-331-3"><a id="__codelineno-331-3" name="__codelineno-331-3" href="#__codelineno-331-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-331-4"><a id="__codelineno-331-4" name="__codelineno-331-4" href="#__codelineno-331-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-331-5"><a id="__codelineno-331-5" name="__codelineno-331-5" href="#__codelineno-331-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;locksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-331-6"><a id="__codelineno-331-6" name="__codelineno-331-6" href="#__codelineno-331-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;locksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-331-7"><a id="__codelineno-331-7" name="__codelineno-331-7" href="#__codelineno-331-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-332-1"><a id="__codelineno-332-1" name="__codelineno-332-1" href="#__codelineno-332-1"></a><span class="c1">-- High: Complex key lock system</span>
</span><span id="__span-332-2"><a id="__codelineno-332-2" name="__codelineno-332-2" href="#__codelineno-332-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedKeyLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-332-3"><a id="__codelineno-332-3" name="__codelineno-332-3" href="#__codelineno-332-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-332-4"><a id="__codelineno-332-4" name="__codelineno-332-4" href="#__codelineno-332-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-332-5"><a id="__codelineno-332-5" name="__codelineno-332-5" href="#__codelineno-332-5"></a><span class="w">    </span><span class="c1">-- Update entity data</span>
</span><span id="__span-332-6"><a id="__codelineno-332-6" name="__codelineno-332-6" href="#__codelineno-332-6"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-332-7"><a id="__codelineno-332-7" name="__codelineno-332-7" href="#__codelineno-332-7"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lockedBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-332-8"><a id="__codelineno-332-8" name="__codelineno-332-8" href="#__codelineno-332-8"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lockedAt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-332-9"><a id="__codelineno-332-9" name="__codelineno-332-9" href="#__codelineno-332-9"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-332-10"><a id="__codelineno-332-10" name="__codelineno-332-10" href="#__codelineno-332-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO lock_logs (timestamp, steamid, entityid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-332-11"><a id="__codelineno-332-11" name="__codelineno-332-11" href="#__codelineno-332-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="p">)</span>
</span><span id="__span-332-12"><a id="__codelineno-332-12" name="__codelineno-332-12" href="#__codelineno-332-12"></a><span class="w">    </span><span class="c1">-- Update character stats</span>
</span><span id="__span-332-13"><a id="__codelineno-332-13" name="__codelineno-332-13" href="#__codelineno-332-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;locksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-332-14"><a id="__codelineno-332-14" name="__codelineno-332-14" href="#__codelineno-332-14"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;locksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-332-15"><a id="__codelineno-332-15" name="__codelineno-332-15" href="#__codelineno-332-15"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastLockTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-332-16"><a id="__codelineno-332-16" name="__codelineno-332-16" href="#__codelineno-332-16"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-332-17"><a id="__codelineno-332-17" name="__codelineno-332-17" href="#__codelineno-332-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-332-18"><a id="__codelineno-332-18" name="__codelineno-332-18" href="#__codelineno-332-18"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-332-19"><a id="__codelineno-332-19" name="__codelineno-332-19" href="#__codelineno-332-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-332-20"><a id="__codelineno-332-20" name="__codelineno-332-20" href="#__codelineno-332-20"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You hear a lock clicking nearby&quot;</span><span class="p">)</span>
</span><span id="__span-332-21"><a id="__codelineno-332-21" name="__codelineno-332-21" href="#__codelineno-332-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-332-22"><a id="__codelineno-332-22" name="__codelineno-332-22" href="#__codelineno-332-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-332-23"><a id="__codelineno-332-23" name="__codelineno-332-23" href="#__codelineno-332-23"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="keyunlock">KeyUnlock</h3>
<p><strong>Purpose</strong></p>
<p>Called when a key unlocks an entity</p>
<p><strong>When Called</strong></p>
<p>When a key is used to unlock a door or entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>owner</code> (<em>Player</em>): The player using the key</li>
<li><code>entity</code> (<em>Entity</em>): The entity being unlocked</li>
<li><code>time</code> (<em>number</em>): The time taken to unlock</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-333-1"><a id="__codelineno-333-1" name="__codelineno-333-1" href="#__codelineno-333-1"></a><span class="c1">-- Simple: Log key unlock</span>
</span><span id="__span-333-2"><a id="__codelineno-333-2" name="__codelineno-333-2" href="#__codelineno-333-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-333-3"><a id="__codelineno-333-3" name="__codelineno-333-3" href="#__codelineno-333-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">owner</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; unlocked &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">entity</span><span class="p">))</span>
</span><span id="__span-333-4"><a id="__codelineno-333-4" name="__codelineno-333-4" href="#__codelineno-333-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-334-1"><a id="__codelineno-334-1" name="__codelineno-334-1" href="#__codelineno-334-1"></a><span class="c1">-- Medium: Track unlock usage</span>
</span><span id="__span-334-2"><a id="__codelineno-334-2" name="__codelineno-334-2" href="#__codelineno-334-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackUnlocks&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-334-3"><a id="__codelineno-334-3" name="__codelineno-334-3" href="#__codelineno-334-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-334-4"><a id="__codelineno-334-4" name="__codelineno-334-4" href="#__codelineno-334-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-334-5"><a id="__codelineno-334-5" name="__codelineno-334-5" href="#__codelineno-334-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">unlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unlocksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-334-6"><a id="__codelineno-334-6" name="__codelineno-334-6" href="#__codelineno-334-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;unlocksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">unlocks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-334-7"><a id="__codelineno-334-7" name="__codelineno-334-7" href="#__codelineno-334-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-335-1"><a id="__codelineno-335-1" name="__codelineno-335-1" href="#__codelineno-335-1"></a><span class="c1">-- High: Complex key unlock system</span>
</span><span id="__span-335-2"><a id="__codelineno-335-2" name="__codelineno-335-2" href="#__codelineno-335-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;KeyUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedKeyUnlock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span>
</span><span id="__span-335-3"><a id="__codelineno-335-3" name="__codelineno-335-3" href="#__codelineno-335-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-335-4"><a id="__codelineno-335-4" name="__codelineno-335-4" href="#__codelineno-335-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-335-5"><a id="__codelineno-335-5" name="__codelineno-335-5" href="#__codelineno-335-5"></a><span class="w">    </span><span class="c1">-- Update entity data</span>
</span><span id="__span-335-6"><a id="__codelineno-335-6" name="__codelineno-335-6" href="#__codelineno-335-6"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-335-7"><a id="__codelineno-335-7" name="__codelineno-335-7" href="#__codelineno-335-7"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;unlockedBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-335-8"><a id="__codelineno-335-8" name="__codelineno-335-8" href="#__codelineno-335-8"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;unlockedAt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-335-9"><a id="__codelineno-335-9" name="__codelineno-335-9" href="#__codelineno-335-9"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-335-10"><a id="__codelineno-335-10" name="__codelineno-335-10" href="#__codelineno-335-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO lock_logs (timestamp, steamid, entityid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-335-11"><a id="__codelineno-335-11" name="__codelineno-335-11" href="#__codelineno-335-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">)</span>
</span><span id="__span-335-12"><a id="__codelineno-335-12" name="__codelineno-335-12" href="#__codelineno-335-12"></a><span class="w">    </span><span class="c1">-- Update character stats</span>
</span><span id="__span-335-13"><a id="__codelineno-335-13" name="__codelineno-335-13" href="#__codelineno-335-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">unlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;unlocksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-335-14"><a id="__codelineno-335-14" name="__codelineno-335-14" href="#__codelineno-335-14"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;unlocksUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">unlocks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-335-15"><a id="__codelineno-335-15" name="__codelineno-335-15" href="#__codelineno-335-15"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastUnlockTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-335-16"><a id="__codelineno-335-16" name="__codelineno-335-16" href="#__codelineno-335-16"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-335-17"><a id="__codelineno-335-17" name="__codelineno-335-17" href="#__codelineno-335-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-335-18"><a id="__codelineno-335-18" name="__codelineno-335-18" href="#__codelineno-335-18"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-335-19"><a id="__codelineno-335-19" name="__codelineno-335-19" href="#__codelineno-335-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-335-20"><a id="__codelineno-335-20" name="__codelineno-335-20" href="#__codelineno-335-20"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You hear a lock clicking nearby&quot;</span><span class="p">)</span>
</span><span id="__span-335-21"><a id="__codelineno-335-21" name="__codelineno-335-21" href="#__codelineno-335-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-335-22"><a id="__codelineno-335-22" name="__codelineno-335-22" href="#__codelineno-335-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-335-23"><a id="__codelineno-335-23" name="__codelineno-335-23" href="#__codelineno-335-23"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="liliatablesloaded">LiliaTablesLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when Lilia database tables are loaded</p>
<p><strong>When Called</strong></p>
<p>After database tables are created/loaded</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-336-1"><a id="__codelineno-336-1" name="__codelineno-336-1" href="#__codelineno-336-1"></a><span class="c1">-- Simple: Log tables loaded</span>
</span><span id="__span-336-2"><a id="__codelineno-336-2" name="__codelineno-336-2" href="#__codelineno-336-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LiliaTablesLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-336-3"><a id="__codelineno-336-3" name="__codelineno-336-3" href="#__codelineno-336-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lilia tables loaded&quot;</span><span class="p">)</span>
</span><span id="__span-336-4"><a id="__codelineno-336-4" name="__codelineno-336-4" href="#__codelineno-336-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-337-1"><a id="__codelineno-337-1" name="__codelineno-337-1" href="#__codelineno-337-1"></a><span class="c1">-- Medium: Create custom tables</span>
</span><span id="__span-337-2"><a id="__codelineno-337-2" name="__codelineno-337-2" href="#__codelineno-337-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LiliaTablesLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CreateCustomTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-337-3"><a id="__codelineno-337-3" name="__codelineno-337-3" href="#__codelineno-337-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_table (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">)</span>
</span><span id="__span-337-4"><a id="__codelineno-337-4" name="__codelineno-337-4" href="#__codelineno-337-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom tables created&quot;</span><span class="p">)</span>
</span><span id="__span-337-5"><a id="__codelineno-337-5" name="__codelineno-337-5" href="#__codelineno-337-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-338-1"><a id="__codelineno-338-1" name="__codelineno-338-1" href="#__codelineno-338-1"></a><span class="c1">-- High: Complex database initialization</span>
</span><span id="__span-338-2"><a id="__codelineno-338-2" name="__codelineno-338-2" href="#__codelineno-338-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LiliaTablesLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDatabaseInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-338-3"><a id="__codelineno-338-3" name="__codelineno-338-3" href="#__codelineno-338-3"></a><span class="c1">-- Create custom tables</span>
</span><span id="__span-338-4"><a id="__codelineno-338-4" name="__codelineno-338-4" href="#__codelineno-338-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-338-5"><a id="__codelineno-338-5" name="__codelineno-338-5" href="#__codelineno-338-5"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_table (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">,</span>
</span><span id="__span-338-6"><a id="__codelineno-338-6" name="__codelineno-338-6" href="#__codelineno-338-6"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_stats (charid INTEGER, stat TEXT, value INTEGER)&quot;</span><span class="p">,</span>
</span><span id="__span-338-7"><a id="__codelineno-338-7" name="__codelineno-338-7" href="#__codelineno-338-7"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_logs (timestamp INTEGER, message TEXT)&quot;</span>
</span><span id="__span-338-8"><a id="__codelineno-338-8" name="__codelineno-338-8" href="#__codelineno-338-8"></a><span class="p">}</span>
</span><span id="__span-338-9"><a id="__codelineno-338-9" name="__codelineno-338-9" href="#__codelineno-338-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">tables</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-338-10"><a id="__codelineno-338-10" name="__codelineno-338-10" href="#__codelineno-338-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">query</span><span class="p">)</span>
</span><span id="__span-338-11"><a id="__codelineno-338-11" name="__codelineno-338-11" href="#__codelineno-338-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-338-12"><a id="__codelineno-338-12" name="__codelineno-338-12" href="#__codelineno-338-12"></a><span class="c1">-- Create indexes</span>
</span><span id="__span-338-13"><a id="__codelineno-338-13" name="__codelineno-338-13" href="#__codelineno-338-13"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE INDEX IF NOT EXISTS idx_my_stats_charid ON my_stats(charid)&quot;</span><span class="p">)</span>
</span><span id="__span-338-14"><a id="__codelineno-338-14" name="__codelineno-338-14" href="#__codelineno-338-14"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom database tables and indexes created&quot;</span><span class="p">)</span>
</span><span id="__span-338-15"><a id="__codelineno-338-15" name="__codelineno-338-15" href="#__codelineno-338-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="loaddata">LoadData</h3>
<p><strong>Purpose</strong></p>
<p>Called to load persistent data</p>
<p><strong>When Called</strong></p>
<p>When data needs to be loaded from storage</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-339-1"><a id="__codelineno-339-1" name="__codelineno-339-1" href="#__codelineno-339-1"></a><span class="c1">-- Simple: Log data load</span>
</span><span id="__span-339-2"><a id="__codelineno-339-2" name="__codelineno-339-2" href="#__codelineno-339-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-339-3"><a id="__codelineno-339-3" name="__codelineno-339-3" href="#__codelineno-339-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data&quot;</span><span class="p">)</span>
</span><span id="__span-339-4"><a id="__codelineno-339-4" name="__codelineno-339-4" href="#__codelineno-339-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-340-1"><a id="__codelineno-340-1" name="__codelineno-340-1" href="#__codelineno-340-1"></a><span class="c1">-- Medium: Load custom data</span>
</span><span id="__span-340-2"><a id="__codelineno-340-2" name="__codelineno-340-2" href="#__codelineno-340-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;LoadCustomData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-340-3"><a id="__codelineno-340-3" name="__codelineno-340-3" href="#__codelineno-340-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-340-4"><a id="__codelineno-340-4" name="__codelineno-340-4" href="#__codelineno-340-4"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-340-5"><a id="__codelineno-340-5" name="__codelineno-340-5" href="#__codelineno-340-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom data loaded&quot;</span><span class="p">)</span>
</span><span id="__span-340-6"><a id="__codelineno-340-6" name="__codelineno-340-6" href="#__codelineno-340-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-341-1"><a id="__codelineno-341-1" name="__codelineno-341-1" href="#__codelineno-341-1"></a><span class="c1">-- High: Complex data loading system</span>
</span><span id="__span-341-2"><a id="__codelineno-341-2" name="__codelineno-341-2" href="#__codelineno-341-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;LoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-341-3"><a id="__codelineno-341-3" name="__codelineno-341-3" href="#__codelineno-341-3"></a><span class="c1">-- Load custom data</span>
</span><span id="__span-341-4"><a id="__codelineno-341-4" name="__codelineno-341-4" href="#__codelineno-341-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-341-5"><a id="__codelineno-341-5" name="__codelineno-341-5" href="#__codelineno-341-5"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-341-6"><a id="__codelineno-341-6" name="__codelineno-341-6" href="#__codelineno-341-6"></a><span class="c1">-- Load from database</span>
</span><span id="__span-341-7"><a id="__codelineno-341-7" name="__codelineno-341-7" href="#__codelineno-341-7"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM my_table&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">results</span><span class="p">)</span>
</span><span id="__span-341-8"><a id="__codelineno-341-8" name="__codelineno-341-8" href="#__codelineno-341-8"></a><span class="kr">if</span><span class="w"> </span><span class="nv">results</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-341-9"><a id="__codelineno-341-9" name="__codelineno-341-9" href="#__codelineno-341-9"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">row</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">results</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-341-10"><a id="__codelineno-341-10" name="__codelineno-341-10" href="#__codelineno-341-10"></a><span class="w">        </span><span class="nv">MyAddon</span><span class="p">.</span><span class="nf">ProcessData</span><span class="p">(</span><span class="nv">row</span><span class="p">)</span>
</span><span id="__span-341-11"><a id="__codelineno-341-11" name="__codelineno-341-11" href="#__codelineno-341-11"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-341-12"><a id="__codelineno-341-12" name="__codelineno-341-12" href="#__codelineno-341-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-341-13"><a id="__codelineno-341-13" name="__codelineno-341-13" href="#__codelineno-341-13"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-341-14"><a id="__codelineno-341-14" name="__codelineno-341-14" href="#__codelineno-341-14"></a><span class="c1">-- Initialize data structures</span>
</span><span id="__span-341-15"><a id="__codelineno-341-15" name="__codelineno-341-15" href="#__codelineno-341-15"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">playerData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">playerData</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-341-16"><a id="__codelineno-341-16" name="__codelineno-341-16" href="#__codelineno-341-16"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">sessionData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-341-17"><a id="__codelineno-341-17" name="__codelineno-341-17" href="#__codelineno-341-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All data loaded successfully&quot;</span><span class="p">)</span>
</span><span id="__span-341-18"><a id="__codelineno-341-18" name="__codelineno-341-18" href="#__codelineno-341-18"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="modifycharactermodel">ModifyCharacterModel</h3>
<p><strong>Purpose</strong></p>
<p>Called to modify a character's model</p>
<p><strong>When Called</strong></p>
<p>When a character's model is being set</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>character</code> (<em>Character</em>): The character whose model is being modified</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>string - The modified model path</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-342-1"><a id="__codelineno-342-1" name="__codelineno-342-1" href="#__codelineno-342-1"></a><span class="c1">-- Simple: Return default model</span>
</span><span id="__span-342-2"><a id="__codelineno-342-2" name="__codelineno-342-2" href="#__codelineno-342-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ModifyCharacterModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-342-3"><a id="__codelineno-342-3" name="__codelineno-342-3" href="#__codelineno-342-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getModel</span><span class="p">()</span>
</span><span id="__span-342-4"><a id="__codelineno-342-4" name="__codelineno-342-4" href="#__codelineno-342-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-343-1"><a id="__codelineno-343-1" name="__codelineno-343-1" href="#__codelineno-343-1"></a><span class="c1">-- Medium: Faction-based models</span>
</span><span id="__span-343-2"><a id="__codelineno-343-2" name="__codelineno-343-2" href="#__codelineno-343-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ModifyCharacterModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionModels&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-343-3"><a id="__codelineno-343-3" name="__codelineno-343-3" href="#__codelineno-343-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-343-4"><a id="__codelineno-343-4" name="__codelineno-343-4" href="#__codelineno-343-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-343-5"><a id="__codelineno-343-5" name="__codelineno-343-5" href="#__codelineno-343-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/player/police.mdl&quot;</span>
</span><span id="__span-343-6"><a id="__codelineno-343-6" name="__codelineno-343-6" href="#__codelineno-343-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-343-7"><a id="__codelineno-343-7" name="__codelineno-343-7" href="#__codelineno-343-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;models/player/medic.mdl&quot;</span>
</span><span id="__span-343-8"><a id="__codelineno-343-8" name="__codelineno-343-8" href="#__codelineno-343-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-343-9"><a id="__codelineno-343-9" name="__codelineno-343-9" href="#__codelineno-343-9"></a><span class="kr">return</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getModel</span><span class="p">()</span>
</span><span id="__span-343-10"><a id="__codelineno-343-10" name="__codelineno-343-10" href="#__codelineno-343-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-344-1"><a id="__codelineno-344-1" name="__codelineno-344-1" href="#__codelineno-344-1"></a><span class="c1">-- High: Complex model modification system</span>
</span><span id="__span-344-2"><a id="__codelineno-344-2" name="__codelineno-344-2" href="#__codelineno-344-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ModifyCharacterModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedModelModification&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-344-3"><a id="__codelineno-344-3" name="__codelineno-344-3" href="#__codelineno-344-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">baseModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getModel</span><span class="p">()</span>
</span><span id="__span-344-4"><a id="__codelineno-344-4" name="__codelineno-344-4" href="#__codelineno-344-4"></a><span class="c1">-- Check for outfit override</span>
</span><span id="__span-344-5"><a id="__codelineno-344-5" name="__codelineno-344-5" href="#__codelineno-344-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;outfit&quot;</span><span class="p">)</span>
</span><span id="__span-344-6"><a id="__codelineno-344-6" name="__codelineno-344-6" href="#__codelineno-344-6"></a><span class="kr">if</span><span class="w"> </span><span class="nv">outfit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-7"><a id="__codelineno-344-7" name="__codelineno-344-7" href="#__codelineno-344-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">outfitItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">instances</span><span class="p">[</span><span class="nv">outfit</span><span class="p">]</span>
</span><span id="__span-344-8"><a id="__codelineno-344-8" name="__codelineno-344-8" href="#__codelineno-344-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">outfitItem</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">outfitItem</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-9"><a id="__codelineno-344-9" name="__codelineno-344-9" href="#__codelineno-344-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">outfitItem</span><span class="p">.</span><span class="py">model</span>
</span><span id="__span-344-10"><a id="__codelineno-344-10" name="__codelineno-344-10" href="#__codelineno-344-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-344-11"><a id="__codelineno-344-11" name="__codelineno-344-11" href="#__codelineno-344-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-344-12"><a id="__codelineno-344-12" name="__codelineno-344-12" href="#__codelineno-344-12"></a><span class="c1">-- Check faction models</span>
</span><span id="__span-344-13"><a id="__codelineno-344-13" name="__codelineno-344-13" href="#__codelineno-344-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()]</span>
</span><span id="__span-344-14"><a id="__codelineno-344-14" name="__codelineno-344-14" href="#__codelineno-344-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">models</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-15"><a id="__codelineno-344-15" name="__codelineno-344-15" href="#__codelineno-344-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">modelIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;modelIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-344-16"><a id="__codelineno-344-16" name="__codelineno-344-16" href="#__codelineno-344-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">models</span><span class="p">[</span><span class="nv">modelIndex</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-17"><a id="__codelineno-344-17" name="__codelineno-344-17" href="#__codelineno-344-17"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">faction</span><span class="p">.</span><span class="py">models</span><span class="p">[</span><span class="nv">modelIndex</span><span class="p">]</span>
</span><span id="__span-344-18"><a id="__codelineno-344-18" name="__codelineno-344-18" href="#__codelineno-344-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-344-19"><a id="__codelineno-344-19" name="__codelineno-344-19" href="#__codelineno-344-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-344-20"><a id="__codelineno-344-20" name="__codelineno-344-20" href="#__codelineno-344-20"></a><span class="c1">-- Check for transformation effects</span>
</span><span id="__span-344-21"><a id="__codelineno-344-21" name="__codelineno-344-21" href="#__codelineno-344-21"></a><span class="kr">if</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transformed&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-22"><a id="__codelineno-344-22" name="__codelineno-344-22" href="#__codelineno-344-22"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">transformModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transformModel&quot;</span><span class="p">)</span>
</span><span id="__span-344-23"><a id="__codelineno-344-23" name="__codelineno-344-23" href="#__codelineno-344-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">transformModel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-344-24"><a id="__codelineno-344-24" name="__codelineno-344-24" href="#__codelineno-344-24"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">transformModel</span>
</span><span id="__span-344-25"><a id="__codelineno-344-25" name="__codelineno-344-25" href="#__codelineno-344-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-344-26"><a id="__codelineno-344-26" name="__codelineno-344-26" href="#__codelineno-344-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-344-27"><a id="__codelineno-344-27" name="__codelineno-344-27" href="#__codelineno-344-27"></a><span class="kr">return</span><span class="w"> </span><span class="nv">baseModel</span>
</span><span id="__span-344-28"><a id="__codelineno-344-28" name="__codelineno-344-28" href="#__codelineno-344-28"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onadminsystemloaded">OnAdminSystemLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when admin system is loaded</p>
<p><strong>When Called</strong></p>
<p>After admin groups and privileges are initialized</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>groups</code> (<em>table</em>): The admin groups table</li>
<li><code>privileges</code> (<em>table</em>): The privileges table</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-345-1"><a id="__codelineno-345-1" name="__codelineno-345-1" href="#__codelineno-345-1"></a><span class="c1">-- Simple: Log admin system load</span>
</span><span id="__span-345-2"><a id="__codelineno-345-2" name="__codelineno-345-2" href="#__codelineno-345-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnAdminSystemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groups</span><span class="p">,</span><span class="w"> </span><span class="nv">privileges</span><span class="p">)</span>
</span><span id="__span-345-3"><a id="__codelineno-345-3" name="__codelineno-345-3" href="#__codelineno-345-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Admin system loaded&quot;</span><span class="p">)</span>
</span><span id="__span-345-4"><a id="__codelineno-345-4" name="__codelineno-345-4" href="#__codelineno-345-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-346-1"><a id="__codelineno-346-1" name="__codelineno-346-1" href="#__codelineno-346-1"></a><span class="c1">-- Medium: Add custom admin groups</span>
</span><span id="__span-346-2"><a id="__codelineno-346-2" name="__codelineno-346-2" href="#__codelineno-346-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnAdminSystemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AddCustomAdminGroups&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groups</span><span class="p">,</span><span class="w"> </span><span class="nv">privileges</span><span class="p">)</span>
</span><span id="__span-346-3"><a id="__codelineno-346-3" name="__codelineno-346-3" href="#__codelineno-346-3"></a><span class="nv">groups</span><span class="p">[</span><span class="s2">&quot;moderator&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-346-4"><a id="__codelineno-346-4" name="__codelineno-346-4" href="#__codelineno-346-4"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Moderator&quot;</span><span class="p">,</span>
</span><span id="__span-346-5"><a id="__codelineno-346-5" name="__codelineno-346-5" href="#__codelineno-346-5"></a><span class="nv">immunity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-346-6"><a id="__codelineno-346-6" name="__codelineno-346-6" href="#__codelineno-346-6"></a><span class="p">}</span>
</span><span id="__span-346-7"><a id="__codelineno-346-7" name="__codelineno-346-7" href="#__codelineno-346-7"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom admin groups added&quot;</span><span class="p">)</span>
</span><span id="__span-346-8"><a id="__codelineno-346-8" name="__codelineno-346-8" href="#__codelineno-346-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-347-1"><a id="__codelineno-347-1" name="__codelineno-347-1" href="#__codelineno-347-1"></a><span class="c1">-- High: Complex admin system customization</span>
</span><span id="__span-347-2"><a id="__codelineno-347-2" name="__codelineno-347-2" href="#__codelineno-347-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnAdminSystemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAdminCustomization&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groups</span><span class="p">,</span><span class="w"> </span><span class="nv">privileges</span><span class="p">)</span>
</span><span id="__span-347-3"><a id="__codelineno-347-3" name="__codelineno-347-3" href="#__codelineno-347-3"></a><span class="c1">-- Add custom admin groups</span>
</span><span id="__span-347-4"><a id="__codelineno-347-4" name="__codelineno-347-4" href="#__codelineno-347-4"></a><span class="nv">groups</span><span class="p">[</span><span class="s2">&quot;moderator&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-347-5"><a id="__codelineno-347-5" name="__codelineno-347-5" href="#__codelineno-347-5"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Moderator&quot;</span><span class="p">,</span>
</span><span id="__span-347-6"><a id="__codelineno-347-6" name="__codelineno-347-6" href="#__codelineno-347-6"></a><span class="nv">immunity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-347-7"><a id="__codelineno-347-7" name="__codelineno-347-7" href="#__codelineno-347-7"></a><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-347-8"><a id="__codelineno-347-8" name="__codelineno-347-8" href="#__codelineno-347-8"></a><span class="p">}</span>
</span><span id="__span-347-9"><a id="__codelineno-347-9" name="__codelineno-347-9" href="#__codelineno-347-9"></a><span class="nv">groups</span><span class="p">[</span><span class="s2">&quot;headAdmin&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-347-10"><a id="__codelineno-347-10" name="__codelineno-347-10" href="#__codelineno-347-10"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Head Admin&quot;</span><span class="p">,</span>
</span><span id="__span-347-11"><a id="__codelineno-347-11" name="__codelineno-347-11" href="#__codelineno-347-11"></a><span class="nv">immunity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
</span><span id="__span-347-12"><a id="__codelineno-347-12" name="__codelineno-347-12" href="#__codelineno-347-12"></a><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-347-13"><a id="__codelineno-347-13" name="__codelineno-347-13" href="#__codelineno-347-13"></a><span class="p">}</span>
</span><span id="__span-347-14"><a id="__codelineno-347-14" name="__codelineno-347-14" href="#__codelineno-347-14"></a><span class="c1">-- Add custom privileges</span>
</span><span id="__span-347-15"><a id="__codelineno-347-15" name="__codelineno-347-15" href="#__codelineno-347-15"></a><span class="nv">privileges</span><span class="p">[</span><span class="s2">&quot;canManageEvents&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-347-16"><a id="__codelineno-347-16" name="__codelineno-347-16" href="#__codelineno-347-16"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Can Manage Events&quot;</span><span class="p">,</span>
</span><span id="__span-347-17"><a id="__codelineno-347-17" name="__codelineno-347-17" href="#__codelineno-347-17"></a><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allows managing server events&quot;</span>
</span><span id="__span-347-18"><a id="__codelineno-347-18" name="__codelineno-347-18" href="#__codelineno-347-18"></a><span class="p">}</span>
</span><span id="__span-347-19"><a id="__codelineno-347-19" name="__codelineno-347-19" href="#__codelineno-347-19"></a><span class="nv">privileges</span><span class="p">[</span><span class="s2">&quot;canEditVendors&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-347-20"><a id="__codelineno-347-20" name="__codelineno-347-20" href="#__codelineno-347-20"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Can Edit Vendors&quot;</span><span class="p">,</span>
</span><span id="__span-347-21"><a id="__codelineno-347-21" name="__codelineno-347-21" href="#__codelineno-347-21"></a><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allows editing vendor inventories&quot;</span>
</span><span id="__span-347-22"><a id="__codelineno-347-22" name="__codelineno-347-22" href="#__codelineno-347-22"></a><span class="p">}</span>
</span><span id="__span-347-23"><a id="__codelineno-347-23" name="__codelineno-347-23" href="#__codelineno-347-23"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Admin system customized with new groups and privileges&quot;</span><span class="p">)</span>
</span><span id="__span-347-24"><a id="__codelineno-347-24" name="__codelineno-347-24" href="#__codelineno-347-24"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharattribboosted">OnCharAttribBoosted</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character attribute is boosted</p>
<p><strong>When Called</strong></p>
<p>When a character's attribute is increased</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character whose attribute was boosted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-348-1"><a id="__codelineno-348-1" name="__codelineno-348-1" href="#__codelineno-348-1"></a><span class="c1">-- Simple: Log attribute boost</span>
</span><span id="__span-348-2"><a id="__codelineno-348-2" name="__codelineno-348-2" href="#__codelineno-348-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribBoosted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-348-3"><a id="__codelineno-348-3" name="__codelineno-348-3" href="#__codelineno-348-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; boosted an attribute&quot;</span><span class="p">)</span>
</span><span id="__span-348-4"><a id="__codelineno-348-4" name="__codelineno-348-4" href="#__codelineno-348-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-349-1"><a id="__codelineno-349-1" name="__codelineno-349-1" href="#__codelineno-349-1"></a><span class="c1">-- Medium: Track attribute boosts</span>
</span><span id="__span-349-2"><a id="__codelineno-349-2" name="__codelineno-349-2" href="#__codelineno-349-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribBoosted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackAttributeBoosts&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-349-3"><a id="__codelineno-349-3" name="__codelineno-349-3" href="#__codelineno-349-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">boosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;attributeBoosts&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-349-4"><a id="__codelineno-349-4" name="__codelineno-349-4" href="#__codelineno-349-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;attributeBoosts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">boosts</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-349-5"><a id="__codelineno-349-5" name="__codelineno-349-5" href="#__codelineno-349-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-350-1"><a id="__codelineno-350-1" name="__codelineno-350-1" href="#__codelineno-350-1"></a><span class="c1">-- High: Complex attribute boost system</span>
</span><span id="__span-350-2"><a id="__codelineno-350-2" name="__codelineno-350-2" href="#__codelineno-350-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribBoosted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAttributeBoost&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-350-3"><a id="__codelineno-350-3" name="__codelineno-350-3" href="#__codelineno-350-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">boosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;attributeBoosts&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-350-4"><a id="__codelineno-350-4" name="__codelineno-350-4" href="#__codelineno-350-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;attributeBoosts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">boosts</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-350-5"><a id="__codelineno-350-5" name="__codelineno-350-5" href="#__codelineno-350-5"></a><span class="c1">-- Log to database</span>
</span><span id="__span-350-6"><a id="__codelineno-350-6" name="__codelineno-350-6" href="#__codelineno-350-6"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO attribute_logs (timestamp, charid, action) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-350-7"><a id="__codelineno-350-7" name="__codelineno-350-7" href="#__codelineno-350-7"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;boosted&quot;</span><span class="p">)</span>
</span><span id="__span-350-8"><a id="__codelineno-350-8" name="__codelineno-350-8" href="#__codelineno-350-8"></a><span class="c1">-- Notify player</span>
</span><span id="__span-350-9"><a id="__codelineno-350-9" name="__codelineno-350-9" href="#__codelineno-350-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-350-10"><a id="__codelineno-350-10" name="__codelineno-350-10" href="#__codelineno-350-10"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-350-11"><a id="__codelineno-350-11" name="__codelineno-350-11" href="#__codelineno-350-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Attribute boosted! Total boosts: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">boosts</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-350-12"><a id="__codelineno-350-12" name="__codelineno-350-12" href="#__codelineno-350-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-350-13"><a id="__codelineno-350-13" name="__codelineno-350-13" href="#__codelineno-350-13"></a><span class="c1">-- Check for achievements</span>
</span><span id="__span-350-14"><a id="__codelineno-350-14" name="__codelineno-350-14" href="#__codelineno-350-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">boosts</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-350-15"><a id="__codelineno-350-15" name="__codelineno-350-15" href="#__codelineno-350-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_attributeMaster&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-350-16"><a id="__codelineno-350-16" name="__codelineno-350-16" href="#__codelineno-350-16"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_attributeMaster&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-350-17"><a id="__codelineno-350-17" name="__codelineno-350-17" href="#__codelineno-350-17"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-350-18"><a id="__codelineno-350-18" name="__codelineno-350-18" href="#__codelineno-350-18"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Attribute Master!&quot;</span><span class="p">)</span>
</span><span id="__span-350-19"><a id="__codelineno-350-19" name="__codelineno-350-19" href="#__codelineno-350-19"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-350-20"><a id="__codelineno-350-20" name="__codelineno-350-20" href="#__codelineno-350-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-350-21"><a id="__codelineno-350-21" name="__codelineno-350-21" href="#__codelineno-350-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-350-22"><a id="__codelineno-350-22" name="__codelineno-350-22" href="#__codelineno-350-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharattribupdated">OnCharAttribUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character attribute is updated</p>
<p><strong>When Called</strong></p>
<p>When a character's attribute value changes</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>character</code> (<em>Character</em>): The character</li>
<li><code>key</code> (<em>string</em>): The attribute key</li>
<li><code>newValue</code> (<em>number</em>): The new attribute value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-351-1"><a id="__codelineno-351-1" name="__codelineno-351-1" href="#__codelineno-351-1"></a><span class="c1">-- Simple: Log attribute updates</span>
</span><span id="__span-351-2"><a id="__codelineno-351-2" name="__codelineno-351-2" href="#__codelineno-351-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-351-3"><a id="__codelineno-351-3" name="__codelineno-351-3" href="#__codelineno-351-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; updated to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-351-4"><a id="__codelineno-351-4" name="__codelineno-351-4" href="#__codelineno-351-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-352-1"><a id="__codelineno-352-1" name="__codelineno-352-1" href="#__codelineno-352-1"></a><span class="c1">-- Medium: Track attribute changes</span>
</span><span id="__span-352-2"><a id="__codelineno-352-2" name="__codelineno-352-2" href="#__codelineno-352-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackAttributeChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-352-3"><a id="__codelineno-352-3" name="__codelineno-352-3" href="#__codelineno-352-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;attributeChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-352-4"><a id="__codelineno-352-4" name="__codelineno-352-4" href="#__codelineno-352-4"></a><span class="nv">changes</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">changes</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-352-5"><a id="__codelineno-352-5" name="__codelineno-352-5" href="#__codelineno-352-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;attributeChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">changes</span><span class="p">)</span>
</span><span id="__span-352-6"><a id="__codelineno-352-6" name="__codelineno-352-6" href="#__codelineno-352-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-353-1"><a id="__codelineno-353-1" name="__codelineno-353-1" href="#__codelineno-353-1"></a><span class="c1">-- High: Complex attribute tracking system</span>
</span><span id="__span-353-2"><a id="__codelineno-353-2" name="__codelineno-353-2" href="#__codelineno-353-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharAttribUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAttributeTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-353-3"><a id="__codelineno-353-3" name="__codelineno-353-3" href="#__codelineno-353-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-353-4"><a id="__codelineno-353-4" name="__codelineno-353-4" href="#__codelineno-353-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO attribute_logs (timestamp, charid, attribute, value) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-353-5"><a id="__codelineno-353-5" name="__codelineno-353-5" href="#__codelineno-353-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-353-6"><a id="__codelineno-353-6" name="__codelineno-353-6" href="#__codelineno-353-6"></a><span class="c1">-- Track changes</span>
</span><span id="__span-353-7"><a id="__codelineno-353-7" name="__codelineno-353-7" href="#__codelineno-353-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;attributeChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-353-8"><a id="__codelineno-353-8" name="__codelineno-353-8" href="#__codelineno-353-8"></a><span class="nv">changes</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">changes</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-353-9"><a id="__codelineno-353-9" name="__codelineno-353-9" href="#__codelineno-353-9"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;attributeChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">changes</span><span class="p">)</span>
</span><span id="__span-353-10"><a id="__codelineno-353-10" name="__codelineno-353-10" href="#__codelineno-353-10"></a><span class="c1">-- Notify player</span>
</span><span id="__span-353-11"><a id="__codelineno-353-11" name="__codelineno-353-11" href="#__codelineno-353-11"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; updated to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newValue</span><span class="p">)</span>
</span><span id="__span-353-12"><a id="__codelineno-353-12" name="__codelineno-353-12" href="#__codelineno-353-12"></a><span class="c1">-- Apply attribute effects</span>
</span><span id="__span-353-13"><a id="__codelineno-353-13" name="__codelineno-353-13" href="#__codelineno-353-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;str&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-353-14"><a id="__codelineno-353-14" name="__codelineno-353-14" href="#__codelineno-353-14"></a><span class="w">    </span><span class="c1">-- Strength affects melee damage</span>
</span><span id="__span-353-15"><a id="__codelineno-353-15" name="__codelineno-353-15" href="#__codelineno-353-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">damageBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-353-16"><a id="__codelineno-353-16" name="__codelineno-353-16" href="#__codelineno-353-16"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;meleeDamageBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">damageBonus</span><span class="p">)</span>
</span><span id="__span-353-17"><a id="__codelineno-353-17" name="__codelineno-353-17" href="#__codelineno-353-17"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;end&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-353-18"><a id="__codelineno-353-18" name="__codelineno-353-18" href="#__codelineno-353-18"></a><span class="w">    </span><span class="c1">-- Endurance affects max health</span>
</span><span id="__span-353-19"><a id="__codelineno-353-19" name="__codelineno-353-19" href="#__codelineno-353-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">healthBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newValue</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-353-20"><a id="__codelineno-353-20" name="__codelineno-353-20" href="#__codelineno-353-20"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">healthBonus</span><span class="p">)</span>
</span><span id="__span-353-21"><a id="__codelineno-353-21" name="__codelineno-353-21" href="#__codelineno-353-21"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;agi&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-353-22"><a id="__codelineno-353-22" name="__codelineno-353-22" href="#__codelineno-353-22"></a><span class="w">    </span><span class="c1">-- Agility affects movement speed</span>
</span><span id="__span-353-23"><a id="__codelineno-353-23" name="__codelineno-353-23" href="#__codelineno-353-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">speedBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">newValue</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="__span-353-24"><a id="__codelineno-353-24" name="__codelineno-353-24" href="#__codelineno-353-24"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetRunSpeed</span><span class="p">(</span><span class="mi">250</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">speedBonus</span><span class="p">)</span>
</span><span id="__span-353-25"><a id="__codelineno-353-25" name="__codelineno-353-25" href="#__codelineno-353-25"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetWalkSpeed</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">speedBonus</span><span class="p">)</span>
</span><span id="__span-353-26"><a id="__codelineno-353-26" name="__codelineno-353-26" href="#__codelineno-353-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-353-27"><a id="__codelineno-353-27" name="__codelineno-353-27" href="#__codelineno-353-27"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharcreated">OnCharCreated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is created</p>
<p><strong>When Called</strong></p>
<p>When a new character is successfully created</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who created the character</li>
<li><code>character</code> (<em>Character</em>): The character that was created</li>
<li><code>originalData</code> (<em>table</em>): The original character data before any modifications</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-354-1"><a id="__codelineno-354-1" name="__codelineno-354-1" href="#__codelineno-354-1"></a><span class="c1">-- Simple: Log character creation</span>
</span><span id="__span-354-2"><a id="__codelineno-354-2" name="__codelineno-354-2" href="#__codelineno-354-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-354-3"><a id="__codelineno-354-3" name="__codelineno-354-3" href="#__codelineno-354-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; created character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-354-4"><a id="__codelineno-354-4" name="__codelineno-354-4" href="#__codelineno-354-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-355-1"><a id="__codelineno-355-1" name="__codelineno-355-1" href="#__codelineno-355-1"></a><span class="c1">-- Medium: Set up new character bonuses</span>
</span><span id="__span-355-2"><a id="__codelineno-355-2" name="__codelineno-355-2" href="#__codelineno-355-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NewCharBonuses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-355-3"><a id="__codelineno-355-3" name="__codelineno-355-3" href="#__codelineno-355-3"></a><span class="c1">-- Give starting money bonus</span>
</span><span id="__span-355-4"><a id="__codelineno-355-4" name="__codelineno-355-4" href="#__codelineno-355-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bonusMoney</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span>
</span><span id="__span-355-5"><a id="__codelineno-355-5" name="__codelineno-355-5" href="#__codelineno-355-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">bonusMoney</span><span class="p">)</span>
</span><span id="__span-355-6"><a id="__codelineno-355-6" name="__codelineno-355-6" href="#__codelineno-355-6"></a><span class="c1">-- Give starting items</span>
</span><span id="__span-355-7"><a id="__codelineno-355-7" name="__codelineno-355-7" href="#__codelineno-355-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">startingItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wallet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id_card&quot;</span><span class="p">}</span>
</span><span id="__span-355-8"><a id="__codelineno-355-8" name="__codelineno-355-8" href="#__codelineno-355-8"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">startingItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-355-9"><a id="__codelineno-355-9" name="__codelineno-355-9" href="#__codelineno-355-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-355-10"><a id="__codelineno-355-10" name="__codelineno-355-10" href="#__codelineno-355-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-355-11"><a id="__codelineno-355-11" name="__codelineno-355-11" href="#__codelineno-355-11"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-355-12"><a id="__codelineno-355-12" name="__codelineno-355-12" href="#__codelineno-355-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-355-13"><a id="__codelineno-355-13" name="__codelineno-355-13" href="#__codelineno-355-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-355-14"><a id="__codelineno-355-14" name="__codelineno-355-14" href="#__codelineno-355-14"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Welcome! You received starting bonuses.&quot;</span><span class="p">)</span>
</span><span id="__span-355-15"><a id="__codelineno-355-15" name="__codelineno-355-15" href="#__codelineno-355-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-356-1"><a id="__codelineno-356-1" name="__codelineno-356-1" href="#__codelineno-356-1"></a><span class="c1">-- High: Complex character creation system</span>
</span><span id="__span-356-2"><a id="__codelineno-356-2" name="__codelineno-356-2" href="#__codelineno-356-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">originalData</span><span class="p">)</span>
</span><span id="__span-356-3"><a id="__codelineno-356-3" name="__codelineno-356-3" href="#__codelineno-356-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-356-4"><a id="__codelineno-356-4" name="__codelineno-356-4" href="#__codelineno-356-4"></a><span class="c1">-- Set up faction-specific starting equipment</span>
</span><span id="__span-356-5"><a id="__codelineno-356-5" name="__codelineno-356-5" href="#__codelineno-356-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionEquipment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-356-6"><a id="__codelineno-356-6" name="__codelineno-356-6" href="#__codelineno-356-6"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-356-7"><a id="__codelineno-356-7" name="__codelineno-356-7" href="#__codelineno-356-7"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;police_badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">},</span>
</span><span id="__span-356-8"><a id="__codelineno-356-8" name="__codelineno-356-8" href="#__codelineno-356-8"></a><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-356-9"><a id="__codelineno-356-9" name="__codelineno-356-9" href="#__codelineno-356-9"></a><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nv">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
</span><span id="__span-356-10"><a id="__codelineno-356-10" name="__codelineno-356-10" href="#__codelineno-356-10"></a><span class="p">},</span>
</span><span id="__span-356-11"><a id="__codelineno-356-11" name="__codelineno-356-11" href="#__codelineno-356-11"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-356-12"><a id="__codelineno-356-12" name="__codelineno-356-12" href="#__codelineno-356-12"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stethoscope&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">},</span>
</span><span id="__span-356-13"><a id="__codelineno-356-13" name="__codelineno-356-13" href="#__codelineno-356-13"></a><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
</span><span id="__span-356-14"><a id="__codelineno-356-14" name="__codelineno-356-14" href="#__codelineno-356-14"></a><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nv">wis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
</span><span id="__span-356-15"><a id="__codelineno-356-15" name="__codelineno-356-15" href="#__codelineno-356-15"></a><span class="p">},</span>
</span><span id="__span-356-16"><a id="__codelineno-356-16" name="__codelineno-356-16" href="#__codelineno-356-16"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-356-17"><a id="__codelineno-356-17" name="__codelineno-356-17" href="#__codelineno-356-17"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wallet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">},</span>
</span><span id="__span-356-18"><a id="__codelineno-356-18" name="__codelineno-356-18" href="#__codelineno-356-18"></a><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
</span><span id="__span-356-19"><a id="__codelineno-356-19" name="__codelineno-356-19" href="#__codelineno-356-19"></a><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nv">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nv">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
</span><span id="__span-356-20"><a id="__codelineno-356-20" name="__codelineno-356-20" href="#__codelineno-356-20"></a><span class="p">}</span>
</span><span id="__span-356-21"><a id="__codelineno-356-21" name="__codelineno-356-21" href="#__codelineno-356-21"></a><span class="p">}</span>
</span><span id="__span-356-22"><a id="__codelineno-356-22" name="__codelineno-356-22" href="#__codelineno-356-22"></a><span class="kd">local</span><span class="w"> </span><span class="nv">equipment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionEquipment</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-356-23"><a id="__codelineno-356-23" name="__codelineno-356-23" href="#__codelineno-356-23"></a><span class="kr">if</span><span class="w"> </span><span class="nv">equipment</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-356-24"><a id="__codelineno-356-24" name="__codelineno-356-24" href="#__codelineno-356-24"></a><span class="w">    </span><span class="c1">-- Give faction-specific money</span>
</span><span id="__span-356-25"><a id="__codelineno-356-25" name="__codelineno-356-25" href="#__codelineno-356-25"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">equipment</span><span class="p">.</span><span class="py">money</span><span class="p">)</span>
</span><span id="__span-356-26"><a id="__codelineno-356-26" name="__codelineno-356-26" href="#__codelineno-356-26"></a><span class="w">    </span><span class="c1">-- Give faction-specific items</span>
</span><span id="__span-356-27"><a id="__codelineno-356-27" name="__codelineno-356-27" href="#__codelineno-356-27"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">equipment</span><span class="p">.</span><span class="py">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-356-28"><a id="__codelineno-356-28" name="__codelineno-356-28" href="#__codelineno-356-28"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-356-29"><a id="__codelineno-356-29" name="__codelineno-356-29" href="#__codelineno-356-29"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-356-30"><a id="__codelineno-356-30" name="__codelineno-356-30" href="#__codelineno-356-30"></a><span class="w">            </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-356-31"><a id="__codelineno-356-31" name="__codelineno-356-31" href="#__codelineno-356-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-356-32"><a id="__codelineno-356-32" name="__codelineno-356-32" href="#__codelineno-356-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-356-33"><a id="__codelineno-356-33" name="__codelineno-356-33" href="#__codelineno-356-33"></a><span class="w">    </span><span class="c1">-- Set faction-specific attributes</span>
</span><span id="__span-356-34"><a id="__codelineno-356-34" name="__codelineno-356-34" href="#__codelineno-356-34"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">equipment</span><span class="p">.</span><span class="py">attributes</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-356-35"><a id="__codelineno-356-35" name="__codelineno-356-35" href="#__codelineno-356-35"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">setAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-356-36"><a id="__codelineno-356-36" name="__codelineno-356-36" href="#__codelineno-356-36"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-356-37"><a id="__codelineno-356-37" name="__codelineno-356-37" href="#__codelineno-356-37"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-356-38"><a id="__codelineno-356-38" name="__codelineno-356-38" href="#__codelineno-356-38"></a><span class="c1">-- Set up character data</span>
</span><span id="__span-356-39"><a id="__codelineno-356-39" name="__codelineno-356-39" href="#__codelineno-356-39"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;creationTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-356-40"><a id="__codelineno-356-40" name="__codelineno-356-40" href="#__codelineno-356-40"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;creationIP&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IPAddress</span><span class="p">())</span>
</span><span id="__span-356-41"><a id="__codelineno-356-41" name="__codelineno-356-41" href="#__codelineno-356-41"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-356-42"><a id="__codelineno-356-42" name="__codelineno-356-42" href="#__codelineno-356-42"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;experience&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-356-43"><a id="__codelineno-356-43" name="__codelineno-356-43" href="#__codelineno-356-43"></a><span class="c1">-- Send welcome message</span>
</span><span id="__span-356-44"><a id="__codelineno-356-44" name="__codelineno-356-44" href="#__codelineno-356-44"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character created successfully! Welcome to the server.&quot;</span><span class="p">)</span>
</span><span id="__span-356-45"><a id="__codelineno-356-45" name="__codelineno-356-45" href="#__codelineno-356-45"></a><span class="c1">-- Log creation</span>
</span><span id="__span-356-46"><a id="__codelineno-356-46" name="__codelineno-356-46" href="#__codelineno-356-46"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s created %s character: %s&quot;</span><span class="p">,</span>
</span><span id="__span-356-47"><a id="__codelineno-356-47" name="__codelineno-356-47" href="#__codelineno-356-47"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()))</span>
</span><span id="__span-356-48"><a id="__codelineno-356-48" name="__codelineno-356-48" href="#__codelineno-356-48"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onchardelete">OnCharDelete</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is deleted</p>
<p><strong>When Called</strong></p>
<p>When a character is successfully deleted</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who deleted the character</li>
<li><code>id</code> (<em>number</em>): The ID of the character that was deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-357-1"><a id="__codelineno-357-1" name="__codelineno-357-1" href="#__codelineno-357-1"></a><span class="c1">-- Simple: Log character deletion</span>
</span><span id="__span-357-2"><a id="__codelineno-357-2" name="__codelineno-357-2" href="#__codelineno-357-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-357-3"><a id="__codelineno-357-3" name="__codelineno-357-3" href="#__codelineno-357-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted character ID: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-357-4"><a id="__codelineno-357-4" name="__codelineno-357-4" href="#__codelineno-357-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-358-1"><a id="__codelineno-358-1" name="__codelineno-358-1" href="#__codelineno-358-1"></a><span class="c1">-- Medium: Track deletion statistics</span>
</span><span id="__span-358-2"><a id="__codelineno-358-2" name="__codelineno-358-2" href="#__codelineno-358-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeletionTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-358-3"><a id="__codelineno-358-3" name="__codelineno-358-3" href="#__codelineno-358-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-358-4"><a id="__codelineno-358-4" name="__codelineno-358-4" href="#__codelineno-358-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-358-5"><a id="__codelineno-358-5" name="__codelineno-358-5" href="#__codelineno-358-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;charactersDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;charactersDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-358-6"><a id="__codelineno-358-6" name="__codelineno-358-6" href="#__codelineno-358-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-358-7"><a id="__codelineno-358-7" name="__codelineno-358-7" href="#__codelineno-358-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-358-8"><a id="__codelineno-358-8" name="__codelineno-358-8" href="#__codelineno-358-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-359-1"><a id="__codelineno-359-1" name="__codelineno-359-1" href="#__codelineno-359-1"></a><span class="c1">-- High: Complex character deletion system</span>
</span><span id="__span-359-2"><a id="__codelineno-359-2" name="__codelineno-359-2" href="#__codelineno-359-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDeletion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-359-3"><a id="__codelineno-359-3" name="__codelineno-359-3" href="#__codelineno-359-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-359-4"><a id="__codelineno-359-4" name="__codelineno-359-4" href="#__codelineno-359-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-359-5"><a id="__codelineno-359-5" name="__codelineno-359-5" href="#__codelineno-359-5"></a><span class="w">    </span><span class="c1">-- Update deletion statistics</span>
</span><span id="__span-359-6"><a id="__codelineno-359-6" name="__codelineno-359-6" href="#__codelineno-359-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;charactersDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;charactersDeleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-359-7"><a id="__codelineno-359-7" name="__codelineno-359-7" href="#__codelineno-359-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-359-8"><a id="__codelineno-359-8" name="__codelineno-359-8" href="#__codelineno-359-8"></a><span class="w">    </span><span class="c1">-- Check for deletion cooldown</span>
</span><span id="__span-359-9"><a id="__codelineno-359-9" name="__codelineno-359-9" href="#__codelineno-359-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-359-10"><a id="__codelineno-359-10" name="__codelineno-359-10" href="#__codelineno-359-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">deleteCooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="c1">-- 1 hour</span>
</span><span id="__span-359-11"><a id="__codelineno-359-11" name="__codelineno-359-11" href="#__codelineno-359-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastDelete</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">deleteCooldown</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-12"><a id="__codelineno-359-12" name="__codelineno-359-12" href="#__codelineno-359-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must wait before deleting another character&quot;</span><span class="p">)</span>
</span><span id="__span-359-13"><a id="__codelineno-359-13" name="__codelineno-359-13" href="#__codelineno-359-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-359-14"><a id="__codelineno-359-14" name="__codelineno-359-14" href="#__codelineno-359-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-15"><a id="__codelineno-359-15" name="__codelineno-359-15" href="#__codelineno-359-15"></a><span class="w">    </span><span class="c1">-- Check for valuable items</span>
</span><span id="__span-359-16"><a id="__codelineno-359-16" name="__codelineno-359-16" href="#__codelineno-359-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-359-17"><a id="__codelineno-359-17" name="__codelineno-359-17" href="#__codelineno-359-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">valuableItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-359-18"><a id="__codelineno-359-18" name="__codelineno-359-18" href="#__codelineno-359-18"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">charInv</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-359-19"><a id="__codelineno-359-19" name="__codelineno-359-19" href="#__codelineno-359-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-20"><a id="__codelineno-359-20" name="__codelineno-359-20" href="#__codelineno-359-20"></a><span class="w">            </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">valuableItems</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-359-21"><a id="__codelineno-359-21" name="__codelineno-359-21" href="#__codelineno-359-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-359-22"><a id="__codelineno-359-22" name="__codelineno-359-22" href="#__codelineno-359-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-23"><a id="__codelineno-359-23" name="__codelineno-359-23" href="#__codelineno-359-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">valuableItems</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-24"><a id="__codelineno-359-24" name="__codelineno-359-24" href="#__codelineno-359-24"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning: You have valuable items. Are you sure you want to delete this character?&quot;</span><span class="p">)</span>
</span><span id="__span-359-25"><a id="__codelineno-359-25" name="__codelineno-359-25" href="#__codelineno-359-25"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-359-26"><a id="__codelineno-359-26" name="__codelineno-359-26" href="#__codelineno-359-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-27"><a id="__codelineno-359-27" name="__codelineno-359-27" href="#__codelineno-359-27"></a><span class="w">    </span><span class="c1">-- Check for faction restrictions</span>
</span><span id="__span-359-28"><a id="__codelineno-359-28" name="__codelineno-359-28" href="#__codelineno-359-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-359-29"><a id="__codelineno-359-29" name="__codelineno-359-29" href="#__codelineno-359-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-30"><a id="__codelineno-359-30" name="__codelineno-359-30" href="#__codelineno-359-30"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must leave your faction before deleting this character&quot;</span><span class="p">)</span>
</span><span id="__span-359-31"><a id="__codelineno-359-31" name="__codelineno-359-31" href="#__codelineno-359-31"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-359-32"><a id="__codelineno-359-32" name="__codelineno-359-32" href="#__codelineno-359-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-33"><a id="__codelineno-359-33" name="__codelineno-359-33" href="#__codelineno-359-33"></a><span class="w">    </span><span class="c1">-- Check for active quests</span>
</span><span id="__span-359-34"><a id="__codelineno-359-34" name="__codelineno-359-34" href="#__codelineno-359-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-359-35"><a id="__codelineno-359-35" name="__codelineno-359-35" href="#__codelineno-359-35"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-36"><a id="__codelineno-359-36" name="__codelineno-359-36" href="#__codelineno-359-36"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have active quests. Complete them before deleting this character&quot;</span><span class="p">)</span>
</span><span id="__span-359-37"><a id="__codelineno-359-37" name="__codelineno-359-37" href="#__codelineno-359-37"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-359-38"><a id="__codelineno-359-38" name="__codelineno-359-38" href="#__codelineno-359-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-39"><a id="__codelineno-359-39" name="__codelineno-359-39" href="#__codelineno-359-39"></a><span class="w">    </span><span class="c1">-- Log deletion</span>
</span><span id="__span-359-40"><a id="__codelineno-359-40" name="__codelineno-359-40" href="#__codelineno-359-40"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s deleted character ID %d (Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-359-41"><a id="__codelineno-359-41" name="__codelineno-359-41" href="#__codelineno-359-41"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">))</span>
</span><span id="__span-359-42"><a id="__codelineno-359-42" name="__codelineno-359-42" href="#__codelineno-359-42"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-359-43"><a id="__codelineno-359-43" name="__codelineno-359-43" href="#__codelineno-359-43"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-359-44"><a id="__codelineno-359-44" name="__codelineno-359-44" href="#__codelineno-359-44"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-359-45"><a id="__codelineno-359-45" name="__codelineno-359-45" href="#__codelineno-359-45"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; deleted character ID &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-359-46"><a id="__codelineno-359-46" name="__codelineno-359-46" href="#__codelineno-359-46"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-359-47"><a id="__codelineno-359-47" name="__codelineno-359-47" href="#__codelineno-359-47"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-359-48"><a id="__codelineno-359-48" name="__codelineno-359-48" href="#__codelineno-359-48"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onchardisconnect">OnCharDisconnect</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character disconnects</p>
<p><strong>When Called</strong></p>
<p>When a player disconnects while having a character loaded</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who disconnected</li>
<li><code>character</code> (<em>Character</em>): The character that was loaded when disconnecting</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-360-1"><a id="__codelineno-360-1" name="__codelineno-360-1" href="#__codelineno-360-1"></a><span class="c1">-- Simple: Log character disconnect</span>
</span><span id="__span-360-2"><a id="__codelineno-360-2" name="__codelineno-360-2" href="#__codelineno-360-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-360-3"><a id="__codelineno-360-3" name="__codelineno-360-3" href="#__codelineno-360-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; disconnected with character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-360-4"><a id="__codelineno-360-4" name="__codelineno-360-4" href="#__codelineno-360-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-361-1"><a id="__codelineno-361-1" name="__codelineno-361-1" href="#__codelineno-361-1"></a><span class="c1">-- Medium: Save character data on disconnect</span>
</span><span id="__span-361-2"><a id="__codelineno-361-2" name="__codelineno-361-2" href="#__codelineno-361-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharDisconnectSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-361-3"><a id="__codelineno-361-3" name="__codelineno-361-3" href="#__codelineno-361-3"></a><span class="c1">-- Save character position</span>
</span><span id="__span-361-4"><a id="__codelineno-361-4" name="__codelineno-361-4" href="#__codelineno-361-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-361-5"><a id="__codelineno-361-5" name="__codelineno-361-5" href="#__codelineno-361-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-361-6"><a id="__codelineno-361-6" name="__codelineno-361-6" href="#__codelineno-361-6"></a><span class="c1">-- Save character health and armor</span>
</span><span id="__span-361-7"><a id="__codelineno-361-7" name="__codelineno-361-7" href="#__codelineno-361-7"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-361-8"><a id="__codelineno-361-8" name="__codelineno-361-8" href="#__codelineno-361-8"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-361-9"><a id="__codelineno-361-9" name="__codelineno-361-9" href="#__codelineno-361-9"></a><span class="c1">-- Save disconnect time</span>
</span><span id="__span-361-10"><a id="__codelineno-361-10" name="__codelineno-361-10" href="#__codelineno-361-10"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-361-11"><a id="__codelineno-361-11" name="__codelineno-361-11" href="#__codelineno-361-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-362-1"><a id="__codelineno-362-1" name="__codelineno-362-1" href="#__codelineno-362-1"></a><span class="c1">-- High: Complex character disconnect system</span>
</span><span id="__span-362-2"><a id="__codelineno-362-2" name="__codelineno-362-2" href="#__codelineno-362-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-362-3"><a id="__codelineno-362-3" name="__codelineno-362-3" href="#__codelineno-362-3"></a><span class="c1">-- Save character state</span>
</span><span id="__span-362-4"><a id="__codelineno-362-4" name="__codelineno-362-4" href="#__codelineno-362-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-362-5"><a id="__codelineno-362-5" name="__codelineno-362-5" href="#__codelineno-362-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-362-6"><a id="__codelineno-362-6" name="__codelineno-362-6" href="#__codelineno-362-6"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-362-7"><a id="__codelineno-362-7" name="__codelineno-362-7" href="#__codelineno-362-7"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-362-8"><a id="__codelineno-362-8" name="__codelineno-362-8" href="#__codelineno-362-8"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-362-9"><a id="__codelineno-362-9" name="__codelineno-362-9" href="#__codelineno-362-9"></a><span class="c1">-- Save inventory state</span>
</span><span id="__span-362-10"><a id="__codelineno-362-10" name="__codelineno-362-10" href="#__codelineno-362-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-362-11"><a id="__codelineno-362-11" name="__codelineno-362-11" href="#__codelineno-362-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-362-12"><a id="__codelineno-362-12" name="__codelineno-362-12" href="#__codelineno-362-12"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;inventoryState&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getData</span><span class="p">())</span>
</span><span id="__span-362-13"><a id="__codelineno-362-13" name="__codelineno-362-13" href="#__codelineno-362-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-362-14"><a id="__codelineno-362-14" name="__codelineno-362-14" href="#__codelineno-362-14"></a><span class="c1">-- Save character money</span>
</span><span id="__span-362-15"><a id="__codelineno-362-15" name="__codelineno-362-15" href="#__codelineno-362-15"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">())</span>
</span><span id="__span-362-16"><a id="__codelineno-362-16" name="__codelineno-362-16" href="#__codelineno-362-16"></a><span class="c1">-- Save character attributes</span>
</span><span id="__span-362-17"><a id="__codelineno-362-17" name="__codelineno-362-17" href="#__codelineno-362-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getAttribs</span><span class="p">()</span>
</span><span id="__span-362-18"><a id="__codelineno-362-18" name="__codelineno-362-18" href="#__codelineno-362-18"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAttributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">attributes</span><span class="p">)</span>
</span><span id="__span-362-19"><a id="__codelineno-362-19" name="__codelineno-362-19" href="#__codelineno-362-19"></a><span class="c1">-- Save character data</span>
</span><span id="__span-362-20"><a id="__codelineno-362-20" name="__codelineno-362-20" href="#__codelineno-362-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">()</span>
</span><span id="__span-362-21"><a id="__codelineno-362-21" name="__codelineno-362-21" href="#__codelineno-362-21"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastCharData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">charData</span><span class="p">)</span>
</span><span id="__span-362-22"><a id="__codelineno-362-22" name="__codelineno-362-22" href="#__codelineno-362-22"></a><span class="c1">-- Check for active effects</span>
</span><span id="__span-362-23"><a id="__codelineno-362-23" name="__codelineno-362-23" href="#__codelineno-362-23"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeEffects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-362-24"><a id="__codelineno-362-24" name="__codelineno-362-24" href="#__codelineno-362-24"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">activeEffects</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-362-25"><a id="__codelineno-362-25" name="__codelineno-362-25" href="#__codelineno-362-25"></a><span class="w">    </span><span class="c1">-- Pause active effects</span>
</span><span id="__span-362-26"><a id="__codelineno-362-26" name="__codelineno-362-26" href="#__codelineno-362-26"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">effect</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeEffects</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-362-27"><a id="__codelineno-362-27" name="__codelineno-362-27" href="#__codelineno-362-27"></a><span class="w">        </span><span class="nv">effect</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-362-28"><a id="__codelineno-362-28" name="__codelineno-362-28" href="#__codelineno-362-28"></a><span class="w">        </span><span class="nv">effect</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-362-29"><a id="__codelineno-362-29" name="__codelineno-362-29" href="#__codelineno-362-29"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-362-30"><a id="__codelineno-362-30" name="__codelineno-362-30" href="#__codelineno-362-30"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">activeEffects</span><span class="p">)</span>
</span><span id="__span-362-31"><a id="__codelineno-362-31" name="__codelineno-362-31" href="#__codelineno-362-31"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-362-32"><a id="__codelineno-362-32" name="__codelineno-362-32" href="#__codelineno-362-32"></a><span class="c1">-- Check for active quests</span>
</span><span id="__span-362-33"><a id="__codelineno-362-33" name="__codelineno-362-33" href="#__codelineno-362-33"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-362-34"><a id="__codelineno-362-34" name="__codelineno-362-34" href="#__codelineno-362-34"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-362-35"><a id="__codelineno-362-35" name="__codelineno-362-35" href="#__codelineno-362-35"></a><span class="w">    </span><span class="c1">-- Pause active quests</span>
</span><span id="__span-362-36"><a id="__codelineno-362-36" name="__codelineno-362-36" href="#__codelineno-362-36"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">quest</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeQuests</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-362-37"><a id="__codelineno-362-37" name="__codelineno-362-37" href="#__codelineno-362-37"></a><span class="w">        </span><span class="nv">quest</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-362-38"><a id="__codelineno-362-38" name="__codelineno-362-38" href="#__codelineno-362-38"></a><span class="w">        </span><span class="nv">quest</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-362-39"><a id="__codelineno-362-39" name="__codelineno-362-39" href="#__codelineno-362-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-362-40"><a id="__codelineno-362-40" name="__codelineno-362-40" href="#__codelineno-362-40"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">activeQuests</span><span class="p">)</span>
</span><span id="__span-362-41"><a id="__codelineno-362-41" name="__codelineno-362-41" href="#__codelineno-362-41"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-362-42"><a id="__codelineno-362-42" name="__codelineno-362-42" href="#__codelineno-362-42"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-362-43"><a id="__codelineno-362-43" name="__codelineno-362-43" href="#__codelineno-362-43"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-362-44"><a id="__codelineno-362-44" name="__codelineno-362-44" href="#__codelineno-362-44"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-362-45"><a id="__codelineno-362-45" name="__codelineno-362-45" href="#__codelineno-362-45"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has disconnected&quot;</span><span class="p">)</span>
</span><span id="__span-362-46"><a id="__codelineno-362-46" name="__codelineno-362-46" href="#__codelineno-362-46"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-362-47"><a id="__codelineno-362-47" name="__codelineno-362-47" href="#__codelineno-362-47"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-362-48"><a id="__codelineno-362-48" name="__codelineno-362-48" href="#__codelineno-362-48"></a><span class="c1">-- Log disconnect</span>
</span><span id="__span-362-49"><a id="__codelineno-362-49" name="__codelineno-362-49" href="#__codelineno-362-49"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s disconnected with character %s (Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-362-50"><a id="__codelineno-362-50" name="__codelineno-362-50" href="#__codelineno-362-50"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()))</span>
</span><span id="__span-362-51"><a id="__codelineno-362-51" name="__codelineno-362-51" href="#__codelineno-362-51"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharfallover">OnCharFallover</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character falls over</p>
<p><strong>When Called</strong></p>
<p>When a character is knocked down/ragdolled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character falling over</li>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>ragdoll</code> (<em>Entity</em>): The ragdoll entity created</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-363-1"><a id="__codelineno-363-1" name="__codelineno-363-1" href="#__codelineno-363-1"></a><span class="c1">-- Simple: Log fallover</span>
</span><span id="__span-363-2"><a id="__codelineno-363-2" name="__codelineno-363-2" href="#__codelineno-363-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFallover&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">ragdoll</span><span class="p">)</span>
</span><span id="__span-363-3"><a id="__codelineno-363-3" name="__codelineno-363-3" href="#__codelineno-363-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; fell over&quot;</span><span class="p">)</span>
</span><span id="__span-363-4"><a id="__codelineno-363-4" name="__codelineno-363-4" href="#__codelineno-363-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-364-1"><a id="__codelineno-364-1" name="__codelineno-364-1" href="#__codelineno-364-1"></a><span class="c1">-- Medium: Set ragdoll data</span>
</span><span id="__span-364-2"><a id="__codelineno-364-2" name="__codelineno-364-2" href="#__codelineno-364-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFallover&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SetRagdollData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">ragdoll</span><span class="p">)</span>
</span><span id="__span-364-3"><a id="__codelineno-364-3" name="__codelineno-364-3" href="#__codelineno-364-3"></a><span class="nv">ragdoll</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;charID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-364-4"><a id="__codelineno-364-4" name="__codelineno-364-4" href="#__codelineno-364-4"></a><span class="nv">ragdoll</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;fallTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-364-5"><a id="__codelineno-364-5" name="__codelineno-364-5" href="#__codelineno-364-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-365-1"><a id="__codelineno-365-1" name="__codelineno-365-1" href="#__codelineno-365-1"></a><span class="c1">-- High: Complex fallover system</span>
</span><span id="__span-365-2"><a id="__codelineno-365-2" name="__codelineno-365-2" href="#__codelineno-365-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFallover&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFallover&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">ragdoll</span><span class="p">)</span>
</span><span id="__span-365-3"><a id="__codelineno-365-3" name="__codelineno-365-3" href="#__codelineno-365-3"></a><span class="c1">-- Set ragdoll data</span>
</span><span id="__span-365-4"><a id="__codelineno-365-4" name="__codelineno-365-4" href="#__codelineno-365-4"></a><span class="nv">ragdoll</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;charID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-365-5"><a id="__codelineno-365-5" name="__codelineno-365-5" href="#__codelineno-365-5"></a><span class="nv">ragdoll</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;fallTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-365-6"><a id="__codelineno-365-6" name="__codelineno-365-6" href="#__codelineno-365-6"></a><span class="nv">ragdoll</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;charName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-365-7"><a id="__codelineno-365-7" name="__codelineno-365-7" href="#__codelineno-365-7"></a><span class="c1">-- Track fallover count</span>
</span><span id="__span-365-8"><a id="__codelineno-365-8" name="__codelineno-365-8" href="#__codelineno-365-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">fallCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;fallCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-365-9"><a id="__codelineno-365-9" name="__codelineno-365-9" href="#__codelineno-365-9"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;fallCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">fallCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-365-10"><a id="__codelineno-365-10" name="__codelineno-365-10" href="#__codelineno-365-10"></a><span class="c1">-- Apply faction-specific effects</span>
</span><span id="__span-365-11"><a id="__codelineno-365-11" name="__codelineno-365-11" href="#__codelineno-365-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-365-12"><a id="__codelineno-365-12" name="__codelineno-365-12" href="#__codelineno-365-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-365-13"><a id="__codelineno-365-13" name="__codelineno-365-13" href="#__codelineno-365-13"></a><span class="w">    </span><span class="c1">-- Police get up faster</span>
</span><span id="__span-365-14"><a id="__codelineno-365-14" name="__codelineno-365-14" href="#__codelineno-365-14"></a><span class="w">    </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-365-15"><a id="__codelineno-365-15" name="__codelineno-365-15" href="#__codelineno-365-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ragdoll</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-365-16"><a id="__codelineno-365-16" name="__codelineno-365-16" href="#__codelineno-365-16"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetRagdolled</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-365-17"><a id="__codelineno-365-17" name="__codelineno-365-17" href="#__codelineno-365-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-365-18"><a id="__codelineno-365-18" name="__codelineno-365-18" href="#__codelineno-365-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-365-19"><a id="__codelineno-365-19" name="__codelineno-365-19" href="#__codelineno-365-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-365-20"><a id="__codelineno-365-20" name="__codelineno-365-20" href="#__codelineno-365-20"></a><span class="c1">-- Notify nearby players</span>
</span><span id="__span-365-21"><a id="__codelineno-365-21" name="__codelineno-365-21" href="#__codelineno-365-21"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-365-22"><a id="__codelineno-365-22" name="__codelineno-365-22" href="#__codelineno-365-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-365-23"><a id="__codelineno-365-23" name="__codelineno-365-23" href="#__codelineno-365-23"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; fell over&quot;</span><span class="p">)</span>
</span><span id="__span-365-24"><a id="__codelineno-365-24" name="__codelineno-365-24" href="#__codelineno-365-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-365-25"><a id="__codelineno-365-25" name="__codelineno-365-25" href="#__codelineno-365-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-365-26"><a id="__codelineno-365-26" name="__codelineno-365-26" href="#__codelineno-365-26"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharflagsgiven">OnCharFlagsGiven</h3>
<p><strong>Purpose</strong></p>
<p>Called when flags are given to a character</p>
<p><strong>When Called</strong></p>
<p>When a character receives new flags</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ply</code> (<em>Player</em>): The player receiving flags</li>
<li><code>self</code> (<em>Character</em>): The character receiving flags</li>
<li><code>addedFlags</code> (<em>string</em>): The flags that were added</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-366-1"><a id="__codelineno-366-1" name="__codelineno-366-1" href="#__codelineno-366-1"></a><span class="c1">-- Simple: Log flags given</span>
</span><span id="__span-366-2"><a id="__codelineno-366-2" name="__codelineno-366-2" href="#__codelineno-366-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-366-3"><a id="__codelineno-366-3" name="__codelineno-366-3" href="#__codelineno-366-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; received flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-366-4"><a id="__codelineno-366-4" name="__codelineno-366-4" href="#__codelineno-366-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-367-1"><a id="__codelineno-367-1" name="__codelineno-367-1" href="#__codelineno-367-1"></a><span class="c1">-- Medium: Track flag changes</span>
</span><span id="__span-367-2"><a id="__codelineno-367-2" name="__codelineno-367-2" href="#__codelineno-367-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackFlagChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-367-3"><a id="__codelineno-367-3" name="__codelineno-367-3" href="#__codelineno-367-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">flagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-367-4"><a id="__codelineno-367-4" name="__codelineno-367-4" href="#__codelineno-367-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">flagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;given&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-367-5"><a id="__codelineno-367-5" name="__codelineno-367-5" href="#__codelineno-367-5"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flagHistory</span><span class="p">)</span>
</span><span id="__span-367-6"><a id="__codelineno-367-6" name="__codelineno-367-6" href="#__codelineno-367-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-368-1"><a id="__codelineno-368-1" name="__codelineno-368-1" href="#__codelineno-368-1"></a><span class="c1">-- High: Complex flag management system</span>
</span><span id="__span-368-2"><a id="__codelineno-368-2" name="__codelineno-368-2" href="#__codelineno-368-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFlagManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-368-3"><a id="__codelineno-368-3" name="__codelineno-368-3" href="#__codelineno-368-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-368-4"><a id="__codelineno-368-4" name="__codelineno-368-4" href="#__codelineno-368-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO flag_logs (timestamp, charid, action, flags) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-368-5"><a id="__codelineno-368-5" name="__codelineno-368-5" href="#__codelineno-368-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;given&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-368-6"><a id="__codelineno-368-6" name="__codelineno-368-6" href="#__codelineno-368-6"></a><span class="c1">-- Track flag history</span>
</span><span id="__span-368-7"><a id="__codelineno-368-7" name="__codelineno-368-7" href="#__codelineno-368-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">flagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-368-8"><a id="__codelineno-368-8" name="__codelineno-368-8" href="#__codelineno-368-8"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">flagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;given&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-368-9"><a id="__codelineno-368-9" name="__codelineno-368-9" href="#__codelineno-368-9"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flagHistory</span><span class="p">)</span>
</span><span id="__span-368-10"><a id="__codelineno-368-10" name="__codelineno-368-10" href="#__codelineno-368-10"></a><span class="c1">-- Notify player</span>
</span><span id="__span-368-11"><a id="__codelineno-368-11" name="__codelineno-368-11" href="#__codelineno-368-11"></a><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You received flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-368-12"><a id="__codelineno-368-12" name="__codelineno-368-12" href="#__codelineno-368-12"></a><span class="c1">-- Apply flag-specific effects</span>
</span><span id="__span-368-13"><a id="__codelineno-368-13" name="__codelineno-368-13" href="#__codelineno-368-13"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="nv">addedFlags</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-368-14"><a id="__codelineno-368-14" name="__codelineno-368-14" href="#__codelineno-368-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">:</span><span class="nf">sub</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
</span><span id="__span-368-15"><a id="__codelineno-368-15" name="__codelineno-368-15" href="#__codelineno-368-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;v&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-368-16"><a id="__codelineno-368-16" name="__codelineno-368-16" href="#__codelineno-368-16"></a><span class="w">        </span><span class="c1">-- VIP flag</span>
</span><span id="__span-368-17"><a id="__codelineno-368-17" name="__codelineno-368-17" href="#__codelineno-368-17"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are now a VIP!&quot;</span><span class="p">)</span>
</span><span id="__span-368-18"><a id="__codelineno-368-18" name="__codelineno-368-18" href="#__codelineno-368-18"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-368-19"><a id="__codelineno-368-19" name="__codelineno-368-19" href="#__codelineno-368-19"></a><span class="w">        </span><span class="c1">-- Admin flag</span>
</span><span id="__span-368-20"><a id="__codelineno-368-20" name="__codelineno-368-20" href="#__codelineno-368-20"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You now have admin privileges!&quot;</span><span class="p">)</span>
</span><span id="__span-368-21"><a id="__codelineno-368-21" name="__codelineno-368-21" href="#__codelineno-368-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-368-22"><a id="__codelineno-368-22" name="__codelineno-368-22" href="#__codelineno-368-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-368-23"><a id="__codelineno-368-23" name="__codelineno-368-23" href="#__codelineno-368-23"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-368-24"><a id="__codelineno-368-24" name="__codelineno-368-24" href="#__codelineno-368-24"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-368-25"><a id="__codelineno-368-25" name="__codelineno-368-25" href="#__codelineno-368-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-368-26"><a id="__codelineno-368-26" name="__codelineno-368-26" href="#__codelineno-368-26"></a><span class="w">        </span><span class="nv">admin</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[FLAGS] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; received flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">addedFlags</span><span class="p">)</span>
</span><span id="__span-368-27"><a id="__codelineno-368-27" name="__codelineno-368-27" href="#__codelineno-368-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-368-28"><a id="__codelineno-368-28" name="__codelineno-368-28" href="#__codelineno-368-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-368-29"><a id="__codelineno-368-29" name="__codelineno-368-29" href="#__codelineno-368-29"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharflagstaken">OnCharFlagsTaken</h3>
<p><strong>Purpose</strong></p>
<p>Called when flags are taken from a character</p>
<p><strong>When Called</strong></p>
<p>When a character loses flags</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ply</code> (<em>Player</em>): The player losing flags</li>
<li><code>self</code> (<em>Character</em>): The character losing flags</li>
<li><code>removedFlags</code> (<em>string</em>): The flags that were removed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-369-1"><a id="__codelineno-369-1" name="__codelineno-369-1" href="#__codelineno-369-1"></a><span class="c1">-- Simple: Log flags taken</span>
</span><span id="__span-369-2"><a id="__codelineno-369-2" name="__codelineno-369-2" href="#__codelineno-369-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-369-3"><a id="__codelineno-369-3" name="__codelineno-369-3" href="#__codelineno-369-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; lost flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-369-4"><a id="__codelineno-369-4" name="__codelineno-369-4" href="#__codelineno-369-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-370-1"><a id="__codelineno-370-1" name="__codelineno-370-1" href="#__codelineno-370-1"></a><span class="c1">-- Medium: Track flag removals</span>
</span><span id="__span-370-2"><a id="__codelineno-370-2" name="__codelineno-370-2" href="#__codelineno-370-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackFlagRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-370-3"><a id="__codelineno-370-3" name="__codelineno-370-3" href="#__codelineno-370-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">flagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-370-4"><a id="__codelineno-370-4" name="__codelineno-370-4" href="#__codelineno-370-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">flagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;taken&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-370-5"><a id="__codelineno-370-5" name="__codelineno-370-5" href="#__codelineno-370-5"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flagHistory</span><span class="p">)</span>
</span><span id="__span-370-6"><a id="__codelineno-370-6" name="__codelineno-370-6" href="#__codelineno-370-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-371-1"><a id="__codelineno-371-1" name="__codelineno-371-1" href="#__codelineno-371-1"></a><span class="c1">-- High: Complex flag removal system</span>
</span><span id="__span-371-2"><a id="__codelineno-371-2" name="__codelineno-371-2" href="#__codelineno-371-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharFlagsTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedFlagRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-371-3"><a id="__codelineno-371-3" name="__codelineno-371-3" href="#__codelineno-371-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-371-4"><a id="__codelineno-371-4" name="__codelineno-371-4" href="#__codelineno-371-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO flag_logs (timestamp, charid, action, flags) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-371-5"><a id="__codelineno-371-5" name="__codelineno-371-5" href="#__codelineno-371-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;taken&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-371-6"><a id="__codelineno-371-6" name="__codelineno-371-6" href="#__codelineno-371-6"></a><span class="c1">-- Track flag history</span>
</span><span id="__span-371-7"><a id="__codelineno-371-7" name="__codelineno-371-7" href="#__codelineno-371-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">flagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-371-8"><a id="__codelineno-371-8" name="__codelineno-371-8" href="#__codelineno-371-8"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">flagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;taken&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-371-9"><a id="__codelineno-371-9" name="__codelineno-371-9" href="#__codelineno-371-9"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;flagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">flagHistory</span><span class="p">)</span>
</span><span id="__span-371-10"><a id="__codelineno-371-10" name="__codelineno-371-10" href="#__codelineno-371-10"></a><span class="c1">-- Notify player</span>
</span><span id="__span-371-11"><a id="__codelineno-371-11" name="__codelineno-371-11" href="#__codelineno-371-11"></a><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You lost flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-371-12"><a id="__codelineno-371-12" name="__codelineno-371-12" href="#__codelineno-371-12"></a><span class="c1">-- Remove flag-specific effects</span>
</span><span id="__span-371-13"><a id="__codelineno-371-13" name="__codelineno-371-13" href="#__codelineno-371-13"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="nv">removedFlags</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-371-14"><a id="__codelineno-371-14" name="__codelineno-371-14" href="#__codelineno-371-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">:</span><span class="nf">sub</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
</span><span id="__span-371-15"><a id="__codelineno-371-15" name="__codelineno-371-15" href="#__codelineno-371-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;v&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-371-16"><a id="__codelineno-371-16" name="__codelineno-371-16" href="#__codelineno-371-16"></a><span class="w">        </span><span class="c1">-- VIP flag removed</span>
</span><span id="__span-371-17"><a id="__codelineno-371-17" name="__codelineno-371-17" href="#__codelineno-371-17"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your VIP status has been revoked&quot;</span><span class="p">)</span>
</span><span id="__span-371-18"><a id="__codelineno-371-18" name="__codelineno-371-18" href="#__codelineno-371-18"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-371-19"><a id="__codelineno-371-19" name="__codelineno-371-19" href="#__codelineno-371-19"></a><span class="w">        </span><span class="c1">-- Admin flag removed</span>
</span><span id="__span-371-20"><a id="__codelineno-371-20" name="__codelineno-371-20" href="#__codelineno-371-20"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your admin privileges have been revoked&quot;</span><span class="p">)</span>
</span><span id="__span-371-21"><a id="__codelineno-371-21" name="__codelineno-371-21" href="#__codelineno-371-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-371-22"><a id="__codelineno-371-22" name="__codelineno-371-22" href="#__codelineno-371-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-371-23"><a id="__codelineno-371-23" name="__codelineno-371-23" href="#__codelineno-371-23"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-371-24"><a id="__codelineno-371-24" name="__codelineno-371-24" href="#__codelineno-371-24"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-371-25"><a id="__codelineno-371-25" name="__codelineno-371-25" href="#__codelineno-371-25"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-371-26"><a id="__codelineno-371-26" name="__codelineno-371-26" href="#__codelineno-371-26"></a><span class="w">        </span><span class="nv">admin</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[FLAGS] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; lost flags: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">removedFlags</span><span class="p">)</span>
</span><span id="__span-371-27"><a id="__codelineno-371-27" name="__codelineno-371-27" href="#__codelineno-371-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-371-28"><a id="__codelineno-371-28" name="__codelineno-371-28" href="#__codelineno-371-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-371-29"><a id="__codelineno-371-29" name="__codelineno-371-29" href="#__codelineno-371-29"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onchargetup">OnCharGetup</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character gets up from being unconscious</p>
<p><strong>When Called</strong></p>
<p>When a character regains consciousness or is revived</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player whose character got up</li>
<li><code>entity</code> (<em>Entity</em>): The ragdoll entity that was removed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-372-1"><a id="__codelineno-372-1" name="__codelineno-372-1" href="#__codelineno-372-1"></a><span class="c1">-- Simple: Log character getup</span>
</span><span id="__span-372-2"><a id="__codelineno-372-2" name="__codelineno-372-2" href="#__codelineno-372-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharGetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-372-3"><a id="__codelineno-372-3" name="__codelineno-372-3" href="#__codelineno-372-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; got up&quot;</span><span class="p">)</span>
</span><span id="__span-372-4"><a id="__codelineno-372-4" name="__codelineno-372-4" href="#__codelineno-372-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-373-1"><a id="__codelineno-373-1" name="__codelineno-373-1" href="#__codelineno-373-1"></a><span class="c1">-- Medium: Handle getup effects</span>
</span><span id="__span-373-2"><a id="__codelineno-373-2" name="__codelineno-373-2" href="#__codelineno-373-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharGetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GetupEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-373-3"><a id="__codelineno-373-3" name="__codelineno-373-3" href="#__codelineno-373-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-373-4"><a id="__codelineno-373-4" name="__codelineno-373-4" href="#__codelineno-373-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-373-5"><a id="__codelineno-373-5" name="__codelineno-373-5" href="#__codelineno-373-5"></a><span class="w">    </span><span class="c1">-- Clear unconscious status</span>
</span><span id="__span-373-6"><a id="__codelineno-373-6" name="__codelineno-373-6" href="#__codelineno-373-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-373-7"><a id="__codelineno-373-7" name="__codelineno-373-7" href="#__codelineno-373-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;getupTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-373-8"><a id="__codelineno-373-8" name="__codelineno-373-8" href="#__codelineno-373-8"></a><span class="w">    </span><span class="c1">-- Restore some health</span>
</span><span id="__span-373-9"><a id="__codelineno-373-9" name="__codelineno-373-9" href="#__codelineno-373-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span>
</span><span id="__span-373-10"><a id="__codelineno-373-10" name="__codelineno-373-10" href="#__codelineno-373-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()</span>
</span><span id="__span-373-11"><a id="__codelineno-373-11" name="__codelineno-373-11" href="#__codelineno-373-11"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">currentHealth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nv">maxHealth</span><span class="p">))</span>
</span><span id="__span-373-12"><a id="__codelineno-373-12" name="__codelineno-373-12" href="#__codelineno-373-12"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have regained consciousness&quot;</span><span class="p">)</span>
</span><span id="__span-373-13"><a id="__codelineno-373-13" name="__codelineno-373-13" href="#__codelineno-373-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-373-14"><a id="__codelineno-373-14" name="__codelineno-373-14" href="#__codelineno-373-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-374-1"><a id="__codelineno-374-1" name="__codelineno-374-1" href="#__codelineno-374-1"></a><span class="c1">-- High: Complex getup system</span>
</span><span id="__span-374-2"><a id="__codelineno-374-2" name="__codelineno-374-2" href="#__codelineno-374-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharGetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedGetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-374-3"><a id="__codelineno-374-3" name="__codelineno-374-3" href="#__codelineno-374-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-374-4"><a id="__codelineno-374-4" name="__codelineno-374-4" href="#__codelineno-374-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-374-5"><a id="__codelineno-374-5" name="__codelineno-374-5" href="#__codelineno-374-5"></a><span class="w">    </span><span class="c1">-- Clear unconscious status</span>
</span><span id="__span-374-6"><a id="__codelineno-374-6" name="__codelineno-374-6" href="#__codelineno-374-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;unconscious&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-374-7"><a id="__codelineno-374-7" name="__codelineno-374-7" href="#__codelineno-374-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;getupTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-374-8"><a id="__codelineno-374-8" name="__codelineno-374-8" href="#__codelineno-374-8"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;revivalTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-374-9"><a id="__codelineno-374-9" name="__codelineno-374-9" href="#__codelineno-374-9"></a><span class="w">    </span><span class="c1">-- Restore health based on faction</span>
</span><span id="__span-374-10"><a id="__codelineno-374-10" name="__codelineno-374-10" href="#__codelineno-374-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-374-11"><a id="__codelineno-374-11" name="__codelineno-374-11" href="#__codelineno-374-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">healthRestore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-374-12"><a id="__codelineno-374-12" name="__codelineno-374-12" href="#__codelineno-374-12"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-374-13"><a id="__codelineno-374-13" name="__codelineno-374-13" href="#__codelineno-374-13"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span>
</span><span id="__span-374-14"><a id="__codelineno-374-14" name="__codelineno-374-14" href="#__codelineno-374-14"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-374-15"><a id="__codelineno-374-15" name="__codelineno-374-15" href="#__codelineno-374-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-374-16"><a id="__codelineno-374-16" name="__codelineno-374-16" href="#__codelineno-374-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restoreAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">healthRestore</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-374-17"><a id="__codelineno-374-17" name="__codelineno-374-17" href="#__codelineno-374-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span>
</span><span id="__span-374-18"><a id="__codelineno-374-18" name="__codelineno-374-18" href="#__codelineno-374-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()</span>
</span><span id="__span-374-19"><a id="__codelineno-374-19" name="__codelineno-374-19" href="#__codelineno-374-19"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">currentHealth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">restoreAmount</span><span class="p">,</span><span class="w"> </span><span class="nv">maxHealth</span><span class="p">))</span>
</span><span id="__span-374-20"><a id="__codelineno-374-20" name="__codelineno-374-20" href="#__codelineno-374-20"></a><span class="w">    </span><span class="c1">-- Restore stamina</span>
</span><span id="__span-374-21"><a id="__codelineno-374-21" name="__codelineno-374-21" href="#__codelineno-374-21"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-374-22"><a id="__codelineno-374-22" name="__codelineno-374-22" href="#__codelineno-374-22"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.min</span><span class="p">(</span><span class="nv">currentStamina</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
</span><span id="__span-374-23"><a id="__codelineno-374-23" name="__codelineno-374-23" href="#__codelineno-374-23"></a><span class="w">    </span><span class="c1">-- Resume active effects</span>
</span><span id="__span-374-24"><a id="__codelineno-374-24" name="__codelineno-374-24" href="#__codelineno-374-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">activeEffects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-374-25"><a id="__codelineno-374-25" name="__codelineno-374-25" href="#__codelineno-374-25"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">effect</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeEffects</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-374-26"><a id="__codelineno-374-26" name="__codelineno-374-26" href="#__codelineno-374-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">effect</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-374-27"><a id="__codelineno-374-27" name="__codelineno-374-27" href="#__codelineno-374-27"></a><span class="w">            </span><span class="nv">effect</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-374-28"><a id="__codelineno-374-28" name="__codelineno-374-28" href="#__codelineno-374-28"></a><span class="w">            </span><span class="nv">effect</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-374-29"><a id="__codelineno-374-29" name="__codelineno-374-29" href="#__codelineno-374-29"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-374-30"><a id="__codelineno-374-30" name="__codelineno-374-30" href="#__codelineno-374-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-374-31"><a id="__codelineno-374-31" name="__codelineno-374-31" href="#__codelineno-374-31"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">activeEffects</span><span class="p">)</span>
</span><span id="__span-374-32"><a id="__codelineno-374-32" name="__codelineno-374-32" href="#__codelineno-374-32"></a><span class="w">    </span><span class="c1">-- Resume active quests</span>
</span><span id="__span-374-33"><a id="__codelineno-374-33" name="__codelineno-374-33" href="#__codelineno-374-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-374-34"><a id="__codelineno-374-34" name="__codelineno-374-34" href="#__codelineno-374-34"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">quest</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeQuests</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-374-35"><a id="__codelineno-374-35" name="__codelineno-374-35" href="#__codelineno-374-35"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">quest</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-374-36"><a id="__codelineno-374-36" name="__codelineno-374-36" href="#__codelineno-374-36"></a><span class="w">            </span><span class="nv">quest</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-374-37"><a id="__codelineno-374-37" name="__codelineno-374-37" href="#__codelineno-374-37"></a><span class="w">            </span><span class="nv">quest</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-374-38"><a id="__codelineno-374-38" name="__codelineno-374-38" href="#__codelineno-374-38"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-374-39"><a id="__codelineno-374-39" name="__codelineno-374-39" href="#__codelineno-374-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-374-40"><a id="__codelineno-374-40" name="__codelineno-374-40" href="#__codelineno-374-40"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">activeQuests</span><span class="p">)</span>
</span><span id="__span-374-41"><a id="__codelineno-374-41" name="__codelineno-374-41" href="#__codelineno-374-41"></a><span class="w">    </span><span class="c1">-- Check for revival achievements</span>
</span><span id="__span-374-42"><a id="__codelineno-374-42" name="__codelineno-374-42" href="#__codelineno-374-42"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">revivals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;revivals&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-374-43"><a id="__codelineno-374-43" name="__codelineno-374-43" href="#__codelineno-374-43"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;revivals&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">revivals</span><span class="p">)</span>
</span><span id="__span-374-44"><a id="__codelineno-374-44" name="__codelineno-374-44" href="#__codelineno-374-44"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">revivals</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_survivor&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-374-45"><a id="__codelineno-374-45" name="__codelineno-374-45" href="#__codelineno-374-45"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_survivor&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-374-46"><a id="__codelineno-374-46" name="__codelineno-374-46" href="#__codelineno-374-46"></a><span class="w">        </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Survivor!&quot;</span><span class="p">)</span>
</span><span id="__span-374-47"><a id="__codelineno-374-47" name="__codelineno-374-47" href="#__codelineno-374-47"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-374-48"><a id="__codelineno-374-48" name="__codelineno-374-48" href="#__codelineno-374-48"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-374-49"><a id="__codelineno-374-49" name="__codelineno-374-49" href="#__codelineno-374-49"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-374-50"><a id="__codelineno-374-50" name="__codelineno-374-50" href="#__codelineno-374-50"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-374-51"><a id="__codelineno-374-51" name="__codelineno-374-51" href="#__codelineno-374-51"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has regained consciousness&quot;</span><span class="p">)</span>
</span><span id="__span-374-52"><a id="__codelineno-374-52" name="__codelineno-374-52" href="#__codelineno-374-52"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-374-53"><a id="__codelineno-374-53" name="__codelineno-374-53" href="#__codelineno-374-53"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-374-54"><a id="__codelineno-374-54" name="__codelineno-374-54" href="#__codelineno-374-54"></a><span class="w">    </span><span class="c1">-- Log getup</span>
</span><span id="__span-374-55"><a id="__codelineno-374-55" name="__codelineno-374-55" href="#__codelineno-374-55"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s got up (Faction: %s, Health: %d)&quot;</span><span class="p">,</span>
</span><span id="__span-374-56"><a id="__codelineno-374-56" name="__codelineno-374-56" href="#__codelineno-374-56"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Health</span><span class="p">()))</span>
</span><span id="__span-374-57"><a id="__codelineno-374-57" name="__codelineno-374-57" href="#__codelineno-374-57"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharkick">OnCharKick</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is kicked</p>
<p><strong>When Called</strong></p>
<p>When a character is kicked from the server</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Character</em>): The character being kicked</li>
<li><code>client</code> (<em>Player</em>): The player being kicked</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-375-1"><a id="__codelineno-375-1" name="__codelineno-375-1" href="#__codelineno-375-1"></a><span class="c1">-- Simple: Log character kick</span>
</span><span id="__span-375-2"><a id="__codelineno-375-2" name="__codelineno-375-2" href="#__codelineno-375-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-375-3"><a id="__codelineno-375-3" name="__codelineno-375-3" href="#__codelineno-375-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked&quot;</span><span class="p">)</span>
</span><span id="__span-375-4"><a id="__codelineno-375-4" name="__codelineno-375-4" href="#__codelineno-375-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-376-1"><a id="__codelineno-376-1" name="__codelineno-376-1" href="#__codelineno-376-1"></a><span class="c1">-- Medium: Handle kick effects</span>
</span><span id="__span-376-2"><a id="__codelineno-376-2" name="__codelineno-376-2" href="#__codelineno-376-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;KickEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-376-3"><a id="__codelineno-376-3" name="__codelineno-376-3" href="#__codelineno-376-3"></a><span class="c1">-- Save character data</span>
</span><span id="__span-376-4"><a id="__codelineno-376-4" name="__codelineno-376-4" href="#__codelineno-376-4"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-376-5"><a id="__codelineno-376-5" name="__codelineno-376-5" href="#__codelineno-376-5"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;kickCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;kickCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-376-6"><a id="__codelineno-376-6" name="__codelineno-376-6" href="#__codelineno-376-6"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-376-7"><a id="__codelineno-376-7" name="__codelineno-376-7" href="#__codelineno-376-7"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-376-8"><a id="__codelineno-376-8" name="__codelineno-376-8" href="#__codelineno-376-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-376-9"><a id="__codelineno-376-9" name="__codelineno-376-9" href="#__codelineno-376-9"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked from the server&quot;</span><span class="p">)</span>
</span><span id="__span-376-10"><a id="__codelineno-376-10" name="__codelineno-376-10" href="#__codelineno-376-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-376-11"><a id="__codelineno-376-11" name="__codelineno-376-11" href="#__codelineno-376-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-376-12"><a id="__codelineno-376-12" name="__codelineno-376-12" href="#__codelineno-376-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-377-1"><a id="__codelineno-377-1" name="__codelineno-377-1" href="#__codelineno-377-1"></a><span class="c1">-- High: Complex kick system</span>
</span><span id="__span-377-2"><a id="__codelineno-377-2" name="__codelineno-377-2" href="#__codelineno-377-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-377-3"><a id="__codelineno-377-3" name="__codelineno-377-3" href="#__codelineno-377-3"></a><span class="c1">-- Save character data</span>
</span><span id="__span-377-4"><a id="__codelineno-377-4" name="__codelineno-377-4" href="#__codelineno-377-4"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastKick&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-377-5"><a id="__codelineno-377-5" name="__codelineno-377-5" href="#__codelineno-377-5"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;kickCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;kickCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-377-6"><a id="__codelineno-377-6" name="__codelineno-377-6" href="#__codelineno-377-6"></a><span class="c1">-- Save character state</span>
</span><span id="__span-377-7"><a id="__codelineno-377-7" name="__codelineno-377-7" href="#__codelineno-377-7"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-377-8"><a id="__codelineno-377-8" name="__codelineno-377-8" href="#__codelineno-377-8"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-377-9"><a id="__codelineno-377-9" name="__codelineno-377-9" href="#__codelineno-377-9"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-377-10"><a id="__codelineno-377-10" name="__codelineno-377-10" href="#__codelineno-377-10"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-377-11"><a id="__codelineno-377-11" name="__codelineno-377-11" href="#__codelineno-377-11"></a><span class="c1">-- Save inventory state</span>
</span><span id="__span-377-12"><a id="__codelineno-377-12" name="__codelineno-377-12" href="#__codelineno-377-12"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-377-13"><a id="__codelineno-377-13" name="__codelineno-377-13" href="#__codelineno-377-13"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-14"><a id="__codelineno-377-14" name="__codelineno-377-14" href="#__codelineno-377-14"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;inventoryState&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getData</span><span class="p">())</span>
</span><span id="__span-377-15"><a id="__codelineno-377-15" name="__codelineno-377-15" href="#__codelineno-377-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-377-16"><a id="__codelineno-377-16" name="__codelineno-377-16" href="#__codelineno-377-16"></a><span class="c1">-- Check for kick reasons</span>
</span><span id="__span-377-17"><a id="__codelineno-377-17" name="__codelineno-377-17" href="#__codelineno-377-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">kickReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;kickReason&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
</span><span id="__span-377-18"><a id="__codelineno-377-18" name="__codelineno-377-18" href="#__codelineno-377-18"></a><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastKickReason&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">kickReason</span><span class="p">)</span>
</span><span id="__span-377-19"><a id="__codelineno-377-19" name="__codelineno-377-19" href="#__codelineno-377-19"></a><span class="c1">-- Check for faction-specific effects</span>
</span><span id="__span-377-20"><a id="__codelineno-377-20" name="__codelineno-377-20" href="#__codelineno-377-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-377-21"><a id="__codelineno-377-21" name="__codelineno-377-21" href="#__codelineno-377-21"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-22"><a id="__codelineno-377-22" name="__codelineno-377-22" href="#__codelineno-377-22"></a><span class="w">    </span><span class="c1">-- Police get backup call</span>
</span><span id="__span-377-23"><a id="__codelineno-377-23" name="__codelineno-377-23" href="#__codelineno-377-23"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-377-24"><a id="__codelineno-377-24" name="__codelineno-377-24" href="#__codelineno-377-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-377-25"><a id="__codelineno-377-25" name="__codelineno-377-25" href="#__codelineno-377-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-26"><a id="__codelineno-377-26" name="__codelineno-377-26" href="#__codelineno-377-26"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[BACKUP] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked! Reason: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">kickReason</span><span class="p">)</span>
</span><span id="__span-377-27"><a id="__codelineno-377-27" name="__codelineno-377-27" href="#__codelineno-377-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-377-28"><a id="__codelineno-377-28" name="__codelineno-377-28" href="#__codelineno-377-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-377-29"><a id="__codelineno-377-29" name="__codelineno-377-29" href="#__codelineno-377-29"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-30"><a id="__codelineno-377-30" name="__codelineno-377-30" href="#__codelineno-377-30"></a><span class="w">    </span><span class="c1">-- Medics get medical alert</span>
</span><span id="__span-377-31"><a id="__codelineno-377-31" name="__codelineno-377-31" href="#__codelineno-377-31"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-377-32"><a id="__codelineno-377-32" name="__codelineno-377-32" href="#__codelineno-377-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-377-33"><a id="__codelineno-377-33" name="__codelineno-377-33" href="#__codelineno-377-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-34"><a id="__codelineno-377-34" name="__codelineno-377-34" href="#__codelineno-377-34"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[MEDICAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked! Reason: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">kickReason</span><span class="p">)</span>
</span><span id="__span-377-35"><a id="__codelineno-377-35" name="__codelineno-377-35" href="#__codelineno-377-35"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-377-36"><a id="__codelineno-377-36" name="__codelineno-377-36" href="#__codelineno-377-36"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-377-37"><a id="__codelineno-377-37" name="__codelineno-377-37" href="#__codelineno-377-37"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-377-38"><a id="__codelineno-377-38" name="__codelineno-377-38" href="#__codelineno-377-38"></a><span class="c1">-- Check for active quests</span>
</span><span id="__span-377-39"><a id="__codelineno-377-39" name="__codelineno-377-39" href="#__codelineno-377-39"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-377-40"><a id="__codelineno-377-40" name="__codelineno-377-40" href="#__codelineno-377-40"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">quest</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeQuests</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-377-41"><a id="__codelineno-377-41" name="__codelineno-377-41" href="#__codelineno-377-41"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">quest</span><span class="p">.</span><span class="py">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;survival&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-42"><a id="__codelineno-377-42" name="__codelineno-377-42" href="#__codelineno-377-42"></a><span class="w">        </span><span class="nv">quest</span><span class="p">.</span><span class="py">failed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-377-43"><a id="__codelineno-377-43" name="__codelineno-377-43" href="#__codelineno-377-43"></a><span class="w">        </span><span class="nv">quest</span><span class="p">.</span><span class="py">failTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-377-44"><a id="__codelineno-377-44" name="__codelineno-377-44" href="#__codelineno-377-44"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-377-45"><a id="__codelineno-377-45" name="__codelineno-377-45" href="#__codelineno-377-45"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-377-46"><a id="__codelineno-377-46" name="__codelineno-377-46" href="#__codelineno-377-46"></a><span class="c1">-- Check for active effects</span>
</span><span id="__span-377-47"><a id="__codelineno-377-47" name="__codelineno-377-47" href="#__codelineno-377-47"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeEffects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-377-48"><a id="__codelineno-377-48" name="__codelineno-377-48" href="#__codelineno-377-48"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">effect</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeEffects</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-377-49"><a id="__codelineno-377-49" name="__codelineno-377-49" href="#__codelineno-377-49"></a><span class="w">    </span><span class="nv">effect</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-377-50"><a id="__codelineno-377-50" name="__codelineno-377-50" href="#__codelineno-377-50"></a><span class="w">    </span><span class="nv">effect</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-377-51"><a id="__codelineno-377-51" name="__codelineno-377-51" href="#__codelineno-377-51"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-377-52"><a id="__codelineno-377-52" name="__codelineno-377-52" href="#__codelineno-377-52"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-377-53"><a id="__codelineno-377-53" name="__codelineno-377-53" href="#__codelineno-377-53"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-377-54"><a id="__codelineno-377-54" name="__codelineno-377-54" href="#__codelineno-377-54"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-377-55"><a id="__codelineno-377-55" name="__codelineno-377-55" href="#__codelineno-377-55"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked from the server&quot;</span><span class="p">)</span>
</span><span id="__span-377-56"><a id="__codelineno-377-56" name="__codelineno-377-56" href="#__codelineno-377-56"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-377-57"><a id="__codelineno-377-57" name="__codelineno-377-57" href="#__codelineno-377-57"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-377-58"><a id="__codelineno-377-58" name="__codelineno-377-58" href="#__codelineno-377-58"></a><span class="c1">-- Log kick</span>
</span><span id="__span-377-59"><a id="__codelineno-377-59" name="__codelineno-377-59" href="#__codelineno-377-59"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s was kicked (Faction: %s, Reason: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-377-60"><a id="__codelineno-377-60" name="__codelineno-377-60" href="#__codelineno-377-60"></a><span class="nv">self</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">kickReason</span><span class="p">))</span>
</span><span id="__span-377-61"><a id="__codelineno-377-61" name="__codelineno-377-61" href="#__codelineno-377-61"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharnetvarchanged">OnCharNetVarChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character's network variable changes</p>
<p><strong>When Called</strong></p>
<p>When a character's networked data is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character whose variable changed</li>
<li><code>key</code> (<em>string</em>): The name of the variable that changed</li>
<li><code>oldVar</code> (<em>any</em>): The previous value of the variable</li>
<li><code>value</code> (<em>any</em>): The new value of the variable</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-378-1"><a id="__codelineno-378-1" name="__codelineno-378-1" href="#__codelineno-378-1"></a><span class="c1">-- Simple: Log network variable changes</span>
</span><span id="__span-378-2"><a id="__codelineno-378-2" name="__codelineno-378-2" href="#__codelineno-378-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharNetVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-378-3"><a id="__codelineno-378-3" name="__codelineno-378-3" href="#__codelineno-378-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; netvar changed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-378-4"><a id="__codelineno-378-4" name="__codelineno-378-4" href="#__codelineno-378-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-379-1"><a id="__codelineno-379-1" name="__codelineno-379-1" href="#__codelineno-379-1"></a><span class="c1">-- Medium: Track specific variable changes</span>
</span><span id="__span-379-2"><a id="__codelineno-379-2" name="__codelineno-379-2" href="#__codelineno-379-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharNetVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NetVarTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-379-3"><a id="__codelineno-379-3" name="__codelineno-379-3" href="#__codelineno-379-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-379-4"><a id="__codelineno-379-4" name="__codelineno-379-4" href="#__codelineno-379-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-379-5"><a id="__codelineno-379-5" name="__codelineno-379-5" href="#__codelineno-379-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-379-6"><a id="__codelineno-379-6" name="__codelineno-379-6" href="#__codelineno-379-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Health changed from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-379-7"><a id="__codelineno-379-7" name="__codelineno-379-7" href="#__codelineno-379-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-379-8"><a id="__codelineno-379-8" name="__codelineno-379-8" href="#__codelineno-379-8"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-379-9"><a id="__codelineno-379-9" name="__codelineno-379-9" href="#__codelineno-379-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-379-10"><a id="__codelineno-379-10" name="__codelineno-379-10" href="#__codelineno-379-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-379-11"><a id="__codelineno-379-11" name="__codelineno-379-11" href="#__codelineno-379-11"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Money changed from $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-379-12"><a id="__codelineno-379-12" name="__codelineno-379-12" href="#__codelineno-379-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-379-13"><a id="__codelineno-379-13" name="__codelineno-379-13" href="#__codelineno-379-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-379-14"><a id="__codelineno-379-14" name="__codelineno-379-14" href="#__codelineno-379-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-380-1"><a id="__codelineno-380-1" name="__codelineno-380-1" href="#__codelineno-380-1"></a><span class="c1">-- High: Complex network variable system</span>
</span><span id="__span-380-2"><a id="__codelineno-380-2" name="__codelineno-380-2" href="#__codelineno-380-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharNetVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedNetVar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-380-3"><a id="__codelineno-380-3" name="__codelineno-380-3" href="#__codelineno-380-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-380-4"><a id="__codelineno-380-4" name="__codelineno-380-4" href="#__codelineno-380-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-380-5"><a id="__codelineno-380-5" name="__codelineno-380-5" href="#__codelineno-380-5"></a><span class="w">    </span><span class="c1">-- Track variable change history</span>
</span><span id="__span-380-6"><a id="__codelineno-380-6" name="__codelineno-380-6" href="#__codelineno-380-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">changeHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;netVarHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-380-7"><a id="__codelineno-380-7" name="__codelineno-380-7" href="#__codelineno-380-7"></a><span class="w">    </span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-380-8"><a id="__codelineno-380-8" name="__codelineno-380-8" href="#__codelineno-380-8"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">key</span><span class="p">],</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-380-9"><a id="__codelineno-380-9" name="__codelineno-380-9" href="#__codelineno-380-9"></a><span class="w">    </span><span class="nv">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span>
</span><span id="__span-380-10"><a id="__codelineno-380-10" name="__codelineno-380-10" href="#__codelineno-380-10"></a><span class="w">    </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span>
</span><span id="__span-380-11"><a id="__codelineno-380-11" name="__codelineno-380-11" href="#__codelineno-380-11"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-380-12"><a id="__codelineno-380-12" name="__codelineno-380-12" href="#__codelineno-380-12"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-380-13"><a id="__codelineno-380-13" name="__codelineno-380-13" href="#__codelineno-380-13"></a><span class="w">    </span><span class="c1">-- Keep only last 10 changes per variable</span>
</span><span id="__span-380-14"><a id="__codelineno-380-14" name="__codelineno-380-14" href="#__codelineno-380-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-15"><a id="__codelineno-380-15" name="__codelineno-380-15" href="#__codelineno-380-15"></a><span class="w">        </span><span class="nb">table.remove</span><span class="p">(</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">key</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-380-16"><a id="__codelineno-380-16" name="__codelineno-380-16" href="#__codelineno-380-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-380-17"><a id="__codelineno-380-17" name="__codelineno-380-17" href="#__codelineno-380-17"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;netVarHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">changeHistory</span><span class="p">)</span>
</span><span id="__span-380-18"><a id="__codelineno-380-18" name="__codelineno-380-18" href="#__codelineno-380-18"></a><span class="w">    </span><span class="c1">-- Handle specific variable changes</span>
</span><span id="__span-380-19"><a id="__codelineno-380-19" name="__codelineno-380-19" href="#__codelineno-380-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-20"><a id="__codelineno-380-20" name="__codelineno-380-20" href="#__codelineno-380-20"></a><span class="w">        </span><span class="c1">-- Health change effects</span>
</span><span id="__span-380-21"><a id="__codelineno-380-21" name="__codelineno-380-21" href="#__codelineno-380-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-22"><a id="__codelineno-380-22" name="__codelineno-380-22" href="#__codelineno-380-22"></a><span class="w">            </span><span class="c1">-- Character died</span>
</span><span id="__span-380-23"><a id="__codelineno-380-23" name="__codelineno-380-23" href="#__codelineno-380-23"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnCharacterDeath&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-380-24"><a id="__codelineno-380-24" name="__codelineno-380-24" href="#__codelineno-380-24"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-25"><a id="__codelineno-380-25" name="__codelineno-380-25" href="#__codelineno-380-25"></a><span class="w">            </span><span class="c1">-- Character revived</span>
</span><span id="__span-380-26"><a id="__codelineno-380-26" name="__codelineno-380-26" href="#__codelineno-380-26"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnCharacterRevive&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-380-27"><a id="__codelineno-380-27" name="__codelineno-380-27" href="#__codelineno-380-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-28"><a id="__codelineno-380-28" name="__codelineno-380-28" href="#__codelineno-380-28"></a><span class="w">        </span><span class="c1">-- Notify nearby players of health change</span>
</span><span id="__span-380-29"><a id="__codelineno-380-29" name="__codelineno-380-29" href="#__codelineno-380-29"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-380-30"><a id="__codelineno-380-30" name="__codelineno-380-30" href="#__codelineno-380-30"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-31"><a id="__codelineno-380-31" name="__codelineno-380-31" href="#__codelineno-380-31"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;&#39;s health: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">())</span>
</span><span id="__span-380-32"><a id="__codelineno-380-32" name="__codelineno-380-32" href="#__codelineno-380-32"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-380-33"><a id="__codelineno-380-33" name="__codelineno-380-33" href="#__codelineno-380-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-34"><a id="__codelineno-380-34" name="__codelineno-380-34" href="#__codelineno-380-34"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-35"><a id="__codelineno-380-35" name="__codelineno-380-35" href="#__codelineno-380-35"></a><span class="w">        </span><span class="c1">-- Money change effects</span>
</span><span id="__span-380-36"><a id="__codelineno-380-36" name="__codelineno-380-36" href="#__codelineno-380-36"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">oldVar</span>
</span><span id="__span-380-37"><a id="__codelineno-380-37" name="__codelineno-380-37" href="#__codelineno-380-37"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-38"><a id="__codelineno-380-38" name="__codelineno-380-38" href="#__codelineno-380-38"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You gained $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">difference</span><span class="p">)</span>
</span><span id="__span-380-39"><a id="__codelineno-380-39" name="__codelineno-380-39" href="#__codelineno-380-39"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-40"><a id="__codelineno-380-40" name="__codelineno-380-40" href="#__codelineno-380-40"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You lost $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.abs</span><span class="p">(</span><span class="nv">difference</span><span class="p">))</span>
</span><span id="__span-380-41"><a id="__codelineno-380-41" name="__codelineno-380-41" href="#__codelineno-380-41"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-42"><a id="__codelineno-380-42" name="__codelineno-380-42" href="#__codelineno-380-42"></a><span class="w">        </span><span class="c1">-- Check for money milestones</span>
</span><span id="__span-380-43"><a id="__codelineno-380-43" name="__codelineno-380-43" href="#__codelineno-380-43"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-44"><a id="__codelineno-380-44" name="__codelineno-380-44" href="#__codelineno-380-44"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Congratulations! You&#39;ve reached $10,000!&quot;</span><span class="p">)</span>
</span><span id="__span-380-45"><a id="__codelineno-380-45" name="__codelineno-380-45" href="#__codelineno-380-45"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-46"><a id="__codelineno-380-46" name="__codelineno-380-46" href="#__codelineno-380-46"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Congratulations! You&#39;ve reached $100,000!&quot;</span><span class="p">)</span>
</span><span id="__span-380-47"><a id="__codelineno-380-47" name="__codelineno-380-47" href="#__codelineno-380-47"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-48"><a id="__codelineno-380-48" name="__codelineno-380-48" href="#__codelineno-380-48"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-49"><a id="__codelineno-380-49" name="__codelineno-380-49" href="#__codelineno-380-49"></a><span class="w">        </span><span class="c1">-- Level change effects</span>
</span><span id="__span-380-50"><a id="__codelineno-380-50" name="__codelineno-380-50" href="#__codelineno-380-50"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-51"><a id="__codelineno-380-51" name="__codelineno-380-51" href="#__codelineno-380-51"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnPlayerLevelUp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-380-52"><a id="__codelineno-380-52" name="__codelineno-380-52" href="#__codelineno-380-52"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-53"><a id="__codelineno-380-53" name="__codelineno-380-53" href="#__codelineno-380-53"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;faction&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-54"><a id="__codelineno-380-54" name="__codelineno-380-54" href="#__codelineno-380-54"></a><span class="w">        </span><span class="c1">-- Faction change effects</span>
</span><span id="__span-380-55"><a id="__codelineno-380-55" name="__codelineno-380-55" href="#__codelineno-380-55"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetTeam</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-380-56"><a id="__codelineno-380-56" name="__codelineno-380-56" href="#__codelineno-380-56"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Faction changed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-380-57"><a id="__codelineno-380-57" name="__codelineno-380-57" href="#__codelineno-380-57"></a><span class="w">        </span><span class="c1">-- Notify other players</span>
</span><span id="__span-380-58"><a id="__codelineno-380-58" name="__codelineno-380-58" href="#__codelineno-380-58"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-380-59"><a id="__codelineno-380-59" name="__codelineno-380-59" href="#__codelineno-380-59"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-60"><a id="__codelineno-380-60" name="__codelineno-380-60" href="#__codelineno-380-60"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; joined faction: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-380-61"><a id="__codelineno-380-61" name="__codelineno-380-61" href="#__codelineno-380-61"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-380-62"><a id="__codelineno-380-62" name="__codelineno-380-62" href="#__codelineno-380-62"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-380-63"><a id="__codelineno-380-63" name="__codelineno-380-63" href="#__codelineno-380-63"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-380-64"><a id="__codelineno-380-64" name="__codelineno-380-64" href="#__codelineno-380-64"></a><span class="w">    </span><span class="c1">-- Log significant changes</span>
</span><span id="__span-380-65"><a id="__codelineno-380-65" name="__codelineno-380-65" href="#__codelineno-380-65"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">math.abs</span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;faction&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-380-66"><a id="__codelineno-380-66" name="__codelineno-380-66" href="#__codelineno-380-66"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s netvar changed: %s from %s to %s&quot;</span><span class="p">,</span>
</span><span id="__span-380-67"><a id="__codelineno-380-67" name="__codelineno-380-67" href="#__codelineno-380-67"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">oldVar</span><span class="p">),</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">)))</span>
</span><span id="__span-380-68"><a id="__codelineno-380-68" name="__codelineno-380-68" href="#__codelineno-380-68"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-380-69"><a id="__codelineno-380-69" name="__codelineno-380-69" href="#__codelineno-380-69"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharpermakilled">OnCharPermakilled</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character is permanently killed</p>
<p><strong>When Called</strong></p>
<p>When a character is permanently removed from the game</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character being permanently killed</li>
<li><code>client</code> (<em>Player</em>): The player whose character was killed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-381-1"><a id="__codelineno-381-1" name="__codelineno-381-1" href="#__codelineno-381-1"></a><span class="c1">-- Simple: Log permanent character death</span>
</span><span id="__span-381-2"><a id="__codelineno-381-2" name="__codelineno-381-2" href="#__codelineno-381-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharPermakilled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-381-3"><a id="__codelineno-381-3" name="__codelineno-381-3" href="#__codelineno-381-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was permanently killed&quot;</span><span class="p">)</span>
</span><span id="__span-381-4"><a id="__codelineno-381-4" name="__codelineno-381-4" href="#__codelineno-381-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-382-1"><a id="__codelineno-382-1" name="__codelineno-382-1" href="#__codelineno-382-1"></a><span class="c1">-- Medium: Handle permanent death effects</span>
</span><span id="__span-382-2"><a id="__codelineno-382-2" name="__codelineno-382-2" href="#__codelineno-382-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharPermakilled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PermaDeathEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-382-3"><a id="__codelineno-382-3" name="__codelineno-382-3" href="#__codelineno-382-3"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-382-4"><a id="__codelineno-382-4" name="__codelineno-382-4" href="#__codelineno-382-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;permaKilled&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-382-5"><a id="__codelineno-382-5" name="__codelineno-382-5" href="#__codelineno-382-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;permaKillTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-382-6"><a id="__codelineno-382-6" name="__codelineno-382-6" href="#__codelineno-382-6"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-382-7"><a id="__codelineno-382-7" name="__codelineno-382-7" href="#__codelineno-382-7"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-382-8"><a id="__codelineno-382-8" name="__codelineno-382-8" href="#__codelineno-382-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-382-9"><a id="__codelineno-382-9" name="__codelineno-382-9" href="#__codelineno-382-9"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was permanently killed&quot;</span><span class="p">)</span>
</span><span id="__span-382-10"><a id="__codelineno-382-10" name="__codelineno-382-10" href="#__codelineno-382-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-382-11"><a id="__codelineno-382-11" name="__codelineno-382-11" href="#__codelineno-382-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-382-12"><a id="__codelineno-382-12" name="__codelineno-382-12" href="#__codelineno-382-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-383-1"><a id="__codelineno-383-1" name="__codelineno-383-1" href="#__codelineno-383-1"></a><span class="c1">-- High: Complex permanent death system</span>
</span><span id="__span-383-2"><a id="__codelineno-383-2" name="__codelineno-383-2" href="#__codelineno-383-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharPermakilled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPermaDeath&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-383-3"><a id="__codelineno-383-3" name="__codelineno-383-3" href="#__codelineno-383-3"></a><span class="c1">-- Set permanent death data</span>
</span><span id="__span-383-4"><a id="__codelineno-383-4" name="__codelineno-383-4" href="#__codelineno-383-4"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;permaKilled&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-383-5"><a id="__codelineno-383-5" name="__codelineno-383-5" href="#__codelineno-383-5"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;permaKillTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-383-6"><a id="__codelineno-383-6" name="__codelineno-383-6" href="#__codelineno-383-6"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;permaKillReason&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
</span><span id="__span-383-7"><a id="__codelineno-383-7" name="__codelineno-383-7" href="#__codelineno-383-7"></a><span class="c1">-- Clear character inventory</span>
</span><span id="__span-383-8"><a id="__codelineno-383-8" name="__codelineno-383-8" href="#__codelineno-383-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-383-9"><a id="__codelineno-383-9" name="__codelineno-383-9" href="#__codelineno-383-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-10"><a id="__codelineno-383-10" name="__codelineno-383-10" href="#__codelineno-383-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-383-11"><a id="__codelineno-383-11" name="__codelineno-383-11" href="#__codelineno-383-11"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-12"><a id="__codelineno-383-12" name="__codelineno-383-12" href="#__codelineno-383-12"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">remove</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-383-13"><a id="__codelineno-383-13" name="__codelineno-383-13" href="#__codelineno-383-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-383-14"><a id="__codelineno-383-14" name="__codelineno-383-14" href="#__codelineno-383-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-15"><a id="__codelineno-383-15" name="__codelineno-383-15" href="#__codelineno-383-15"></a><span class="c1">-- Clear character money</span>
</span><span id="__span-383-16"><a id="__codelineno-383-16" name="__codelineno-383-16" href="#__codelineno-383-16"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-383-17"><a id="__codelineno-383-17" name="__codelineno-383-17" href="#__codelineno-383-17"></a><span class="c1">-- Clear character attributes</span>
</span><span id="__span-383-18"><a id="__codelineno-383-18" name="__codelineno-383-18" href="#__codelineno-383-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getAttribs</span><span class="p">()</span>
</span><span id="__span-383-19"><a id="__codelineno-383-19" name="__codelineno-383-19" href="#__codelineno-383-19"></a><span class="kr">for</span><span class="w"> </span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">attributes</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-20"><a id="__codelineno-383-20" name="__codelineno-383-20" href="#__codelineno-383-20"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setAttrib</span><span class="p">(</span><span class="nv">attr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-383-21"><a id="__codelineno-383-21" name="__codelineno-383-21" href="#__codelineno-383-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-22"><a id="__codelineno-383-22" name="__codelineno-383-22" href="#__codelineno-383-22"></a><span class="c1">-- Clear character data</span>
</span><span id="__span-383-23"><a id="__codelineno-383-23" name="__codelineno-383-23" href="#__codelineno-383-23"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-383-24"><a id="__codelineno-383-24" name="__codelineno-383-24" href="#__codelineno-383-24"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;experience&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-383-25"><a id="__codelineno-383-25" name="__codelineno-383-25" href="#__codelineno-383-25"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-383-26"><a id="__codelineno-383-26" name="__codelineno-383-26" href="#__codelineno-383-26"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-383-27"><a id="__codelineno-383-27" name="__codelineno-383-27" href="#__codelineno-383-27"></a><span class="c1">-- Check for faction-specific effects</span>
</span><span id="__span-383-28"><a id="__codelineno-383-28" name="__codelineno-383-28" href="#__codelineno-383-28"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-383-29"><a id="__codelineno-383-29" name="__codelineno-383-29" href="#__codelineno-383-29"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-30"><a id="__codelineno-383-30" name="__codelineno-383-30" href="#__codelineno-383-30"></a><span class="w">    </span><span class="c1">-- Police get backup call</span>
</span><span id="__span-383-31"><a id="__codelineno-383-31" name="__codelineno-383-31" href="#__codelineno-383-31"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-32"><a id="__codelineno-383-32" name="__codelineno-383-32" href="#__codelineno-383-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-383-33"><a id="__codelineno-383-33" name="__codelineno-383-33" href="#__codelineno-383-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-34"><a id="__codelineno-383-34" name="__codelineno-383-34" href="#__codelineno-383-34"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[BACKUP] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was permanently killed!&quot;</span><span class="p">)</span>
</span><span id="__span-383-35"><a id="__codelineno-383-35" name="__codelineno-383-35" href="#__codelineno-383-35"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-383-36"><a id="__codelineno-383-36" name="__codelineno-383-36" href="#__codelineno-383-36"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-383-37"><a id="__codelineno-383-37" name="__codelineno-383-37" href="#__codelineno-383-37"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-38"><a id="__codelineno-383-38" name="__codelineno-383-38" href="#__codelineno-383-38"></a><span class="w">    </span><span class="c1">-- Medics get medical alert</span>
</span><span id="__span-383-39"><a id="__codelineno-383-39" name="__codelineno-383-39" href="#__codelineno-383-39"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-40"><a id="__codelineno-383-40" name="__codelineno-383-40" href="#__codelineno-383-40"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-383-41"><a id="__codelineno-383-41" name="__codelineno-383-41" href="#__codelineno-383-41"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-42"><a id="__codelineno-383-42" name="__codelineno-383-42" href="#__codelineno-383-42"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[MEDICAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was permanently killed!&quot;</span><span class="p">)</span>
</span><span id="__span-383-43"><a id="__codelineno-383-43" name="__codelineno-383-43" href="#__codelineno-383-43"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-383-44"><a id="__codelineno-383-44" name="__codelineno-383-44" href="#__codelineno-383-44"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-383-45"><a id="__codelineno-383-45" name="__codelineno-383-45" href="#__codelineno-383-45"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-46"><a id="__codelineno-383-46" name="__codelineno-383-46" href="#__codelineno-383-46"></a><span class="c1">-- Check for active quests</span>
</span><span id="__span-383-47"><a id="__codelineno-383-47" name="__codelineno-383-47" href="#__codelineno-383-47"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeQuests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeQuests&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-383-48"><a id="__codelineno-383-48" name="__codelineno-383-48" href="#__codelineno-383-48"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">quest</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeQuests</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-49"><a id="__codelineno-383-49" name="__codelineno-383-49" href="#__codelineno-383-49"></a><span class="w">    </span><span class="nv">quest</span><span class="p">.</span><span class="py">failed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-383-50"><a id="__codelineno-383-50" name="__codelineno-383-50" href="#__codelineno-383-50"></a><span class="w">    </span><span class="nv">quest</span><span class="p">.</span><span class="py">failTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-383-51"><a id="__codelineno-383-51" name="__codelineno-383-51" href="#__codelineno-383-51"></a><span class="w">    </span><span class="nv">quest</span><span class="p">.</span><span class="py">failReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Character permanently killed&quot;</span>
</span><span id="__span-383-52"><a id="__codelineno-383-52" name="__codelineno-383-52" href="#__codelineno-383-52"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-53"><a id="__codelineno-383-53" name="__codelineno-383-53" href="#__codelineno-383-53"></a><span class="c1">-- Check for active effects</span>
</span><span id="__span-383-54"><a id="__codelineno-383-54" name="__codelineno-383-54" href="#__codelineno-383-54"></a><span class="kd">local</span><span class="w"> </span><span class="nv">activeEffects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;activeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-383-55"><a id="__codelineno-383-55" name="__codelineno-383-55" href="#__codelineno-383-55"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">effect</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">activeEffects</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-56"><a id="__codelineno-383-56" name="__codelineno-383-56" href="#__codelineno-383-56"></a><span class="w">    </span><span class="nv">effect</span><span class="p">.</span><span class="py">paused</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-383-57"><a id="__codelineno-383-57" name="__codelineno-383-57" href="#__codelineno-383-57"></a><span class="w">    </span><span class="nv">effect</span><span class="p">.</span><span class="py">pauseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-383-58"><a id="__codelineno-383-58" name="__codelineno-383-58" href="#__codelineno-383-58"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-59"><a id="__codelineno-383-59" name="__codelineno-383-59" href="#__codelineno-383-59"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-383-60"><a id="__codelineno-383-60" name="__codelineno-383-60" href="#__codelineno-383-60"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-383-61"><a id="__codelineno-383-61" name="__codelineno-383-61" href="#__codelineno-383-61"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-383-62"><a id="__codelineno-383-62" name="__codelineno-383-62" href="#__codelineno-383-62"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was permanently killed&quot;</span><span class="p">)</span>
</span><span id="__span-383-63"><a id="__codelineno-383-63" name="__codelineno-383-63" href="#__codelineno-383-63"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-383-64"><a id="__codelineno-383-64" name="__codelineno-383-64" href="#__codelineno-383-64"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-383-65"><a id="__codelineno-383-65" name="__codelineno-383-65" href="#__codelineno-383-65"></a><span class="c1">-- Log permanent death</span>
</span><span id="__span-383-66"><a id="__codelineno-383-66" name="__codelineno-383-66" href="#__codelineno-383-66"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s was permanently killed (Faction: %s, Level: %d)&quot;</span><span class="p">,</span>
</span><span id="__span-383-67"><a id="__codelineno-383-67" name="__codelineno-383-67" href="#__codelineno-383-67"></a><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-383-68"><a id="__codelineno-383-68" name="__codelineno-383-68" href="#__codelineno-383-68"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharrecognized">OnCharRecognized</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character recognizes another character</p>
<p><strong>When Called</strong></p>
<p>When a character successfully identifies another character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player doing the recognizing</li>
<li><code>target</code> (<em>Player</em>): The player being recognized</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-384-1"><a id="__codelineno-384-1" name="__codelineno-384-1" href="#__codelineno-384-1"></a><span class="c1">-- Simple: Log character recognition</span>
</span><span id="__span-384-2"><a id="__codelineno-384-2" name="__codelineno-384-2" href="#__codelineno-384-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-384-3"><a id="__codelineno-384-3" name="__codelineno-384-3" href="#__codelineno-384-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; recognized &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-384-4"><a id="__codelineno-384-4" name="__codelineno-384-4" href="#__codelineno-384-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-385-1"><a id="__codelineno-385-1" name="__codelineno-385-1" href="#__codelineno-385-1"></a><span class="c1">-- Medium: Handle recognition effects</span>
</span><span id="__span-385-2"><a id="__codelineno-385-2" name="__codelineno-385-2" href="#__codelineno-385-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RecognitionEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-385-3"><a id="__codelineno-385-3" name="__codelineno-385-3" href="#__codelineno-385-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">clientChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-385-4"><a id="__codelineno-385-4" name="__codelineno-385-4" href="#__codelineno-385-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-385-5"><a id="__codelineno-385-5" name="__codelineno-385-5" href="#__codelineno-385-5"></a><span class="kr">if</span><span class="w"> </span><span class="nv">clientChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-385-6"><a id="__codelineno-385-6" name="__codelineno-385-6" href="#__codelineno-385-6"></a><span class="w">    </span><span class="c1">-- Add recognition data</span>
</span><span id="__span-385-7"><a id="__codelineno-385-7" name="__codelineno-385-7" href="#__codelineno-385-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">recognitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;recognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-385-8"><a id="__codelineno-385-8" name="__codelineno-385-8" href="#__codelineno-385-8"></a><span class="w">    </span><span class="nv">recognitions</span><span class="p">[</span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getID</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-385-9"><a id="__codelineno-385-9" name="__codelineno-385-9" href="#__codelineno-385-9"></a><span class="w">    </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">recognitions</span><span class="p">)</span>
</span><span id="__span-385-10"><a id="__codelineno-385-10" name="__codelineno-385-10" href="#__codelineno-385-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You recognized &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-385-11"><a id="__codelineno-385-11" name="__codelineno-385-11" href="#__codelineno-385-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-385-12"><a id="__codelineno-385-12" name="__codelineno-385-12" href="#__codelineno-385-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-386-1"><a id="__codelineno-386-1" name="__codelineno-386-1" href="#__codelineno-386-1"></a><span class="c1">-- High: Complex recognition system</span>
</span><span id="__span-386-2"><a id="__codelineno-386-2" name="__codelineno-386-2" href="#__codelineno-386-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharRecognized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRecognition&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-386-3"><a id="__codelineno-386-3" name="__codelineno-386-3" href="#__codelineno-386-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">clientChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-386-4"><a id="__codelineno-386-4" name="__codelineno-386-4" href="#__codelineno-386-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-386-5"><a id="__codelineno-386-5" name="__codelineno-386-5" href="#__codelineno-386-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">clientChar</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-386-6"><a id="__codelineno-386-6" name="__codelineno-386-6" href="#__codelineno-386-6"></a><span class="w">    </span><span class="c1">-- Add recognition data</span>
</span><span id="__span-386-7"><a id="__codelineno-386-7" name="__codelineno-386-7" href="#__codelineno-386-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">recognitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;recognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-386-8"><a id="__codelineno-386-8" name="__codelineno-386-8" href="#__codelineno-386-8"></a><span class="w">    </span><span class="nv">recognitions</span><span class="p">[</span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getID</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-386-9"><a id="__codelineno-386-9" name="__codelineno-386-9" href="#__codelineno-386-9"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-386-10"><a id="__codelineno-386-10" name="__codelineno-386-10" href="#__codelineno-386-10"></a><span class="w">    </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-386-11"><a id="__codelineno-386-11" name="__codelineno-386-11" href="#__codelineno-386-11"></a><span class="w">    </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-386-12"><a id="__codelineno-386-12" name="__codelineno-386-12" href="#__codelineno-386-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-386-13"><a id="__codelineno-386-13" name="__codelineno-386-13" href="#__codelineno-386-13"></a><span class="w">    </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">recognitions</span><span class="p">)</span>
</span><span id="__span-386-14"><a id="__codelineno-386-14" name="__codelineno-386-14" href="#__codelineno-386-14"></a><span class="w">    </span><span class="c1">-- Check for faction-specific recognition</span>
</span><span id="__span-386-15"><a id="__codelineno-386-15" name="__codelineno-386-15" href="#__codelineno-386-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">clientFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-386-16"><a id="__codelineno-386-16" name="__codelineno-386-16" href="#__codelineno-386-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-386-17"><a id="__codelineno-386-17" name="__codelineno-386-17" href="#__codelineno-386-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">clientFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-18"><a id="__codelineno-386-18" name="__codelineno-386-18" href="#__codelineno-386-18"></a><span class="w">        </span><span class="c1">-- Police recognizing criminal</span>
</span><span id="__span-386-19"><a id="__codelineno-386-19" name="__codelineno-386-19" href="#__codelineno-386-19"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You recognized criminal: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-386-20"><a id="__codelineno-386-20" name="__codelineno-386-20" href="#__codelineno-386-20"></a><span class="w">        </span><span class="c1">-- Notify other police</span>
</span><span id="__span-386-21"><a id="__codelineno-386-21" name="__codelineno-386-21" href="#__codelineno-386-21"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-386-22"><a id="__codelineno-386-22" name="__codelineno-386-22" href="#__codelineno-386-22"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-386-23"><a id="__codelineno-386-23" name="__codelineno-386-23" href="#__codelineno-386-23"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-24"><a id="__codelineno-386-24" name="__codelineno-386-24" href="#__codelineno-386-24"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[POLICE] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; recognized criminal: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-386-25"><a id="__codelineno-386-25" name="__codelineno-386-25" href="#__codelineno-386-25"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-386-26"><a id="__codelineno-386-26" name="__codelineno-386-26" href="#__codelineno-386-26"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-386-27"><a id="__codelineno-386-27" name="__codelineno-386-27" href="#__codelineno-386-27"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">clientFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-28"><a id="__codelineno-386-28" name="__codelineno-386-28" href="#__codelineno-386-28"></a><span class="w">        </span><span class="c1">-- Criminal recognizing police</span>
</span><span id="__span-386-29"><a id="__codelineno-386-29" name="__codelineno-386-29" href="#__codelineno-386-29"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You recognized police officer: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-386-30"><a id="__codelineno-386-30" name="__codelineno-386-30" href="#__codelineno-386-30"></a><span class="w">        </span><span class="c1">-- Notify other criminals</span>
</span><span id="__span-386-31"><a id="__codelineno-386-31" name="__codelineno-386-31" href="#__codelineno-386-31"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-386-32"><a id="__codelineno-386-32" name="__codelineno-386-32" href="#__codelineno-386-32"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-386-33"><a id="__codelineno-386-33" name="__codelineno-386-33" href="#__codelineno-386-33"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-34"><a id="__codelineno-386-34" name="__codelineno-386-34" href="#__codelineno-386-34"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[CRIMINAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; recognized police: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-386-35"><a id="__codelineno-386-35" name="__codelineno-386-35" href="#__codelineno-386-35"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-386-36"><a id="__codelineno-386-36" name="__codelineno-386-36" href="#__codelineno-386-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-386-37"><a id="__codelineno-386-37" name="__codelineno-386-37" href="#__codelineno-386-37"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-386-38"><a id="__codelineno-386-38" name="__codelineno-386-38" href="#__codelineno-386-38"></a><span class="w">        </span><span class="c1">-- General recognition</span>
</span><span id="__span-386-39"><a id="__codelineno-386-39" name="__codelineno-386-39" href="#__codelineno-386-39"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You recognized &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-386-40"><a id="__codelineno-386-40" name="__codelineno-386-40" href="#__codelineno-386-40"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-386-41"><a id="__codelineno-386-41" name="__codelineno-386-41" href="#__codelineno-386-41"></a><span class="w">    </span><span class="c1">-- Check for recognition achievements</span>
</span><span id="__span-386-42"><a id="__codelineno-386-42" name="__codelineno-386-42" href="#__codelineno-386-42"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">recognitionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;recognitionCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-386-43"><a id="__codelineno-386-43" name="__codelineno-386-43" href="#__codelineno-386-43"></a><span class="w">    </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recognitionCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">recognitionCount</span><span class="p">)</span>
</span><span id="__span-386-44"><a id="__codelineno-386-44" name="__codelineno-386-44" href="#__codelineno-386-44"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">recognitionCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_recognizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-45"><a id="__codelineno-386-45" name="__codelineno-386-45" href="#__codelineno-386-45"></a><span class="w">        </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_recognizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-386-46"><a id="__codelineno-386-46" name="__codelineno-386-46" href="#__codelineno-386-46"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Recognizer!&quot;</span><span class="p">)</span>
</span><span id="__span-386-47"><a id="__codelineno-386-47" name="__codelineno-386-47" href="#__codelineno-386-47"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-386-48"><a id="__codelineno-386-48" name="__codelineno-386-48" href="#__codelineno-386-48"></a><span class="w">    </span><span class="c1">-- Check for faction recognition achievements</span>
</span><span id="__span-386-49"><a id="__codelineno-386-49" name="__codelineno-386-49" href="#__codelineno-386-49"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionRecognitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;factionRecognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-386-50"><a id="__codelineno-386-50" name="__codelineno-386-50" href="#__codelineno-386-50"></a><span class="w">    </span><span class="nv">factionRecognitions</span><span class="p">[</span><span class="nv">targetFaction</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">factionRecognitions</span><span class="p">[</span><span class="nv">targetFaction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-386-51"><a id="__codelineno-386-51" name="__codelineno-386-51" href="#__codelineno-386-51"></a><span class="w">    </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;factionRecognitions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">factionRecognitions</span><span class="p">)</span>
</span><span id="__span-386-52"><a id="__codelineno-386-52" name="__codelineno-386-52" href="#__codelineno-386-52"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">factionRecognitions</span><span class="p">[</span><span class="nv">targetFaction</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_faction_recognizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-386-53"><a id="__codelineno-386-53" name="__codelineno-386-53" href="#__codelineno-386-53"></a><span class="w">        </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_faction_recognizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-386-54"><a id="__codelineno-386-54" name="__codelineno-386-54" href="#__codelineno-386-54"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Faction Recognizer!&quot;</span><span class="p">)</span>
</span><span id="__span-386-55"><a id="__codelineno-386-55" name="__codelineno-386-55" href="#__codelineno-386-55"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-386-56"><a id="__codelineno-386-56" name="__codelineno-386-56" href="#__codelineno-386-56"></a><span class="w">    </span><span class="c1">-- Log recognition</span>
</span><span id="__span-386-57"><a id="__codelineno-386-57" name="__codelineno-386-57" href="#__codelineno-386-57"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s recognized %s (Factions: %s -&gt; %s)&quot;</span><span class="p">,</span>
</span><span id="__span-386-58"><a id="__codelineno-386-58" name="__codelineno-386-58" href="#__codelineno-386-58"></a><span class="w">    </span><span class="nv">clientChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">clientFaction</span><span class="p">,</span><span class="w"> </span><span class="nv">targetFaction</span><span class="p">))</span>
</span><span id="__span-386-59"><a id="__codelineno-386-59" name="__codelineno-386-59" href="#__codelineno-386-59"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onchartradevendor">OnCharTradeVendor</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character trades with a vendor</p>
<p><strong>When Called</strong></p>
<p>When a character buys or sells items to/from a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player trading with the vendor</li>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>item</code> (<em>Item</em>): The item being traded</li>
<li><code>isSellingToVendor</code> (<em>boolean</em>): True if selling to vendor, false if buying</li>
<li><code>character</code> (<em>Character</em>): The character doing the trading</li>
<li><code>itemType</code> (<em>string</em>): The type of item being traded</li>
<li><code>isFailed</code> (<em>boolean</em>): Whether the trade failed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-387-1"><a id="__codelineno-387-1" name="__codelineno-387-1" href="#__codelineno-387-1"></a><span class="c1">-- Simple: Log vendor trades</span>
</span><span id="__span-387-2"><a id="__codelineno-387-2" name="__codelineno-387-2" href="#__codelineno-387-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharTradeVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isFailed</span><span class="p">)</span>
</span><span id="__span-387-3"><a id="__codelineno-387-3" name="__codelineno-387-3" href="#__codelineno-387-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;sold&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;bought&quot;</span>
</span><span id="__span-387-4"><a id="__codelineno-387-4" name="__codelineno-387-4" href="#__codelineno-387-4"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; from vendor&quot;</span><span class="p">)</span>
</span><span id="__span-387-5"><a id="__codelineno-387-5" name="__codelineno-387-5" href="#__codelineno-387-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-388-1"><a id="__codelineno-388-1" name="__codelineno-388-1" href="#__codelineno-388-1"></a><span class="c1">-- Medium: Track trade statistics</span>
</span><span id="__span-388-2"><a id="__codelineno-388-2" name="__codelineno-388-2" href="#__codelineno-388-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharTradeVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TradeTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isFailed</span><span class="p">)</span>
</span><span id="__span-388-3"><a id="__codelineno-388-3" name="__codelineno-388-3" href="#__codelineno-388-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">isFailed</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-388-4"><a id="__codelineno-388-4" name="__codelineno-388-4" href="#__codelineno-388-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-388-5"><a id="__codelineno-388-5" name="__codelineno-388-5" href="#__codelineno-388-5"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">trades</span><span class="p">)</span>
</span><span id="__span-388-6"><a id="__codelineno-388-6" name="__codelineno-388-6" href="#__codelineno-388-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;sold&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;bought&quot;</span>
</span><span id="__span-388-7"><a id="__codelineno-388-7" name="__codelineno-388-7" href="#__codelineno-388-7"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; from vendor&quot;</span><span class="p">)</span>
</span><span id="__span-388-8"><a id="__codelineno-388-8" name="__codelineno-388-8" href="#__codelineno-388-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-388-9"><a id="__codelineno-388-9" name="__codelineno-388-9" href="#__codelineno-388-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-389-1"><a id="__codelineno-389-1" name="__codelineno-389-1" href="#__codelineno-389-1"></a><span class="c1">-- High: Complex vendor trading system</span>
</span><span id="__span-389-2"><a id="__codelineno-389-2" name="__codelineno-389-2" href="#__codelineno-389-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharTradeVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorTrading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isFailed</span><span class="p">)</span>
</span><span id="__span-389-3"><a id="__codelineno-389-3" name="__codelineno-389-3" href="#__codelineno-389-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">isFailed</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-4"><a id="__codelineno-389-4" name="__codelineno-389-4" href="#__codelineno-389-4"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Trade failed!&quot;</span><span class="p">)</span>
</span><span id="__span-389-5"><a id="__codelineno-389-5" name="__codelineno-389-5" href="#__codelineno-389-5"></a><span class="w">    </span><span class="kr">return</span>
</span><span id="__span-389-6"><a id="__codelineno-389-6" name="__codelineno-389-6" href="#__codelineno-389-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-389-7"><a id="__codelineno-389-7" name="__codelineno-389-7" href="#__codelineno-389-7"></a><span class="c1">-- Update trade statistics</span>
</span><span id="__span-389-8"><a id="__codelineno-389-8" name="__codelineno-389-8" href="#__codelineno-389-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-389-9"><a id="__codelineno-389-9" name="__codelineno-389-9" href="#__codelineno-389-9"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">trades</span><span class="p">)</span>
</span><span id="__span-389-10"><a id="__codelineno-389-10" name="__codelineno-389-10" href="#__codelineno-389-10"></a><span class="c1">-- Update vendor statistics</span>
</span><span id="__span-389-11"><a id="__codelineno-389-11" name="__codelineno-389-11" href="#__codelineno-389-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-389-12"><a id="__codelineno-389-12" name="__codelineno-389-12" href="#__codelineno-389-12"></a><span class="nv">vendorData</span><span class="p">.</span><span class="py">tradeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">vendorData</span><span class="p">.</span><span class="py">tradeCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-389-13"><a id="__codelineno-389-13" name="__codelineno-389-13" href="#__codelineno-389-13"></a><span class="nv">vendorData</span><span class="p">.</span><span class="py">lastTrade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-389-14"><a id="__codelineno-389-14" name="__codelineno-389-14" href="#__codelineno-389-14"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-389-15"><a id="__codelineno-389-15" name="__codelineno-389-15" href="#__codelineno-389-15"></a><span class="c1">-- Check for trade achievements</span>
</span><span id="__span-389-16"><a id="__codelineno-389-16" name="__codelineno-389-16" href="#__codelineno-389-16"></a><span class="kr">if</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_trader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-17"><a id="__codelineno-389-17" name="__codelineno-389-17" href="#__codelineno-389-17"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_trader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-389-18"><a id="__codelineno-389-18" name="__codelineno-389-18" href="#__codelineno-389-18"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Trader!&quot;</span><span class="p">)</span>
</span><span id="__span-389-19"><a id="__codelineno-389-19" name="__codelineno-389-19" href="#__codelineno-389-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-389-20"><a id="__codelineno-389-20" name="__codelineno-389-20" href="#__codelineno-389-20"></a><span class="c1">-- Check for faction-specific trading</span>
</span><span id="__span-389-21"><a id="__codelineno-389-21" name="__codelineno-389-21" href="#__codelineno-389-21"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-389-22"><a id="__codelineno-389-22" name="__codelineno-389-22" href="#__codelineno-389-22"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-23"><a id="__codelineno-389-23" name="__codelineno-389-23" href="#__codelineno-389-23"></a><span class="w">    </span><span class="c1">-- Police selling items - check for contraband</span>
</span><span id="__span-389-24"><a id="__codelineno-389-24" name="__codelineno-389-24" href="#__codelineno-389-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;drug&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-25"><a id="__codelineno-389-25" name="__codelineno-389-25" href="#__codelineno-389-25"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning: Selling contraband as police officer!&quot;</span><span class="p">)</span>
</span><span id="__span-389-26"><a id="__codelineno-389-26" name="__codelineno-389-26" href="#__codelineno-389-26"></a><span class="w">        </span><span class="c1">-- Notify other police</span>
</span><span id="__span-389-27"><a id="__codelineno-389-27" name="__codelineno-389-27" href="#__codelineno-389-27"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-389-28"><a id="__codelineno-389-28" name="__codelineno-389-28" href="#__codelineno-389-28"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-389-29"><a id="__codelineno-389-29" name="__codelineno-389-29" href="#__codelineno-389-29"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-30"><a id="__codelineno-389-30" name="__codelineno-389-30" href="#__codelineno-389-30"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[POLICE] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; sold contraband: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-389-31"><a id="__codelineno-389-31" name="__codelineno-389-31" href="#__codelineno-389-31"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-389-32"><a id="__codelineno-389-32" name="__codelineno-389-32" href="#__codelineno-389-32"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-389-33"><a id="__codelineno-389-33" name="__codelineno-389-33" href="#__codelineno-389-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-389-34"><a id="__codelineno-389-34" name="__codelineno-389-34" href="#__codelineno-389-34"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-35"><a id="__codelineno-389-35" name="__codelineno-389-35" href="#__codelineno-389-35"></a><span class="w">    </span><span class="c1">-- Criminal buying items - check for weapons</span>
</span><span id="__span-389-36"><a id="__codelineno-389-36" name="__codelineno-389-36" href="#__codelineno-389-36"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-37"><a id="__codelineno-389-37" name="__codelineno-389-37" href="#__codelineno-389-37"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You purchased a weapon from the vendor&quot;</span><span class="p">)</span>
</span><span id="__span-389-38"><a id="__codelineno-389-38" name="__codelineno-389-38" href="#__codelineno-389-38"></a><span class="w">        </span><span class="c1">-- Notify other criminals</span>
</span><span id="__span-389-39"><a id="__codelineno-389-39" name="__codelineno-389-39" href="#__codelineno-389-39"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-389-40"><a id="__codelineno-389-40" name="__codelineno-389-40" href="#__codelineno-389-40"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-389-41"><a id="__codelineno-389-41" name="__codelineno-389-41" href="#__codelineno-389-41"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-42"><a id="__codelineno-389-42" name="__codelineno-389-42" href="#__codelineno-389-42"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[CRIMINAL] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; bought weapon: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-389-43"><a id="__codelineno-389-43" name="__codelineno-389-43" href="#__codelineno-389-43"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-389-44"><a id="__codelineno-389-44" name="__codelineno-389-44" href="#__codelineno-389-44"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-389-45"><a id="__codelineno-389-45" name="__codelineno-389-45" href="#__codelineno-389-45"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-389-46"><a id="__codelineno-389-46" name="__codelineno-389-46" href="#__codelineno-389-46"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-389-47"><a id="__codelineno-389-47" name="__codelineno-389-47" href="#__codelineno-389-47"></a><span class="c1">-- Check for bulk trading</span>
</span><span id="__span-389-48"><a id="__codelineno-389-48" name="__codelineno-389-48" href="#__codelineno-389-48"></a><span class="kd">local</span><span class="w"> </span><span class="nv">recentTrades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;recentTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-389-49"><a id="__codelineno-389-49" name="__codelineno-389-49" href="#__codelineno-389-49"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">recentTrades</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-389-50"><a id="__codelineno-389-50" name="__codelineno-389-50" href="#__codelineno-389-50"></a><span class="c1">-- Remove trades older than 1 hour</span>
</span><span id="__span-389-51"><a id="__codelineno-389-51" name="__codelineno-389-51" href="#__codelineno-389-51"></a><span class="kd">local</span><span class="w"> </span><span class="nv">cutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3600</span>
</span><span id="__span-389-52"><a id="__codelineno-389-52" name="__codelineno-389-52" href="#__codelineno-389-52"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="nv">recentTrades</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-389-53"><a id="__codelineno-389-53" name="__codelineno-389-53" href="#__codelineno-389-53"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">recentTrades</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">cutoff</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-54"><a id="__codelineno-389-54" name="__codelineno-389-54" href="#__codelineno-389-54"></a><span class="w">        </span><span class="nb">table.remove</span><span class="p">(</span><span class="nv">recentTrades</span><span class="p">,</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
</span><span id="__span-389-55"><a id="__codelineno-389-55" name="__codelineno-389-55" href="#__codelineno-389-55"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-389-56"><a id="__codelineno-389-56" name="__codelineno-389-56" href="#__codelineno-389-56"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-389-57"><a id="__codelineno-389-57" name="__codelineno-389-57" href="#__codelineno-389-57"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;recentTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">recentTrades</span><span class="p">)</span>
</span><span id="__span-389-58"><a id="__codelineno-389-58" name="__codelineno-389-58" href="#__codelineno-389-58"></a><span class="c1">-- Check for bulk trading achievement</span>
</span><span id="__span-389-59"><a id="__codelineno-389-59" name="__codelineno-389-59" href="#__codelineno-389-59"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">recentTrades</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_bulk_trader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-389-60"><a id="__codelineno-389-60" name="__codelineno-389-60" href="#__codelineno-389-60"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_bulk_trader&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-389-61"><a id="__codelineno-389-61" name="__codelineno-389-61" href="#__codelineno-389-61"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Bulk Trader!&quot;</span><span class="p">)</span>
</span><span id="__span-389-62"><a id="__codelineno-389-62" name="__codelineno-389-62" href="#__codelineno-389-62"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-389-63"><a id="__codelineno-389-63" name="__codelineno-389-63" href="#__codelineno-389-63"></a><span class="c1">-- Log trade</span>
</span><span id="__span-389-64"><a id="__codelineno-389-64" name="__codelineno-389-64" href="#__codelineno-389-64"></a><span class="kd">local</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;sold&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;bought&quot;</span>
</span><span id="__span-389-65"><a id="__codelineno-389-65" name="__codelineno-389-65" href="#__codelineno-389-65"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s %s %s from vendor %s (Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-389-66"><a id="__codelineno-389-66" name="__codelineno-389-66" href="#__codelineno-389-66"></a><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">))</span>
</span><span id="__span-389-67"><a id="__codelineno-389-67" name="__codelineno-389-67" href="#__codelineno-389-67"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncharvarchanged">OnCharVarChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a character's variable changes</p>
<p><strong>When Called</strong></p>
<p>When a character's data variable is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>character</code> (<em>Character</em>): The character whose variable changed</li>
<li><code>varName</code> (<em>string</em>): The name of the variable that changed</li>
<li><code>oldVar</code> (<em>any</em>): The previous value of the variable</li>
<li><code>newVar</code> (<em>any</em>): The new value of the variable</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-390-1"><a id="__codelineno-390-1" name="__codelineno-390-1" href="#__codelineno-390-1"></a><span class="c1">-- Simple: Log variable changes</span>
</span><span id="__span-390-2"><a id="__codelineno-390-2" name="__codelineno-390-2" href="#__codelineno-390-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">varName</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-390-3"><a id="__codelineno-390-3" name="__codelineno-390-3" href="#__codelineno-390-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; var changed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">newVar</span><span class="p">))</span>
</span><span id="__span-390-4"><a id="__codelineno-390-4" name="__codelineno-390-4" href="#__codelineno-390-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-391-1"><a id="__codelineno-391-1" name="__codelineno-391-1" href="#__codelineno-391-1"></a><span class="c1">-- Medium: Track specific variable changes</span>
</span><span id="__span-391-2"><a id="__codelineno-391-2" name="__codelineno-391-2" href="#__codelineno-391-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VarTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">varName</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-391-3"><a id="__codelineno-391-3" name="__codelineno-391-3" href="#__codelineno-391-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-4"><a id="__codelineno-391-4" name="__codelineno-391-4" href="#__codelineno-391-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-391-5"><a id="__codelineno-391-5" name="__codelineno-391-5" href="#__codelineno-391-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-6"><a id="__codelineno-391-6" name="__codelineno-391-6" href="#__codelineno-391-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Level changed from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-391-7"><a id="__codelineno-391-7" name="__codelineno-391-7" href="#__codelineno-391-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-391-8"><a id="__codelineno-391-8" name="__codelineno-391-8" href="#__codelineno-391-8"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-9"><a id="__codelineno-391-9" name="__codelineno-391-9" href="#__codelineno-391-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-391-10"><a id="__codelineno-391-10" name="__codelineno-391-10" href="#__codelineno-391-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-11"><a id="__codelineno-391-11" name="__codelineno-391-11" href="#__codelineno-391-11"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">oldVar</span>
</span><span id="__span-391-12"><a id="__codelineno-391-12" name="__codelineno-391-12" href="#__codelineno-391-12"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-13"><a id="__codelineno-391-13" name="__codelineno-391-13" href="#__codelineno-391-13"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You gained $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">difference</span><span class="p">)</span>
</span><span id="__span-391-14"><a id="__codelineno-391-14" name="__codelineno-391-14" href="#__codelineno-391-14"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-391-15"><a id="__codelineno-391-15" name="__codelineno-391-15" href="#__codelineno-391-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You lost $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.abs</span><span class="p">(</span><span class="nv">difference</span><span class="p">))</span>
</span><span id="__span-391-16"><a id="__codelineno-391-16" name="__codelineno-391-16" href="#__codelineno-391-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-391-17"><a id="__codelineno-391-17" name="__codelineno-391-17" href="#__codelineno-391-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-391-18"><a id="__codelineno-391-18" name="__codelineno-391-18" href="#__codelineno-391-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-391-19"><a id="__codelineno-391-19" name="__codelineno-391-19" href="#__codelineno-391-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-392-1"><a id="__codelineno-392-1" name="__codelineno-392-1" href="#__codelineno-392-1"></a><span class="c1">-- High: Complex variable change system</span>
</span><span id="__span-392-2"><a id="__codelineno-392-2" name="__codelineno-392-2" href="#__codelineno-392-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCharVarChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVarChange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">varName</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-392-3"><a id="__codelineno-392-3" name="__codelineno-392-3" href="#__codelineno-392-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-392-4"><a id="__codelineno-392-4" name="__codelineno-392-4" href="#__codelineno-392-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-392-5"><a id="__codelineno-392-5" name="__codelineno-392-5" href="#__codelineno-392-5"></a><span class="w">    </span><span class="c1">-- Track variable change history</span>
</span><span id="__span-392-6"><a id="__codelineno-392-6" name="__codelineno-392-6" href="#__codelineno-392-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">changeHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;varHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-392-7"><a id="__codelineno-392-7" name="__codelineno-392-7" href="#__codelineno-392-7"></a><span class="w">    </span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">varName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">varName</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-392-8"><a id="__codelineno-392-8" name="__codelineno-392-8" href="#__codelineno-392-8"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">varName</span><span class="p">],</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-392-9"><a id="__codelineno-392-9" name="__codelineno-392-9" href="#__codelineno-392-9"></a><span class="w">    </span><span class="nv">oldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span>
</span><span id="__span-392-10"><a id="__codelineno-392-10" name="__codelineno-392-10" href="#__codelineno-392-10"></a><span class="w">    </span><span class="nv">newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newVar</span><span class="p">,</span>
</span><span id="__span-392-11"><a id="__codelineno-392-11" name="__codelineno-392-11" href="#__codelineno-392-11"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-392-12"><a id="__codelineno-392-12" name="__codelineno-392-12" href="#__codelineno-392-12"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-392-13"><a id="__codelineno-392-13" name="__codelineno-392-13" href="#__codelineno-392-13"></a><span class="w">    </span><span class="c1">-- Keep only last 20 changes per variable</span>
</span><span id="__span-392-14"><a id="__codelineno-392-14" name="__codelineno-392-14" href="#__codelineno-392-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">varName</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-15"><a id="__codelineno-392-15" name="__codelineno-392-15" href="#__codelineno-392-15"></a><span class="w">        </span><span class="nb">table.remove</span><span class="p">(</span><span class="nv">changeHistory</span><span class="p">[</span><span class="nv">varName</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-392-16"><a id="__codelineno-392-16" name="__codelineno-392-16" href="#__codelineno-392-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-392-17"><a id="__codelineno-392-17" name="__codelineno-392-17" href="#__codelineno-392-17"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;varHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">changeHistory</span><span class="p">)</span>
</span><span id="__span-392-18"><a id="__codelineno-392-18" name="__codelineno-392-18" href="#__codelineno-392-18"></a><span class="w">    </span><span class="c1">-- Handle specific variable changes</span>
</span><span id="__span-392-19"><a id="__codelineno-392-19" name="__codelineno-392-19" href="#__codelineno-392-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-20"><a id="__codelineno-392-20" name="__codelineno-392-20" href="#__codelineno-392-20"></a><span class="w">        </span><span class="c1">-- Level change effects</span>
</span><span id="__span-392-21"><a id="__codelineno-392-21" name="__codelineno-392-21" href="#__codelineno-392-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-22"><a id="__codelineno-392-22" name="__codelineno-392-22" href="#__codelineno-392-22"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnPlayerLevelUp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">,</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-392-23"><a id="__codelineno-392-23" name="__codelineno-392-23" href="#__codelineno-392-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-24"><a id="__codelineno-392-24" name="__codelineno-392-24" href="#__codelineno-392-24"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-25"><a id="__codelineno-392-25" name="__codelineno-392-25" href="#__codelineno-392-25"></a><span class="w">        </span><span class="c1">-- Money change effects</span>
</span><span id="__span-392-26"><a id="__codelineno-392-26" name="__codelineno-392-26" href="#__codelineno-392-26"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">oldVar</span>
</span><span id="__span-392-27"><a id="__codelineno-392-27" name="__codelineno-392-27" href="#__codelineno-392-27"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-28"><a id="__codelineno-392-28" name="__codelineno-392-28" href="#__codelineno-392-28"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You gained $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">difference</span><span class="p">)</span>
</span><span id="__span-392-29"><a id="__codelineno-392-29" name="__codelineno-392-29" href="#__codelineno-392-29"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">difference</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-30"><a id="__codelineno-392-30" name="__codelineno-392-30" href="#__codelineno-392-30"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You lost $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.abs</span><span class="p">(</span><span class="nv">difference</span><span class="p">))</span>
</span><span id="__span-392-31"><a id="__codelineno-392-31" name="__codelineno-392-31" href="#__codelineno-392-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-32"><a id="__codelineno-392-32" name="__codelineno-392-32" href="#__codelineno-392-32"></a><span class="w">        </span><span class="c1">-- Check for money milestones</span>
</span><span id="__span-392-33"><a id="__codelineno-392-33" name="__codelineno-392-33" href="#__codelineno-392-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-34"><a id="__codelineno-392-34" name="__codelineno-392-34" href="#__codelineno-392-34"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Congratulations! You&#39;ve reached $10,000!&quot;</span><span class="p">)</span>
</span><span id="__span-392-35"><a id="__codelineno-392-35" name="__codelineno-392-35" href="#__codelineno-392-35"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-36"><a id="__codelineno-392-36" name="__codelineno-392-36" href="#__codelineno-392-36"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Congratulations! You&#39;ve reached $100,000!&quot;</span><span class="p">)</span>
</span><span id="__span-392-37"><a id="__codelineno-392-37" name="__codelineno-392-37" href="#__codelineno-392-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-38"><a id="__codelineno-392-38" name="__codelineno-392-38" href="#__codelineno-392-38"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;faction&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-39"><a id="__codelineno-392-39" name="__codelineno-392-39" href="#__codelineno-392-39"></a><span class="w">        </span><span class="c1">-- Faction change effects</span>
</span><span id="__span-392-40"><a id="__codelineno-392-40" name="__codelineno-392-40" href="#__codelineno-392-40"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetTeam</span><span class="p">(</span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-392-41"><a id="__codelineno-392-41" name="__codelineno-392-41" href="#__codelineno-392-41"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Faction changed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-392-42"><a id="__codelineno-392-42" name="__codelineno-392-42" href="#__codelineno-392-42"></a><span class="w">        </span><span class="c1">-- Notify other players</span>
</span><span id="__span-392-43"><a id="__codelineno-392-43" name="__codelineno-392-43" href="#__codelineno-392-43"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-392-44"><a id="__codelineno-392-44" name="__codelineno-392-44" href="#__codelineno-392-44"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-45"><a id="__codelineno-392-45" name="__codelineno-392-45" href="#__codelineno-392-45"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; joined faction: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newVar</span><span class="p">)</span>
</span><span id="__span-392-46"><a id="__codelineno-392-46" name="__codelineno-392-46" href="#__codelineno-392-46"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-392-47"><a id="__codelineno-392-47" name="__codelineno-392-47" href="#__codelineno-392-47"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-48"><a id="__codelineno-392-48" name="__codelineno-392-48" href="#__codelineno-392-48"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-49"><a id="__codelineno-392-49" name="__codelineno-392-49" href="#__codelineno-392-49"></a><span class="w">        </span><span class="c1">-- Health change effects</span>
</span><span id="__span-392-50"><a id="__codelineno-392-50" name="__codelineno-392-50" href="#__codelineno-392-50"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-51"><a id="__codelineno-392-51" name="__codelineno-392-51" href="#__codelineno-392-51"></a><span class="w">            </span><span class="c1">-- Character died</span>
</span><span id="__span-392-52"><a id="__codelineno-392-52" name="__codelineno-392-52" href="#__codelineno-392-52"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnCharacterDeath&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-392-53"><a id="__codelineno-392-53" name="__codelineno-392-53" href="#__codelineno-392-53"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-54"><a id="__codelineno-392-54" name="__codelineno-392-54" href="#__codelineno-392-54"></a><span class="w">            </span><span class="c1">-- Character revived</span>
</span><span id="__span-392-55"><a id="__codelineno-392-55" name="__codelineno-392-55" href="#__codelineno-392-55"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;OnCharacterRevive&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-392-56"><a id="__codelineno-392-56" name="__codelineno-392-56" href="#__codelineno-392-56"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-57"><a id="__codelineno-392-57" name="__codelineno-392-57" href="#__codelineno-392-57"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stamina&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-58"><a id="__codelineno-392-58" name="__codelineno-392-58" href="#__codelineno-392-58"></a><span class="w">        </span><span class="c1">-- Stamina change effects</span>
</span><span id="__span-392-59"><a id="__codelineno-392-59" name="__codelineno-392-59" href="#__codelineno-392-59"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-60"><a id="__codelineno-392-60" name="__codelineno-392-60" href="#__codelineno-392-60"></a><span class="w">            </span><span class="c1">-- Stamina depleted</span>
</span><span id="__span-392-61"><a id="__codelineno-392-61" name="__codelineno-392-61" href="#__codelineno-392-61"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;PlayerStaminaDepleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-392-62"><a id="__codelineno-392-62" name="__codelineno-392-62" href="#__codelineno-392-62"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">newVar</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">oldVar</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-63"><a id="__codelineno-392-63" name="__codelineno-392-63" href="#__codelineno-392-63"></a><span class="w">            </span><span class="c1">-- Stamina restored</span>
</span><span id="__span-392-64"><a id="__codelineno-392-64" name="__codelineno-392-64" href="#__codelineno-392-64"></a><span class="w">            </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;PlayerStaminaGained&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-392-65"><a id="__codelineno-392-65" name="__codelineno-392-65" href="#__codelineno-392-65"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-392-66"><a id="__codelineno-392-66" name="__codelineno-392-66" href="#__codelineno-392-66"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-392-67"><a id="__codelineno-392-67" name="__codelineno-392-67" href="#__codelineno-392-67"></a><span class="w">    </span><span class="c1">-- Log significant changes</span>
</span><span id="__span-392-68"><a id="__codelineno-392-68" name="__codelineno-392-68" href="#__codelineno-392-68"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">math.abs</span><span class="p">(</span><span class="nv">newVar</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">oldVar</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;faction&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">varName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;level&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-392-69"><a id="__codelineno-392-69" name="__codelineno-392-69" href="#__codelineno-392-69"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s var changed: %s from %s to %s&quot;</span><span class="p">,</span>
</span><span id="__span-392-70"><a id="__codelineno-392-70" name="__codelineno-392-70" href="#__codelineno-392-70"></a><span class="w">        </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">varName</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">oldVar</span><span class="p">),</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">newVar</span><span class="p">)))</span>
</span><span id="__span-392-71"><a id="__codelineno-392-71" name="__codelineno-392-71" href="#__codelineno-392-71"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-392-72"><a id="__codelineno-392-72" name="__codelineno-392-72" href="#__codelineno-392-72"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncheatercaught">OnCheaterCaught</h3>
<p><strong>Purpose</strong></p>
<p>Called when a cheater is caught</p>
<p><strong>When Called</strong></p>
<p>When anti-cheat systems detect cheating behavior</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who was caught cheating</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-393-1"><a id="__codelineno-393-1" name="__codelineno-393-1" href="#__codelineno-393-1"></a><span class="c1">-- Simple: Log cheater detection</span>
</span><span id="__span-393-2"><a id="__codelineno-393-2" name="__codelineno-393-2" href="#__codelineno-393-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterCaught&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-393-3"><a id="__codelineno-393-3" name="__codelineno-393-3" href="#__codelineno-393-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cheater caught: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-393-4"><a id="__codelineno-393-4" name="__codelineno-393-4" href="#__codelineno-393-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-394-1"><a id="__codelineno-394-1" name="__codelineno-394-1" href="#__codelineno-394-1"></a><span class="c1">-- Medium: Handle cheater punishment</span>
</span><span id="__span-394-2"><a id="__codelineno-394-2" name="__codelineno-394-2" href="#__codelineno-394-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterCaught&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CheaterPunishment&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-394-3"><a id="__codelineno-394-3" name="__codelineno-394-3" href="#__codelineno-394-3"></a><span class="c1">-- Kick the cheater</span>
</span><span id="__span-394-4"><a id="__codelineno-394-4" name="__codelineno-394-4" href="#__codelineno-394-4"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Cheating detected&quot;</span><span class="p">)</span>
</span><span id="__span-394-5"><a id="__codelineno-394-5" name="__codelineno-394-5" href="#__codelineno-394-5"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-394-6"><a id="__codelineno-394-6" name="__codelineno-394-6" href="#__codelineno-394-6"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-394-7"><a id="__codelineno-394-7" name="__codelineno-394-7" href="#__codelineno-394-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-394-8"><a id="__codelineno-394-8" name="__codelineno-394-8" href="#__codelineno-394-8"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] Cheater caught: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-394-9"><a id="__codelineno-394-9" name="__codelineno-394-9" href="#__codelineno-394-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-394-10"><a id="__codelineno-394-10" name="__codelineno-394-10" href="#__codelineno-394-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-394-11"><a id="__codelineno-394-11" name="__codelineno-394-11" href="#__codelineno-394-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-395-1"><a id="__codelineno-395-1" name="__codelineno-395-1" href="#__codelineno-395-1"></a><span class="c1">-- High: Complex anti-cheat system</span>
</span><span id="__span-395-2"><a id="__codelineno-395-2" name="__codelineno-395-2" href="#__codelineno-395-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterCaught&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAntiCheat&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-395-3"><a id="__codelineno-395-3" name="__codelineno-395-3" href="#__codelineno-395-3"></a><span class="c1">-- Get cheater data</span>
</span><span id="__span-395-4"><a id="__codelineno-395-4" name="__codelineno-395-4" href="#__codelineno-395-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-395-5"><a id="__codelineno-395-5" name="__codelineno-395-5" href="#__codelineno-395-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">steamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span>
</span><span id="__span-395-6"><a id="__codelineno-395-6" name="__codelineno-395-6" href="#__codelineno-395-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IPAddress</span><span class="p">()</span>
</span><span id="__span-395-7"><a id="__codelineno-395-7" name="__codelineno-395-7" href="#__codelineno-395-7"></a><span class="c1">-- Log cheater information</span>
</span><span id="__span-395-8"><a id="__codelineno-395-8" name="__codelineno-395-8" href="#__codelineno-395-8"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Cheater caught: %s (SteamID: %s, IP: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-395-9"><a id="__codelineno-395-9" name="__codelineno-395-9" href="#__codelineno-395-9"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">ip</span><span class="p">))</span>
</span><span id="__span-395-10"><a id="__codelineno-395-10" name="__codelineno-395-10" href="#__codelineno-395-10"></a><span class="c1">-- Add to cheater database</span>
</span><span id="__span-395-11"><a id="__codelineno-395-11" name="__codelineno-395-11" href="#__codelineno-395-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">cheaterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-395-12"><a id="__codelineno-395-12" name="__codelineno-395-12" href="#__codelineno-395-12"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-395-13"><a id="__codelineno-395-13" name="__codelineno-395-13" href="#__codelineno-395-13"></a><span class="nv">steamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span>
</span><span id="__span-395-14"><a id="__codelineno-395-14" name="__codelineno-395-14" href="#__codelineno-395-14"></a><span class="nv">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ip</span><span class="p">,</span>
</span><span id="__span-395-15"><a id="__codelineno-395-15" name="__codelineno-395-15" href="#__codelineno-395-15"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-395-16"><a id="__codelineno-395-16" name="__codelineno-395-16" href="#__codelineno-395-16"></a><span class="nv">charID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-395-17"><a id="__codelineno-395-17" name="__codelineno-395-17" href="#__codelineno-395-17"></a><span class="p">}</span>
</span><span id="__span-395-18"><a id="__codelineno-395-18" name="__codelineno-395-18" href="#__codelineno-395-18"></a><span class="c1">-- Store cheater data</span>
</span><span id="__span-395-19"><a id="__codelineno-395-19" name="__codelineno-395-19" href="#__codelineno-395-19"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;cheaters&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">cheaterData</span><span class="p">)</span>
</span><span id="__span-395-20"><a id="__codelineno-395-20" name="__codelineno-395-20" href="#__codelineno-395-20"></a><span class="c1">-- Kick the cheater</span>
</span><span id="__span-395-21"><a id="__codelineno-395-21" name="__codelineno-395-21" href="#__codelineno-395-21"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Cheating detected - You have been banned&quot;</span><span class="p">)</span>
</span><span id="__span-395-22"><a id="__codelineno-395-22" name="__codelineno-395-22" href="#__codelineno-395-22"></a><span class="c1">-- Notify all admins</span>
</span><span id="__span-395-23"><a id="__codelineno-395-23" name="__codelineno-395-23" href="#__codelineno-395-23"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-395-24"><a id="__codelineno-395-24" name="__codelineno-395-24" href="#__codelineno-395-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-395-25"><a id="__codelineno-395-25" name="__codelineno-395-25" href="#__codelineno-395-25"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] Cheater caught: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-395-26"><a id="__codelineno-395-26" name="__codelineno-395-26" href="#__codelineno-395-26"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] SteamID: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">steamID</span><span class="p">)</span>
</span><span id="__span-395-27"><a id="__codelineno-395-27" name="__codelineno-395-27" href="#__codelineno-395-27"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] IP: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ip</span><span class="p">)</span>
</span><span id="__span-395-28"><a id="__codelineno-395-28" name="__codelineno-395-28" href="#__codelineno-395-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-395-29"><a id="__codelineno-395-29" name="__codelineno-395-29" href="#__codelineno-395-29"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-395-30"><a id="__codelineno-395-30" name="__codelineno-395-30" href="#__codelineno-395-30"></a><span class="c1">-- Log to file</span>
</span><span id="__span-395-31"><a id="__codelineno-395-31" name="__codelineno-395-31" href="#__codelineno-395-31"></a><span class="kd">local</span><span class="w"> </span><span class="nv">logFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cheaters.txt&quot;</span>
</span><span id="__span-395-32"><a id="__codelineno-395-32" name="__codelineno-395-32" href="#__codelineno-395-32"></a><span class="kd">local</span><span class="w"> </span><span class="nv">logData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;[%s] %s (SteamID: %s, IP: %s)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-395-33"><a id="__codelineno-395-33" name="__codelineno-395-33" href="#__codelineno-395-33"></a><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">ip</span><span class="p">)</span>
</span><span id="__span-395-34"><a id="__codelineno-395-34" name="__codelineno-395-34" href="#__codelineno-395-34"></a><span class="c1">-- Write to log file</span>
</span><span id="__span-395-35"><a id="__codelineno-395-35" name="__codelineno-395-35" href="#__codelineno-395-35"></a><span class="nv">file</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="nv">logFile</span><span class="p">,</span><span class="w"> </span><span class="nv">logData</span><span class="p">)</span>
</span><span id="__span-395-36"><a id="__codelineno-395-36" name="__codelineno-395-36" href="#__codelineno-395-36"></a><span class="c1">-- Check for repeat offenders</span>
</span><span id="__span-395-37"><a id="__codelineno-395-37" name="__codelineno-395-37" href="#__codelineno-395-37"></a><span class="kd">local</span><span class="w"> </span><span class="nv">cheaterHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;cheaterHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-395-38"><a id="__codelineno-395-38" name="__codelineno-395-38" href="#__codelineno-395-38"></a><span class="nv">cheaterHistory</span><span class="p">[</span><span class="nv">steamID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">cheaterHistory</span><span class="p">[</span><span class="nv">steamID</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-395-39"><a id="__codelineno-395-39" name="__codelineno-395-39" href="#__codelineno-395-39"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;cheaterHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">cheaterHistory</span><span class="p">)</span>
</span><span id="__span-395-40"><a id="__codelineno-395-40" name="__codelineno-395-40" href="#__codelineno-395-40"></a><span class="kr">if</span><span class="w"> </span><span class="nv">cheaterHistory</span><span class="p">[</span><span class="nv">steamID</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-395-41"><a id="__codelineno-395-41" name="__codelineno-395-41" href="#__codelineno-395-41"></a><span class="w">    </span><span class="c1">-- Repeat offender</span>
</span><span id="__span-395-42"><a id="__codelineno-395-42" name="__codelineno-395-42" href="#__codelineno-395-42"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Repeat cheater: %s (SteamID: %s) - %d offenses&quot;</span><span class="p">,</span>
</span><span id="__span-395-43"><a id="__codelineno-395-43" name="__codelineno-395-43" href="#__codelineno-395-43"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">cheaterHistory</span><span class="p">[</span><span class="nv">steamID</span><span class="p">]))</span>
</span><span id="__span-395-44"><a id="__codelineno-395-44" name="__codelineno-395-44" href="#__codelineno-395-44"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-395-45"><a id="__codelineno-395-45" name="__codelineno-395-45" href="#__codelineno-395-45"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncheaterstatuschanged">OnCheaterStatusChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a cheater's status changes</p>
<p><strong>When Called</strong></p>
<p>When a player's cheater status is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose status changed</li>
<li><code>target</code> (<em>Player</em>): The target player (if applicable)</li>
<li><code>status</code> (<em>string</em>): The new cheater status</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-396-1"><a id="__codelineno-396-1" name="__codelineno-396-1" href="#__codelineno-396-1"></a><span class="c1">-- Simple: Log cheater status changes</span>
</span><span id="__span-396-2"><a id="__codelineno-396-2" name="__codelineno-396-2" href="#__codelineno-396-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterStatusChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">status</span><span class="p">)</span>
</span><span id="__span-396-3"><a id="__codelineno-396-3" name="__codelineno-396-3" href="#__codelineno-396-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; cheater status changed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">status</span><span class="p">)</span>
</span><span id="__span-396-4"><a id="__codelineno-396-4" name="__codelineno-396-4" href="#__codelineno-396-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-397-1"><a id="__codelineno-397-1" name="__codelineno-397-1" href="#__codelineno-397-1"></a><span class="c1">-- Medium: Handle status change effects</span>
</span><span id="__span-397-2"><a id="__codelineno-397-2" name="__codelineno-397-2" href="#__codelineno-397-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterStatusChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;StatusChangeEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">status</span><span class="p">)</span>
</span><span id="__span-397-3"><a id="__codelineno-397-3" name="__codelineno-397-3" href="#__codelineno-397-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;banned&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-397-4"><a id="__codelineno-397-4" name="__codelineno-397-4" href="#__codelineno-397-4"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;You have been banned for cheating&quot;</span><span class="p">)</span>
</span><span id="__span-397-5"><a id="__codelineno-397-5" name="__codelineno-397-5" href="#__codelineno-397-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;warned&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-397-6"><a id="__codelineno-397-6" name="__codelineno-397-6" href="#__codelineno-397-6"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning: Cheating behavior detected&quot;</span><span class="p">)</span>
</span><span id="__span-397-7"><a id="__codelineno-397-7" name="__codelineno-397-7" href="#__codelineno-397-7"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;cleared&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-397-8"><a id="__codelineno-397-8" name="__codelineno-397-8" href="#__codelineno-397-8"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your cheater status has been cleared&quot;</span><span class="p">)</span>
</span><span id="__span-397-9"><a id="__codelineno-397-9" name="__codelineno-397-9" href="#__codelineno-397-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-397-10"><a id="__codelineno-397-10" name="__codelineno-397-10" href="#__codelineno-397-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-398-1"><a id="__codelineno-398-1" name="__codelineno-398-1" href="#__codelineno-398-1"></a><span class="c1">-- High: Complex cheater status system</span>
</span><span id="__span-398-2"><a id="__codelineno-398-2" name="__codelineno-398-2" href="#__codelineno-398-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCheaterStatusChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCheaterStatus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">status</span><span class="p">)</span>
</span><span id="__span-398-3"><a id="__codelineno-398-3" name="__codelineno-398-3" href="#__codelineno-398-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-398-4"><a id="__codelineno-398-4" name="__codelineno-398-4" href="#__codelineno-398-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-398-5"><a id="__codelineno-398-5" name="__codelineno-398-5" href="#__codelineno-398-5"></a><span class="w">    </span><span class="c1">-- Update cheater status</span>
</span><span id="__span-398-6"><a id="__codelineno-398-6" name="__codelineno-398-6" href="#__codelineno-398-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;cheaterStatus&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">status</span><span class="p">)</span>
</span><span id="__span-398-7"><a id="__codelineno-398-7" name="__codelineno-398-7" href="#__codelineno-398-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;statusChangeTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-398-8"><a id="__codelineno-398-8" name="__codelineno-398-8" href="#__codelineno-398-8"></a><span class="w">    </span><span class="c1">-- Handle status-specific effects</span>
</span><span id="__span-398-9"><a id="__codelineno-398-9" name="__codelineno-398-9" href="#__codelineno-398-9"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;banned&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-10"><a id="__codelineno-398-10" name="__codelineno-398-10" href="#__codelineno-398-10"></a><span class="w">        </span><span class="c1">-- Ban the player</span>
</span><span id="__span-398-11"><a id="__codelineno-398-11" name="__codelineno-398-11" href="#__codelineno-398-11"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;You have been banned for cheating&quot;</span><span class="p">)</span>
</span><span id="__span-398-12"><a id="__codelineno-398-12" name="__codelineno-398-12" href="#__codelineno-398-12"></a><span class="w">        </span><span class="c1">-- Add to ban database</span>
</span><span id="__span-398-13"><a id="__codelineno-398-13" name="__codelineno-398-13" href="#__codelineno-398-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">banData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-398-14"><a id="__codelineno-398-14" name="__codelineno-398-14" href="#__codelineno-398-14"></a><span class="w">        </span><span class="nv">steamID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-398-15"><a id="__codelineno-398-15" name="__codelineno-398-15" href="#__codelineno-398-15"></a><span class="w">        </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-398-16"><a id="__codelineno-398-16" name="__codelineno-398-16" href="#__codelineno-398-16"></a><span class="w">        </span><span class="nv">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cheating&quot;</span><span class="p">,</span>
</span><span id="__span-398-17"><a id="__codelineno-398-17" name="__codelineno-398-17" href="#__codelineno-398-17"></a><span class="w">        </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-398-18"><a id="__codelineno-398-18" name="__codelineno-398-18" href="#__codelineno-398-18"></a><span class="w">        </span><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;System&quot;</span>
</span><span id="__span-398-19"><a id="__codelineno-398-19" name="__codelineno-398-19" href="#__codelineno-398-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-398-20"><a id="__codelineno-398-20" name="__codelineno-398-20" href="#__codelineno-398-20"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;bans&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">banData</span><span class="p">)</span>
</span><span id="__span-398-21"><a id="__codelineno-398-21" name="__codelineno-398-21" href="#__codelineno-398-21"></a><span class="w">        </span><span class="c1">-- Notify admins</span>
</span><span id="__span-398-22"><a id="__codelineno-398-22" name="__codelineno-398-22" href="#__codelineno-398-22"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-398-23"><a id="__codelineno-398-23" name="__codelineno-398-23" href="#__codelineno-398-23"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-24"><a id="__codelineno-398-24" name="__codelineno-398-24" href="#__codelineno-398-24"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been banned for cheating&quot;</span><span class="p">)</span>
</span><span id="__span-398-25"><a id="__codelineno-398-25" name="__codelineno-398-25" href="#__codelineno-398-25"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-398-26"><a id="__codelineno-398-26" name="__codelineno-398-26" href="#__codelineno-398-26"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-398-27"><a id="__codelineno-398-27" name="__codelineno-398-27" href="#__codelineno-398-27"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;warned&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-28"><a id="__codelineno-398-28" name="__codelineno-398-28" href="#__codelineno-398-28"></a><span class="w">        </span><span class="c1">-- Warn the player</span>
</span><span id="__span-398-29"><a id="__codelineno-398-29" name="__codelineno-398-29" href="#__codelineno-398-29"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning: Cheating behavior detected&quot;</span><span class="p">)</span>
</span><span id="__span-398-30"><a id="__codelineno-398-30" name="__codelineno-398-30" href="#__codelineno-398-30"></a><span class="w">        </span><span class="c1">-- Add warning to character</span>
</span><span id="__span-398-31"><a id="__codelineno-398-31" name="__codelineno-398-31" href="#__codelineno-398-31"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;warnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-398-32"><a id="__codelineno-398-32" name="__codelineno-398-32" href="#__codelineno-398-32"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;warnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">warnings</span><span class="p">)</span>
</span><span id="__span-398-33"><a id="__codelineno-398-33" name="__codelineno-398-33" href="#__codelineno-398-33"></a><span class="w">        </span><span class="c1">-- Check for warning limits</span>
</span><span id="__span-398-34"><a id="__codelineno-398-34" name="__codelineno-398-34" href="#__codelineno-398-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">warnings</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-35"><a id="__codelineno-398-35" name="__codelineno-398-35" href="#__codelineno-398-35"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;You have received too many warnings&quot;</span><span class="p">)</span>
</span><span id="__span-398-36"><a id="__codelineno-398-36" name="__codelineno-398-36" href="#__codelineno-398-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-398-37"><a id="__codelineno-398-37" name="__codelineno-398-37" href="#__codelineno-398-37"></a><span class="w">        </span><span class="c1">-- Notify admins</span>
</span><span id="__span-398-38"><a id="__codelineno-398-38" name="__codelineno-398-38" href="#__codelineno-398-38"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-398-39"><a id="__codelineno-398-39" name="__codelineno-398-39" href="#__codelineno-398-39"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-40"><a id="__codelineno-398-40" name="__codelineno-398-40" href="#__codelineno-398-40"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been warned for cheating&quot;</span><span class="p">)</span>
</span><span id="__span-398-41"><a id="__codelineno-398-41" name="__codelineno-398-41" href="#__codelineno-398-41"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-398-42"><a id="__codelineno-398-42" name="__codelineno-398-42" href="#__codelineno-398-42"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-398-43"><a id="__codelineno-398-43" name="__codelineno-398-43" href="#__codelineno-398-43"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;cleared&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-44"><a id="__codelineno-398-44" name="__codelineno-398-44" href="#__codelineno-398-44"></a><span class="w">        </span><span class="c1">-- Clear cheater status</span>
</span><span id="__span-398-45"><a id="__codelineno-398-45" name="__codelineno-398-45" href="#__codelineno-398-45"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your cheater status has been cleared&quot;</span><span class="p">)</span>
</span><span id="__span-398-46"><a id="__codelineno-398-46" name="__codelineno-398-46" href="#__codelineno-398-46"></a><span class="w">        </span><span class="c1">-- Clear warnings</span>
</span><span id="__span-398-47"><a id="__codelineno-398-47" name="__codelineno-398-47" href="#__codelineno-398-47"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;warnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-398-48"><a id="__codelineno-398-48" name="__codelineno-398-48" href="#__codelineno-398-48"></a><span class="w">        </span><span class="c1">-- Notify admins</span>
</span><span id="__span-398-49"><a id="__codelineno-398-49" name="__codelineno-398-49" href="#__codelineno-398-49"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-398-50"><a id="__codelineno-398-50" name="__codelineno-398-50" href="#__codelineno-398-50"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-398-51"><a id="__codelineno-398-51" name="__codelineno-398-51" href="#__codelineno-398-51"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; cheater status has been cleared&quot;</span><span class="p">)</span>
</span><span id="__span-398-52"><a id="__codelineno-398-52" name="__codelineno-398-52" href="#__codelineno-398-52"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-398-53"><a id="__codelineno-398-53" name="__codelineno-398-53" href="#__codelineno-398-53"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-398-54"><a id="__codelineno-398-54" name="__codelineno-398-54" href="#__codelineno-398-54"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-398-55"><a id="__codelineno-398-55" name="__codelineno-398-55" href="#__codelineno-398-55"></a><span class="w">    </span><span class="c1">-- Log status change</span>
</span><span id="__span-398-56"><a id="__codelineno-398-56" name="__codelineno-398-56" href="#__codelineno-398-56"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Cheater status changed: %s -&gt; %s (Admin: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-398-57"><a id="__codelineno-398-57" name="__codelineno-398-57" href="#__codelineno-398-57"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">status</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;System&quot;</span><span class="p">))</span>
</span><span id="__span-398-58"><a id="__codelineno-398-58" name="__codelineno-398-58" href="#__codelineno-398-58"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="oncreateplayerragdoll">OnCreatePlayerRagdoll</h3>
<p><strong>Purpose</strong></p>
<p>Called when creating a player ragdoll</p>
<p><strong>When Called</strong></p>
<p>When a player ragdoll is being created</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Player</em>): The player whose ragdoll is being created</li>
<li><code>entity</code> (<em>Entity</em>): The ragdoll entity</li>
<li><code>isDead</code> (<em>boolean</em>): Whether the player is dead</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-399-1"><a id="__codelineno-399-1" name="__codelineno-399-1" href="#__codelineno-399-1"></a><span class="c1">-- Simple: Log ragdoll creation</span>
</span><span id="__span-399-2"><a id="__codelineno-399-2" name="__codelineno-399-2" href="#__codelineno-399-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCreatePlayerRagdoll&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">isDead</span><span class="p">)</span>
</span><span id="__span-399-3"><a id="__codelineno-399-3" name="__codelineno-399-3" href="#__codelineno-399-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; ragdoll created&quot;</span><span class="p">)</span>
</span><span id="__span-399-4"><a id="__codelineno-399-4" name="__codelineno-399-4" href="#__codelineno-399-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-400-1"><a id="__codelineno-400-1" name="__codelineno-400-1" href="#__codelineno-400-1"></a><span class="c1">-- Medium: Set up ragdoll data</span>
</span><span id="__span-400-2"><a id="__codelineno-400-2" name="__codelineno-400-2" href="#__codelineno-400-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCreatePlayerRagdoll&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RagdollSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">isDead</span><span class="p">)</span>
</span><span id="__span-400-3"><a id="__codelineno-400-3" name="__codelineno-400-3" href="#__codelineno-400-3"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-400-4"><a id="__codelineno-400-4" name="__codelineno-400-4" href="#__codelineno-400-4"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;isDead&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">isDead</span><span class="p">)</span>
</span><span id="__span-400-5"><a id="__codelineno-400-5" name="__codelineno-400-5" href="#__codelineno-400-5"></a><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;deathTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-400-6"><a id="__codelineno-400-6" name="__codelineno-400-6" href="#__codelineno-400-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-401-1"><a id="__codelineno-401-1" name="__codelineno-401-1" href="#__codelineno-401-1"></a><span class="c1">-- High: Complex ragdoll creation system</span>
</span><span id="__span-401-2"><a id="__codelineno-401-2" name="__codelineno-401-2" href="#__codelineno-401-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnCreatePlayerRagdoll&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedRagdollCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">isDead</span><span class="p">)</span>
</span><span id="__span-401-3"><a id="__codelineno-401-3" name="__codelineno-401-3" href="#__codelineno-401-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-401-4"><a id="__codelineno-401-4" name="__codelineno-401-4" href="#__codelineno-401-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-401-5"><a id="__codelineno-401-5" name="__codelineno-401-5" href="#__codelineno-401-5"></a><span class="w">    </span><span class="c1">-- Set up ragdoll data</span>
</span><span id="__span-401-6"><a id="__codelineno-401-6" name="__codelineno-401-6" href="#__codelineno-401-6"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-401-7"><a id="__codelineno-401-7" name="__codelineno-401-7" href="#__codelineno-401-7"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;isDead&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">isDead</span><span class="p">)</span>
</span><span id="__span-401-8"><a id="__codelineno-401-8" name="__codelineno-401-8" href="#__codelineno-401-8"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;deathTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-401-9"><a id="__codelineno-401-9" name="__codelineno-401-9" href="#__codelineno-401-9"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;charID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-401-10"><a id="__codelineno-401-10" name="__codelineno-401-10" href="#__codelineno-401-10"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;charName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-401-11"><a id="__codelineno-401-11" name="__codelineno-401-11" href="#__codelineno-401-11"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">())</span>
</span><span id="__span-401-12"><a id="__codelineno-401-12" name="__codelineno-401-12" href="#__codelineno-401-12"></a><span class="w">    </span><span class="c1">-- Set up ragdoll appearance</span>
</span><span id="__span-401-13"><a id="__codelineno-401-13" name="__codelineno-401-13" href="#__codelineno-401-13"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">())</span>
</span><span id="__span-401-14"><a id="__codelineno-401-14" name="__codelineno-401-14" href="#__codelineno-401-14"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetSkin</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetSkin</span><span class="p">())</span>
</span><span id="__span-401-15"><a id="__codelineno-401-15" name="__codelineno-401-15" href="#__codelineno-401-15"></a><span class="w">    </span><span class="c1">-- Set up bodygroups</span>
</span><span id="__span-401-16"><a id="__codelineno-401-16" name="__codelineno-401-16" href="#__codelineno-401-16"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetNumBodyGroups</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-401-17"><a id="__codelineno-401-17" name="__codelineno-401-17" href="#__codelineno-401-17"></a><span class="w">        </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetBodygroup</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetBodygroup</span><span class="p">(</span><span class="nv">i</span><span class="p">))</span>
</span><span id="__span-401-18"><a id="__codelineno-401-18" name="__codelineno-401-18" href="#__codelineno-401-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-401-19"><a id="__codelineno-401-19" name="__codelineno-401-19" href="#__codelineno-401-19"></a><span class="w">    </span><span class="c1">-- Set up ragdoll position and angles</span>
</span><span id="__span-401-20"><a id="__codelineno-401-20" name="__codelineno-401-20" href="#__codelineno-401-20"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-401-21"><a id="__codelineno-401-21" name="__codelineno-401-21" href="#__codelineno-401-21"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetAngles</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-401-22"><a id="__codelineno-401-22" name="__codelineno-401-22" href="#__codelineno-401-22"></a><span class="w">    </span><span class="c1">-- Apply faction-specific effects</span>
</span><span id="__span-401-23"><a id="__codelineno-401-23" name="__codelineno-401-23" href="#__codelineno-401-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-401-24"><a id="__codelineno-401-24" name="__codelineno-401-24" href="#__codelineno-401-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-401-25"><a id="__codelineno-401-25" name="__codelineno-401-25" href="#__codelineno-401-25"></a><span class="w">        </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetColor</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">))</span>
</span><span id="__span-401-26"><a id="__codelineno-401-26" name="__codelineno-401-26" href="#__codelineno-401-26"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-401-27"><a id="__codelineno-401-27" name="__codelineno-401-27" href="#__codelineno-401-27"></a><span class="w">        </span><span class="nv">entity</span><span class="p">:</span><span class="nf">SetColor</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">))</span>
</span><span id="__span-401-28"><a id="__codelineno-401-28" name="__codelineno-401-28" href="#__codelineno-401-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-401-29"><a id="__codelineno-401-29" name="__codelineno-401-29" href="#__codelineno-401-29"></a><span class="w">    </span><span class="c1">-- Set up ragdoll physics</span>
</span><span id="__span-401-30"><a id="__codelineno-401-30" name="__codelineno-401-30" href="#__codelineno-401-30"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">phys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPhysicsObject</span><span class="p">()</span>
</span><span id="__span-401-31"><a id="__codelineno-401-31" name="__codelineno-401-31" href="#__codelineno-401-31"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">phys</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-401-32"><a id="__codelineno-401-32" name="__codelineno-401-32" href="#__codelineno-401-32"></a><span class="w">        </span><span class="nv">phys</span><span class="p">:</span><span class="nf">SetVelocity</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetVelocity</span><span class="p">())</span>
</span><span id="__span-401-33"><a id="__codelineno-401-33" name="__codelineno-401-33" href="#__codelineno-401-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-401-34"><a id="__codelineno-401-34" name="__codelineno-401-34" href="#__codelineno-401-34"></a><span class="w">    </span><span class="c1">-- Log ragdoll creation</span>
</span><span id="__span-401-35"><a id="__codelineno-401-35" name="__codelineno-401-35" href="#__codelineno-401-35"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Ragdoll created for %s (Faction: %s, Dead: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-401-36"><a id="__codelineno-401-36" name="__codelineno-401-36" href="#__codelineno-401-36"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">isDead</span><span class="p">)))</span>
</span><span id="__span-401-37"><a id="__codelineno-401-37" name="__codelineno-401-37" href="#__codelineno-401-37"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ondataset">OnDataSet</h3>
<p><strong>Purpose</strong></p>
<p>Called when data is set</p>
<p><strong>When Called</strong></p>
<p>When persistent data is being saved</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>key</code> (<em>string</em>): The data key</li>
<li><code>value</code> (<em>any</em>): The data value</li>
<li><code>gamemode</code> (<em>string</em>): The gamemode name</li>
<li><code>map</code> (<em>string</em>): The map name</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-402-1"><a id="__codelineno-402-1" name="__codelineno-402-1" href="#__codelineno-402-1"></a><span class="c1">-- Simple: Log data setting</span>
</span><span id="__span-402-2"><a id="__codelineno-402-2" name="__codelineno-402-2" href="#__codelineno-402-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDataSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">gamemode</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">)</span>
</span><span id="__span-402-3"><a id="__codelineno-402-3" name="__codelineno-402-3" href="#__codelineno-402-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data set: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-402-4"><a id="__codelineno-402-4" name="__codelineno-402-4" href="#__codelineno-402-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-403-1"><a id="__codelineno-403-1" name="__codelineno-403-1" href="#__codelineno-403-1"></a><span class="c1">-- Medium: Validate data before saving</span>
</span><span id="__span-403-2"><a id="__codelineno-403-2" name="__codelineno-403-2" href="#__codelineno-403-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDataSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DataValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">gamemode</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">)</span>
</span><span id="__span-403-3"><a id="__codelineno-403-3" name="__codelineno-403-3" href="#__codelineno-403-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;playerMoney&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-403-4"><a id="__codelineno-403-4" name="__codelineno-403-4" href="#__codelineno-403-4"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid money value: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-403-5"><a id="__codelineno-403-5" name="__codelineno-403-5" href="#__codelineno-403-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-403-6"><a id="__codelineno-403-6" name="__codelineno-403-6" href="#__codelineno-403-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-403-7"><a id="__codelineno-403-7" name="__codelineno-403-7" href="#__codelineno-403-7"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;playerLevel&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-403-8"><a id="__codelineno-403-8" name="__codelineno-403-8" href="#__codelineno-403-8"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid level value: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-403-9"><a id="__codelineno-403-9" name="__codelineno-403-9" href="#__codelineno-403-9"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-403-10"><a id="__codelineno-403-10" name="__codelineno-403-10" href="#__codelineno-403-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-403-11"><a id="__codelineno-403-11" name="__codelineno-403-11" href="#__codelineno-403-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-404-1"><a id="__codelineno-404-1" name="__codelineno-404-1" href="#__codelineno-404-1"></a><span class="c1">-- High: Complex data management system</span>
</span><span id="__span-404-2"><a id="__codelineno-404-2" name="__codelineno-404-2" href="#__codelineno-404-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDataSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">gamemode</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">)</span>
</span><span id="__span-404-3"><a id="__codelineno-404-3" name="__codelineno-404-3" href="#__codelineno-404-3"></a><span class="c1">-- Log data changes</span>
</span><span id="__span-404-4"><a id="__codelineno-404-4" name="__codelineno-404-4" href="#__codelineno-404-4"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Data set: %s = %s (Gamemode: %s, Map: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-404-5"><a id="__codelineno-404-5" name="__codelineno-404-5" href="#__codelineno-404-5"></a><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">),</span><span class="w"> </span><span class="nv">gamemode</span><span class="p">,</span><span class="w"> </span><span class="nv">map</span><span class="p">))</span>
</span><span id="__span-404-6"><a id="__codelineno-404-6" name="__codelineno-404-6" href="#__codelineno-404-6"></a><span class="c1">-- Validate data types</span>
</span><span id="__span-404-7"><a id="__codelineno-404-7" name="__codelineno-404-7" href="#__codelineno-404-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">dataTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-404-8"><a id="__codelineno-404-8" name="__codelineno-404-8" href="#__codelineno-404-8"></a><span class="p">[</span><span class="s2">&quot;playerMoney&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-404-9"><a id="__codelineno-404-9" name="__codelineno-404-9" href="#__codelineno-404-9"></a><span class="p">[</span><span class="s2">&quot;playerLevel&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-404-10"><a id="__codelineno-404-10" name="__codelineno-404-10" href="#__codelineno-404-10"></a><span class="p">[</span><span class="s2">&quot;playerName&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-404-11"><a id="__codelineno-404-11" name="__codelineno-404-11" href="#__codelineno-404-11"></a><span class="p">[</span><span class="s2">&quot;playerFaction&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
</span><span id="__span-404-12"><a id="__codelineno-404-12" name="__codelineno-404-12" href="#__codelineno-404-12"></a><span class="p">}</span>
</span><span id="__span-404-13"><a id="__codelineno-404-13" name="__codelineno-404-13" href="#__codelineno-404-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">expectedType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dataTypes</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span>
</span><span id="__span-404-14"><a id="__codelineno-404-14" name="__codelineno-404-14" href="#__codelineno-404-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">expectedType</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">expectedType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-404-15"><a id="__codelineno-404-15" name="__codelineno-404-15" href="#__codelineno-404-15"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type mismatch for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: expected &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">expectedType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;, got &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-404-16"><a id="__codelineno-404-16" name="__codelineno-404-16" href="#__codelineno-404-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-404-17"><a id="__codelineno-404-17" name="__codelineno-404-17" href="#__codelineno-404-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-404-18"><a id="__codelineno-404-18" name="__codelineno-404-18" href="#__codelineno-404-18"></a><span class="c1">-- Validate value ranges</span>
</span><span id="__span-404-19"><a id="__codelineno-404-19" name="__codelineno-404-19" href="#__codelineno-404-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;playerMoney&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-404-20"><a id="__codelineno-404-20" name="__codelineno-404-20" href="#__codelineno-404-20"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Money value out of range: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-404-21"><a id="__codelineno-404-21" name="__codelineno-404-21" href="#__codelineno-404-21"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-404-22"><a id="__codelineno-404-22" name="__codelineno-404-22" href="#__codelineno-404-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-404-23"><a id="__codelineno-404-23" name="__codelineno-404-23" href="#__codelineno-404-23"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;playerLevel&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-404-24"><a id="__codelineno-404-24" name="__codelineno-404-24" href="#__codelineno-404-24"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Level value out of range: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-404-25"><a id="__codelineno-404-25" name="__codelineno-404-25" href="#__codelineno-404-25"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-404-26"><a id="__codelineno-404-26" name="__codelineno-404-26" href="#__codelineno-404-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-404-27"><a id="__codelineno-404-27" name="__codelineno-404-27" href="#__codelineno-404-27"></a><span class="c1">-- Update data cache</span>
</span><span id="__span-404-28"><a id="__codelineno-404-28" name="__codelineno-404-28" href="#__codelineno-404-28"></a><span class="nv">lia</span><span class="p">.</span><span class="py">dataCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">dataCache</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-404-29"><a id="__codelineno-404-29" name="__codelineno-404-29" href="#__codelineno-404-29"></a><span class="nv">lia</span><span class="p">.</span><span class="py">dataCache</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-404-30"><a id="__codelineno-404-30" name="__codelineno-404-30" href="#__codelineno-404-30"></a><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span>
</span><span id="__span-404-31"><a id="__codelineno-404-31" name="__codelineno-404-31" href="#__codelineno-404-31"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-404-32"><a id="__codelineno-404-32" name="__codelineno-404-32" href="#__codelineno-404-32"></a><span class="nv">gamemode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gamemode</span><span class="p">,</span>
</span><span id="__span-404-33"><a id="__codelineno-404-33" name="__codelineno-404-33" href="#__codelineno-404-33"></a><span class="nv">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">map</span>
</span><span id="__span-404-34"><a id="__codelineno-404-34" name="__codelineno-404-34" href="#__codelineno-404-34"></a><span class="p">}</span>
</span><span id="__span-404-35"><a id="__codelineno-404-35" name="__codelineno-404-35" href="#__codelineno-404-35"></a><span class="c1">-- Notify admins of important changes</span>
</span><span id="__span-404-36"><a id="__codelineno-404-36" name="__codelineno-404-36" href="#__codelineno-404-36"></a><span class="kd">local</span><span class="w"> </span><span class="nv">importantKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;playerMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;playerLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;playerFaction&quot;</span><span class="p">}</span>
</span><span id="__span-404-37"><a id="__codelineno-404-37" name="__codelineno-404-37" href="#__codelineno-404-37"></a><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">importantKeys</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-404-38"><a id="__codelineno-404-38" name="__codelineno-404-38" href="#__codelineno-404-38"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-404-39"><a id="__codelineno-404-39" name="__codelineno-404-39" href="#__codelineno-404-39"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-404-40"><a id="__codelineno-404-40" name="__codelineno-404-40" href="#__codelineno-404-40"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[DATA] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-404-41"><a id="__codelineno-404-41" name="__codelineno-404-41" href="#__codelineno-404-41"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-404-42"><a id="__codelineno-404-42" name="__codelineno-404-42" href="#__codelineno-404-42"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-404-43"><a id="__codelineno-404-43" name="__codelineno-404-43" href="#__codelineno-404-43"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-404-44"><a id="__codelineno-404-44" name="__codelineno-404-44" href="#__codelineno-404-44"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ondatabaseloaded">OnDatabaseLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when the database has finished loading all data</p>
<p><strong>When Called</strong></p>
<p>After all database operations and data loading is complete</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-405-1"><a id="__codelineno-405-1" name="__codelineno-405-1" href="#__codelineno-405-1"></a><span class="c1">-- Simple: Log database loaded</span>
</span><span id="__span-405-2"><a id="__codelineno-405-2" name="__codelineno-405-2" href="#__codelineno-405-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDatabaseLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-405-3"><a id="__codelineno-405-3" name="__codelineno-405-3" href="#__codelineno-405-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database loading complete&quot;</span><span class="p">)</span>
</span><span id="__span-405-4"><a id="__codelineno-405-4" name="__codelineno-405-4" href="#__codelineno-405-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-406-1"><a id="__codelineno-406-1" name="__codelineno-406-1" href="#__codelineno-406-1"></a><span class="c1">-- Medium: Initialize addon after DB load</span>
</span><span id="__span-406-2"><a id="__codelineno-406-2" name="__codelineno-406-2" href="#__codelineno-406-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDatabaseLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InitAfterDB&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-406-3"><a id="__codelineno-406-3" name="__codelineno-406-3" href="#__codelineno-406-3"></a><span class="nv">MyAddon</span><span class="p">:</span><span class="nf">Initialize</span><span class="p">()</span>
</span><span id="__span-406-4"><a id="__codelineno-406-4" name="__codelineno-406-4" href="#__codelineno-406-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Addon initialized after database load&quot;</span><span class="p">)</span>
</span><span id="__span-406-5"><a id="__codelineno-406-5" name="__codelineno-406-5" href="#__codelineno-406-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-407-1"><a id="__codelineno-407-1" name="__codelineno-407-1" href="#__codelineno-407-1"></a><span class="c1">-- High: Complex post-database initialization</span>
</span><span id="__span-407-2"><a id="__codelineno-407-2" name="__codelineno-407-2" href="#__codelineno-407-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnDatabaseLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPostDBInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-407-3"><a id="__codelineno-407-3" name="__codelineno-407-3" href="#__codelineno-407-3"></a><span class="c1">-- Load all cached data</span>
</span><span id="__span-407-4"><a id="__codelineno-407-4" name="__codelineno-407-4" href="#__codelineno-407-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;allData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-407-5"><a id="__codelineno-407-5" name="__codelineno-407-5" href="#__codelineno-407-5"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-407-6"><a id="__codelineno-407-6" name="__codelineno-407-6" href="#__codelineno-407-6"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-407-7"><a id="__codelineno-407-7" name="__codelineno-407-7" href="#__codelineno-407-7"></a><span class="c1">-- Initialize player statistics</span>
</span><span id="__span-407-8"><a id="__codelineno-407-8" name="__codelineno-407-8" href="#__codelineno-407-8"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-407-9"><a id="__codelineno-407-9" name="__codelineno-407-9" href="#__codelineno-407-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-407-10"><a id="__codelineno-407-10" name="__codelineno-407-10" href="#__codelineno-407-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-407-11"><a id="__codelineno-407-11" name="__codelineno-407-11" href="#__codelineno-407-11"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">loadStats</span><span class="p">()</span>
</span><span id="__span-407-12"><a id="__codelineno-407-12" name="__codelineno-407-12" href="#__codelineno-407-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-407-13"><a id="__codelineno-407-13" name="__codelineno-407-13" href="#__codelineno-407-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-407-14"><a id="__codelineno-407-14" name="__codelineno-407-14" href="#__codelineno-407-14"></a><span class="c1">-- Start background processes</span>
</span><span id="__span-407-15"><a id="__codelineno-407-15" name="__codelineno-407-15" href="#__codelineno-407-15"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DataSync&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-407-16"><a id="__codelineno-407-16" name="__codelineno-407-16" href="#__codelineno-407-16"></a><span class="nv">MyAddon</span><span class="p">:</span><span class="nf">SyncData</span><span class="p">()</span>
</span><span id="__span-407-17"><a id="__codelineno-407-17" name="__codelineno-407-17" href="#__codelineno-407-17"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-407-18"><a id="__codelineno-407-18" name="__codelineno-407-18" href="#__codelineno-407-18"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All systems initialized after database load&quot;</span><span class="p">)</span>
</span><span id="__span-407-19"><a id="__codelineno-407-19" name="__codelineno-407-19" href="#__codelineno-407-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onentityloaded">OnEntityLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when an entity is loaded from the database</p>
<p><strong>When Called</strong></p>
<p>When an entity is restored from saved data</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>createdEnt</code> (<em>Entity</em>): The entity that was created</li>
<li><code>data</code> (<em>table</em>): The saved entity data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-408-1"><a id="__codelineno-408-1" name="__codelineno-408-1" href="#__codelineno-408-1"></a><span class="c1">-- Simple: Log entity loading</span>
</span><span id="__span-408-2"><a id="__codelineno-408-2" name="__codelineno-408-2" href="#__codelineno-408-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">createdEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-408-3"><a id="__codelineno-408-3" name="__codelineno-408-3" href="#__codelineno-408-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entity loaded: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">createdEnt</span><span class="p">))</span>
</span><span id="__span-408-4"><a id="__codelineno-408-4" name="__codelineno-408-4" href="#__codelineno-408-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-409-1"><a id="__codelineno-409-1" name="__codelineno-409-1" href="#__codelineno-409-1"></a><span class="c1">-- Medium: Track loaded entities</span>
</span><span id="__span-409-2"><a id="__codelineno-409-2" name="__codelineno-409-2" href="#__codelineno-409-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackEntities&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">createdEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-409-3"><a id="__codelineno-409-3" name="__codelineno-409-3" href="#__codelineno-409-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedEntities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedEntities</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-409-4"><a id="__codelineno-409-4" name="__codelineno-409-4" href="#__codelineno-409-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedEntities</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-409-5"><a id="__codelineno-409-5" name="__codelineno-409-5" href="#__codelineno-409-5"></a><span class="nv">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">,</span>
</span><span id="__span-409-6"><a id="__codelineno-409-6" name="__codelineno-409-6" href="#__codelineno-409-6"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-409-7"><a id="__codelineno-409-7" name="__codelineno-409-7" href="#__codelineno-409-7"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-409-8"><a id="__codelineno-409-8" name="__codelineno-409-8" href="#__codelineno-409-8"></a><span class="p">})</span>
</span><span id="__span-409-9"><a id="__codelineno-409-9" name="__codelineno-409-9" href="#__codelineno-409-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-410-1"><a id="__codelineno-410-1" name="__codelineno-410-1" href="#__codelineno-410-1"></a><span class="c1">-- High: Complex entity loading handling</span>
</span><span id="__span-410-2"><a id="__codelineno-410-2" name="__codelineno-410-2" href="#__codelineno-410-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEntityLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">createdEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-410-3"><a id="__codelineno-410-3" name="__codelineno-410-3" href="#__codelineno-410-3"></a><span class="c1">-- Log entity loading</span>
</span><span id="__span-410-4"><a id="__codelineno-410-4" name="__codelineno-410-4" href="#__codelineno-410-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;entity_loaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-410-5"><a id="__codelineno-410-5" name="__codelineno-410-5" href="#__codelineno-410-5"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-410-6"><a id="__codelineno-410-6" name="__codelineno-410-6" href="#__codelineno-410-6"></a><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-410-7"><a id="__codelineno-410-7" name="__codelineno-410-7" href="#__codelineno-410-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-410-8"><a id="__codelineno-410-8" name="__codelineno-410-8" href="#__codelineno-410-8"></a><span class="p">})</span>
</span><span id="__span-410-9"><a id="__codelineno-410-9" name="__codelineno-410-9" href="#__codelineno-410-9"></a><span class="c1">-- Restore custom data</span>
</span><span id="__span-410-10"><a id="__codelineno-410-10" name="__codelineno-410-10" href="#__codelineno-410-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-410-11"><a id="__codelineno-410-11" name="__codelineno-410-11" href="#__codelineno-410-11"></a><span class="w">    </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">SetCustomData</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">customData</span><span class="p">)</span>
</span><span id="__span-410-12"><a id="__codelineno-410-12" name="__codelineno-410-12" href="#__codelineno-410-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-410-13"><a id="__codelineno-410-13" name="__codelineno-410-13" href="#__codelineno-410-13"></a><span class="c1">-- Setup entity-specific behavior</span>
</span><span id="__span-410-14"><a id="__codelineno-410-14" name="__codelineno-410-14" href="#__codelineno-410-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;lia_item&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-410-15"><a id="__codelineno-410-15" name="__codelineno-410-15" href="#__codelineno-410-15"></a><span class="w">    </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">SetupItemData</span><span class="p">(</span><span class="nv">data</span><span class="p">.</span><span class="py">itemData</span><span class="p">)</span>
</span><span id="__span-410-16"><a id="__codelineno-410-16" name="__codelineno-410-16" href="#__codelineno-410-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-410-17"><a id="__codelineno-410-17" name="__codelineno-410-17" href="#__codelineno-410-17"></a><span class="c1">-- Notify entity of loading</span>
</span><span id="__span-410-18"><a id="__codelineno-410-18" name="__codelineno-410-18" href="#__codelineno-410-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">createdEnt</span><span class="p">.</span><span class="py">OnLoaded</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-410-19"><a id="__codelineno-410-19" name="__codelineno-410-19" href="#__codelineno-410-19"></a><span class="w">    </span><span class="nv">createdEnt</span><span class="p">:</span><span class="nf">OnLoaded</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-410-20"><a id="__codelineno-410-20" name="__codelineno-410-20" href="#__codelineno-410-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-410-21"><a id="__codelineno-410-21" name="__codelineno-410-21" href="#__codelineno-410-21"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onentitypersistupdated">OnEntityPersistUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when an entity's persistent data is updated</p>
<p><strong>When Called</strong></p>
<p>When an entity's save data is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The entity being updated</li>
<li><code>data</code> (<em>table</em>): The updated persistent data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-411-1"><a id="__codelineno-411-1" name="__codelineno-411-1" href="#__codelineno-411-1"></a><span class="c1">-- Simple: Log entity updates</span>
</span><span id="__span-411-2"><a id="__codelineno-411-2" name="__codelineno-411-2" href="#__codelineno-411-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersistUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-411-3"><a id="__codelineno-411-3" name="__codelineno-411-3" href="#__codelineno-411-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entity data updated: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-411-4"><a id="__codelineno-411-4" name="__codelineno-411-4" href="#__codelineno-411-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-412-1"><a id="__codelineno-412-1" name="__codelineno-412-1" href="#__codelineno-412-1"></a><span class="c1">-- Medium: Track entity changes</span>
</span><span id="__span-412-2"><a id="__codelineno-412-2" name="__codelineno-412-2" href="#__codelineno-412-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersistUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackEntityChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-412-3"><a id="__codelineno-412-3" name="__codelineno-412-3" href="#__codelineno-412-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">entityChanges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">entityChanges</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-412-4"><a id="__codelineno-412-4" name="__codelineno-412-4" href="#__codelineno-412-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">entityChanges</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-412-5"><a id="__codelineno-412-5" name="__codelineno-412-5" href="#__codelineno-412-5"></a><span class="nv">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">,</span>
</span><span id="__span-412-6"><a id="__codelineno-412-6" name="__codelineno-412-6" href="#__codelineno-412-6"></a><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">,</span>
</span><span id="__span-412-7"><a id="__codelineno-412-7" name="__codelineno-412-7" href="#__codelineno-412-7"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-412-8"><a id="__codelineno-412-8" name="__codelineno-412-8" href="#__codelineno-412-8"></a><span class="p">})</span>
</span><span id="__span-412-9"><a id="__codelineno-412-9" name="__codelineno-412-9" href="#__codelineno-412-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-413-1"><a id="__codelineno-413-1" name="__codelineno-413-1" href="#__codelineno-413-1"></a><span class="c1">-- High: Complex entity update handling</span>
</span><span id="__span-413-2"><a id="__codelineno-413-2" name="__codelineno-413-2" href="#__codelineno-413-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersistUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEntityUpdate&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-413-3"><a id="__codelineno-413-3" name="__codelineno-413-3" href="#__codelineno-413-3"></a><span class="c1">-- Log entity update</span>
</span><span id="__span-413-4"><a id="__codelineno-413-4" name="__codelineno-413-4" href="#__codelineno-413-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;entity_persist_updated&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-413-5"><a id="__codelineno-413-5" name="__codelineno-413-5" href="#__codelineno-413-5"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-413-6"><a id="__codelineno-413-6" name="__codelineno-413-6" href="#__codelineno-413-6"></a><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-413-7"><a id="__codelineno-413-7" name="__codelineno-413-7" href="#__codelineno-413-7"></a><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">data</span><span class="p">),</span>
</span><span id="__span-413-8"><a id="__codelineno-413-8" name="__codelineno-413-8" href="#__codelineno-413-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-413-9"><a id="__codelineno-413-9" name="__codelineno-413-9" href="#__codelineno-413-9"></a><span class="p">})</span>
</span><span id="__span-413-10"><a id="__codelineno-413-10" name="__codelineno-413-10" href="#__codelineno-413-10"></a><span class="c1">-- Validate data integrity</span>
</span><span id="__span-413-11"><a id="__codelineno-413-11" name="__codelineno-413-11" href="#__codelineno-413-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">position</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">position</span><span class="p">.</span><span class="py">x</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-413-12"><a id="__codelineno-413-12" name="__codelineno-413-12" href="#__codelineno-413-12"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Invalid position data for entity &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-413-13"><a id="__codelineno-413-13" name="__codelineno-413-13" href="#__codelineno-413-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-413-14"><a id="__codelineno-413-14" name="__codelineno-413-14" href="#__codelineno-413-14"></a><span class="c1">-- Update entity-specific data</span>
</span><span id="__span-413-15"><a id="__codelineno-413-15" name="__codelineno-413-15" href="#__codelineno-413-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">OnPersistDataUpdated</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-413-16"><a id="__codelineno-413-16" name="__codelineno-413-16" href="#__codelineno-413-16"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">OnPersistDataUpdated</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-413-17"><a id="__codelineno-413-17" name="__codelineno-413-17" href="#__codelineno-413-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-413-18"><a id="__codelineno-413-18" name="__codelineno-413-18" href="#__codelineno-413-18"></a><span class="c1">-- Sync to clients if needed</span>
</span><span id="__span-413-19"><a id="__codelineno-413-19" name="__codelineno-413-19" href="#__codelineno-413-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">syncToClients</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-413-20"><a id="__codelineno-413-20" name="__codelineno-413-20" href="#__codelineno-413-20"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;liaEntityDataUpdate&quot;</span><span class="p">)</span>
</span><span id="__span-413-21"><a id="__codelineno-413-21" name="__codelineno-413-21" href="#__codelineno-413-21"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteEntity</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-413-22"><a id="__codelineno-413-22" name="__codelineno-413-22" href="#__codelineno-413-22"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteTable</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-413-23"><a id="__codelineno-413-23" name="__codelineno-413-23" href="#__codelineno-413-23"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">()</span>
</span><span id="__span-413-24"><a id="__codelineno-413-24" name="__codelineno-413-24" href="#__codelineno-413-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-413-25"><a id="__codelineno-413-25" name="__codelineno-413-25" href="#__codelineno-413-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onentitypersisted">OnEntityPersisted</h3>
<p><strong>Purpose</strong></p>
<p>Called when an entity is persisted to the database</p>
<p><strong>When Called</strong></p>
<p>When an entity's data is saved to the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The entity being saved</li>
<li><code>entData</code> (<em>table</em>): The entity data being saved</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-414-1"><a id="__codelineno-414-1" name="__codelineno-414-1" href="#__codelineno-414-1"></a><span class="c1">-- Simple: Log entity persistence</span>
</span><span id="__span-414-2"><a id="__codelineno-414-2" name="__codelineno-414-2" href="#__codelineno-414-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersisted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">entData</span><span class="p">)</span>
</span><span id="__span-414-3"><a id="__codelineno-414-3" name="__codelineno-414-3" href="#__codelineno-414-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entity persisted: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-414-4"><a id="__codelineno-414-4" name="__codelineno-414-4" href="#__codelineno-414-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-415-1"><a id="__codelineno-415-1" name="__codelineno-415-1" href="#__codelineno-415-1"></a><span class="c1">-- Medium: Track entity saves</span>
</span><span id="__span-415-2"><a id="__codelineno-415-2" name="__codelineno-415-2" href="#__codelineno-415-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersisted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackEntitySaves&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">entData</span><span class="p">)</span>
</span><span id="__span-415-3"><a id="__codelineno-415-3" name="__codelineno-415-3" href="#__codelineno-415-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">savedEntities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">savedEntities</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-415-4"><a id="__codelineno-415-4" name="__codelineno-415-4" href="#__codelineno-415-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">savedEntities</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-415-5"><a id="__codelineno-415-5" name="__codelineno-415-5" href="#__codelineno-415-5"></a><span class="nv">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">,</span>
</span><span id="__span-415-6"><a id="__codelineno-415-6" name="__codelineno-415-6" href="#__codelineno-415-6"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-415-7"><a id="__codelineno-415-7" name="__codelineno-415-7" href="#__codelineno-415-7"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-415-8"><a id="__codelineno-415-8" name="__codelineno-415-8" href="#__codelineno-415-8"></a><span class="p">})</span>
</span><span id="__span-415-9"><a id="__codelineno-415-9" name="__codelineno-415-9" href="#__codelineno-415-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-416-1"><a id="__codelineno-416-1" name="__codelineno-416-1" href="#__codelineno-416-1"></a><span class="c1">-- High: Complex entity persistence handling</span>
</span><span id="__span-416-2"><a id="__codelineno-416-2" name="__codelineno-416-2" href="#__codelineno-416-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnEntityPersisted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedEntityPersistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">entData</span><span class="p">)</span>
</span><span id="__span-416-3"><a id="__codelineno-416-3" name="__codelineno-416-3" href="#__codelineno-416-3"></a><span class="c1">-- Log entity persistence</span>
</span><span id="__span-416-4"><a id="__codelineno-416-4" name="__codelineno-416-4" href="#__codelineno-416-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;entity_persisted&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-416-5"><a id="__codelineno-416-5" name="__codelineno-416-5" href="#__codelineno-416-5"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-416-6"><a id="__codelineno-416-6" name="__codelineno-416-6" href="#__codelineno-416-6"></a><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-416-7"><a id="__codelineno-416-7" name="__codelineno-416-7" href="#__codelineno-416-7"></a><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">entData</span><span class="p">),</span>
</span><span id="__span-416-8"><a id="__codelineno-416-8" name="__codelineno-416-8" href="#__codelineno-416-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-416-9"><a id="__codelineno-416-9" name="__codelineno-416-9" href="#__codelineno-416-9"></a><span class="p">})</span>
</span><span id="__span-416-10"><a id="__codelineno-416-10" name="__codelineno-416-10" href="#__codelineno-416-10"></a><span class="c1">-- Validate data before saving</span>
</span><span id="__span-416-11"><a id="__codelineno-416-11" name="__codelineno-416-11" href="#__codelineno-416-11"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">entData</span><span class="p">.</span><span class="py">position</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">entData</span><span class="p">.</span><span class="py">angles</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-416-12"><a id="__codelineno-416-12" name="__codelineno-416-12" href="#__codelineno-416-12"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Incomplete entity data for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-416-13"><a id="__codelineno-416-13" name="__codelineno-416-13" href="#__codelineno-416-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-416-14"><a id="__codelineno-416-14" name="__codelineno-416-14" href="#__codelineno-416-14"></a><span class="c1">-- Add custom persistence data</span>
</span><span id="__span-416-15"><a id="__codelineno-416-15" name="__codelineno-416-15" href="#__codelineno-416-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">GetCustomPersistenceData</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-416-16"><a id="__codelineno-416-16" name="__codelineno-416-16" href="#__codelineno-416-16"></a><span class="w">    </span><span class="nv">entData</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetCustomPersistenceData</span><span class="p">()</span>
</span><span id="__span-416-17"><a id="__codelineno-416-17" name="__codelineno-416-17" href="#__codelineno-416-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-416-18"><a id="__codelineno-416-18" name="__codelineno-416-18" href="#__codelineno-416-18"></a><span class="c1">-- Update entity statistics</span>
</span><span id="__span-416-19"><a id="__codelineno-416-19" name="__codelineno-416-19" href="#__codelineno-416-19"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;entityStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-416-20"><a id="__codelineno-416-20" name="__codelineno-416-20" href="#__codelineno-416-20"></a><span class="nv">stats</span><span class="p">[</span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">stats</span><span class="p">[</span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-416-21"><a id="__codelineno-416-21" name="__codelineno-416-21" href="#__codelineno-416-21"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;entityStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-416-22"><a id="__codelineno-416-22" name="__codelineno-416-22" href="#__codelineno-416-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onitemadded">OnItemAdded</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is added to an inventory</p>
<p><strong>When Called</strong></p>
<p>When an item is successfully added to any inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>owner</code> (<em>Player|Character</em>): The owner of the inventory</li>
<li><code>item</code> (<em>Item</em>): The item that was added</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-417-1"><a id="__codelineno-417-1" name="__codelineno-417-1" href="#__codelineno-417-1"></a><span class="c1">-- Simple: Log item additions</span>
</span><span id="__span-417-2"><a id="__codelineno-417-2" name="__codelineno-417-2" href="#__codelineno-417-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-417-3"><a id="__codelineno-417-3" name="__codelineno-417-3" href="#__codelineno-417-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; added to inventory&quot;</span><span class="p">)</span>
</span><span id="__span-417-4"><a id="__codelineno-417-4" name="__codelineno-417-4" href="#__codelineno-417-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-418-1"><a id="__codelineno-418-1" name="__codelineno-418-1" href="#__codelineno-418-1"></a><span class="c1">-- Medium: Handle special item effects</span>
</span><span id="__span-418-2"><a id="__codelineno-418-2" name="__codelineno-418-2" href="#__codelineno-418-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-418-3"><a id="__codelineno-418-3" name="__codelineno-418-3" href="#__codelineno-418-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-418-4"><a id="__codelineno-418-4" name="__codelineno-418-4" href="#__codelineno-418-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-418-5"><a id="__codelineno-418-5" name="__codelineno-418-5" href="#__codelineno-418-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health_potion&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-418-6"><a id="__codelineno-418-6" name="__codelineno-418-6" href="#__codelineno-418-6"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;healthBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;healthBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">))</span>
</span><span id="__span-418-7"><a id="__codelineno-418-7" name="__codelineno-418-7" href="#__codelineno-418-7"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stamina_boost&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-418-8"><a id="__codelineno-418-8" name="__codelineno-418-8" href="#__codelineno-418-8"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;staminaBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;staminaBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-418-9"><a id="__codelineno-418-9" name="__codelineno-418-9" href="#__codelineno-418-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-418-10"><a id="__codelineno-418-10" name="__codelineno-418-10" href="#__codelineno-418-10"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-419-1"><a id="__codelineno-419-1" name="__codelineno-419-1" href="#__codelineno-419-1"></a><span class="c1">-- High: Complex item management system</span>
</span><span id="__span-419-2"><a id="__codelineno-419-2" name="__codelineno-419-2" href="#__codelineno-419-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemAdded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-419-3"><a id="__codelineno-419-3" name="__codelineno-419-3" href="#__codelineno-419-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-419-4"><a id="__codelineno-419-4" name="__codelineno-419-4" href="#__codelineno-419-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-419-5"><a id="__codelineno-419-5" name="__codelineno-419-5" href="#__codelineno-419-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-419-6"><a id="__codelineno-419-6" name="__codelineno-419-6" href="#__codelineno-419-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-419-7"><a id="__codelineno-419-7" name="__codelineno-419-7" href="#__codelineno-419-7"></a><span class="w">        </span><span class="c1">-- Check for set bonuses</span>
</span><span id="__span-419-8"><a id="__codelineno-419-8" name="__codelineno-419-8" href="#__codelineno-419-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-419-9"><a id="__codelineno-419-9" name="__codelineno-419-9" href="#__codelineno-419-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-419-10"><a id="__codelineno-419-10" name="__codelineno-419-10" href="#__codelineno-419-10"></a><span class="w">        </span><span class="c1">-- Check for armor set</span>
</span><span id="__span-419-11"><a id="__codelineno-419-11" name="__codelineno-419-11" href="#__codelineno-419-11"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-419-12"><a id="__codelineno-419-12" name="__codelineno-419-12" href="#__codelineno-419-12"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">invItem</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-419-13"><a id="__codelineno-419-13" name="__codelineno-419-13" href="#__codelineno-419-13"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nv">invItem</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;armor_&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-14"><a id="__codelineno-419-14" name="__codelineno-419-14" href="#__codelineno-419-14"></a><span class="w">                </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-419-15"><a id="__codelineno-419-15" name="__codelineno-419-15" href="#__codelineno-419-15"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-419-16"><a id="__codelineno-419-16" name="__codelineno-419-16" href="#__codelineno-419-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-419-17"><a id="__codelineno-419-17" name="__codelineno-419-17" href="#__codelineno-419-17"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">armorPieces</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-18"><a id="__codelineno-419-18" name="__codelineno-419-18" href="#__codelineno-419-18"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;armorSetBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-419-19"><a id="__codelineno-419-19" name="__codelineno-419-19" href="#__codelineno-419-19"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Armor set bonus activated!&quot;</span><span class="p">)</span>
</span><span id="__span-419-20"><a id="__codelineno-419-20" name="__codelineno-419-20" href="#__codelineno-419-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-419-21"><a id="__codelineno-419-21" name="__codelineno-419-21" href="#__codelineno-419-21"></a><span class="w">        </span><span class="c1">-- Check for weapon upgrades</span>
</span><span id="__span-419-22"><a id="__codelineno-419-22" name="__codelineno-419-22" href="#__codelineno-419-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_upgrade&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-23"><a id="__codelineno-419-23" name="__codelineno-419-23" href="#__codelineno-419-23"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">weapon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">hasItem</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
</span><span id="__span-419-24"><a id="__codelineno-419-24" name="__codelineno-419-24" href="#__codelineno-419-24"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">weapon</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-25"><a id="__codelineno-419-25" name="__codelineno-419-25" href="#__codelineno-419-25"></a><span class="w">                </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-419-26"><a id="__codelineno-419-26" name="__codelineno-419-26" href="#__codelineno-419-26"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Weapon upgraded!&quot;</span><span class="p">)</span>
</span><span id="__span-419-27"><a id="__codelineno-419-27" name="__codelineno-419-27" href="#__codelineno-419-27"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-419-28"><a id="__codelineno-419-28" name="__codelineno-419-28" href="#__codelineno-419-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-419-29"><a id="__codelineno-419-29" name="__codelineno-419-29" href="#__codelineno-419-29"></a><span class="w">        </span><span class="c1">-- Check for quest items</span>
</span><span id="__span-419-30"><a id="__codelineno-419-30" name="__codelineno-419-30" href="#__codelineno-419-30"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-31"><a id="__codelineno-419-31" name="__codelineno-419-31" href="#__codelineno-419-31"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">questID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questID&quot;</span><span class="p">)</span>
</span><span id="__span-419-32"><a id="__codelineno-419-32" name="__codelineno-419-32" href="#__codelineno-419-32"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">questID</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-419-33"><a id="__codelineno-419-33" name="__codelineno-419-33" href="#__codelineno-419-33"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;questProgress&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;questProgress&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})[</span><span class="nv">questID</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-419-34"><a id="__codelineno-419-34" name="__codelineno-419-34" href="#__codelineno-419-34"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Quest progress updated!&quot;</span><span class="p">)</span>
</span><span id="__span-419-35"><a id="__codelineno-419-35" name="__codelineno-419-35" href="#__codelineno-419-35"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-419-36"><a id="__codelineno-419-36" name="__codelineno-419-36" href="#__codelineno-419-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-419-37"><a id="__codelineno-419-37" name="__codelineno-419-37" href="#__codelineno-419-37"></a><span class="w">        </span><span class="c1">-- Update inventory weight</span>
</span><span id="__span-419-38"><a id="__codelineno-419-38" name="__codelineno-419-38" href="#__codelineno-419-38"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-419-39"><a id="__codelineno-419-39" name="__codelineno-419-39" href="#__codelineno-419-39"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;currentWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-419-40"><a id="__codelineno-419-40" name="__codelineno-419-40" href="#__codelineno-419-40"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;currentWeight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="p">)</span>
</span><span id="__span-419-41"><a id="__codelineno-419-41" name="__codelineno-419-41" href="#__codelineno-419-41"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onitemcreated">OnItemCreated</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item instance is created</p>
<p><strong>When Called</strong></p>
<p>When a new item instance is created from an item table</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>itemTable</code> (<em>table</em>): The item table definition</li>
<li><code>self</code> (<em>Item</em>): The item instance being created</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-420-1"><a id="__codelineno-420-1" name="__codelineno-420-1" href="#__codelineno-420-1"></a><span class="c1">-- Simple: Log item creation</span>
</span><span id="__span-420-2"><a id="__codelineno-420-2" name="__codelineno-420-2" href="#__codelineno-420-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-420-3"><a id="__codelineno-420-3" name="__codelineno-420-3" href="#__codelineno-420-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item created: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-420-4"><a id="__codelineno-420-4" name="__codelineno-420-4" href="#__codelineno-420-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-421-1"><a id="__codelineno-421-1" name="__codelineno-421-1" href="#__codelineno-421-1"></a><span class="c1">-- Medium: Set up item-specific data</span>
</span><span id="__span-421-2"><a id="__codelineno-421-2" name="__codelineno-421-2" href="#__codelineno-421-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-421-3"><a id="__codelineno-421-3" name="__codelineno-421-3" href="#__codelineno-421-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-421-4"><a id="__codelineno-421-4" name="__codelineno-421-4" href="#__codelineno-421-4"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ammo&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</span><span id="__span-421-5"><a id="__codelineno-421-5" name="__codelineno-421-5" href="#__codelineno-421-5"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-421-6"><a id="__codelineno-421-6" name="__codelineno-421-6" href="#__codelineno-421-6"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health_potion&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-421-7"><a id="__codelineno-421-7" name="__codelineno-421-7" href="#__codelineno-421-7"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;healAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-421-8"><a id="__codelineno-421-8" name="__codelineno-421-8" href="#__codelineno-421-8"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;uses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-421-9"><a id="__codelineno-421-9" name="__codelineno-421-9" href="#__codelineno-421-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-421-10"><a id="__codelineno-421-10" name="__codelineno-421-10" href="#__codelineno-421-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-422-1"><a id="__codelineno-422-1" name="__codelineno-422-1" href="#__codelineno-422-1"></a><span class="c1">-- High: Complex item creation system</span>
</span><span id="__span-422-2"><a id="__codelineno-422-2" name="__codelineno-422-2" href="#__codelineno-422-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTable</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-422-3"><a id="__codelineno-422-3" name="__codelineno-422-3" href="#__codelineno-422-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-422-4"><a id="__codelineno-422-4" name="__codelineno-422-4" href="#__codelineno-422-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-422-5"><a id="__codelineno-422-5" name="__codelineno-422-5" href="#__codelineno-422-5"></a><span class="w">    </span><span class="c1">-- Set up item quality</span>
</span><span id="__span-422-6"><a id="__codelineno-422-6" name="__codelineno-422-6" href="#__codelineno-422-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;common&quot;</span><span class="p">)</span>
</span><span id="__span-422-7"><a id="__codelineno-422-7" name="__codelineno-422-7" href="#__codelineno-422-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">qualityMultipliers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-422-8"><a id="__codelineno-422-8" name="__codelineno-422-8" href="#__codelineno-422-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;common&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-422-9"><a id="__codelineno-422-9" name="__codelineno-422-9" href="#__codelineno-422-9"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;uncommon&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
</span><span id="__span-422-10"><a id="__codelineno-422-10" name="__codelineno-422-10" href="#__codelineno-422-10"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;rare&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="__span-422-11"><a id="__codelineno-422-11" name="__codelineno-422-11" href="#__codelineno-422-11"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;epic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
</span><span id="__span-422-12"><a id="__codelineno-422-12" name="__codelineno-422-12" href="#__codelineno-422-12"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;legendary&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span>
</span><span id="__span-422-13"><a id="__codelineno-422-13" name="__codelineno-422-13" href="#__codelineno-422-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-422-14"><a id="__codelineno-422-14" name="__codelineno-422-14" href="#__codelineno-422-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">qualityMultipliers</span><span class="p">[</span><span class="nv">quality</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mf">1.0</span>
</span><span id="__span-422-15"><a id="__codelineno-422-15" name="__codelineno-422-15" href="#__codelineno-422-15"></a><span class="w">    </span><span class="c1">-- Apply quality bonuses</span>
</span><span id="__span-422-16"><a id="__codelineno-422-16" name="__codelineno-422-16" href="#__codelineno-422-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-17"><a id="__codelineno-422-17" name="__codelineno-422-17" href="#__codelineno-422-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-422-18"><a id="__codelineno-422-18" name="__codelineno-422-18" href="#__codelineno-422-18"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">baseDamage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">multiplier</span><span class="p">))</span>
</span><span id="__span-422-19"><a id="__codelineno-422-19" name="__codelineno-422-19" href="#__codelineno-422-19"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">multiplier</span><span class="p">))</span>
</span><span id="__span-422-20"><a id="__codelineno-422-20" name="__codelineno-422-20" href="#__codelineno-422-20"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">itemTable</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;armor_vest&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-21"><a id="__codelineno-422-21" name="__codelineno-422-21" href="#__codelineno-422-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">baseProtection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-422-22"><a id="__codelineno-422-22" name="__codelineno-422-22" href="#__codelineno-422-22"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;protection&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">baseProtection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">multiplier</span><span class="p">))</span>
</span><span id="__span-422-23"><a id="__codelineno-422-23" name="__codelineno-422-23" href="#__codelineno-422-23"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="mi">200</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">multiplier</span><span class="p">))</span>
</span><span id="__span-422-24"><a id="__codelineno-422-24" name="__codelineno-422-24" href="#__codelineno-422-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-422-25"><a id="__codelineno-422-25" name="__codelineno-422-25" href="#__codelineno-422-25"></a><span class="w">    </span><span class="c1">-- Set up item level</span>
</span><span id="__span-422-26"><a id="__codelineno-422-26" name="__codelineno-422-26" href="#__codelineno-422-26"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-422-27"><a id="__codelineno-422-27" name="__codelineno-422-27" href="#__codelineno-422-27"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">itemLevel</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-28"><a id="__codelineno-422-28" name="__codelineno-422-28" href="#__codelineno-422-28"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">levelBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">itemLevel</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span>
</span><span id="__span-422-29"><a id="__codelineno-422-29" name="__codelineno-422-29" href="#__codelineno-422-29"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-422-30"><a id="__codelineno-422-30" name="__codelineno-422-30" href="#__codelineno-422-30"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">currentValue</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">levelBonus</span><span class="p">)))</span>
</span><span id="__span-422-31"><a id="__codelineno-422-31" name="__codelineno-422-31" href="#__codelineno-422-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-422-32"><a id="__codelineno-422-32" name="__codelineno-422-32" href="#__codelineno-422-32"></a><span class="w">    </span><span class="c1">-- Set up item enchantments</span>
</span><span id="__span-422-33"><a id="__codelineno-422-33" name="__codelineno-422-33" href="#__codelineno-422-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">enchantments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;enchantments&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-422-34"><a id="__codelineno-422-34" name="__codelineno-422-34" href="#__codelineno-422-34"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">enchantments</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-35"><a id="__codelineno-422-35" name="__codelineno-422-35" href="#__codelineno-422-35"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">enchant</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">enchantments</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-422-36"><a id="__codelineno-422-36" name="__codelineno-422-36" href="#__codelineno-422-36"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">enchant</span><span class="p">.</span><span class="py">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;fire&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-37"><a id="__codelineno-422-37" name="__codelineno-422-37" href="#__codelineno-422-37"></a><span class="w">                </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;fireDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;fireDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">enchant</span><span class="p">.</span><span class="py">value</span><span class="p">))</span>
</span><span id="__span-422-38"><a id="__codelineno-422-38" name="__codelineno-422-38" href="#__codelineno-422-38"></a><span class="w">            </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">enchant</span><span class="p">.</span><span class="py">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ice&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-39"><a id="__codelineno-422-39" name="__codelineno-422-39" href="#__codelineno-422-39"></a><span class="w">                </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;iceDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;iceDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">enchant</span><span class="p">.</span><span class="py">value</span><span class="p">))</span>
</span><span id="__span-422-40"><a id="__codelineno-422-40" name="__codelineno-422-40" href="#__codelineno-422-40"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-422-41"><a id="__codelineno-422-41" name="__codelineno-422-41" href="#__codelineno-422-41"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-422-42"><a id="__codelineno-422-42" name="__codelineno-422-42" href="#__codelineno-422-42"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-422-43"><a id="__codelineno-422-43" name="__codelineno-422-43" href="#__codelineno-422-43"></a><span class="w">    </span><span class="c1">-- Set up item binding</span>
</span><span id="__span-422-44"><a id="__codelineno-422-44" name="__codelineno-422-44" href="#__codelineno-422-44"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bindOnPickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-422-45"><a id="__codelineno-422-45" name="__codelineno-422-45" href="#__codelineno-422-45"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;boundTo&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-422-46"><a id="__codelineno-422-46" name="__codelineno-422-46" href="#__codelineno-422-46"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-422-47"><a id="__codelineno-422-47" name="__codelineno-422-47" href="#__codelineno-422-47"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onitemspawned">OnItemSpawned</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item entity is spawned in the world</p>
<p><strong>When Called</strong></p>
<p>When an item is dropped or spawned as a world entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The item entity that was spawned</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-423-1"><a id="__codelineno-423-1" name="__codelineno-423-1" href="#__codelineno-423-1"></a><span class="c1">-- Simple: Log item spawning</span>
</span><span id="__span-423-2"><a id="__codelineno-423-2" name="__codelineno-423-2" href="#__codelineno-423-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemSpawned&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-423-3"><a id="__codelineno-423-3" name="__codelineno-423-3" href="#__codelineno-423-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item spawned: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetItem</span><span class="p">().</span><span class="nv">uniqueID</span><span class="p">)</span>
</span><span id="__span-423-4"><a id="__codelineno-423-4" name="__codelineno-423-4" href="#__codelineno-423-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-424-1"><a id="__codelineno-424-1" name="__codelineno-424-1" href="#__codelineno-424-1"></a><span class="c1">-- Medium: Set up item physics</span>
</span><span id="__span-424-2"><a id="__codelineno-424-2" name="__codelineno-424-2" href="#__codelineno-424-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemSpawned&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemPhysics&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-424-3"><a id="__codelineno-424-3" name="__codelineno-424-3" href="#__codelineno-424-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetItem</span><span class="p">()</span>
</span><span id="__span-424-4"><a id="__codelineno-424-4" name="__codelineno-424-4" href="#__codelineno-424-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;heavy_box&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-424-5"><a id="__codelineno-424-5" name="__codelineno-424-5" href="#__codelineno-424-5"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetPhysicsAttacker</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetOwner</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-424-6"><a id="__codelineno-424-6" name="__codelineno-424-6" href="#__codelineno-424-6"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPhysicsObject</span><span class="p">():</span><span class="nf">SetMass</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-424-7"><a id="__codelineno-424-7" name="__codelineno-424-7" href="#__codelineno-424-7"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;fragile_item&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-424-8"><a id="__codelineno-424-8" name="__codelineno-424-8" href="#__codelineno-424-8"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetPhysicsAttacker</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetOwner</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-424-9"><a id="__codelineno-424-9" name="__codelineno-424-9" href="#__codelineno-424-9"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPhysicsObject</span><span class="p">():</span><span class="nf">SetMass</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-424-10"><a id="__codelineno-424-10" name="__codelineno-424-10" href="#__codelineno-424-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-424-11"><a id="__codelineno-424-11" name="__codelineno-424-11" href="#__codelineno-424-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-425-1"><a id="__codelineno-425-1" name="__codelineno-425-1" href="#__codelineno-425-1"></a><span class="c1">-- High: Complex item spawning system</span>
</span><span id="__span-425-2"><a id="__codelineno-425-2" name="__codelineno-425-2" href="#__codelineno-425-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnItemSpawned&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemSpawning&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-425-3"><a id="__codelineno-425-3" name="__codelineno-425-3" href="#__codelineno-425-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetItem</span><span class="p">()</span>
</span><span id="__span-425-4"><a id="__codelineno-425-4" name="__codelineno-425-4" href="#__codelineno-425-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-425-5"><a id="__codelineno-425-5" name="__codelineno-425-5" href="#__codelineno-425-5"></a><span class="w">    </span><span class="c1">-- Set up item glow effects</span>
</span><span id="__span-425-6"><a id="__codelineno-425-6" name="__codelineno-425-6" href="#__codelineno-425-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;glow&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-7"><a id="__codelineno-425-7" name="__codelineno-425-7" href="#__codelineno-425-7"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetMaterial</span><span class="p">(</span><span class="s2">&quot;models/effects/comball_tape&quot;</span><span class="p">)</span>
</span><span id="__span-425-8"><a id="__codelineno-425-8" name="__codelineno-425-8" href="#__codelineno-425-8"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetColor</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">))</span>
</span><span id="__span-425-9"><a id="__codelineno-425-9" name="__codelineno-425-9" href="#__codelineno-425-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-10"><a id="__codelineno-425-10" name="__codelineno-425-10" href="#__codelineno-425-10"></a><span class="w">    </span><span class="c1">-- Set up item size</span>
</span><span id="__span-425-11"><a id="__codelineno-425-11" name="__codelineno-425-11" href="#__codelineno-425-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-425-12"><a id="__codelineno-425-12" name="__codelineno-425-12" href="#__codelineno-425-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">scale</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-13"><a id="__codelineno-425-13" name="__codelineno-425-13" href="#__codelineno-425-13"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetModelScale</span><span class="p">(</span><span class="nv">scale</span><span class="p">)</span>
</span><span id="__span-425-14"><a id="__codelineno-425-14" name="__codelineno-425-14" href="#__codelineno-425-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-15"><a id="__codelineno-425-15" name="__codelineno-425-15" href="#__codelineno-425-15"></a><span class="w">    </span><span class="c1">-- Set up item physics</span>
</span><span id="__span-425-16"><a id="__codelineno-425-16" name="__codelineno-425-16" href="#__codelineno-425-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">physics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPhysicsObject</span><span class="p">()</span>
</span><span id="__span-425-17"><a id="__codelineno-425-17" name="__codelineno-425-17" href="#__codelineno-425-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">physics</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-18"><a id="__codelineno-425-18" name="__codelineno-425-18" href="#__codelineno-425-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-425-19"><a id="__codelineno-425-19" name="__codelineno-425-19" href="#__codelineno-425-19"></a><span class="w">        </span><span class="nv">physics</span><span class="p">:</span><span class="nf">SetMass</span><span class="p">(</span><span class="nv">weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-425-20"><a id="__codelineno-425-20" name="__codelineno-425-20" href="#__codelineno-425-20"></a><span class="w">        </span><span class="c1">-- Set up friction</span>
</span><span id="__span-425-21"><a id="__codelineno-425-21" name="__codelineno-425-21" href="#__codelineno-425-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">friction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;friction&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-425-22"><a id="__codelineno-425-22" name="__codelineno-425-22" href="#__codelineno-425-22"></a><span class="w">        </span><span class="nv">physics</span><span class="p">:</span><span class="nf">SetMaterial</span><span class="p">(</span><span class="s2">&quot;friction_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">friction</span><span class="p">)</span>
</span><span id="__span-425-23"><a id="__codelineno-425-23" name="__codelineno-425-23" href="#__codelineno-425-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-24"><a id="__codelineno-425-24" name="__codelineno-425-24" href="#__codelineno-425-24"></a><span class="w">    </span><span class="c1">-- Set up item lifetime</span>
</span><span id="__span-425-25"><a id="__codelineno-425-25" name="__codelineno-425-25" href="#__codelineno-425-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lifetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lifetime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-425-26"><a id="__codelineno-425-26" name="__codelineno-425-26" href="#__codelineno-425-26"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">lifetime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-27"><a id="__codelineno-425-27" name="__codelineno-425-27" href="#__codelineno-425-27"></a><span class="w">        </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="nv">lifetime</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-425-28"><a id="__codelineno-425-28" name="__codelineno-425-28" href="#__codelineno-425-28"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-29"><a id="__codelineno-425-29" name="__codelineno-425-29" href="#__codelineno-425-29"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">Remove</span><span class="p">()</span>
</span><span id="__span-425-30"><a id="__codelineno-425-30" name="__codelineno-425-30" href="#__codelineno-425-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-425-31"><a id="__codelineno-425-31" name="__codelineno-425-31" href="#__codelineno-425-31"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-425-32"><a id="__codelineno-425-32" name="__codelineno-425-32" href="#__codelineno-425-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-33"><a id="__codelineno-425-33" name="__codelineno-425-33" href="#__codelineno-425-33"></a><span class="w">    </span><span class="c1">-- Set up item protection</span>
</span><span id="__span-425-34"><a id="__codelineno-425-34" name="__codelineno-425-34" href="#__codelineno-425-34"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;protected&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-35"><a id="__codelineno-425-35" name="__codelineno-425-35" href="#__codelineno-425-35"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetCollisionGroup</span><span class="p">(</span><span class="nv">COLLISION_GROUP_WORLD</span><span class="p">)</span>
</span><span id="__span-425-36"><a id="__codelineno-425-36" name="__codelineno-425-36" href="#__codelineno-425-36"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetSolid</span><span class="p">(</span><span class="nv">SOLID_VPHYSICS</span><span class="p">)</span>
</span><span id="__span-425-37"><a id="__codelineno-425-37" name="__codelineno-425-37" href="#__codelineno-425-37"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-38"><a id="__codelineno-425-38" name="__codelineno-425-38" href="#__codelineno-425-38"></a><span class="w">    </span><span class="c1">-- Set up item sound</span>
</span><span id="__span-425-39"><a id="__codelineno-425-39" name="__codelineno-425-39" href="#__codelineno-425-39"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;dropSound&quot;</span><span class="p">)</span>
</span><span id="__span-425-40"><a id="__codelineno-425-40" name="__codelineno-425-40" href="#__codelineno-425-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">sound</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-425-41"><a id="__codelineno-425-41" name="__codelineno-425-41" href="#__codelineno-425-41"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">EmitSound</span><span class="p">(</span><span class="nv">sound</span><span class="p">)</span>
</span><span id="__span-425-42"><a id="__codelineno-425-42" name="__codelineno-425-42" href="#__codelineno-425-42"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-425-43"><a id="__codelineno-425-43" name="__codelineno-425-43" href="#__codelineno-425-43"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onloadtables">OnLoadTables</h3>
<p><strong>Purpose</strong></p>
<p>Called when database tables are being loaded</p>
<p><strong>When Called</strong></p>
<p>During database initialization when tables are loaded</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-426-1"><a id="__codelineno-426-1" name="__codelineno-426-1" href="#__codelineno-426-1"></a><span class="c1">-- Simple: Log table loading</span>
</span><span id="__span-426-2"><a id="__codelineno-426-2" name="__codelineno-426-2" href="#__codelineno-426-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnLoadTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-426-3"><a id="__codelineno-426-3" name="__codelineno-426-3" href="#__codelineno-426-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database tables are being loaded&quot;</span><span class="p">)</span>
</span><span id="__span-426-4"><a id="__codelineno-426-4" name="__codelineno-426-4" href="#__codelineno-426-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-427-1"><a id="__codelineno-427-1" name="__codelineno-427-1" href="#__codelineno-427-1"></a><span class="c1">-- Medium: Initialize custom tables</span>
</span><span id="__span-427-2"><a id="__codelineno-427-2" name="__codelineno-427-2" href="#__codelineno-427-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnLoadTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InitCustomTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-427-3"><a id="__codelineno-427-3" name="__codelineno-427-3" href="#__codelineno-427-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS custom_data (id INT PRIMARY KEY, data TEXT)&quot;</span><span class="p">)</span>
</span><span id="__span-427-4"><a id="__codelineno-427-4" name="__codelineno-427-4" href="#__codelineno-427-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom tables initialized&quot;</span><span class="p">)</span>
</span><span id="__span-427-5"><a id="__codelineno-427-5" name="__codelineno-427-5" href="#__codelineno-427-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-428-1"><a id="__codelineno-428-1" name="__codelineno-428-1" href="#__codelineno-428-1"></a><span class="c1">-- High: Complex table initialization and migration</span>
</span><span id="__span-428-2"><a id="__codelineno-428-2" name="__codelineno-428-2" href="#__codelineno-428-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnLoadTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTableSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-428-3"><a id="__codelineno-428-3" name="__codelineno-428-3" href="#__codelineno-428-3"></a><span class="c1">-- Create custom tables</span>
</span><span id="__span-428-4"><a id="__codelineno-428-4" name="__codelineno-428-4" href="#__codelineno-428-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS player_stats (steamid VARCHAR(255) PRIMARY KEY, kills INT, deaths INT, playtime INT)&quot;</span><span class="p">)</span>
</span><span id="__span-428-5"><a id="__codelineno-428-5" name="__codelineno-428-5" href="#__codelineno-428-5"></a><span class="c1">-- Check for table migrations</span>
</span><span id="__span-428-6"><a id="__codelineno-428-6" name="__codelineno-428-6" href="#__codelineno-428-6"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM information_schema.columns WHERE table_name = &#39;player_stats&#39; AND column_name = &#39;score&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-428-7"><a id="__codelineno-428-7" name="__codelineno-428-7" href="#__codelineno-428-7"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">#</span><span class="nv">data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-428-8"><a id="__codelineno-428-8" name="__codelineno-428-8" href="#__codelineno-428-8"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;ALTER TABLE player_stats ADD COLUMN score INT DEFAULT 0&quot;</span><span class="p">)</span>
</span><span id="__span-428-9"><a id="__codelineno-428-9" name="__codelineno-428-9" href="#__codelineno-428-9"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Migrated player_stats table&quot;</span><span class="p">)</span>
</span><span id="__span-428-10"><a id="__codelineno-428-10" name="__codelineno-428-10" href="#__codelineno-428-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-428-11"><a id="__codelineno-428-11" name="__codelineno-428-11" href="#__codelineno-428-11"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-428-12"><a id="__codelineno-428-12" name="__codelineno-428-12" href="#__codelineno-428-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onoocmessagesent">OnOOCMessageSent</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player sends an OOC (Out of Character) message</p>
<p><strong>When Called</strong></p>
<p>When a player sends a message in OOC chat</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player sending the message</li>
<li><code>message</code> (<em>string</em>): The OOC message text</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-429-1"><a id="__codelineno-429-1" name="__codelineno-429-1" href="#__codelineno-429-1"></a><span class="c1">-- Simple: Log OOC messages</span>
</span><span id="__span-429-2"><a id="__codelineno-429-2" name="__codelineno-429-2" href="#__codelineno-429-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnOOCMessageSent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-429-3"><a id="__codelineno-429-3" name="__codelineno-429-3" href="#__codelineno-429-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; sent OOC: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-429-4"><a id="__codelineno-429-4" name="__codelineno-429-4" href="#__codelineno-429-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-430-1"><a id="__codelineno-430-1" name="__codelineno-430-1" href="#__codelineno-430-1"></a><span class="c1">-- Medium: Filter OOC messages</span>
</span><span id="__span-430-2"><a id="__codelineno-430-2" name="__codelineno-430-2" href="#__codelineno-430-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnOOCMessageSent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;OOCFiltering&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-430-3"><a id="__codelineno-430-3" name="__codelineno-430-3" href="#__codelineno-430-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-430-4"><a id="__codelineno-430-4" name="__codelineno-430-4" href="#__codelineno-430-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-430-5"><a id="__codelineno-430-5" name="__codelineno-430-5" href="#__codelineno-430-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need a character to use OOC chat&quot;</span><span class="p">)</span>
</span><span id="__span-430-6"><a id="__codelineno-430-6" name="__codelineno-430-6" href="#__codelineno-430-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-430-7"><a id="__codelineno-430-7" name="__codelineno-430-7" href="#__codelineno-430-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-430-8"><a id="__codelineno-430-8" name="__codelineno-430-8" href="#__codelineno-430-8"></a><span class="c1">-- Check if player is muted</span>
</span><span id="__span-430-9"><a id="__codelineno-430-9" name="__codelineno-430-9" href="#__codelineno-430-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;muted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-430-10"><a id="__codelineno-430-10" name="__codelineno-430-10" href="#__codelineno-430-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are muted and cannot send OOC messages&quot;</span><span class="p">)</span>
</span><span id="__span-430-11"><a id="__codelineno-430-11" name="__codelineno-430-11" href="#__codelineno-430-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-430-12"><a id="__codelineno-430-12" name="__codelineno-430-12" href="#__codelineno-430-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-430-13"><a id="__codelineno-430-13" name="__codelineno-430-13" href="#__codelineno-430-13"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-431-1"><a id="__codelineno-431-1" name="__codelineno-431-1" href="#__codelineno-431-1"></a><span class="c1">-- High: Complex OOC system</span>
</span><span id="__span-431-2"><a id="__codelineno-431-2" name="__codelineno-431-2" href="#__codelineno-431-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnOOCMessageSent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedOOC&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-431-3"><a id="__codelineno-431-3" name="__codelineno-431-3" href="#__codelineno-431-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-431-4"><a id="__codelineno-431-4" name="__codelineno-431-4" href="#__codelineno-431-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-5"><a id="__codelineno-431-5" name="__codelineno-431-5" href="#__codelineno-431-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need a character to use OOC chat&quot;</span><span class="p">)</span>
</span><span id="__span-431-6"><a id="__codelineno-431-6" name="__codelineno-431-6" href="#__codelineno-431-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-7"><a id="__codelineno-431-7" name="__codelineno-431-7" href="#__codelineno-431-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-8"><a id="__codelineno-431-8" name="__codelineno-431-8" href="#__codelineno-431-8"></a><span class="c1">-- Check if player is muted</span>
</span><span id="__span-431-9"><a id="__codelineno-431-9" name="__codelineno-431-9" href="#__codelineno-431-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;muted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-10"><a id="__codelineno-431-10" name="__codelineno-431-10" href="#__codelineno-431-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are muted and cannot send OOC messages&quot;</span><span class="p">)</span>
</span><span id="__span-431-11"><a id="__codelineno-431-11" name="__codelineno-431-11" href="#__codelineno-431-11"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-12"><a id="__codelineno-431-12" name="__codelineno-431-12" href="#__codelineno-431-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-13"><a id="__codelineno-431-13" name="__codelineno-431-13" href="#__codelineno-431-13"></a><span class="c1">-- Check if player is gagged</span>
</span><span id="__span-431-14"><a id="__codelineno-431-14" name="__codelineno-431-14" href="#__codelineno-431-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;gagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-15"><a id="__codelineno-431-15" name="__codelineno-431-15" href="#__codelineno-431-15"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are gagged and cannot send OOC messages&quot;</span><span class="p">)</span>
</span><span id="__span-431-16"><a id="__codelineno-431-16" name="__codelineno-431-16" href="#__codelineno-431-16"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-17"><a id="__codelineno-431-17" name="__codelineno-431-17" href="#__codelineno-431-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-18"><a id="__codelineno-431-18" name="__codelineno-431-18" href="#__codelineno-431-18"></a><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-431-19"><a id="__codelineno-431-19" name="__codelineno-431-19" href="#__codelineno-431-19"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-431-20"><a id="__codelineno-431-20" name="__codelineno-431-20" href="#__codelineno-431-20"></a><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-21"><a id="__codelineno-431-21" name="__codelineno-431-21" href="#__codelineno-431-21"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Police officers cannot use OOC chat&quot;</span><span class="p">)</span>
</span><span id="__span-431-22"><a id="__codelineno-431-22" name="__codelineno-431-22" href="#__codelineno-431-22"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-23"><a id="__codelineno-431-23" name="__codelineno-431-23" href="#__codelineno-431-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-24"><a id="__codelineno-431-24" name="__codelineno-431-24" href="#__codelineno-431-24"></a><span class="c1">-- Check for spam protection</span>
</span><span id="__span-431-25"><a id="__codelineno-431-25" name="__codelineno-431-25" href="#__codelineno-431-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastOOC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastOOC&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-431-26"><a id="__codelineno-431-26" name="__codelineno-431-26" href="#__codelineno-431-26"></a><span class="kd">local</span><span class="w"> </span><span class="nv">oocCooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1">-- 5 second cooldown for OOC</span>
</span><span id="__span-431-27"><a id="__codelineno-431-27" name="__codelineno-431-27" href="#__codelineno-431-27"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastOOC</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">oocCooldown</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-28"><a id="__codelineno-431-28" name="__codelineno-431-28" href="#__codelineno-431-28"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before sending another OOC message&quot;</span><span class="p">)</span>
</span><span id="__span-431-29"><a id="__codelineno-431-29" name="__codelineno-431-29" href="#__codelineno-431-29"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-30"><a id="__codelineno-431-30" name="__codelineno-431-30" href="#__codelineno-431-30"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-31"><a id="__codelineno-431-31" name="__codelineno-431-31" href="#__codelineno-431-31"></a><span class="c1">-- Check message length</span>
</span><span id="__span-431-32"><a id="__codelineno-431-32" name="__codelineno-431-32" href="#__codelineno-431-32"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.len</span><span class="p">(</span><span class="nv">message</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-33"><a id="__codelineno-431-33" name="__codelineno-431-33" href="#__codelineno-431-33"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;OOC message too long (max 200 characters)&quot;</span><span class="p">)</span>
</span><span id="__span-431-34"><a id="__codelineno-431-34" name="__codelineno-431-34" href="#__codelineno-431-34"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-35"><a id="__codelineno-431-35" name="__codelineno-431-35" href="#__codelineno-431-35"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-36"><a id="__codelineno-431-36" name="__codelineno-431-36" href="#__codelineno-431-36"></a><span class="c1">-- Check for inappropriate content</span>
</span><span id="__span-431-37"><a id="__codelineno-431-37" name="__codelineno-431-37" href="#__codelineno-431-37"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bannedWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cheat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;exploit&quot;</span><span class="p">}</span>
</span><span id="__span-431-38"><a id="__codelineno-431-38" name="__codelineno-431-38" href="#__codelineno-431-38"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bannedWords</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-431-39"><a id="__codelineno-431-39" name="__codelineno-431-39" href="#__codelineno-431-39"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">message</span><span class="p">),</span><span class="w"> </span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">word</span><span class="p">))</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-40"><a id="__codelineno-431-40" name="__codelineno-431-40" href="#__codelineno-431-40"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your OOC message was blocked for inappropriate content&quot;</span><span class="p">)</span>
</span><span id="__span-431-41"><a id="__codelineno-431-41" name="__codelineno-431-41" href="#__codelineno-431-41"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-42"><a id="__codelineno-431-42" name="__codelineno-431-42" href="#__codelineno-431-42"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-431-43"><a id="__codelineno-431-43" name="__codelineno-431-43" href="#__codelineno-431-43"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-44"><a id="__codelineno-431-44" name="__codelineno-431-44" href="#__codelineno-431-44"></a><span class="c1">-- Update last OOC time</span>
</span><span id="__span-431-45"><a id="__codelineno-431-45" name="__codelineno-431-45" href="#__codelineno-431-45"></a><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastOOC&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-431-46"><a id="__codelineno-431-46" name="__codelineno-431-46" href="#__codelineno-431-46"></a><span class="c1">-- Check for admin commands</span>
</span><span id="__span-431-47"><a id="__codelineno-431-47" name="__codelineno-431-47" href="#__codelineno-431-47"></a><span class="kr">if</span><span class="w"> </span><span class="nb">string.sub</span><span class="p">(</span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-48"><a id="__codelineno-431-48" name="__codelineno-431-48" href="#__codelineno-431-48"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">string.sub</span><span class="p">(</span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-431-49"><a id="__codelineno-431-49" name="__codelineno-431-49" href="#__codelineno-431-49"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">command</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-50"><a id="__codelineno-431-50" name="__codelineno-431-50" href="#__codelineno-431-50"></a><span class="w">        </span><span class="c1">-- Admin command</span>
</span><span id="__span-431-51"><a id="__codelineno-431-51" name="__codelineno-431-51" href="#__codelineno-431-51"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Admin command executed&quot;</span><span class="p">)</span>
</span><span id="__span-431-52"><a id="__codelineno-431-52" name="__codelineno-431-52" href="#__codelineno-431-52"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-431-53"><a id="__codelineno-431-53" name="__codelineno-431-53" href="#__codelineno-431-53"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-431-54"><a id="__codelineno-431-54" name="__codelineno-431-54" href="#__codelineno-431-54"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-55"><a id="__codelineno-431-55" name="__codelineno-431-55" href="#__codelineno-431-55"></a><span class="c1">-- Log OOC message</span>
</span><span id="__span-431-56"><a id="__codelineno-431-56" name="__codelineno-431-56" href="#__codelineno-431-56"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;[OOC] %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">message</span><span class="p">))</span>
</span><span id="__span-431-57"><a id="__codelineno-431-57" name="__codelineno-431-57" href="#__codelineno-431-57"></a><span class="c1">-- Notify admins of OOC usage</span>
</span><span id="__span-431-58"><a id="__codelineno-431-58" name="__codelineno-431-58" href="#__codelineno-431-58"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-431-59"><a id="__codelineno-431-59" name="__codelineno-431-59" href="#__codelineno-431-59"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-431-60"><a id="__codelineno-431-60" name="__codelineno-431-60" href="#__codelineno-431-60"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[OOC] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-431-61"><a id="__codelineno-431-61" name="__codelineno-431-61" href="#__codelineno-431-61"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-431-62"><a id="__codelineno-431-62" name="__codelineno-431-62" href="#__codelineno-431-62"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-431-63"><a id="__codelineno-431-63" name="__codelineno-431-63" href="#__codelineno-431-63"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onpac3parttransfered">OnPAC3PartTransfered</h3>
<p><strong>Purpose</strong></p>
<p>Called when a PAC3 part is transferred</p>
<p><strong>When Called</strong></p>
<p>When a PAC3 part is moved between players or inventories</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>part</code> (<em>table</em>): The PAC3 part data being transferred</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-432-1"><a id="__codelineno-432-1" name="__codelineno-432-1" href="#__codelineno-432-1"></a><span class="c1">-- Simple: Log PAC3 part transfer</span>
</span><span id="__span-432-2"><a id="__codelineno-432-2" name="__codelineno-432-2" href="#__codelineno-432-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPAC3PartTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">part</span><span class="p">)</span>
</span><span id="__span-432-3"><a id="__codelineno-432-3" name="__codelineno-432-3" href="#__codelineno-432-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PAC3 part transferred: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">part</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">))</span>
</span><span id="__span-432-4"><a id="__codelineno-432-4" name="__codelineno-432-4" href="#__codelineno-432-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-433-1"><a id="__codelineno-433-1" name="__codelineno-433-1" href="#__codelineno-433-1"></a><span class="c1">-- Medium: Track PAC3 transfers</span>
</span><span id="__span-433-2"><a id="__codelineno-433-2" name="__codelineno-433-2" href="#__codelineno-433-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPAC3PartTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackPAC3Transfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">part</span><span class="p">)</span>
</span><span id="__span-433-3"><a id="__codelineno-433-3" name="__codelineno-433-3" href="#__codelineno-433-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">pac3Transfers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">pac3Transfers</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-433-4"><a id="__codelineno-433-4" name="__codelineno-433-4" href="#__codelineno-433-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">pac3Transfers</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-433-5"><a id="__codelineno-433-5" name="__codelineno-433-5" href="#__codelineno-433-5"></a><span class="nv">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">part</span><span class="p">,</span>
</span><span id="__span-433-6"><a id="__codelineno-433-6" name="__codelineno-433-6" href="#__codelineno-433-6"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-433-7"><a id="__codelineno-433-7" name="__codelineno-433-7" href="#__codelineno-433-7"></a><span class="p">})</span>
</span><span id="__span-433-8"><a id="__codelineno-433-8" name="__codelineno-433-8" href="#__codelineno-433-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-434-1"><a id="__codelineno-434-1" name="__codelineno-434-1" href="#__codelineno-434-1"></a><span class="c1">-- High: Complex PAC3 part transfer handling</span>
</span><span id="__span-434-2"><a id="__codelineno-434-2" name="__codelineno-434-2" href="#__codelineno-434-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPAC3PartTransfered&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPAC3Transfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">part</span><span class="p">)</span>
</span><span id="__span-434-3"><a id="__codelineno-434-3" name="__codelineno-434-3" href="#__codelineno-434-3"></a><span class="c1">-- Log PAC3 transfer</span>
</span><span id="__span-434-4"><a id="__codelineno-434-4" name="__codelineno-434-4" href="#__codelineno-434-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;pac3_part_transferred&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-434-5"><a id="__codelineno-434-5" name="__codelineno-434-5" href="#__codelineno-434-5"></a><span class="nv">partName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">part</span><span class="p">.</span><span class="py">name</span><span class="p">,</span>
</span><span id="__span-434-6"><a id="__codelineno-434-6" name="__codelineno-434-6" href="#__codelineno-434-6"></a><span class="nv">partID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">part</span><span class="p">.</span><span class="py">id</span><span class="p">,</span>
</span><span id="__span-434-7"><a id="__codelineno-434-7" name="__codelineno-434-7" href="#__codelineno-434-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-434-8"><a id="__codelineno-434-8" name="__codelineno-434-8" href="#__codelineno-434-8"></a><span class="p">})</span>
</span><span id="__span-434-9"><a id="__codelineno-434-9" name="__codelineno-434-9" href="#__codelineno-434-9"></a><span class="c1">-- Validate part data</span>
</span><span id="__span-434-10"><a id="__codelineno-434-10" name="__codelineno-434-10" href="#__codelineno-434-10"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">part</span><span class="p">.</span><span class="py">id</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">part</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-434-11"><a id="__codelineno-434-11" name="__codelineno-434-11" href="#__codelineno-434-11"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Invalid PAC3 part data&quot;</span><span class="p">)</span>
</span><span id="__span-434-12"><a id="__codelineno-434-12" name="__codelineno-434-12" href="#__codelineno-434-12"></a><span class="w">    </span><span class="kr">return</span>
</span><span id="__span-434-13"><a id="__codelineno-434-13" name="__codelineno-434-13" href="#__codelineno-434-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-434-14"><a id="__codelineno-434-14" name="__codelineno-434-14" href="#__codelineno-434-14"></a><span class="c1">-- Update part statistics</span>
</span><span id="__span-434-15"><a id="__codelineno-434-15" name="__codelineno-434-15" href="#__codelineno-434-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;pac3Stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">transfers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-434-16"><a id="__codelineno-434-16" name="__codelineno-434-16" href="#__codelineno-434-16"></a><span class="nv">stats</span><span class="p">.</span><span class="py">transfers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">transfers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-434-17"><a id="__codelineno-434-17" name="__codelineno-434-17" href="#__codelineno-434-17"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;pac3Stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-434-18"><a id="__codelineno-434-18" name="__codelineno-434-18" href="#__codelineno-434-18"></a><span class="c1">-- Notify relevant players</span>
</span><span id="__span-434-19"><a id="__codelineno-434-19" name="__codelineno-434-19" href="#__codelineno-434-19"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-434-20"><a id="__codelineno-434-20" name="__codelineno-434-20" href="#__codelineno-434-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">HasPAC3Part</span><span class="p">(</span><span class="nv">part</span><span class="p">.</span><span class="py">id</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-434-21"><a id="__codelineno-434-21" name="__codelineno-434-21" href="#__codelineno-434-21"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;PAC3 part &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">part</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been transferred&quot;</span><span class="p">)</span>
</span><span id="__span-434-22"><a id="__codelineno-434-22" name="__codelineno-434-22" href="#__codelineno-434-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-434-23"><a id="__codelineno-434-23" name="__codelineno-434-23" href="#__codelineno-434-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-434-24"><a id="__codelineno-434-24" name="__codelineno-434-24" href="#__codelineno-434-24"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onpickupmoney">OnPickupMoney</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player picks up money</p>
<p><strong>When Called</strong></p>
<p>When a player collects money from the ground</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player picking up money</li>
<li><code>moneyEntity</code> (<em>Entity</em>): The money entity being picked up</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-435-1"><a id="__codelineno-435-1" name="__codelineno-435-1" href="#__codelineno-435-1"></a><span class="c1">-- Simple: Log money pickup</span>
</span><span id="__span-435-2"><a id="__codelineno-435-2" name="__codelineno-435-2" href="#__codelineno-435-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">)</span>
</span><span id="__span-435-3"><a id="__codelineno-435-3" name="__codelineno-435-3" href="#__codelineno-435-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; picked up money&quot;</span><span class="p">)</span>
</span><span id="__span-435-4"><a id="__codelineno-435-4" name="__codelineno-435-4" href="#__codelineno-435-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-436-1"><a id="__codelineno-436-1" name="__codelineno-436-1" href="#__codelineno-436-1"></a><span class="c1">-- Medium: Track money pickups</span>
</span><span id="__span-436-2"><a id="__codelineno-436-2" name="__codelineno-436-2" href="#__codelineno-436-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackMoneyPickups&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">)</span>
</span><span id="__span-436-3"><a id="__codelineno-436-3" name="__codelineno-436-3" href="#__codelineno-436-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-436-4"><a id="__codelineno-436-4" name="__codelineno-436-4" href="#__codelineno-436-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-436-5"><a id="__codelineno-436-5" name="__codelineno-436-5" href="#__codelineno-436-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">:</span><span class="nf">GetMoneyAmount</span><span class="p">()</span>
</span><span id="__span-436-6"><a id="__codelineno-436-6" name="__codelineno-436-6" href="#__codelineno-436-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pickups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;moneyPickups&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-436-7"><a id="__codelineno-436-7" name="__codelineno-436-7" href="#__codelineno-436-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;moneyPickups&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">pickups</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span>
</span><span id="__span-436-8"><a id="__codelineno-436-8" name="__codelineno-436-8" href="#__codelineno-436-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-436-9"><a id="__codelineno-436-9" name="__codelineno-436-9" href="#__codelineno-436-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-437-1"><a id="__codelineno-437-1" name="__codelineno-437-1" href="#__codelineno-437-1"></a><span class="c1">-- High: Complex money pickup handling</span>
</span><span id="__span-437-2"><a id="__codelineno-437-2" name="__codelineno-437-2" href="#__codelineno-437-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPickupMoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedMoneyPickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">)</span>
</span><span id="__span-437-3"><a id="__codelineno-437-3" name="__codelineno-437-3" href="#__codelineno-437-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-437-4"><a id="__codelineno-437-4" name="__codelineno-437-4" href="#__codelineno-437-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-437-5"><a id="__codelineno-437-5" name="__codelineno-437-5" href="#__codelineno-437-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">:</span><span class="nf">GetMoneyAmount</span><span class="p">()</span>
</span><span id="__span-437-6"><a id="__codelineno-437-6" name="__codelineno-437-6" href="#__codelineno-437-6"></a><span class="w">    </span><span class="c1">-- Log money pickup</span>
</span><span id="__span-437-7"><a id="__codelineno-437-7" name="__codelineno-437-7" href="#__codelineno-437-7"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;money_pickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-437-8"><a id="__codelineno-437-8" name="__codelineno-437-8" href="#__codelineno-437-8"></a><span class="w">    </span><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-437-9"><a id="__codelineno-437-9" name="__codelineno-437-9" href="#__codelineno-437-9"></a><span class="w">    </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span>
</span><span id="__span-437-10"><a id="__codelineno-437-10" name="__codelineno-437-10" href="#__codelineno-437-10"></a><span class="w">    </span><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">moneyEntity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-437-11"><a id="__codelineno-437-11" name="__codelineno-437-11" href="#__codelineno-437-11"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-437-12"><a id="__codelineno-437-12" name="__codelineno-437-12" href="#__codelineno-437-12"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-437-13"><a id="__codelineno-437-13" name="__codelineno-437-13" href="#__codelineno-437-13"></a><span class="w">    </span><span class="c1">-- Update player statistics</span>
</span><span id="__span-437-14"><a id="__codelineno-437-14" name="__codelineno-437-14" href="#__codelineno-437-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;moneyStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">pickedUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-437-15"><a id="__codelineno-437-15" name="__codelineno-437-15" href="#__codelineno-437-15"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">pickedUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">pickedUp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-437-16"><a id="__codelineno-437-16" name="__codelineno-437-16" href="#__codelineno-437-16"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">totalAmount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">amount</span>
</span><span id="__span-437-17"><a id="__codelineno-437-17" name="__codelineno-437-17" href="#__codelineno-437-17"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;moneyStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-437-18"><a id="__codelineno-437-18" name="__codelineno-437-18" href="#__codelineno-437-18"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-437-19"><a id="__codelineno-437-19" name="__codelineno-437-19" href="#__codelineno-437-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">totalAmount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-437-20"><a id="__codelineno-437-20" name="__codelineno-437-20" href="#__codelineno-437-20"></a><span class="w">        </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;PlayerEarnedAchievement&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;money_collector&quot;</span><span class="p">)</span>
</span><span id="__span-437-21"><a id="__codelineno-437-21" name="__codelineno-437-21" href="#__codelineno-437-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-437-22"><a id="__codelineno-437-22" name="__codelineno-437-22" href="#__codelineno-437-22"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-437-23"><a id="__codelineno-437-23" name="__codelineno-437-23" href="#__codelineno-437-23"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You picked up &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">currency</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nv">amount</span><span class="p">))</span>
</span><span id="__span-437-24"><a id="__codelineno-437-24" name="__codelineno-437-24" href="#__codelineno-437-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerdropweapon">OnPlayerDropWeapon</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player drops a weapon</p>
<p><strong>When Called</strong></p>
<p>When a player drops a weapon from their inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player dropping the weapon</li>
<li><code>weapon</code> (<em>Weapon</em>): The weapon being dropped</li>
<li><code>entity</code> (<em>Entity</em>): The weapon entity created</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-438-1"><a id="__codelineno-438-1" name="__codelineno-438-1" href="#__codelineno-438-1"></a><span class="c1">-- Simple: Log weapon drops</span>
</span><span id="__span-438-2"><a id="__codelineno-438-2" name="__codelineno-438-2" href="#__codelineno-438-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerDropWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">weapon</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-438-3"><a id="__codelineno-438-3" name="__codelineno-438-3" href="#__codelineno-438-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; dropped weapon: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">())</span>
</span><span id="__span-438-4"><a id="__codelineno-438-4" name="__codelineno-438-4" href="#__codelineno-438-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-439-1"><a id="__codelineno-439-1" name="__codelineno-439-1" href="#__codelineno-439-1"></a><span class="c1">-- Medium: Track weapon drop statistics</span>
</span><span id="__span-439-2"><a id="__codelineno-439-2" name="__codelineno-439-2" href="#__codelineno-439-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerDropWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WeaponTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">weapon</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-439-3"><a id="__codelineno-439-3" name="__codelineno-439-3" href="#__codelineno-439-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-439-4"><a id="__codelineno-439-4" name="__codelineno-439-4" href="#__codelineno-439-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-439-5"><a id="__codelineno-439-5" name="__codelineno-439-5" href="#__codelineno-439-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weaponsDropped&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weaponsDropped&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-439-6"><a id="__codelineno-439-6" name="__codelineno-439-6" href="#__codelineno-439-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastWeaponDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-439-7"><a id="__codelineno-439-7" name="__codelineno-439-7" href="#__codelineno-439-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-439-8"><a id="__codelineno-439-8" name="__codelineno-439-8" href="#__codelineno-439-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-440-1"><a id="__codelineno-440-1" name="__codelineno-440-1" href="#__codelineno-440-1"></a><span class="c1">-- High: Complex weapon drop system</span>
</span><span id="__span-440-2"><a id="__codelineno-440-2" name="__codelineno-440-2" href="#__codelineno-440-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerDropWeapon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWeaponDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">weapon</span><span class="p">,</span><span class="w"> </span><span class="nv">entity</span><span class="p">)</span>
</span><span id="__span-440-3"><a id="__codelineno-440-3" name="__codelineno-440-3" href="#__codelineno-440-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-440-4"><a id="__codelineno-440-4" name="__codelineno-440-4" href="#__codelineno-440-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-440-5"><a id="__codelineno-440-5" name="__codelineno-440-5" href="#__codelineno-440-5"></a><span class="w">    </span><span class="c1">-- Check if weapon is bound</span>
</span><span id="__span-440-6"><a id="__codelineno-440-6" name="__codelineno-440-6" href="#__codelineno-440-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bound&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-7"><a id="__codelineno-440-7" name="__codelineno-440-7" href="#__codelineno-440-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;boundTo&quot;</span><span class="p">)</span>
</span><span id="__span-440-8"><a id="__codelineno-440-8" name="__codelineno-440-8" href="#__codelineno-440-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">boundTo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-9"><a id="__codelineno-440-9" name="__codelineno-440-9" href="#__codelineno-440-9"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This weapon is bound to you and cannot be dropped&quot;</span><span class="p">)</span>
</span><span id="__span-440-10"><a id="__codelineno-440-10" name="__codelineno-440-10" href="#__codelineno-440-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-440-11"><a id="__codelineno-440-11" name="__codelineno-440-11" href="#__codelineno-440-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-440-12"><a id="__codelineno-440-12" name="__codelineno-440-12" href="#__codelineno-440-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-13"><a id="__codelineno-440-13" name="__codelineno-440-13" href="#__codelineno-440-13"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-440-14"><a id="__codelineno-440-14" name="__codelineno-440-14" href="#__codelineno-440-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-440-15"><a id="__codelineno-440-15" name="__codelineno-440-15" href="#__codelineno-440-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_pistol&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-16"><a id="__codelineno-440-16" name="__codelineno-440-16" href="#__codelineno-440-16"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Police officers cannot drop their service weapon&quot;</span><span class="p">)</span>
</span><span id="__span-440-17"><a id="__codelineno-440-17" name="__codelineno-440-17" href="#__codelineno-440-17"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-440-18"><a id="__codelineno-440-18" name="__codelineno-440-18" href="#__codelineno-440-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-19"><a id="__codelineno-440-19" name="__codelineno-440-19" href="#__codelineno-440-19"></a><span class="w">    </span><span class="c1">-- Check if weapon is valuable</span>
</span><span id="__span-440-20"><a id="__codelineno-440-20" name="__codelineno-440-20" href="#__codelineno-440-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">weaponValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-440-21"><a id="__codelineno-440-21" name="__codelineno-440-21" href="#__codelineno-440-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">weaponValue</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-22"><a id="__codelineno-440-22" name="__codelineno-440-22" href="#__codelineno-440-22"></a><span class="w">        </span><span class="c1">-- Valuable weapon - require confirmation</span>
</span><span id="__span-440-23"><a id="__codelineno-440-23" name="__codelineno-440-23" href="#__codelineno-440-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning: This is a valuable weapon. Are you sure you want to drop it?&quot;</span><span class="p">)</span>
</span><span id="__span-440-24"><a id="__codelineno-440-24" name="__codelineno-440-24" href="#__codelineno-440-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-25"><a id="__codelineno-440-25" name="__codelineno-440-25" href="#__codelineno-440-25"></a><span class="w">    </span><span class="c1">-- Update weapon drop statistics</span>
</span><span id="__span-440-26"><a id="__codelineno-440-26" name="__codelineno-440-26" href="#__codelineno-440-26"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;weaponsDropped&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weaponsDropped&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-440-27"><a id="__codelineno-440-27" name="__codelineno-440-27" href="#__codelineno-440-27"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastWeaponDrop&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-440-28"><a id="__codelineno-440-28" name="__codelineno-440-28" href="#__codelineno-440-28"></a><span class="w">    </span><span class="c1">-- Set weapon entity data</span>
</span><span id="__span-440-29"><a id="__codelineno-440-29" name="__codelineno-440-29" href="#__codelineno-440-29"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;droppedBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-440-30"><a id="__codelineno-440-30" name="__codelineno-440-30" href="#__codelineno-440-30"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;droppedTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-440-31"><a id="__codelineno-440-31" name="__codelineno-440-31" href="#__codelineno-440-31"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;weaponClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">())</span>
</span><span id="__span-440-32"><a id="__codelineno-440-32" name="__codelineno-440-32" href="#__codelineno-440-32"></a><span class="w">    </span><span class="c1">-- Set weapon entity lifetime</span>
</span><span id="__span-440-33"><a id="__codelineno-440-33" name="__codelineno-440-33" href="#__codelineno-440-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lifetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="w"> </span><span class="c1">-- 10 minutes</span>
</span><span id="__span-440-34"><a id="__codelineno-440-34" name="__codelineno-440-34" href="#__codelineno-440-34"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lifetime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">lifetime</span><span class="p">)</span>
</span><span id="__span-440-35"><a id="__codelineno-440-35" name="__codelineno-440-35" href="#__codelineno-440-35"></a><span class="w">    </span><span class="c1">-- Start weapon cleanup timer</span>
</span><span id="__span-440-36"><a id="__codelineno-440-36" name="__codelineno-440-36" href="#__codelineno-440-36"></a><span class="w">    </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="nv">lifetime</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-440-37"><a id="__codelineno-440-37" name="__codelineno-440-37" href="#__codelineno-440-37"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-38"><a id="__codelineno-440-38" name="__codelineno-440-38" href="#__codelineno-440-38"></a><span class="w">        </span><span class="nv">entity</span><span class="p">:</span><span class="nf">Remove</span><span class="p">()</span>
</span><span id="__span-440-39"><a id="__codelineno-440-39" name="__codelineno-440-39" href="#__codelineno-440-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-40"><a id="__codelineno-440-40" name="__codelineno-440-40" href="#__codelineno-440-40"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-440-41"><a id="__codelineno-440-41" name="__codelineno-440-41" href="#__codelineno-440-41"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-440-42"><a id="__codelineno-440-42" name="__codelineno-440-42" href="#__codelineno-440-42"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">weaponsDropped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weaponsDropped&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-440-43"><a id="__codelineno-440-43" name="__codelineno-440-43" href="#__codelineno-440-43"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">weaponsDropped</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_weapon_dropper&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-44"><a id="__codelineno-440-44" name="__codelineno-440-44" href="#__codelineno-440-44"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_weapon_dropper&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-440-45"><a id="__codelineno-440-45" name="__codelineno-440-45" href="#__codelineno-440-45"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Weapon Dropper!&quot;</span><span class="p">)</span>
</span><span id="__span-440-46"><a id="__codelineno-440-46" name="__codelineno-440-46" href="#__codelineno-440-46"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-47"><a id="__codelineno-440-47" name="__codelineno-440-47" href="#__codelineno-440-47"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-440-48"><a id="__codelineno-440-48" name="__codelineno-440-48" href="#__codelineno-440-48"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-440-49"><a id="__codelineno-440-49" name="__codelineno-440-49" href="#__codelineno-440-49"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-440-50"><a id="__codelineno-440-50" name="__codelineno-440-50" href="#__codelineno-440-50"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; dropped a weapon&quot;</span><span class="p">)</span>
</span><span id="__span-440-51"><a id="__codelineno-440-51" name="__codelineno-440-51" href="#__codelineno-440-51"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-440-52"><a id="__codelineno-440-52" name="__codelineno-440-52" href="#__codelineno-440-52"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-440-53"><a id="__codelineno-440-53" name="__codelineno-440-53" href="#__codelineno-440-53"></a><span class="w">    </span><span class="c1">-- Log weapon drop</span>
</span><span id="__span-440-54"><a id="__codelineno-440-54" name="__codelineno-440-54" href="#__codelineno-440-54"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s dropped weapon %s (Value: $%d)&quot;</span><span class="p">,</span>
</span><span id="__span-440-55"><a id="__codelineno-440-55" name="__codelineno-440-55" href="#__codelineno-440-55"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span><span class="w"> </span><span class="nv">weaponValue</span><span class="p">))</span>
</span><span id="__span-440-56"><a id="__codelineno-440-56" name="__codelineno-440-56" href="#__codelineno-440-56"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerentersequence">OnPlayerEnterSequence</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player enters a sequence</p>
<p><strong>When Called</strong></p>
<p>When a player starts a sequence (animation)</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Player</em>): The player entering the sequence</li>
<li><code>sequenceName</code> (<em>string</em>): The name of the sequence</li>
<li><code>callback</code> (<em>function</em>): The callback function to call when sequence ends</li>
<li><code>time</code> (<em>number</em>): The duration of the sequence</li>
<li><code>noFreeze</code> (<em>boolean</em>): Whether the player should be frozen during sequence</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-441-1"><a id="__codelineno-441-1" name="__codelineno-441-1" href="#__codelineno-441-1"></a><span class="c1">-- Simple: Log sequence entry</span>
</span><span id="__span-441-2"><a id="__codelineno-441-2" name="__codelineno-441-2" href="#__codelineno-441-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerEnterSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">,</span><span class="w"> </span><span class="nv">callback</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">,</span><span class="w"> </span><span class="nv">noFreeze</span><span class="p">)</span>
</span><span id="__span-441-3"><a id="__codelineno-441-3" name="__codelineno-441-3" href="#__codelineno-441-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; entered sequence: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">)</span>
</span><span id="__span-441-4"><a id="__codelineno-441-4" name="__codelineno-441-4" href="#__codelineno-441-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-442-1"><a id="__codelineno-442-1" name="__codelineno-442-1" href="#__codelineno-442-1"></a><span class="c1">-- Medium: Track sequence usage</span>
</span><span id="__span-442-2"><a id="__codelineno-442-2" name="__codelineno-442-2" href="#__codelineno-442-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerEnterSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SequenceTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">,</span><span class="w"> </span><span class="nv">callback</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">,</span><span class="w"> </span><span class="nv">noFreeze</span><span class="p">)</span>
</span><span id="__span-442-3"><a id="__codelineno-442-3" name="__codelineno-442-3" href="#__codelineno-442-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-442-4"><a id="__codelineno-442-4" name="__codelineno-442-4" href="#__codelineno-442-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-442-5"><a id="__codelineno-442-5" name="__codelineno-442-5" href="#__codelineno-442-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequencesUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-442-6"><a id="__codelineno-442-6" name="__codelineno-442-6" href="#__codelineno-442-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-442-7"><a id="__codelineno-442-7" name="__codelineno-442-7" href="#__codelineno-442-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-442-8"><a id="__codelineno-442-8" name="__codelineno-442-8" href="#__codelineno-442-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-443-1"><a id="__codelineno-443-1" name="__codelineno-443-1" href="#__codelineno-443-1"></a><span class="c1">-- High: Complex sequence system</span>
</span><span id="__span-443-2"><a id="__codelineno-443-2" name="__codelineno-443-2" href="#__codelineno-443-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerEnterSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">,</span><span class="w"> </span><span class="nv">callback</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">,</span><span class="w"> </span><span class="nv">noFreeze</span><span class="p">)</span>
</span><span id="__span-443-3"><a id="__codelineno-443-3" name="__codelineno-443-3" href="#__codelineno-443-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-443-4"><a id="__codelineno-443-4" name="__codelineno-443-4" href="#__codelineno-443-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-443-5"><a id="__codelineno-443-5" name="__codelineno-443-5" href="#__codelineno-443-5"></a><span class="w">    </span><span class="c1">-- Check if player is already in a sequence</span>
</span><span id="__span-443-6"><a id="__codelineno-443-6" name="__codelineno-443-6" href="#__codelineno-443-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;inSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-7"><a id="__codelineno-443-7" name="__codelineno-443-7" href="#__codelineno-443-7"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are already performing an action&quot;</span><span class="p">)</span>
</span><span id="__span-443-8"><a id="__codelineno-443-8" name="__codelineno-443-8" href="#__codelineno-443-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-443-9"><a id="__codelineno-443-9" name="__codelineno-443-9" href="#__codelineno-443-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-10"><a id="__codelineno-443-10" name="__codelineno-443-10" href="#__codelineno-443-10"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-443-11"><a id="__codelineno-443-11" name="__codelineno-443-11" href="#__codelineno-443-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-443-12"><a id="__codelineno-443-12" name="__codelineno-443-12" href="#__codelineno-443-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedSequences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-443-13"><a id="__codelineno-443-13" name="__codelineno-443-13" href="#__codelineno-443-13"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;dance&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sit&quot;</span><span class="p">},</span>
</span><span id="__span-443-14"><a id="__codelineno-443-14" name="__codelineno-443-14" href="#__codelineno-443-14"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;dance&quot;</span><span class="p">},</span>
</span><span id="__span-443-15"><a id="__codelineno-443-15" name="__codelineno-443-15" href="#__codelineno-443-15"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-443-16"><a id="__codelineno-443-16" name="__codelineno-443-16" href="#__codelineno-443-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-443-17"><a id="__codelineno-443-17" name="__codelineno-443-17" href="#__codelineno-443-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">restricted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">restrictedSequences</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-443-18"><a id="__codelineno-443-18" name="__codelineno-443-18" href="#__codelineno-443-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">restricted</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-19"><a id="__codelineno-443-19" name="__codelineno-443-19" href="#__codelineno-443-19"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your faction cannot perform this action&quot;</span><span class="p">)</span>
</span><span id="__span-443-20"><a id="__codelineno-443-20" name="__codelineno-443-20" href="#__codelineno-443-20"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-443-21"><a id="__codelineno-443-21" name="__codelineno-443-21" href="#__codelineno-443-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-22"><a id="__codelineno-443-22" name="__codelineno-443-22" href="#__codelineno-443-22"></a><span class="w">    </span><span class="c1">-- Check level requirements</span>
</span><span id="__span-443-23"><a id="__codelineno-443-23" name="__codelineno-443-23" href="#__codelineno-443-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sequenceRequirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-443-24"><a id="__codelineno-443-24" name="__codelineno-443-24" href="#__codelineno-443-24"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;dance&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-443-25"><a id="__codelineno-443-25" name="__codelineno-443-25" href="#__codelineno-443-25"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;sit&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-443-26"><a id="__codelineno-443-26" name="__codelineno-443-26" href="#__codelineno-443-26"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;wave&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-443-27"><a id="__codelineno-443-27" name="__codelineno-443-27" href="#__codelineno-443-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-443-28"><a id="__codelineno-443-28" name="__codelineno-443-28" href="#__codelineno-443-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sequenceRequirements</span><span class="p">[</span><span class="nv">sequenceName</span><span class="p">]</span>
</span><span id="__span-443-29"><a id="__codelineno-443-29" name="__codelineno-443-29" href="#__codelineno-443-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-30"><a id="__codelineno-443-30" name="__codelineno-443-30" href="#__codelineno-443-30"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-443-31"><a id="__codelineno-443-31" name="__codelineno-443-31" href="#__codelineno-443-31"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-32"><a id="__codelineno-443-32" name="__codelineno-443-32" href="#__codelineno-443-32"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need to be level &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requiredLevel</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to perform this action&quot;</span><span class="p">)</span>
</span><span id="__span-443-33"><a id="__codelineno-443-33" name="__codelineno-443-33" href="#__codelineno-443-33"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-443-34"><a id="__codelineno-443-34" name="__codelineno-443-34" href="#__codelineno-443-34"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-443-35"><a id="__codelineno-443-35" name="__codelineno-443-35" href="#__codelineno-443-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-36"><a id="__codelineno-443-36" name="__codelineno-443-36" href="#__codelineno-443-36"></a><span class="w">    </span><span class="c1">-- Set sequence data</span>
</span><span id="__span-443-37"><a id="__codelineno-443-37" name="__codelineno-443-37" href="#__codelineno-443-37"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;inSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-443-38"><a id="__codelineno-443-38" name="__codelineno-443-38" href="#__codelineno-443-38"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;currentSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">)</span>
</span><span id="__span-443-39"><a id="__codelineno-443-39" name="__codelineno-443-39" href="#__codelineno-443-39"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequenceStartTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-443-40"><a id="__codelineno-443-40" name="__codelineno-443-40" href="#__codelineno-443-40"></a><span class="w">    </span><span class="c1">-- Update sequence statistics</span>
</span><span id="__span-443-41"><a id="__codelineno-443-41" name="__codelineno-443-41" href="#__codelineno-443-41"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequencesUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-443-42"><a id="__codelineno-443-42" name="__codelineno-443-42" href="#__codelineno-443-42"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-443-43"><a id="__codelineno-443-43" name="__codelineno-443-43" href="#__codelineno-443-43"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-443-44"><a id="__codelineno-443-44" name="__codelineno-443-44" href="#__codelineno-443-44"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sequencesUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-443-45"><a id="__codelineno-443-45" name="__codelineno-443-45" href="#__codelineno-443-45"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">sequencesUsed</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_performer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-46"><a id="__codelineno-443-46" name="__codelineno-443-46" href="#__codelineno-443-46"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_performer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-443-47"><a id="__codelineno-443-47" name="__codelineno-443-47" href="#__codelineno-443-47"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Performer!&quot;</span><span class="p">)</span>
</span><span id="__span-443-48"><a id="__codelineno-443-48" name="__codelineno-443-48" href="#__codelineno-443-48"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-49"><a id="__codelineno-443-49" name="__codelineno-443-49" href="#__codelineno-443-49"></a><span class="w">    </span><span class="c1">-- Set up sequence end callback</span>
</span><span id="__span-443-50"><a id="__codelineno-443-50" name="__codelineno-443-50" href="#__codelineno-443-50"></a><span class="w">    </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="nv">time</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-443-51"><a id="__codelineno-443-51" name="__codelineno-443-51" href="#__codelineno-443-51"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;inSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-52"><a id="__codelineno-443-52" name="__codelineno-443-52" href="#__codelineno-443-52"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;inSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-443-53"><a id="__codelineno-443-53" name="__codelineno-443-53" href="#__codelineno-443-53"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;currentSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-443-54"><a id="__codelineno-443-54" name="__codelineno-443-54" href="#__codelineno-443-54"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">callback</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-55"><a id="__codelineno-443-55" name="__codelineno-443-55" href="#__codelineno-443-55"></a><span class="w">            </span><span class="nf">callback</span><span class="p">()</span>
</span><span id="__span-443-56"><a id="__codelineno-443-56" name="__codelineno-443-56" href="#__codelineno-443-56"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-443-57"><a id="__codelineno-443-57" name="__codelineno-443-57" href="#__codelineno-443-57"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-58"><a id="__codelineno-443-58" name="__codelineno-443-58" href="#__codelineno-443-58"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-443-59"><a id="__codelineno-443-59" name="__codelineno-443-59" href="#__codelineno-443-59"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-443-60"><a id="__codelineno-443-60" name="__codelineno-443-60" href="#__codelineno-443-60"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-443-61"><a id="__codelineno-443-61" name="__codelineno-443-61" href="#__codelineno-443-61"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-443-62"><a id="__codelineno-443-62" name="__codelineno-443-62" href="#__codelineno-443-62"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is performing: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">)</span>
</span><span id="__span-443-63"><a id="__codelineno-443-63" name="__codelineno-443-63" href="#__codelineno-443-63"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-443-64"><a id="__codelineno-443-64" name="__codelineno-443-64" href="#__codelineno-443-64"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-443-65"><a id="__codelineno-443-65" name="__codelineno-443-65" href="#__codelineno-443-65"></a><span class="w">    </span><span class="c1">-- Log sequence entry</span>
</span><span id="__span-443-66"><a id="__codelineno-443-66" name="__codelineno-443-66" href="#__codelineno-443-66"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s entered sequence %s (Duration: %d seconds)&quot;</span><span class="p">,</span>
</span><span id="__span-443-67"><a id="__codelineno-443-67" name="__codelineno-443-67" href="#__codelineno-443-67"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">sequenceName</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="p">))</span>
</span><span id="__span-443-68"><a id="__codelineno-443-68" name="__codelineno-443-68" href="#__codelineno-443-68"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerinteractitem">OnPlayerInteractItem</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player interacts with an item</p>
<p><strong>When Called</strong></p>
<p>When a player uses an item or performs an action on it</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player interacting with the item</li>
<li><code>action</code> (<em>string</em>): The action being performed</li>
<li><code>self</code> (<em>Item</em>): The item being interacted with</li>
<li><code>result</code> (<em>any</em>): The result of the interaction</li>
<li><code>data</code> (<em>table</em>): Additional data for the interaction</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-444-1"><a id="__codelineno-444-1" name="__codelineno-444-1" href="#__codelineno-444-1"></a><span class="c1">-- Simple: Log item interactions</span>
</span><span id="__span-444-2"><a id="__codelineno-444-2" name="__codelineno-444-2" href="#__codelineno-444-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">result</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-444-3"><a id="__codelineno-444-3" name="__codelineno-444-3" href="#__codelineno-444-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; used &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; with action &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">action</span><span class="p">)</span>
</span><span id="__span-444-4"><a id="__codelineno-444-4" name="__codelineno-444-4" href="#__codelineno-444-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-445-1"><a id="__codelineno-445-1" name="__codelineno-445-1" href="#__codelineno-445-1"></a><span class="c1">-- Medium: Handle special item effects</span>
</span><span id="__span-445-2"><a id="__codelineno-445-2" name="__codelineno-445-2" href="#__codelineno-445-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">result</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-445-3"><a id="__codelineno-445-3" name="__codelineno-445-3" href="#__codelineno-445-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-445-4"><a id="__codelineno-445-4" name="__codelineno-445-4" href="#__codelineno-445-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health_potion&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-445-5"><a id="__codelineno-445-5" name="__codelineno-445-5" href="#__codelineno-445-5"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">healAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;healAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-445-6"><a id="__codelineno-445-6" name="__codelineno-445-6" href="#__codelineno-445-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">healAmount</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()))</span>
</span><span id="__span-445-7"><a id="__codelineno-445-7" name="__codelineno-445-7" href="#__codelineno-445-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You healed for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">healAmount</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; HP&quot;</span><span class="p">)</span>
</span><span id="__span-445-8"><a id="__codelineno-445-8" name="__codelineno-445-8" href="#__codelineno-445-8"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stamina_boost&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-445-9"><a id="__codelineno-445-9" name="__codelineno-445-9" href="#__codelineno-445-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">boostAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;boostAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-445-10"><a id="__codelineno-445-10" name="__codelineno-445-10" href="#__codelineno-445-10"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-445-11"><a id="__codelineno-445-11" name="__codelineno-445-11" href="#__codelineno-445-11"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.min</span><span class="p">(</span><span class="nv">currentStamina</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">boostAmount</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
</span><span id="__span-445-12"><a id="__codelineno-445-12" name="__codelineno-445-12" href="#__codelineno-445-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You gained &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">boostAmount</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; stamina&quot;</span><span class="p">)</span>
</span><span id="__span-445-13"><a id="__codelineno-445-13" name="__codelineno-445-13" href="#__codelineno-445-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-445-14"><a id="__codelineno-445-14" name="__codelineno-445-14" href="#__codelineno-445-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-445-15"><a id="__codelineno-445-15" name="__codelineno-445-15" href="#__codelineno-445-15"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-446-1"><a id="__codelineno-446-1" name="__codelineno-446-1" href="#__codelineno-446-1"></a><span class="c1">-- High: Complex item interaction system</span>
</span><span id="__span-446-2"><a id="__codelineno-446-2" name="__codelineno-446-2" href="#__codelineno-446-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemInteractions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">result</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-446-3"><a id="__codelineno-446-3" name="__codelineno-446-3" href="#__codelineno-446-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-446-4"><a id="__codelineno-446-4" name="__codelineno-446-4" href="#__codelineno-446-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-446-5"><a id="__codelineno-446-5" name="__codelineno-446-5" href="#__codelineno-446-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;use&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-6"><a id="__codelineno-446-6" name="__codelineno-446-6" href="#__codelineno-446-6"></a><span class="w">        </span><span class="c1">-- Handle consumable items</span>
</span><span id="__span-446-7"><a id="__codelineno-446-7" name="__codelineno-446-7" href="#__codelineno-446-7"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;health_potion&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-8"><a id="__codelineno-446-8" name="__codelineno-446-8" href="#__codelineno-446-8"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">healAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;healAmount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-446-9"><a id="__codelineno-446-9" name="__codelineno-446-9" href="#__codelineno-446-9"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-446-10"><a id="__codelineno-446-10" name="__codelineno-446-10" href="#__codelineno-446-10"></a><span class="w">            </span><span class="nv">healAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">healAmount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">charLevel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 10% bonus per level</span>
</span><span id="__span-446-11"><a id="__codelineno-446-11" name="__codelineno-446-11" href="#__codelineno-446-11"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">healAmount</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()))</span>
</span><span id="__span-446-12"><a id="__codelineno-446-12" name="__codelineno-446-12" href="#__codelineno-446-12"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You healed for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">healAmount</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; HP&quot;</span><span class="p">)</span>
</span><span id="__span-446-13"><a id="__codelineno-446-13" name="__codelineno-446-13" href="#__codelineno-446-13"></a><span class="w">            </span><span class="c1">-- Consume the item</span>
</span><span id="__span-446-14"><a id="__codelineno-446-14" name="__codelineno-446-14" href="#__codelineno-446-14"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">uses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;uses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-446-15"><a id="__codelineno-446-15" name="__codelineno-446-15" href="#__codelineno-446-15"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">uses</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-16"><a id="__codelineno-446-16" name="__codelineno-446-16" href="#__codelineno-446-16"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">remove</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-446-17"><a id="__codelineno-446-17" name="__codelineno-446-17" href="#__codelineno-446-17"></a><span class="w">            </span><span class="kr">else</span>
</span><span id="__span-446-18"><a id="__codelineno-446-18" name="__codelineno-446-18" href="#__codelineno-446-18"></a><span class="w">                </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;uses&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">uses</span><span class="p">)</span>
</span><span id="__span-446-19"><a id="__codelineno-446-19" name="__codelineno-446-19" href="#__codelineno-446-19"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-446-20"><a id="__codelineno-446-20" name="__codelineno-446-20" href="#__codelineno-446-20"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;weapon_upgrade&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-21"><a id="__codelineno-446-21" name="__codelineno-446-21" href="#__codelineno-446-21"></a><span class="w">            </span><span class="c1">-- Upgrade weapon</span>
</span><span id="__span-446-22"><a id="__codelineno-446-22" name="__codelineno-446-22" href="#__codelineno-446-22"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">weapon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">hasItem</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
</span><span id="__span-446-23"><a id="__codelineno-446-23" name="__codelineno-446-23" href="#__codelineno-446-23"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">weapon</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-24"><a id="__codelineno-446-24" name="__codelineno-446-24" href="#__codelineno-446-24"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-446-25"><a id="__codelineno-446-25" name="__codelineno-446-25" href="#__codelineno-446-25"></a><span class="w">                </span><span class="nv">weapon</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentDamage</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-446-26"><a id="__codelineno-446-26" name="__codelineno-446-26" href="#__codelineno-446-26"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Weapon upgraded! Damage increased by 5&quot;</span><span class="p">)</span>
</span><span id="__span-446-27"><a id="__codelineno-446-27" name="__codelineno-446-27" href="#__codelineno-446-27"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">remove</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-446-28"><a id="__codelineno-446-28" name="__codelineno-446-28" href="#__codelineno-446-28"></a><span class="w">            </span><span class="kr">else</span>
</span><span id="__span-446-29"><a id="__codelineno-446-29" name="__codelineno-446-29" href="#__codelineno-446-29"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You need a weapon to upgrade&quot;</span><span class="p">)</span>
</span><span id="__span-446-30"><a id="__codelineno-446-30" name="__codelineno-446-30" href="#__codelineno-446-30"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-446-31"><a id="__codelineno-446-31" name="__codelineno-446-31" href="#__codelineno-446-31"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;teleport_scroll&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-32"><a id="__codelineno-446-32" name="__codelineno-446-32" href="#__codelineno-446-32"></a><span class="w">            </span><span class="c1">-- Teleport to spawn</span>
</span><span id="__span-446-33"><a id="__codelineno-446-33" name="__codelineno-446-33" href="#__codelineno-446-33"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">util</span><span class="p">.</span><span class="nf">getSpawns</span><span class="p">()</span>
</span><span id="__span-446-34"><a id="__codelineno-446-34" name="__codelineno-446-34" href="#__codelineno-446-34"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">spawns</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-35"><a id="__codelineno-446-35" name="__codelineno-446-35" href="#__codelineno-446-35"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">spawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawns</span><span class="p">[</span><span class="nb">math.random</span><span class="p">(</span><span class="o">#</span><span class="nv">spawns</span><span class="p">)]</span>
</span><span id="__span-446-36"><a id="__codelineno-446-36" name="__codelineno-446-36" href="#__codelineno-446-36"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="p">)</span>
</span><span id="__span-446-37"><a id="__codelineno-446-37" name="__codelineno-446-37" href="#__codelineno-446-37"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetAngles</span><span class="p">(</span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="p">)</span>
</span><span id="__span-446-38"><a id="__codelineno-446-38" name="__codelineno-446-38" href="#__codelineno-446-38"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You teleported to spawn&quot;</span><span class="p">)</span>
</span><span id="__span-446-39"><a id="__codelineno-446-39" name="__codelineno-446-39" href="#__codelineno-446-39"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">remove</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-446-40"><a id="__codelineno-446-40" name="__codelineno-446-40" href="#__codelineno-446-40"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-446-41"><a id="__codelineno-446-41" name="__codelineno-446-41" href="#__codelineno-446-41"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-446-42"><a id="__codelineno-446-42" name="__codelineno-446-42" href="#__codelineno-446-42"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;examine&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-43"><a id="__codelineno-446-43" name="__codelineno-446-43" href="#__codelineno-446-43"></a><span class="w">        </span><span class="c1">-- Show item details</span>
</span><span id="__span-446-44"><a id="__codelineno-446-44" name="__codelineno-446-44" href="#__codelineno-446-44"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-446-45"><a id="__codelineno-446-45" name="__codelineno-446-45" href="#__codelineno-446-45"></a><span class="w">        </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">name</span><span class="p">,</span>
</span><span id="__span-446-46"><a id="__codelineno-446-46" name="__codelineno-446-46" href="#__codelineno-446-46"></a><span class="w">        </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">description</span><span class="p">,</span>
</span><span id="__span-446-47"><a id="__codelineno-446-47" name="__codelineno-446-47" href="#__codelineno-446-47"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
</span><span id="__span-446-48"><a id="__codelineno-446-48" name="__codelineno-446-48" href="#__codelineno-446-48"></a><span class="w">        </span><span class="nv">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-446-49"><a id="__codelineno-446-49" name="__codelineno-446-49" href="#__codelineno-446-49"></a><span class="w">        </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-446-50"><a id="__codelineno-446-50" name="__codelineno-446-50" href="#__codelineno-446-50"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-446-51"><a id="__codelineno-446-51" name="__codelineno-446-51" href="#__codelineno-446-51"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemData</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-446-52"><a id="__codelineno-446-52" name="__codelineno-446-52" href="#__codelineno-446-52"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Description: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemData</span><span class="p">.</span><span class="py">description</span><span class="p">)</span>
</span><span id="__span-446-53"><a id="__codelineno-446-53" name="__codelineno-446-53" href="#__codelineno-446-53"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Value: $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemData</span><span class="p">.</span><span class="py">value</span><span class="p">)</span>
</span><span id="__span-446-54"><a id="__codelineno-446-54" name="__codelineno-446-54" href="#__codelineno-446-54"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Weight: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemData</span><span class="p">.</span><span class="py">weight</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
</span><span id="__span-446-55"><a id="__codelineno-446-55" name="__codelineno-446-55" href="#__codelineno-446-55"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Durability: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemData</span><span class="p">.</span><span class="py">durability</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
</span><span id="__span-446-56"><a id="__codelineno-446-56" name="__codelineno-446-56" href="#__codelineno-446-56"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;repair&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-57"><a id="__codelineno-446-57" name="__codelineno-446-57" href="#__codelineno-446-57"></a><span class="w">        </span><span class="c1">-- Repair item</span>
</span><span id="__span-446-58"><a id="__codelineno-446-58" name="__codelineno-446-58" href="#__codelineno-446-58"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentDurability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-446-59"><a id="__codelineno-446-59" name="__codelineno-446-59" href="#__codelineno-446-59"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentDurability</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-446-60"><a id="__codelineno-446-60" name="__codelineno-446-60" href="#__codelineno-446-60"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">repairAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">currentDurability</span><span class="p">)</span>
</span><span id="__span-446-61"><a id="__codelineno-446-61" name="__codelineno-446-61" href="#__codelineno-446-61"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">currentDurability</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">repairAmount</span><span class="p">)</span>
</span><span id="__span-446-62"><a id="__codelineno-446-62" name="__codelineno-446-62" href="#__codelineno-446-62"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item repaired! Durability increased by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">repairAmount</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
</span><span id="__span-446-63"><a id="__codelineno-446-63" name="__codelineno-446-63" href="#__codelineno-446-63"></a><span class="w">        </span><span class="kr">else</span>
</span><span id="__span-446-64"><a id="__codelineno-446-64" name="__codelineno-446-64" href="#__codelineno-446-64"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item is already at full durability&quot;</span><span class="p">)</span>
</span><span id="__span-446-65"><a id="__codelineno-446-65" name="__codelineno-446-65" href="#__codelineno-446-65"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-446-66"><a id="__codelineno-446-66" name="__codelineno-446-66" href="#__codelineno-446-66"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-446-67"><a id="__codelineno-446-67" name="__codelineno-446-67" href="#__codelineno-446-67"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerjoinclass">OnPlayerJoinClass</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player joins a class</p>
<p><strong>When Called</strong></p>
<p>When a player successfully joins a new class</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player joining the class</li>
<li><code>class</code> (<em>string</em>): The class being joined</li>
<li><code>oldClass</code> (<em>string</em>): The previous class (if any)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-447-1"><a id="__codelineno-447-1" name="__codelineno-447-1" href="#__codelineno-447-1"></a><span class="c1">-- Simple: Log class changes</span>
</span><span id="__span-447-2"><a id="__codelineno-447-2" name="__codelineno-447-2" href="#__codelineno-447-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-447-3"><a id="__codelineno-447-3" name="__codelineno-447-3" href="#__codelineno-447-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; joined class: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-447-4"><a id="__codelineno-447-4" name="__codelineno-447-4" href="#__codelineno-447-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-448-1"><a id="__codelineno-448-1" name="__codelineno-448-1" href="#__codelineno-448-1"></a><span class="c1">-- Medium: Give class-specific bonuses</span>
</span><span id="__span-448-2"><a id="__codelineno-448-2" name="__codelineno-448-2" href="#__codelineno-448-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ClassBonuses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-448-3"><a id="__codelineno-448-3" name="__codelineno-448-3" href="#__codelineno-448-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-448-4"><a id="__codelineno-448-4" name="__codelineno-448-4" href="#__codelineno-448-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-448-5"><a id="__codelineno-448-5" name="__codelineno-448-5" href="#__codelineno-448-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police_officer&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-448-6"><a id="__codelineno-448-6" name="__codelineno-448-6" href="#__codelineno-448-6"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;authority&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-448-7"><a id="__codelineno-448-7" name="__codelineno-448-7" href="#__codelineno-448-7"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-448-8"><a id="__codelineno-448-8" name="__codelineno-448-8" href="#__codelineno-448-8"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-448-9"><a id="__codelineno-448-9" name="__codelineno-448-9" href="#__codelineno-448-9"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;healingBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="__span-448-10"><a id="__codelineno-448-10" name="__codelineno-448-10" href="#__codelineno-448-10"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">)</span>
</span><span id="__span-448-11"><a id="__codelineno-448-11" name="__codelineno-448-11" href="#__codelineno-448-11"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-448-12"><a id="__codelineno-448-12" name="__codelineno-448-12" href="#__codelineno-448-12"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;authority&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-448-13"><a id="__codelineno-448-13" name="__codelineno-448-13" href="#__codelineno-448-13"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-448-14"><a id="__codelineno-448-14" name="__codelineno-448-14" href="#__codelineno-448-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-448-15"><a id="__codelineno-448-15" name="__codelineno-448-15" href="#__codelineno-448-15"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Class bonuses applied!&quot;</span><span class="p">)</span>
</span><span id="__span-448-16"><a id="__codelineno-448-16" name="__codelineno-448-16" href="#__codelineno-448-16"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-449-1"><a id="__codelineno-449-1" name="__codelineno-449-1" href="#__codelineno-449-1"></a><span class="c1">-- High: Complex class system</span>
</span><span id="__span-449-2"><a id="__codelineno-449-2" name="__codelineno-449-2" href="#__codelineno-449-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerJoinClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedClasses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-449-3"><a id="__codelineno-449-3" name="__codelineno-449-3" href="#__codelineno-449-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-449-4"><a id="__codelineno-449-4" name="__codelineno-449-4" href="#__codelineno-449-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-449-5"><a id="__codelineno-449-5" name="__codelineno-449-5" href="#__codelineno-449-5"></a><span class="w">    </span><span class="c1">-- Remove old class bonuses</span>
</span><span id="__span-449-6"><a id="__codelineno-449-6" name="__codelineno-449-6" href="#__codelineno-449-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">oldClass</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-7"><a id="__codelineno-449-7" name="__codelineno-449-7" href="#__codelineno-449-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">oldBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-8"><a id="__codelineno-449-8" name="__codelineno-449-8" href="#__codelineno-449-8"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;police_officer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;authority&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;salary&quot;</span><span class="p">},</span>
</span><span id="__span-449-9"><a id="__codelineno-449-9" name="__codelineno-449-9" href="#__codelineno-449-9"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;healingBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medicalKnowledge&quot;</span><span class="p">},</span>
</span><span id="__span-449-10"><a id="__codelineno-449-10" name="__codelineno-449-10" href="#__codelineno-449-10"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;engineer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;repairBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;technicalSkill&quot;</span><span class="p">}</span>
</span><span id="__span-449-11"><a id="__codelineno-449-11" name="__codelineno-449-11" href="#__codelineno-449-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-449-12"><a id="__codelineno-449-12" name="__codelineno-449-12" href="#__codelineno-449-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">oldBonuses</span><span class="p">[</span><span class="nv">oldClass</span><span class="p">]</span>
</span><span id="__span-449-13"><a id="__codelineno-449-13" name="__codelineno-449-13" href="#__codelineno-449-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-14"><a id="__codelineno-449-14" name="__codelineno-449-14" href="#__codelineno-449-14"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-449-15"><a id="__codelineno-449-15" name="__codelineno-449-15" href="#__codelineno-449-15"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="nv">bonus</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-449-16"><a id="__codelineno-449-16" name="__codelineno-449-16" href="#__codelineno-449-16"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-449-17"><a id="__codelineno-449-17" name="__codelineno-449-17" href="#__codelineno-449-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-449-18"><a id="__codelineno-449-18" name="__codelineno-449-18" href="#__codelineno-449-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-449-19"><a id="__codelineno-449-19" name="__codelineno-449-19" href="#__codelineno-449-19"></a><span class="w">    </span><span class="c1">-- Apply new class bonuses</span>
</span><span id="__span-449-20"><a id="__codelineno-449-20" name="__codelineno-449-20" href="#__codelineno-449-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">classBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-21"><a id="__codelineno-449-21" name="__codelineno-449-21" href="#__codelineno-449-21"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police_officer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-22"><a id="__codelineno-449-22" name="__codelineno-449-22" href="#__codelineno-449-22"></a><span class="w">    </span><span class="nv">authority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-449-23"><a id="__codelineno-449-23" name="__codelineno-449-23" href="#__codelineno-449-23"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-449-24"><a id="__codelineno-449-24" name="__codelineno-449-24" href="#__codelineno-449-24"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;police_badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">}</span>
</span><span id="__span-449-25"><a id="__codelineno-449-25" name="__codelineno-449-25" href="#__codelineno-449-25"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-449-26"><a id="__codelineno-449-26" name="__codelineno-449-26" href="#__codelineno-449-26"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-27"><a id="__codelineno-449-27" name="__codelineno-449-27" href="#__codelineno-449-27"></a><span class="w">    </span><span class="nv">healingBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="__span-449-28"><a id="__codelineno-449-28" name="__codelineno-449-28" href="#__codelineno-449-28"></a><span class="w">    </span><span class="nv">medicalKnowledge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-449-29"><a id="__codelineno-449-29" name="__codelineno-449-29" href="#__codelineno-449-29"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
</span><span id="__span-449-30"><a id="__codelineno-449-30" name="__codelineno-449-30" href="#__codelineno-449-30"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stethoscope&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">}</span>
</span><span id="__span-449-31"><a id="__codelineno-449-31" name="__codelineno-449-31" href="#__codelineno-449-31"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-449-32"><a id="__codelineno-449-32" name="__codelineno-449-32" href="#__codelineno-449-32"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;engineer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-33"><a id="__codelineno-449-33" name="__codelineno-449-33" href="#__codelineno-449-33"></a><span class="w">    </span><span class="nv">repairBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
</span><span id="__span-449-34"><a id="__codelineno-449-34" name="__codelineno-449-34" href="#__codelineno-449-34"></a><span class="w">    </span><span class="nv">technicalSkill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
</span><span id="__span-449-35"><a id="__codelineno-449-35" name="__codelineno-449-35" href="#__codelineno-449-35"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span>
</span><span id="__span-449-36"><a id="__codelineno-449-36" name="__codelineno-449-36" href="#__codelineno-449-36"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wrench&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;screwdriver&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;multitool&quot;</span><span class="p">}</span>
</span><span id="__span-449-37"><a id="__codelineno-449-37" name="__codelineno-449-37" href="#__codelineno-449-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-449-38"><a id="__codelineno-449-38" name="__codelineno-449-38" href="#__codelineno-449-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-449-39"><a id="__codelineno-449-39" name="__codelineno-449-39" href="#__codelineno-449-39"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">classBonuses</span><span class="p">[</span><span class="nv">class</span><span class="p">]</span>
</span><span id="__span-449-40"><a id="__codelineno-449-40" name="__codelineno-449-40" href="#__codelineno-449-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-41"><a id="__codelineno-449-41" name="__codelineno-449-41" href="#__codelineno-449-41"></a><span class="w">        </span><span class="c1">-- Apply stat bonuses</span>
</span><span id="__span-449-42"><a id="__codelineno-449-42" name="__codelineno-449-42" href="#__codelineno-449-42"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-449-43"><a id="__codelineno-449-43" name="__codelineno-449-43" href="#__codelineno-449-43"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">stat</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;items&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-44"><a id="__codelineno-449-44" name="__codelineno-449-44" href="#__codelineno-449-44"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-449-45"><a id="__codelineno-449-45" name="__codelineno-449-45" href="#__codelineno-449-45"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-449-46"><a id="__codelineno-449-46" name="__codelineno-449-46" href="#__codelineno-449-46"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-449-47"><a id="__codelineno-449-47" name="__codelineno-449-47" href="#__codelineno-449-47"></a><span class="w">        </span><span class="c1">-- Give class items</span>
</span><span id="__span-449-48"><a id="__codelineno-449-48" name="__codelineno-449-48" href="#__codelineno-449-48"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-49"><a id="__codelineno-449-49" name="__codelineno-449-49" href="#__codelineno-449-49"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-449-50"><a id="__codelineno-449-50" name="__codelineno-449-50" href="#__codelineno-449-50"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-449-51"><a id="__codelineno-449-51" name="__codelineno-449-51" href="#__codelineno-449-51"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-449-52"><a id="__codelineno-449-52" name="__codelineno-449-52" href="#__codelineno-449-52"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-53"><a id="__codelineno-449-53" name="__codelineno-449-53" href="#__codelineno-449-53"></a><span class="w">                    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-449-54"><a id="__codelineno-449-54" name="__codelineno-449-54" href="#__codelineno-449-54"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-449-55"><a id="__codelineno-449-55" name="__codelineno-449-55" href="#__codelineno-449-55"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-449-56"><a id="__codelineno-449-56" name="__codelineno-449-56" href="#__codelineno-449-56"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-449-57"><a id="__codelineno-449-57" name="__codelineno-449-57" href="#__codelineno-449-57"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-449-58"><a id="__codelineno-449-58" name="__codelineno-449-58" href="#__codelineno-449-58"></a><span class="w">    </span><span class="c1">-- Update character appearance</span>
</span><span id="__span-449-59"><a id="__codelineno-449-59" name="__codelineno-449-59" href="#__codelineno-449-59"></a><span class="w">    </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-449-60"><a id="__codelineno-449-60" name="__codelineno-449-60" href="#__codelineno-449-60"></a><span class="w">    </span><span class="c1">-- Notify other players</span>
</span><span id="__span-449-61"><a id="__codelineno-449-61" name="__codelineno-449-61" href="#__codelineno-449-61"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-449-62"><a id="__codelineno-449-62" name="__codelineno-449-62" href="#__codelineno-449-62"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-449-63"><a id="__codelineno-449-63" name="__codelineno-449-63" href="#__codelineno-449-63"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; joined the &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; class&quot;</span><span class="p">)</span>
</span><span id="__span-449-64"><a id="__codelineno-449-64" name="__codelineno-449-64" href="#__codelineno-449-64"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-449-65"><a id="__codelineno-449-65" name="__codelineno-449-65" href="#__codelineno-449-65"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-449-66"><a id="__codelineno-449-66" name="__codelineno-449-66" href="#__codelineno-449-66"></a><span class="w">    </span><span class="c1">-- Log class change</span>
</span><span id="__span-449-67"><a id="__codelineno-449-67" name="__codelineno-449-67" href="#__codelineno-449-67"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s joined class %s (was %s)&quot;</span><span class="p">,</span>
</span><span id="__span-449-68"><a id="__codelineno-449-68" name="__codelineno-449-68" href="#__codelineno-449-68"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">))</span>
</span><span id="__span-449-69"><a id="__codelineno-449-69" name="__codelineno-449-69" href="#__codelineno-449-69"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerleavesequence">OnPlayerLeaveSequence</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player leaves a sequence</p>
<p><strong>When Called</strong></p>
<p>When a player finishes or exits a sequence</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Player</em>): The player leaving the sequence</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-450-1"><a id="__codelineno-450-1" name="__codelineno-450-1" href="#__codelineno-450-1"></a><span class="c1">-- Simple: Log sequence exit</span>
</span><span id="__span-450-2"><a id="__codelineno-450-2" name="__codelineno-450-2" href="#__codelineno-450-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLeaveSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-450-3"><a id="__codelineno-450-3" name="__codelineno-450-3" href="#__codelineno-450-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; left sequence&quot;</span><span class="p">)</span>
</span><span id="__span-450-4"><a id="__codelineno-450-4" name="__codelineno-450-4" href="#__codelineno-450-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-451-1"><a id="__codelineno-451-1" name="__codelineno-451-1" href="#__codelineno-451-1"></a><span class="c1">-- Medium: Track sequence completion</span>
</span><span id="__span-451-2"><a id="__codelineno-451-2" name="__codelineno-451-2" href="#__codelineno-451-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLeaveSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SequenceTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-451-3"><a id="__codelineno-451-3" name="__codelineno-451-3" href="#__codelineno-451-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-451-4"><a id="__codelineno-451-4" name="__codelineno-451-4" href="#__codelineno-451-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-451-5"><a id="__codelineno-451-5" name="__codelineno-451-5" href="#__codelineno-451-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequencesCompleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesCompleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-451-6"><a id="__codelineno-451-6" name="__codelineno-451-6" href="#__codelineno-451-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSequenceEnd&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-451-7"><a id="__codelineno-451-7" name="__codelineno-451-7" href="#__codelineno-451-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-451-8"><a id="__codelineno-451-8" name="__codelineno-451-8" href="#__codelineno-451-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-452-1"><a id="__codelineno-452-1" name="__codelineno-452-1" href="#__codelineno-452-1"></a><span class="c1">-- High: Complex sequence exit system</span>
</span><span id="__span-452-2"><a id="__codelineno-452-2" name="__codelineno-452-2" href="#__codelineno-452-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLeaveSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSequenceExit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-452-3"><a id="__codelineno-452-3" name="__codelineno-452-3" href="#__codelineno-452-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-452-4"><a id="__codelineno-452-4" name="__codelineno-452-4" href="#__codelineno-452-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-452-5"><a id="__codelineno-452-5" name="__codelineno-452-5" href="#__codelineno-452-5"></a><span class="w">    </span><span class="c1">-- Get sequence data</span>
</span><span id="__span-452-6"><a id="__codelineno-452-6" name="__codelineno-452-6" href="#__codelineno-452-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;currentSequence&quot;</span><span class="p">)</span>
</span><span id="__span-452-7"><a id="__codelineno-452-7" name="__codelineno-452-7" href="#__codelineno-452-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sequenceStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequenceStartTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-452-8"><a id="__codelineno-452-8" name="__codelineno-452-8" href="#__codelineno-452-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sequenceDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">sequenceStartTime</span>
</span><span id="__span-452-9"><a id="__codelineno-452-9" name="__codelineno-452-9" href="#__codelineno-452-9"></a><span class="w">    </span><span class="c1">-- Update sequence statistics</span>
</span><span id="__span-452-10"><a id="__codelineno-452-10" name="__codelineno-452-10" href="#__codelineno-452-10"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequencesCompleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesCompleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-452-11"><a id="__codelineno-452-11" name="__codelineno-452-11" href="#__codelineno-452-11"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSequenceEnd&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-452-12"><a id="__codelineno-452-12" name="__codelineno-452-12" href="#__codelineno-452-12"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;totalSequenceTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;totalSequenceTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">sequenceDuration</span><span class="p">))</span>
</span><span id="__span-452-13"><a id="__codelineno-452-13" name="__codelineno-452-13" href="#__codelineno-452-13"></a><span class="w">    </span><span class="c1">-- Clear sequence data</span>
</span><span id="__span-452-14"><a id="__codelineno-452-14" name="__codelineno-452-14" href="#__codelineno-452-14"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;inSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-452-15"><a id="__codelineno-452-15" name="__codelineno-452-15" href="#__codelineno-452-15"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;currentSequence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-452-16"><a id="__codelineno-452-16" name="__codelineno-452-16" href="#__codelineno-452-16"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sequenceStartTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-452-17"><a id="__codelineno-452-17" name="__codelineno-452-17" href="#__codelineno-452-17"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-452-18"><a id="__codelineno-452-18" name="__codelineno-452-18" href="#__codelineno-452-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sequencesCompleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sequencesCompleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-452-19"><a id="__codelineno-452-19" name="__codelineno-452-19" href="#__codelineno-452-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">sequencesCompleted</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_sequence_master&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-20"><a id="__codelineno-452-20" name="__codelineno-452-20" href="#__codelineno-452-20"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_sequence_master&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-452-21"><a id="__codelineno-452-21" name="__codelineno-452-21" href="#__codelineno-452-21"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Sequence Master!&quot;</span><span class="p">)</span>
</span><span id="__span-452-22"><a id="__codelineno-452-22" name="__codelineno-452-22" href="#__codelineno-452-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-452-23"><a id="__codelineno-452-23" name="__codelineno-452-23" href="#__codelineno-452-23"></a><span class="w">    </span><span class="c1">-- Check for sequence-specific achievements</span>
</span><span id="__span-452-24"><a id="__codelineno-452-24" name="__codelineno-452-24" href="#__codelineno-452-24"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentSequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;dance&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-25"><a id="__codelineno-452-25" name="__codelineno-452-25" href="#__codelineno-452-25"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">danceCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;danceCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-452-26"><a id="__codelineno-452-26" name="__codelineno-452-26" href="#__codelineno-452-26"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;danceCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">danceCount</span><span class="p">)</span>
</span><span id="__span-452-27"><a id="__codelineno-452-27" name="__codelineno-452-27" href="#__codelineno-452-27"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">danceCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_dancer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-28"><a id="__codelineno-452-28" name="__codelineno-452-28" href="#__codelineno-452-28"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_dancer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-452-29"><a id="__codelineno-452-29" name="__codelineno-452-29" href="#__codelineno-452-29"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Dancer!&quot;</span><span class="p">)</span>
</span><span id="__span-452-30"><a id="__codelineno-452-30" name="__codelineno-452-30" href="#__codelineno-452-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-452-31"><a id="__codelineno-452-31" name="__codelineno-452-31" href="#__codelineno-452-31"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">currentSequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;sit&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-32"><a id="__codelineno-452-32" name="__codelineno-452-32" href="#__codelineno-452-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">sitCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sitCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-452-33"><a id="__codelineno-452-33" name="__codelineno-452-33" href="#__codelineno-452-33"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sitCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">sitCount</span><span class="p">)</span>
</span><span id="__span-452-34"><a id="__codelineno-452-34" name="__codelineno-452-34" href="#__codelineno-452-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">sitCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_sitter&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-35"><a id="__codelineno-452-35" name="__codelineno-452-35" href="#__codelineno-452-35"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_sitter&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-452-36"><a id="__codelineno-452-36" name="__codelineno-452-36" href="#__codelineno-452-36"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Sitter!&quot;</span><span class="p">)</span>
</span><span id="__span-452-37"><a id="__codelineno-452-37" name="__codelineno-452-37" href="#__codelineno-452-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-452-38"><a id="__codelineno-452-38" name="__codelineno-452-38" href="#__codelineno-452-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-452-39"><a id="__codelineno-452-39" name="__codelineno-452-39" href="#__codelineno-452-39"></a><span class="w">    </span><span class="c1">-- Check for sequence duration achievements</span>
</span><span id="__span-452-40"><a id="__codelineno-452-40" name="__codelineno-452-40" href="#__codelineno-452-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">sequenceDuration</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 1 minute</span>
</span><span id="__span-452-41"><a id="__codelineno-452-41" name="__codelineno-452-41" href="#__codelineno-452-41"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">longSequences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;longSequences&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-452-42"><a id="__codelineno-452-42" name="__codelineno-452-42" href="#__codelineno-452-42"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;longSequences&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">longSequences</span><span class="p">)</span>
</span><span id="__span-452-43"><a id="__codelineno-452-43" name="__codelineno-452-43" href="#__codelineno-452-43"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">longSequences</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_patient&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-44"><a id="__codelineno-452-44" name="__codelineno-452-44" href="#__codelineno-452-44"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_patient&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-452-45"><a id="__codelineno-452-45" name="__codelineno-452-45" href="#__codelineno-452-45"></a><span class="w">            </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Patient!&quot;</span><span class="p">)</span>
</span><span id="__span-452-46"><a id="__codelineno-452-46" name="__codelineno-452-46" href="#__codelineno-452-46"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-452-47"><a id="__codelineno-452-47" name="__codelineno-452-47" href="#__codelineno-452-47"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-452-48"><a id="__codelineno-452-48" name="__codelineno-452-48" href="#__codelineno-452-48"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-452-49"><a id="__codelineno-452-49" name="__codelineno-452-49" href="#__codelineno-452-49"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-452-50"><a id="__codelineno-452-50" name="__codelineno-452-50" href="#__codelineno-452-50"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-452-51"><a id="__codelineno-452-51" name="__codelineno-452-51" href="#__codelineno-452-51"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; finished performing: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">currentSequence</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;action&quot;</span><span class="p">))</span>
</span><span id="__span-452-52"><a id="__codelineno-452-52" name="__codelineno-452-52" href="#__codelineno-452-52"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-452-53"><a id="__codelineno-452-53" name="__codelineno-452-53" href="#__codelineno-452-53"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-452-54"><a id="__codelineno-452-54" name="__codelineno-452-54" href="#__codelineno-452-54"></a><span class="w">    </span><span class="c1">-- Log sequence exit</span>
</span><span id="__span-452-55"><a id="__codelineno-452-55" name="__codelineno-452-55" href="#__codelineno-452-55"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s left sequence %s (Duration: %d seconds)&quot;</span><span class="p">,</span>
</span><span id="__span-452-56"><a id="__codelineno-452-56" name="__codelineno-452-56" href="#__codelineno-452-56"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">currentSequence</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">sequenceDuration</span><span class="p">))</span>
</span><span id="__span-452-57"><a id="__codelineno-452-57" name="__codelineno-452-57" href="#__codelineno-452-57"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerloststackitem">OnPlayerLostStackItem</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player loses a stack item</p>
<p><strong>When Called</strong></p>
<p>When a player's stack item is removed or lost</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>itemTypeOrItem</code> (<em>string/Item</em>): The item type or item instance that was lost</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-453-1"><a id="__codelineno-453-1" name="__codelineno-453-1" href="#__codelineno-453-1"></a><span class="c1">-- Simple: Log stack item loss</span>
</span><span id="__span-453-2"><a id="__codelineno-453-2" name="__codelineno-453-2" href="#__codelineno-453-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLostStackItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">)</span>
</span><span id="__span-453-3"><a id="__codelineno-453-3" name="__codelineno-453-3" href="#__codelineno-453-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Player lost stack item: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">))</span>
</span><span id="__span-453-4"><a id="__codelineno-453-4" name="__codelineno-453-4" href="#__codelineno-453-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-454-1"><a id="__codelineno-454-1" name="__codelineno-454-1" href="#__codelineno-454-1"></a><span class="c1">-- Medium: Track stack item losses</span>
</span><span id="__span-454-2"><a id="__codelineno-454-2" name="__codelineno-454-2" href="#__codelineno-454-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLostStackItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackStackLosses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">)</span>
</span><span id="__span-454-3"><a id="__codelineno-454-3" name="__codelineno-454-3" href="#__codelineno-454-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">stackLosses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">stackLosses</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-454-4"><a id="__codelineno-454-4" name="__codelineno-454-4" href="#__codelineno-454-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">itemTypeOrItem</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">itemTypeOrItem</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-454-5"><a id="__codelineno-454-5" name="__codelineno-454-5" href="#__codelineno-454-5"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">stackLosses</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">stackLosses</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-454-6"><a id="__codelineno-454-6" name="__codelineno-454-6" href="#__codelineno-454-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-455-1"><a id="__codelineno-455-1" name="__codelineno-455-1" href="#__codelineno-455-1"></a><span class="c1">-- High: Complex stack item loss handling</span>
</span><span id="__span-455-2"><a id="__codelineno-455-2" name="__codelineno-455-2" href="#__codelineno-455-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerLostStackItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStackLoss&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">)</span>
</span><span id="__span-455-3"><a id="__codelineno-455-3" name="__codelineno-455-3" href="#__codelineno-455-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">itemTypeOrItem</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">itemTypeOrItem</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">itemTypeOrItem</span><span class="p">.</span><span class="py">uniqueID</span>
</span><span id="__span-455-4"><a id="__codelineno-455-4" name="__codelineno-455-4" href="#__codelineno-455-4"></a><span class="c1">-- Log stack item loss</span>
</span><span id="__span-455-5"><a id="__codelineno-455-5" name="__codelineno-455-5" href="#__codelineno-455-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;stack_item_lost&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-455-6"><a id="__codelineno-455-6" name="__codelineno-455-6" href="#__codelineno-455-6"></a><span class="nv">itemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span>
</span><span id="__span-455-7"><a id="__codelineno-455-7" name="__codelineno-455-7" href="#__codelineno-455-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-455-8"><a id="__codelineno-455-8" name="__codelineno-455-8" href="#__codelineno-455-8"></a><span class="p">})</span>
</span><span id="__span-455-9"><a id="__codelineno-455-9" name="__codelineno-455-9" href="#__codelineno-455-9"></a><span class="c1">-- Find all players who had this item</span>
</span><span id="__span-455-10"><a id="__codelineno-455-10" name="__codelineno-455-10" href="#__codelineno-455-10"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-455-11"><a id="__codelineno-455-11" name="__codelineno-455-11" href="#__codelineno-455-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-455-12"><a id="__codelineno-455-12" name="__codelineno-455-12" href="#__codelineno-455-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-455-13"><a id="__codelineno-455-13" name="__codelineno-455-13" href="#__codelineno-455-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-455-14"><a id="__codelineno-455-14" name="__codelineno-455-14" href="#__codelineno-455-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-455-15"><a id="__codelineno-455-15" name="__codelineno-455-15" href="#__codelineno-455-15"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-455-16"><a id="__codelineno-455-16" name="__codelineno-455-16" href="#__codelineno-455-16"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-455-17"><a id="__codelineno-455-17" name="__codelineno-455-17" href="#__codelineno-455-17"></a><span class="w">                    </span><span class="c1">-- Notify player</span>
</span><span id="__span-455-18"><a id="__codelineno-455-18" name="__codelineno-455-18" href="#__codelineno-455-18"></a><span class="w">                    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You lost a stack item: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-455-19"><a id="__codelineno-455-19" name="__codelineno-455-19" href="#__codelineno-455-19"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-455-20"><a id="__codelineno-455-20" name="__codelineno-455-20" href="#__codelineno-455-20"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-455-21"><a id="__codelineno-455-21" name="__codelineno-455-21" href="#__codelineno-455-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-455-22"><a id="__codelineno-455-22" name="__codelineno-455-22" href="#__codelineno-455-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-455-23"><a id="__codelineno-455-23" name="__codelineno-455-23" href="#__codelineno-455-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-455-24"><a id="__codelineno-455-24" name="__codelineno-455-24" href="#__codelineno-455-24"></a><span class="c1">-- Update global statistics</span>
</span><span id="__span-455-25"><a id="__codelineno-455-25" name="__codelineno-455-25" href="#__codelineno-455-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;stackStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">lost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-455-26"><a id="__codelineno-455-26" name="__codelineno-455-26" href="#__codelineno-455-26"></a><span class="nv">stats</span><span class="p">.</span><span class="py">lost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">lost</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-455-27"><a id="__codelineno-455-27" name="__codelineno-455-27" href="#__codelineno-455-27"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;stackStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-455-28"><a id="__codelineno-455-28" name="__codelineno-455-28" href="#__codelineno-455-28"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerobserve">OnPlayerObserve</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player enters or exits observer mode</p>
<p><strong>When Called</strong></p>
<p>When a player starts or stops observing</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player entering/exiting observer mode</li>
<li><code>state</code> (<em>boolean</em>): True if entering observer mode, false if exiting</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-456-1"><a id="__codelineno-456-1" name="__codelineno-456-1" href="#__codelineno-456-1"></a><span class="c1">-- Simple: Log observer mode changes</span>
</span><span id="__span-456-2"><a id="__codelineno-456-2" name="__codelineno-456-2" href="#__codelineno-456-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerObserve&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-456-3"><a id="__codelineno-456-3" name="__codelineno-456-3" href="#__codelineno-456-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-456-4"><a id="__codelineno-456-4" name="__codelineno-456-4" href="#__codelineno-456-4"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; entered observer mode&quot;</span><span class="p">)</span>
</span><span id="__span-456-5"><a id="__codelineno-456-5" name="__codelineno-456-5" href="#__codelineno-456-5"></a><span class="kr">else</span>
</span><span id="__span-456-6"><a id="__codelineno-456-6" name="__codelineno-456-6" href="#__codelineno-456-6"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; exited observer mode&quot;</span><span class="p">)</span>
</span><span id="__span-456-7"><a id="__codelineno-456-7" name="__codelineno-456-7" href="#__codelineno-456-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-456-8"><a id="__codelineno-456-8" name="__codelineno-456-8" href="#__codelineno-456-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-457-1"><a id="__codelineno-457-1" name="__codelineno-457-1" href="#__codelineno-457-1"></a><span class="c1">-- Medium: Handle observer mode restrictions</span>
</span><span id="__span-457-2"><a id="__codelineno-457-2" name="__codelineno-457-2" href="#__codelineno-457-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerObserve&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ObserverRestrictions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-457-3"><a id="__codelineno-457-3" name="__codelineno-457-3" href="#__codelineno-457-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-457-4"><a id="__codelineno-457-4" name="__codelineno-457-4" href="#__codelineno-457-4"></a><span class="w">    </span><span class="c1">-- Hide player when observing</span>
</span><span id="__span-457-5"><a id="__codelineno-457-5" name="__codelineno-457-5" href="#__codelineno-457-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-457-6"><a id="__codelineno-457-6" name="__codelineno-457-6" href="#__codelineno-457-6"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNotSolid</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-457-7"><a id="__codelineno-457-7" name="__codelineno-457-7" href="#__codelineno-457-7"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMoveType</span><span class="p">(</span><span class="nv">MOVETYPE_NOCLIP</span><span class="p">)</span>
</span><span id="__span-457-8"><a id="__codelineno-457-8" name="__codelineno-457-8" href="#__codelineno-457-8"></a><span class="w">    </span><span class="c1">-- Notify other players</span>
</span><span id="__span-457-9"><a id="__codelineno-457-9" name="__codelineno-457-9" href="#__codelineno-457-9"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-457-10"><a id="__codelineno-457-10" name="__codelineno-457-10" href="#__codelineno-457-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-457-11"><a id="__codelineno-457-11" name="__codelineno-457-11" href="#__codelineno-457-11"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is now observing&quot;</span><span class="p">)</span>
</span><span id="__span-457-12"><a id="__codelineno-457-12" name="__codelineno-457-12" href="#__codelineno-457-12"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-457-13"><a id="__codelineno-457-13" name="__codelineno-457-13" href="#__codelineno-457-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-457-14"><a id="__codelineno-457-14" name="__codelineno-457-14" href="#__codelineno-457-14"></a><span class="kr">else</span>
</span><span id="__span-457-15"><a id="__codelineno-457-15" name="__codelineno-457-15" href="#__codelineno-457-15"></a><span class="w">    </span><span class="c1">-- Restore player when exiting observer mode</span>
</span><span id="__span-457-16"><a id="__codelineno-457-16" name="__codelineno-457-16" href="#__codelineno-457-16"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-457-17"><a id="__codelineno-457-17" name="__codelineno-457-17" href="#__codelineno-457-17"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNotSolid</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-457-18"><a id="__codelineno-457-18" name="__codelineno-457-18" href="#__codelineno-457-18"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMoveType</span><span class="p">(</span><span class="nv">MOVETYPE_WALK</span><span class="p">)</span>
</span><span id="__span-457-19"><a id="__codelineno-457-19" name="__codelineno-457-19" href="#__codelineno-457-19"></a><span class="w">    </span><span class="c1">-- Notify other players</span>
</span><span id="__span-457-20"><a id="__codelineno-457-20" name="__codelineno-457-20" href="#__codelineno-457-20"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-457-21"><a id="__codelineno-457-21" name="__codelineno-457-21" href="#__codelineno-457-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-457-22"><a id="__codelineno-457-22" name="__codelineno-457-22" href="#__codelineno-457-22"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is no longer observing&quot;</span><span class="p">)</span>
</span><span id="__span-457-23"><a id="__codelineno-457-23" name="__codelineno-457-23" href="#__codelineno-457-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-457-24"><a id="__codelineno-457-24" name="__codelineno-457-24" href="#__codelineno-457-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-457-25"><a id="__codelineno-457-25" name="__codelineno-457-25" href="#__codelineno-457-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-457-26"><a id="__codelineno-457-26" name="__codelineno-457-26" href="#__codelineno-457-26"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-458-1"><a id="__codelineno-458-1" name="__codelineno-458-1" href="#__codelineno-458-1"></a><span class="c1">-- High: Complex observer mode system</span>
</span><span id="__span-458-2"><a id="__codelineno-458-2" name="__codelineno-458-2" href="#__codelineno-458-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerObserve&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedObserver&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-458-3"><a id="__codelineno-458-3" name="__codelineno-458-3" href="#__codelineno-458-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-458-4"><a id="__codelineno-458-4" name="__codelineno-458-4" href="#__codelineno-458-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-458-5"><a id="__codelineno-458-5" name="__codelineno-458-5" href="#__codelineno-458-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-6"><a id="__codelineno-458-6" name="__codelineno-458-6" href="#__codelineno-458-6"></a><span class="w">        </span><span class="c1">-- Check if player has permission to observe</span>
</span><span id="__span-458-7"><a id="__codelineno-458-7" name="__codelineno-458-7" href="#__codelineno-458-7"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-8"><a id="__codelineno-458-8" name="__codelineno-458-8" href="#__codelineno-458-8"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to observe&quot;</span><span class="p">)</span>
</span><span id="__span-458-9"><a id="__codelineno-458-9" name="__codelineno-458-9" href="#__codelineno-458-9"></a><span class="w">            </span><span class="kr">return</span>
</span><span id="__span-458-10"><a id="__codelineno-458-10" name="__codelineno-458-10" href="#__codelineno-458-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-458-11"><a id="__codelineno-458-11" name="__codelineno-458-11" href="#__codelineno-458-11"></a><span class="w">        </span><span class="c1">-- Store original position</span>
</span><span id="__span-458-12"><a id="__codelineno-458-12" name="__codelineno-458-12" href="#__codelineno-458-12"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;observePos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-458-13"><a id="__codelineno-458-13" name="__codelineno-458-13" href="#__codelineno-458-13"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;observeAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-458-14"><a id="__codelineno-458-14" name="__codelineno-458-14" href="#__codelineno-458-14"></a><span class="w">        </span><span class="c1">-- Set up observer mode</span>
</span><span id="__span-458-15"><a id="__codelineno-458-15" name="__codelineno-458-15" href="#__codelineno-458-15"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-458-16"><a id="__codelineno-458-16" name="__codelineno-458-16" href="#__codelineno-458-16"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNotSolid</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-458-17"><a id="__codelineno-458-17" name="__codelineno-458-17" href="#__codelineno-458-17"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMoveType</span><span class="p">(</span><span class="nv">MOVETYPE_NOCLIP</span><span class="p">)</span>
</span><span id="__span-458-18"><a id="__codelineno-458-18" name="__codelineno-458-18" href="#__codelineno-458-18"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-458-19"><a id="__codelineno-458-19" name="__codelineno-458-19" href="#__codelineno-458-19"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-458-20"><a id="__codelineno-458-20" name="__codelineno-458-20" href="#__codelineno-458-20"></a><span class="w">        </span><span class="c1">-- Set observer target</span>
</span><span id="__span-458-21"><a id="__codelineno-458-21" name="__codelineno-458-21" href="#__codelineno-458-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;observeTarget&quot;</span><span class="p">)</span>
</span><span id="__span-458-22"><a id="__codelineno-458-22" name="__codelineno-458-22" href="#__codelineno-458-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-23"><a id="__codelineno-458-23" name="__codelineno-458-23" href="#__codelineno-458-23"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetObserverTarget</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span>
</span><span id="__span-458-24"><a id="__codelineno-458-24" name="__codelineno-458-24" href="#__codelineno-458-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-458-25"><a id="__codelineno-458-25" name="__codelineno-458-25" href="#__codelineno-458-25"></a><span class="w">        </span><span class="c1">-- Notify admins</span>
</span><span id="__span-458-26"><a id="__codelineno-458-26" name="__codelineno-458-26" href="#__codelineno-458-26"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-458-27"><a id="__codelineno-458-27" name="__codelineno-458-27" href="#__codelineno-458-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-28"><a id="__codelineno-458-28" name="__codelineno-458-28" href="#__codelineno-458-28"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; entered observer mode&quot;</span><span class="p">)</span>
</span><span id="__span-458-29"><a id="__codelineno-458-29" name="__codelineno-458-29" href="#__codelineno-458-29"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-458-30"><a id="__codelineno-458-30" name="__codelineno-458-30" href="#__codelineno-458-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-458-31"><a id="__codelineno-458-31" name="__codelineno-458-31" href="#__codelineno-458-31"></a><span class="w">        </span><span class="c1">-- Log observer mode</span>
</span><span id="__span-458-32"><a id="__codelineno-458-32" name="__codelineno-458-32" href="#__codelineno-458-32"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s entered observer mode at %s&quot;</span><span class="p">,</span>
</span><span id="__span-458-33"><a id="__codelineno-458-33" name="__codelineno-458-33" href="#__codelineno-458-33"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="__span-458-34"><a id="__codelineno-458-34" name="__codelineno-458-34" href="#__codelineno-458-34"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-458-35"><a id="__codelineno-458-35" name="__codelineno-458-35" href="#__codelineno-458-35"></a><span class="w">        </span><span class="c1">-- Restore player</span>
</span><span id="__span-458-36"><a id="__codelineno-458-36" name="__codelineno-458-36" href="#__codelineno-458-36"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNoDraw</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-458-37"><a id="__codelineno-458-37" name="__codelineno-458-37" href="#__codelineno-458-37"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetNotSolid</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-458-38"><a id="__codelineno-458-38" name="__codelineno-458-38" href="#__codelineno-458-38"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMoveType</span><span class="p">(</span><span class="nv">MOVETYPE_WALK</span><span class="p">)</span>
</span><span id="__span-458-39"><a id="__codelineno-458-39" name="__codelineno-458-39" href="#__codelineno-458-39"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-458-40"><a id="__codelineno-458-40" name="__codelineno-458-40" href="#__codelineno-458-40"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-458-41"><a id="__codelineno-458-41" name="__codelineno-458-41" href="#__codelineno-458-41"></a><span class="w">        </span><span class="c1">-- Restore position if available</span>
</span><span id="__span-458-42"><a id="__codelineno-458-42" name="__codelineno-458-42" href="#__codelineno-458-42"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">observePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;observePos&quot;</span><span class="p">)</span>
</span><span id="__span-458-43"><a id="__codelineno-458-43" name="__codelineno-458-43" href="#__codelineno-458-43"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">observeAng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;observeAng&quot;</span><span class="p">)</span>
</span><span id="__span-458-44"><a id="__codelineno-458-44" name="__codelineno-458-44" href="#__codelineno-458-44"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">observePos</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">observeAng</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-45"><a id="__codelineno-458-45" name="__codelineno-458-45" href="#__codelineno-458-45"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nv">observePos</span><span class="p">)</span>
</span><span id="__span-458-46"><a id="__codelineno-458-46" name="__codelineno-458-46" href="#__codelineno-458-46"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetAngles</span><span class="p">(</span><span class="nv">observeAng</span><span class="p">)</span>
</span><span id="__span-458-47"><a id="__codelineno-458-47" name="__codelineno-458-47" href="#__codelineno-458-47"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-458-48"><a id="__codelineno-458-48" name="__codelineno-458-48" href="#__codelineno-458-48"></a><span class="w">        </span><span class="c1">-- Clear observer data</span>
</span><span id="__span-458-49"><a id="__codelineno-458-49" name="__codelineno-458-49" href="#__codelineno-458-49"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;observePos&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-458-50"><a id="__codelineno-458-50" name="__codelineno-458-50" href="#__codelineno-458-50"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;observeAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-458-51"><a id="__codelineno-458-51" name="__codelineno-458-51" href="#__codelineno-458-51"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;observeTarget&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-458-52"><a id="__codelineno-458-52" name="__codelineno-458-52" href="#__codelineno-458-52"></a><span class="w">        </span><span class="c1">-- Notify admins</span>
</span><span id="__span-458-53"><a id="__codelineno-458-53" name="__codelineno-458-53" href="#__codelineno-458-53"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-458-54"><a id="__codelineno-458-54" name="__codelineno-458-54" href="#__codelineno-458-54"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-458-55"><a id="__codelineno-458-55" name="__codelineno-458-55" href="#__codelineno-458-55"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; exited observer mode&quot;</span><span class="p">)</span>
</span><span id="__span-458-56"><a id="__codelineno-458-56" name="__codelineno-458-56" href="#__codelineno-458-56"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-458-57"><a id="__codelineno-458-57" name="__codelineno-458-57" href="#__codelineno-458-57"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-458-58"><a id="__codelineno-458-58" name="__codelineno-458-58" href="#__codelineno-458-58"></a><span class="w">        </span><span class="c1">-- Log observer mode exit</span>
</span><span id="__span-458-59"><a id="__codelineno-458-59" name="__codelineno-458-59" href="#__codelineno-458-59"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s exited observer mode at %s&quot;</span><span class="p">,</span>
</span><span id="__span-458-60"><a id="__codelineno-458-60" name="__codelineno-458-60" href="#__codelineno-458-60"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="__span-458-61"><a id="__codelineno-458-61" name="__codelineno-458-61" href="#__codelineno-458-61"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-458-62"><a id="__codelineno-458-62" name="__codelineno-458-62" href="#__codelineno-458-62"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerpurchasedoor">OnPlayerPurchaseDoor</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player purchases a door</p>
<p><strong>When Called</strong></p>
<p>When a player successfully buys a door</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player purchasing the door</li>
<li><code>door</code> (<em>Entity</em>): The door being purchased</li>
<li><code>price</code> (<em>number</em>): The price paid for the door</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-459-1"><a id="__codelineno-459-1" name="__codelineno-459-1" href="#__codelineno-459-1"></a><span class="c1">-- Simple: Log door purchases</span>
</span><span id="__span-459-2"><a id="__codelineno-459-2" name="__codelineno-459-2" href="#__codelineno-459-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerPurchaseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-459-3"><a id="__codelineno-459-3" name="__codelineno-459-3" href="#__codelineno-459-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; purchased door for $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-459-4"><a id="__codelineno-459-4" name="__codelineno-459-4" href="#__codelineno-459-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-460-1"><a id="__codelineno-460-1" name="__codelineno-460-1" href="#__codelineno-460-1"></a><span class="c1">-- Medium: Handle door purchase bonuses</span>
</span><span id="__span-460-2"><a id="__codelineno-460-2" name="__codelineno-460-2" href="#__codelineno-460-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerPurchaseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DoorBonuses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-460-3"><a id="__codelineno-460-3" name="__codelineno-460-3" href="#__codelineno-460-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-460-4"><a id="__codelineno-460-4" name="__codelineno-460-4" href="#__codelineno-460-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-460-5"><a id="__codelineno-460-5" name="__codelineno-460-5" href="#__codelineno-460-5"></a><span class="w">    </span><span class="c1">-- Give purchase bonus</span>
</span><span id="__span-460-6"><a id="__codelineno-460-6" name="__codelineno-460-6" href="#__codelineno-460-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 10% bonus</span>
</span><span id="__span-460-7"><a id="__codelineno-460-7" name="__codelineno-460-7" href="#__codelineno-460-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">bonus</span><span class="p">)</span>
</span><span id="__span-460-8"><a id="__codelineno-460-8" name="__codelineno-460-8" href="#__codelineno-460-8"></a><span class="w">    </span><span class="c1">-- Set door ownership</span>
</span><span id="__span-460-9"><a id="__codelineno-460-9" name="__codelineno-460-9" href="#__codelineno-460-9"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-460-10"><a id="__codelineno-460-10" name="__codelineno-460-10" href="#__codelineno-460-10"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;purchaseTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-460-11"><a id="__codelineno-460-11" name="__codelineno-460-11" href="#__codelineno-460-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Door purchased! You received a $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; bonus&quot;</span><span class="p">)</span>
</span><span id="__span-460-12"><a id="__codelineno-460-12" name="__codelineno-460-12" href="#__codelineno-460-12"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-461-1"><a id="__codelineno-461-1" name="__codelineno-461-1" href="#__codelineno-461-1"></a><span class="c1">-- High: Complex door purchase system</span>
</span><span id="__span-461-2"><a id="__codelineno-461-2" name="__codelineno-461-2" href="#__codelineno-461-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerPurchaseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorPurchases&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-461-3"><a id="__codelineno-461-3" name="__codelineno-461-3" href="#__codelineno-461-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-461-4"><a id="__codelineno-461-4" name="__codelineno-461-4" href="#__codelineno-461-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-461-5"><a id="__codelineno-461-5" name="__codelineno-461-5" href="#__codelineno-461-5"></a><span class="w">    </span><span class="c1">-- Set up door ownership</span>
</span><span id="__span-461-6"><a id="__codelineno-461-6" name="__codelineno-461-6" href="#__codelineno-461-6"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-461-7"><a id="__codelineno-461-7" name="__codelineno-461-7" href="#__codelineno-461-7"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;purchaseTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-461-8"><a id="__codelineno-461-8" name="__codelineno-461-8" href="#__codelineno-461-8"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;purchasePrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-461-9"><a id="__codelineno-461-9" name="__codelineno-461-9" href="#__codelineno-461-9"></a><span class="w">    </span><span class="c1">-- Give door key</span>
</span><span id="__span-461-10"><a id="__codelineno-461-10" name="__codelineno-461-10" href="#__codelineno-461-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="s2">&quot;door_key&quot;</span><span class="p">)</span>
</span><span id="__span-461-11"><a id="__codelineno-461-11" name="__codelineno-461-11" href="#__codelineno-461-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-461-12"><a id="__codelineno-461-12" name="__codelineno-461-12" href="#__codelineno-461-12"></a><span class="w">        </span><span class="nv">key</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-461-13"><a id="__codelineno-461-13" name="__codelineno-461-13" href="#__codelineno-461-13"></a><span class="w">        </span><span class="nv">key</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;doorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{}).</span><span class="nv">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Door&quot;</span><span class="p">)</span>
</span><span id="__span-461-14"><a id="__codelineno-461-14" name="__codelineno-461-14" href="#__codelineno-461-14"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">():</span><span class="nf">add</span><span class="p">(</span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-461-15"><a id="__codelineno-461-15" name="__codelineno-461-15" href="#__codelineno-461-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-461-16"><a id="__codelineno-461-16" name="__codelineno-461-16" href="#__codelineno-461-16"></a><span class="w">    </span><span class="c1">-- Check for bulk purchase discount</span>
</span><span id="__span-461-17"><a id="__codelineno-461-17" name="__codelineno-461-17" href="#__codelineno-461-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ownedDoors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-461-18"><a id="__codelineno-461-18" name="__codelineno-461-18" href="#__codelineno-461-18"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ent</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">ents</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-461-19"><a id="__codelineno-461-19" name="__codelineno-461-19" href="#__codelineno-461-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ent</span><span class="p">.</span><span class="py">IsDoor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-461-20"><a id="__codelineno-461-20" name="__codelineno-461-20" href="#__codelineno-461-20"></a><span class="w">            </span><span class="nv">ownedDoors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ownedDoors</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-461-21"><a id="__codelineno-461-21" name="__codelineno-461-21" href="#__codelineno-461-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-461-22"><a id="__codelineno-461-22" name="__codelineno-461-22" href="#__codelineno-461-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-461-23"><a id="__codelineno-461-23" name="__codelineno-461-23" href="#__codelineno-461-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ownedDoors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-461-24"><a id="__codelineno-461-24" name="__codelineno-461-24" href="#__codelineno-461-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">discount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nv">price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 20% discount</span>
</span><span id="__span-461-25"><a id="__codelineno-461-25" name="__codelineno-461-25" href="#__codelineno-461-25"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">discount</span><span class="p">)</span>
</span><span id="__span-461-26"><a id="__codelineno-461-26" name="__codelineno-461-26" href="#__codelineno-461-26"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Bulk purchase discount: $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">discount</span><span class="p">)</span>
</span><span id="__span-461-27"><a id="__codelineno-461-27" name="__codelineno-461-27" href="#__codelineno-461-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-461-28"><a id="__codelineno-461-28" name="__codelineno-461-28" href="#__codelineno-461-28"></a><span class="w">    </span><span class="c1">-- Update character statistics</span>
</span><span id="__span-461-29"><a id="__codelineno-461-29" name="__codelineno-461-29" href="#__codelineno-461-29"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorsOwned&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsOwned&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-461-30"><a id="__codelineno-461-30" name="__codelineno-461-30" href="#__codelineno-461-30"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;totalSpent&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;totalSpent&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">price</span><span class="p">))</span>
</span><span id="__span-461-31"><a id="__codelineno-461-31" name="__codelineno-461-31" href="#__codelineno-461-31"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-461-32"><a id="__codelineno-461-32" name="__codelineno-461-32" href="#__codelineno-461-32"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsOwned&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-461-33"><a id="__codelineno-461-33" name="__codelineno-461-33" href="#__codelineno-461-33"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_landlord&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-461-34"><a id="__codelineno-461-34" name="__codelineno-461-34" href="#__codelineno-461-34"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Landlord!&quot;</span><span class="p">)</span>
</span><span id="__span-461-35"><a id="__codelineno-461-35" name="__codelineno-461-35" href="#__codelineno-461-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-461-36"><a id="__codelineno-461-36" name="__codelineno-461-36" href="#__codelineno-461-36"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-461-37"><a id="__codelineno-461-37" name="__codelineno-461-37" href="#__codelineno-461-37"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-461-38"><a id="__codelineno-461-38" name="__codelineno-461-38" href="#__codelineno-461-38"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-461-39"><a id="__codelineno-461-39" name="__codelineno-461-39" href="#__codelineno-461-39"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; purchased a door for $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span>
</span><span id="__span-461-40"><a id="__codelineno-461-40" name="__codelineno-461-40" href="#__codelineno-461-40"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-461-41"><a id="__codelineno-461-41" name="__codelineno-461-41" href="#__codelineno-461-41"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-461-42"><a id="__codelineno-461-42" name="__codelineno-461-42" href="#__codelineno-461-42"></a><span class="w">    </span><span class="c1">-- Log purchase</span>
</span><span id="__span-461-43"><a id="__codelineno-461-43" name="__codelineno-461-43" href="#__codelineno-461-43"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s purchased door %s for $%d&quot;</span><span class="p">,</span>
</span><span id="__span-461-44"><a id="__codelineno-461-44" name="__codelineno-461-44" href="#__codelineno-461-44"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">price</span><span class="p">))</span>
</span><span id="__span-461-45"><a id="__codelineno-461-45" name="__codelineno-461-45" href="#__codelineno-461-45"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onplayerswitchclass">OnPlayerSwitchClass</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player switches classes</p>
<p><strong>When Called</strong></p>
<p>When a player successfully changes their class</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player switching classes</li>
<li><code>class</code> (<em>string</em>): The new class being switched to</li>
<li><code>oldClass</code> (<em>string</em>): The previous class</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-462-1"><a id="__codelineno-462-1" name="__codelineno-462-1" href="#__codelineno-462-1"></a><span class="c1">-- Simple: Log class switches</span>
</span><span id="__span-462-2"><a id="__codelineno-462-2" name="__codelineno-462-2" href="#__codelineno-462-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerSwitchClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-462-3"><a id="__codelineno-462-3" name="__codelineno-462-3" href="#__codelineno-462-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; switched from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldClass</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-462-4"><a id="__codelineno-462-4" name="__codelineno-462-4" href="#__codelineno-462-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-463-1"><a id="__codelineno-463-1" name="__codelineno-463-1" href="#__codelineno-463-1"></a><span class="c1">-- Medium: Handle class switch bonuses</span>
</span><span id="__span-463-2"><a id="__codelineno-463-2" name="__codelineno-463-2" href="#__codelineno-463-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerSwitchClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ClassSwitchBonuses&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-463-3"><a id="__codelineno-463-3" name="__codelineno-463-3" href="#__codelineno-463-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-463-4"><a id="__codelineno-463-4" name="__codelineno-463-4" href="#__codelineno-463-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-463-5"><a id="__codelineno-463-5" name="__codelineno-463-5" href="#__codelineno-463-5"></a><span class="w">    </span><span class="c1">-- Give switch bonus</span>
</span><span id="__span-463-6"><a id="__codelineno-463-6" name="__codelineno-463-6" href="#__codelineno-463-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">switchBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-463-7"><a id="__codelineno-463-7" name="__codelineno-463-7" href="#__codelineno-463-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setMoney</span><span class="p">(</span><span class="nv">char</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">switchBonus</span><span class="p">)</span>
</span><span id="__span-463-8"><a id="__codelineno-463-8" name="__codelineno-463-8" href="#__codelineno-463-8"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Class switch bonus: $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">switchBonus</span><span class="p">)</span>
</span><span id="__span-463-9"><a id="__codelineno-463-9" name="__codelineno-463-9" href="#__codelineno-463-9"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-464-1"><a id="__codelineno-464-1" name="__codelineno-464-1" href="#__codelineno-464-1"></a><span class="c1">-- High: Complex class switching system</span>
</span><span id="__span-464-2"><a id="__codelineno-464-2" name="__codelineno-464-2" href="#__codelineno-464-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnPlayerSwitchClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedClassSwitching&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span><span class="w"> </span><span class="nv">oldClass</span><span class="p">)</span>
</span><span id="__span-464-3"><a id="__codelineno-464-3" name="__codelineno-464-3" href="#__codelineno-464-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-464-4"><a id="__codelineno-464-4" name="__codelineno-464-4" href="#__codelineno-464-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-464-5"><a id="__codelineno-464-5" name="__codelineno-464-5" href="#__codelineno-464-5"></a><span class="w">    </span><span class="c1">-- Remove old class bonuses</span>
</span><span id="__span-464-6"><a id="__codelineno-464-6" name="__codelineno-464-6" href="#__codelineno-464-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">oldClass</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-7"><a id="__codelineno-464-7" name="__codelineno-464-7" href="#__codelineno-464-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">oldBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-8"><a id="__codelineno-464-8" name="__codelineno-464-8" href="#__codelineno-464-8"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;police_officer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;authority&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;salary&quot;</span><span class="p">},</span>
</span><span id="__span-464-9"><a id="__codelineno-464-9" name="__codelineno-464-9" href="#__codelineno-464-9"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;healingBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medicalKnowledge&quot;</span><span class="p">},</span>
</span><span id="__span-464-10"><a id="__codelineno-464-10" name="__codelineno-464-10" href="#__codelineno-464-10"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;engineer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;repairBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;technicalSkill&quot;</span><span class="p">}</span>
</span><span id="__span-464-11"><a id="__codelineno-464-11" name="__codelineno-464-11" href="#__codelineno-464-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-464-12"><a id="__codelineno-464-12" name="__codelineno-464-12" href="#__codelineno-464-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">oldBonuses</span><span class="p">[</span><span class="nv">oldClass</span><span class="p">]</span>
</span><span id="__span-464-13"><a id="__codelineno-464-13" name="__codelineno-464-13" href="#__codelineno-464-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-14"><a id="__codelineno-464-14" name="__codelineno-464-14" href="#__codelineno-464-14"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-464-15"><a id="__codelineno-464-15" name="__codelineno-464-15" href="#__codelineno-464-15"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="nv">bonus</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-464-16"><a id="__codelineno-464-16" name="__codelineno-464-16" href="#__codelineno-464-16"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-464-17"><a id="__codelineno-464-17" name="__codelineno-464-17" href="#__codelineno-464-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-464-18"><a id="__codelineno-464-18" name="__codelineno-464-18" href="#__codelineno-464-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-464-19"><a id="__codelineno-464-19" name="__codelineno-464-19" href="#__codelineno-464-19"></a><span class="w">    </span><span class="c1">-- Apply new class bonuses</span>
</span><span id="__span-464-20"><a id="__codelineno-464-20" name="__codelineno-464-20" href="#__codelineno-464-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">classBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-21"><a id="__codelineno-464-21" name="__codelineno-464-21" href="#__codelineno-464-21"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police_officer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-22"><a id="__codelineno-464-22" name="__codelineno-464-22" href="#__codelineno-464-22"></a><span class="w">    </span><span class="nv">authority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-464-23"><a id="__codelineno-464-23" name="__codelineno-464-23" href="#__codelineno-464-23"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-464-24"><a id="__codelineno-464-24" name="__codelineno-464-24" href="#__codelineno-464-24"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;police_badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">}</span>
</span><span id="__span-464-25"><a id="__codelineno-464-25" name="__codelineno-464-25" href="#__codelineno-464-25"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-464-26"><a id="__codelineno-464-26" name="__codelineno-464-26" href="#__codelineno-464-26"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-27"><a id="__codelineno-464-27" name="__codelineno-464-27" href="#__codelineno-464-27"></a><span class="w">    </span><span class="nv">healingBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="__span-464-28"><a id="__codelineno-464-28" name="__codelineno-464-28" href="#__codelineno-464-28"></a><span class="w">    </span><span class="nv">medicalKnowledge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-464-29"><a id="__codelineno-464-29" name="__codelineno-464-29" href="#__codelineno-464-29"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
</span><span id="__span-464-30"><a id="__codelineno-464-30" name="__codelineno-464-30" href="#__codelineno-464-30"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stethoscope&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">}</span>
</span><span id="__span-464-31"><a id="__codelineno-464-31" name="__codelineno-464-31" href="#__codelineno-464-31"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-464-32"><a id="__codelineno-464-32" name="__codelineno-464-32" href="#__codelineno-464-32"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;engineer&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-33"><a id="__codelineno-464-33" name="__codelineno-464-33" href="#__codelineno-464-33"></a><span class="w">    </span><span class="nv">repairBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
</span><span id="__span-464-34"><a id="__codelineno-464-34" name="__codelineno-464-34" href="#__codelineno-464-34"></a><span class="w">    </span><span class="nv">technicalSkill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
</span><span id="__span-464-35"><a id="__codelineno-464-35" name="__codelineno-464-35" href="#__codelineno-464-35"></a><span class="w">    </span><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span>
</span><span id="__span-464-36"><a id="__codelineno-464-36" name="__codelineno-464-36" href="#__codelineno-464-36"></a><span class="w">    </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wrench&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;screwdriver&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;multitool&quot;</span><span class="p">}</span>
</span><span id="__span-464-37"><a id="__codelineno-464-37" name="__codelineno-464-37" href="#__codelineno-464-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-464-38"><a id="__codelineno-464-38" name="__codelineno-464-38" href="#__codelineno-464-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-464-39"><a id="__codelineno-464-39" name="__codelineno-464-39" href="#__codelineno-464-39"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">classBonuses</span><span class="p">[</span><span class="nv">class</span><span class="p">]</span>
</span><span id="__span-464-40"><a id="__codelineno-464-40" name="__codelineno-464-40" href="#__codelineno-464-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-41"><a id="__codelineno-464-41" name="__codelineno-464-41" href="#__codelineno-464-41"></a><span class="w">        </span><span class="c1">-- Apply stat bonuses</span>
</span><span id="__span-464-42"><a id="__codelineno-464-42" name="__codelineno-464-42" href="#__codelineno-464-42"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-464-43"><a id="__codelineno-464-43" name="__codelineno-464-43" href="#__codelineno-464-43"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">stat</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;items&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-44"><a id="__codelineno-464-44" name="__codelineno-464-44" href="#__codelineno-464-44"></a><span class="w">                </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-464-45"><a id="__codelineno-464-45" name="__codelineno-464-45" href="#__codelineno-464-45"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-464-46"><a id="__codelineno-464-46" name="__codelineno-464-46" href="#__codelineno-464-46"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-464-47"><a id="__codelineno-464-47" name="__codelineno-464-47" href="#__codelineno-464-47"></a><span class="w">        </span><span class="c1">-- Give class items</span>
</span><span id="__span-464-48"><a id="__codelineno-464-48" name="__codelineno-464-48" href="#__codelineno-464-48"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-49"><a id="__codelineno-464-49" name="__codelineno-464-49" href="#__codelineno-464-49"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-464-50"><a id="__codelineno-464-50" name="__codelineno-464-50" href="#__codelineno-464-50"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-464-51"><a id="__codelineno-464-51" name="__codelineno-464-51" href="#__codelineno-464-51"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-464-52"><a id="__codelineno-464-52" name="__codelineno-464-52" href="#__codelineno-464-52"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-53"><a id="__codelineno-464-53" name="__codelineno-464-53" href="#__codelineno-464-53"></a><span class="w">                    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-464-54"><a id="__codelineno-464-54" name="__codelineno-464-54" href="#__codelineno-464-54"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-464-55"><a id="__codelineno-464-55" name="__codelineno-464-55" href="#__codelineno-464-55"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-464-56"><a id="__codelineno-464-56" name="__codelineno-464-56" href="#__codelineno-464-56"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-464-57"><a id="__codelineno-464-57" name="__codelineno-464-57" href="#__codelineno-464-57"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-464-58"><a id="__codelineno-464-58" name="__codelineno-464-58" href="#__codelineno-464-58"></a><span class="w">    </span><span class="c1">-- Update character appearance</span>
</span><span id="__span-464-59"><a id="__codelineno-464-59" name="__codelineno-464-59" href="#__codelineno-464-59"></a><span class="w">    </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-464-60"><a id="__codelineno-464-60" name="__codelineno-464-60" href="#__codelineno-464-60"></a><span class="w">    </span><span class="c1">-- Check for class switch cooldown</span>
</span><span id="__span-464-61"><a id="__codelineno-464-61" name="__codelineno-464-61" href="#__codelineno-464-61"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastClassSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-464-62"><a id="__codelineno-464-62" name="__codelineno-464-62" href="#__codelineno-464-62"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">switchCooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="c1">-- 1 hour</span>
</span><span id="__span-464-63"><a id="__codelineno-464-63" name="__codelineno-464-63" href="#__codelineno-464-63"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastSwitch</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">switchCooldown</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-64"><a id="__codelineno-464-64" name="__codelineno-464-64" href="#__codelineno-464-64"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You must wait before switching classes again&quot;</span><span class="p">)</span>
</span><span id="__span-464-65"><a id="__codelineno-464-65" name="__codelineno-464-65" href="#__codelineno-464-65"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-464-66"><a id="__codelineno-464-66" name="__codelineno-464-66" href="#__codelineno-464-66"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-464-67"><a id="__codelineno-464-67" name="__codelineno-464-67" href="#__codelineno-464-67"></a><span class="w">    </span><span class="c1">-- Update switch time</span>
</span><span id="__span-464-68"><a id="__codelineno-464-68" name="__codelineno-464-68" href="#__codelineno-464-68"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastClassSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-464-69"><a id="__codelineno-464-69" name="__codelineno-464-69" href="#__codelineno-464-69"></a><span class="w">    </span><span class="c1">-- Check for achievement</span>
</span><span id="__span-464-70"><a id="__codelineno-464-70" name="__codelineno-464-70" href="#__codelineno-464-70"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">classSwitches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;classSwitches&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-464-71"><a id="__codelineno-464-71" name="__codelineno-464-71" href="#__codelineno-464-71"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;classSwitches&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">classSwitches</span><span class="p">)</span>
</span><span id="__span-464-72"><a id="__codelineno-464-72" name="__codelineno-464-72" href="#__codelineno-464-72"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">classSwitches</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_class_hopper&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-73"><a id="__codelineno-464-73" name="__codelineno-464-73" href="#__codelineno-464-73"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_class_hopper&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-464-74"><a id="__codelineno-464-74" name="__codelineno-464-74" href="#__codelineno-464-74"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Class Hopper!&quot;</span><span class="p">)</span>
</span><span id="__span-464-75"><a id="__codelineno-464-75" name="__codelineno-464-75" href="#__codelineno-464-75"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-464-76"><a id="__codelineno-464-76" name="__codelineno-464-76" href="#__codelineno-464-76"></a><span class="w">    </span><span class="c1">-- Notify other players</span>
</span><span id="__span-464-77"><a id="__codelineno-464-77" name="__codelineno-464-77" href="#__codelineno-464-77"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-464-78"><a id="__codelineno-464-78" name="__codelineno-464-78" href="#__codelineno-464-78"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-464-79"><a id="__codelineno-464-79" name="__codelineno-464-79" href="#__codelineno-464-79"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; switched to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; class&quot;</span><span class="p">)</span>
</span><span id="__span-464-80"><a id="__codelineno-464-80" name="__codelineno-464-80" href="#__codelineno-464-80"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-464-81"><a id="__codelineno-464-81" name="__codelineno-464-81" href="#__codelineno-464-81"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-464-82"><a id="__codelineno-464-82" name="__codelineno-464-82" href="#__codelineno-464-82"></a><span class="w">    </span><span class="c1">-- Log class switch</span>
</span><span id="__span-464-83"><a id="__codelineno-464-83" name="__codelineno-464-83" href="#__codelineno-464-83"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s switched from %s to %s class&quot;</span><span class="p">,</span>
</span><span id="__span-464-84"><a id="__codelineno-464-84" name="__codelineno-464-84" href="#__codelineno-464-84"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">oldClass</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">))</span>
</span><span id="__span-464-85"><a id="__codelineno-464-85" name="__codelineno-464-85" href="#__codelineno-464-85"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onrequestitemtransfer">OnRequestItemTransfer</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item transfer is requested</p>
<p><strong>When Called</strong></p>
<p>When a request is made to transfer an item to another inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>item</code> (<em>Item</em>): The item being transferred</li>
<li><code>targetInventory</code> (<em>Inventory</em>): The target inventory</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-465-1"><a id="__codelineno-465-1" name="__codelineno-465-1" href="#__codelineno-465-1"></a><span class="c1">-- Simple: Log item transfer requests</span>
</span><span id="__span-465-2"><a id="__codelineno-465-2" name="__codelineno-465-2" href="#__codelineno-465-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnRequestItemTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">targetInventory</span><span class="p">)</span>
</span><span id="__span-465-3"><a id="__codelineno-465-3" name="__codelineno-465-3" href="#__codelineno-465-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item transfer requested: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-465-4"><a id="__codelineno-465-4" name="__codelineno-465-4" href="#__codelineno-465-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-466-1"><a id="__codelineno-466-1" name="__codelineno-466-1" href="#__codelineno-466-1"></a><span class="c1">-- Medium: Track transfer requests</span>
</span><span id="__span-466-2"><a id="__codelineno-466-2" name="__codelineno-466-2" href="#__codelineno-466-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnRequestItemTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTransferRequests&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">targetInventory</span><span class="p">)</span>
</span><span id="__span-466-3"><a id="__codelineno-466-3" name="__codelineno-466-3" href="#__codelineno-466-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">transferRequests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">transferRequests</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-4"><a id="__codelineno-466-4" name="__codelineno-466-4" href="#__codelineno-466-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">transferRequests</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-466-5"><a id="__codelineno-466-5" name="__codelineno-466-5" href="#__codelineno-466-5"></a><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span>
</span><span id="__span-466-6"><a id="__codelineno-466-6" name="__codelineno-466-6" href="#__codelineno-466-6"></a><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetInventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-466-7"><a id="__codelineno-466-7" name="__codelineno-466-7" href="#__codelineno-466-7"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-466-8"><a id="__codelineno-466-8" name="__codelineno-466-8" href="#__codelineno-466-8"></a><span class="p">})</span>
</span><span id="__span-466-9"><a id="__codelineno-466-9" name="__codelineno-466-9" href="#__codelineno-466-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-467-1"><a id="__codelineno-467-1" name="__codelineno-467-1" href="#__codelineno-467-1"></a><span class="c1">-- High: Complex transfer request handling</span>
</span><span id="__span-467-2"><a id="__codelineno-467-2" name="__codelineno-467-2" href="#__codelineno-467-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnRequestItemTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTransferRequest&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">item</span><span class="p">,</span><span class="w"> </span><span class="nv">targetInventory</span><span class="p">)</span>
</span><span id="__span-467-3"><a id="__codelineno-467-3" name="__codelineno-467-3" href="#__codelineno-467-3"></a><span class="c1">-- Log transfer request</span>
</span><span id="__span-467-4"><a id="__codelineno-467-4" name="__codelineno-467-4" href="#__codelineno-467-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;item_transfer_request&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-467-5"><a id="__codelineno-467-5" name="__codelineno-467-5" href="#__codelineno-467-5"></a><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span>
</span><span id="__span-467-6"><a id="__codelineno-467-6" name="__codelineno-467-6" href="#__codelineno-467-6"></a><span class="nv">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getInventory</span><span class="p">():</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-467-7"><a id="__codelineno-467-7" name="__codelineno-467-7" href="#__codelineno-467-7"></a><span class="nv">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetInventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-467-8"><a id="__codelineno-467-8" name="__codelineno-467-8" href="#__codelineno-467-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-467-9"><a id="__codelineno-467-9" name="__codelineno-467-9" href="#__codelineno-467-9"></a><span class="p">})</span>
</span><span id="__span-467-10"><a id="__codelineno-467-10" name="__codelineno-467-10" href="#__codelineno-467-10"></a><span class="c1">-- Check transfer restrictions</span>
</span><span id="__span-467-11"><a id="__codelineno-467-11" name="__codelineno-467-11" href="#__codelineno-467-11"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-467-12"><a id="__codelineno-467-12" name="__codelineno-467-12" href="#__codelineno-467-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-467-13"><a id="__codelineno-467-13" name="__codelineno-467-13" href="#__codelineno-467-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-467-14"><a id="__codelineno-467-14" name="__codelineno-467-14" href="#__codelineno-467-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-467-15"><a id="__codelineno-467-15" name="__codelineno-467-15" href="#__codelineno-467-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-467-16"><a id="__codelineno-467-16" name="__codelineno-467-16" href="#__codelineno-467-16"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-467-17"><a id="__codelineno-467-17" name="__codelineno-467-17" href="#__codelineno-467-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-467-18"><a id="__codelineno-467-18" name="__codelineno-467-18" href="#__codelineno-467-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-467-19"><a id="__codelineno-467-19" name="__codelineno-467-19" href="#__codelineno-467-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onsalaryadjust">OnSalaryAdjust</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player's salary is adjusted</p>
<p><strong>When Called</strong></p>
<p>When a player's salary amount is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose salary is being adjusted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-468-1"><a id="__codelineno-468-1" name="__codelineno-468-1" href="#__codelineno-468-1"></a><span class="c1">-- Simple: Log salary adjustments</span>
</span><span id="__span-468-2"><a id="__codelineno-468-2" name="__codelineno-468-2" href="#__codelineno-468-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryAdjust&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-468-3"><a id="__codelineno-468-3" name="__codelineno-468-3" href="#__codelineno-468-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;&#39;s salary was adjusted&quot;</span><span class="p">)</span>
</span><span id="__span-468-4"><a id="__codelineno-468-4" name="__codelineno-468-4" href="#__codelineno-468-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-469-1"><a id="__codelineno-469-1" name="__codelineno-469-1" href="#__codelineno-469-1"></a><span class="c1">-- Medium: Track salary changes</span>
</span><span id="__span-469-2"><a id="__codelineno-469-2" name="__codelineno-469-2" href="#__codelineno-469-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryAdjust&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackSalaryChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-469-3"><a id="__codelineno-469-3" name="__codelineno-469-3" href="#__codelineno-469-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-469-4"><a id="__codelineno-469-4" name="__codelineno-469-4" href="#__codelineno-469-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-469-5"><a id="__codelineno-469-5" name="__codelineno-469-5" href="#__codelineno-469-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;salaryHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-469-6"><a id="__codelineno-469-6" name="__codelineno-469-6" href="#__codelineno-469-6"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">history</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-469-7"><a id="__codelineno-469-7" name="__codelineno-469-7" href="#__codelineno-469-7"></a><span class="w">    </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-469-8"><a id="__codelineno-469-8" name="__codelineno-469-8" href="#__codelineno-469-8"></a><span class="w">    </span><span class="nv">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;adjusted&quot;</span>
</span><span id="__span-469-9"><a id="__codelineno-469-9" name="__codelineno-469-9" href="#__codelineno-469-9"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-469-10"><a id="__codelineno-469-10" name="__codelineno-469-10" href="#__codelineno-469-10"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salaryHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">history</span><span class="p">)</span>
</span><span id="__span-469-11"><a id="__codelineno-469-11" name="__codelineno-469-11" href="#__codelineno-469-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-469-12"><a id="__codelineno-469-12" name="__codelineno-469-12" href="#__codelineno-469-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-470-1"><a id="__codelineno-470-1" name="__codelineno-470-1" href="#__codelineno-470-1"></a><span class="c1">-- High: Complex salary adjustment tracking</span>
</span><span id="__span-470-2"><a id="__codelineno-470-2" name="__codelineno-470-2" href="#__codelineno-470-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryAdjust&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalaryAdjustment&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-470-3"><a id="__codelineno-470-3" name="__codelineno-470-3" href="#__codelineno-470-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-470-4"><a id="__codelineno-470-4" name="__codelineno-470-4" href="#__codelineno-470-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-470-5"><a id="__codelineno-470-5" name="__codelineno-470-5" href="#__codelineno-470-5"></a><span class="w">    </span><span class="c1">-- Log salary adjustment</span>
</span><span id="__span-470-6"><a id="__codelineno-470-6" name="__codelineno-470-6" href="#__codelineno-470-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;salary_adjust&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-470-7"><a id="__codelineno-470-7" name="__codelineno-470-7" href="#__codelineno-470-7"></a><span class="w">    </span><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-470-8"><a id="__codelineno-470-8" name="__codelineno-470-8" href="#__codelineno-470-8"></a><span class="w">    </span><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-470-9"><a id="__codelineno-470-9" name="__codelineno-470-9" href="#__codelineno-470-9"></a><span class="w">    </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">(),</span>
</span><span id="__span-470-10"><a id="__codelineno-470-10" name="__codelineno-470-10" href="#__codelineno-470-10"></a><span class="w">    </span><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getClass</span><span class="p">(),</span>
</span><span id="__span-470-11"><a id="__codelineno-470-11" name="__codelineno-470-11" href="#__codelineno-470-11"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-470-12"><a id="__codelineno-470-12" name="__codelineno-470-12" href="#__codelineno-470-12"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-470-13"><a id="__codelineno-470-13" name="__codelineno-470-13" href="#__codelineno-470-13"></a><span class="w">    </span><span class="c1">-- Update salary statistics</span>
</span><span id="__span-470-14"><a id="__codelineno-470-14" name="__codelineno-470-14" href="#__codelineno-470-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;salaryStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">adjustments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-470-15"><a id="__codelineno-470-15" name="__codelineno-470-15" href="#__codelineno-470-15"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">adjustments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">adjustments</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-470-16"><a id="__codelineno-470-16" name="__codelineno-470-16" href="#__codelineno-470-16"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">lastAdjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-470-17"><a id="__codelineno-470-17" name="__codelineno-470-17" href="#__codelineno-470-17"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salaryStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-470-18"><a id="__codelineno-470-18" name="__codelineno-470-18" href="#__codelineno-470-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onsalarygiven">OnSalaryGiven</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player receives their salary</p>
<p><strong>When Called</strong></p>
<p>When salary is paid to a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player receiving the salary</li>
<li><code>char</code> (<em>Character</em>): The character receiving the salary</li>
<li><code>pay</code> (<em>number</em>): The amount of salary paid</li>
<li><code>faction</code> (<em>number</em>): The faction ID</li>
<li><code>class</code> (<em>number</em>): The class ID</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-471-1"><a id="__codelineno-471-1" name="__codelineno-471-1" href="#__codelineno-471-1"></a><span class="c1">-- Simple: Log salary payments</span>
</span><span id="__span-471-2"><a id="__codelineno-471-2" name="__codelineno-471-2" href="#__codelineno-471-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-471-3"><a id="__codelineno-471-3" name="__codelineno-471-3" href="#__codelineno-471-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; received salary: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">pay</span><span class="p">)</span>
</span><span id="__span-471-4"><a id="__codelineno-471-4" name="__codelineno-471-4" href="#__codelineno-471-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-472-1"><a id="__codelineno-472-1" name="__codelineno-472-1" href="#__codelineno-472-1"></a><span class="c1">-- Medium: Track salary payments</span>
</span><span id="__span-472-2"><a id="__codelineno-472-2" name="__codelineno-472-2" href="#__codelineno-472-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackSalaryPayments&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-472-3"><a id="__codelineno-472-3" name="__codelineno-472-3" href="#__codelineno-472-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;salaryHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-472-4"><a id="__codelineno-472-4" name="__codelineno-472-4" href="#__codelineno-472-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">history</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-472-5"><a id="__codelineno-472-5" name="__codelineno-472-5" href="#__codelineno-472-5"></a><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span>
</span><span id="__span-472-6"><a id="__codelineno-472-6" name="__codelineno-472-6" href="#__codelineno-472-6"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-472-7"><a id="__codelineno-472-7" name="__codelineno-472-7" href="#__codelineno-472-7"></a><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span>
</span><span id="__span-472-8"><a id="__codelineno-472-8" name="__codelineno-472-8" href="#__codelineno-472-8"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">class</span>
</span><span id="__span-472-9"><a id="__codelineno-472-9" name="__codelineno-472-9" href="#__codelineno-472-9"></a><span class="p">})</span>
</span><span id="__span-472-10"><a id="__codelineno-472-10" name="__codelineno-472-10" href="#__codelineno-472-10"></a><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salaryHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">history</span><span class="p">)</span>
</span><span id="__span-472-11"><a id="__codelineno-472-11" name="__codelineno-472-11" href="#__codelineno-472-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-473-1"><a id="__codelineno-473-1" name="__codelineno-473-1" href="#__codelineno-473-1"></a><span class="c1">-- High: Complex salary payment tracking</span>
</span><span id="__span-473-2"><a id="__codelineno-473-2" name="__codelineno-473-2" href="#__codelineno-473-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSalaryGiven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalaryTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-473-3"><a id="__codelineno-473-3" name="__codelineno-473-3" href="#__codelineno-473-3"></a><span class="c1">-- Log salary payment</span>
</span><span id="__span-473-4"><a id="__codelineno-473-4" name="__codelineno-473-4" href="#__codelineno-473-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;salary_given&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-473-5"><a id="__codelineno-473-5" name="__codelineno-473-5" href="#__codelineno-473-5"></a><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-473-6"><a id="__codelineno-473-6" name="__codelineno-473-6" href="#__codelineno-473-6"></a><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-473-7"><a id="__codelineno-473-7" name="__codelineno-473-7" href="#__codelineno-473-7"></a><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span>
</span><span id="__span-473-8"><a id="__codelineno-473-8" name="__codelineno-473-8" href="#__codelineno-473-8"></a><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span>
</span><span id="__span-473-9"><a id="__codelineno-473-9" name="__codelineno-473-9" href="#__codelineno-473-9"></a><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">class</span><span class="p">,</span>
</span><span id="__span-473-10"><a id="__codelineno-473-10" name="__codelineno-473-10" href="#__codelineno-473-10"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-473-11"><a id="__codelineno-473-11" name="__codelineno-473-11" href="#__codelineno-473-11"></a><span class="p">})</span>
</span><span id="__span-473-12"><a id="__codelineno-473-12" name="__codelineno-473-12" href="#__codelineno-473-12"></a><span class="c1">-- Update salary statistics</span>
</span><span id="__span-473-13"><a id="__codelineno-473-13" name="__codelineno-473-13" href="#__codelineno-473-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;salaryStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-473-14"><a id="__codelineno-473-14" name="__codelineno-473-14" href="#__codelineno-473-14"></a><span class="nv">stats</span><span class="p">.</span><span class="py">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">pay</span>
</span><span id="__span-473-15"><a id="__codelineno-473-15" name="__codelineno-473-15" href="#__codelineno-473-15"></a><span class="nv">stats</span><span class="p">.</span><span class="py">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-473-16"><a id="__codelineno-473-16" name="__codelineno-473-16" href="#__codelineno-473-16"></a><span class="nv">stats</span><span class="p">.</span><span class="py">lastPayment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-473-17"><a id="__codelineno-473-17" name="__codelineno-473-17" href="#__codelineno-473-17"></a><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;salaryStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-473-18"><a id="__codelineno-473-18" name="__codelineno-473-18" href="#__codelineno-473-18"></a><span class="c1">-- Notify player</span>
</span><span id="__span-473-19"><a id="__codelineno-473-19" name="__codelineno-473-19" href="#__codelineno-473-19"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You received your salary: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">currency</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nv">pay</span><span class="p">))</span>
</span><span id="__span-473-20"><a id="__codelineno-473-20" name="__codelineno-473-20" href="#__codelineno-473-20"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onsaveditemloaded">OnSavedItemLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when saved items are loaded</p>
<p><strong>When Called</strong></p>
<p>When items are loaded from the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>loadedItems</code> (<em>table</em>): Table of items that were loaded</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-474-1"><a id="__codelineno-474-1" name="__codelineno-474-1" href="#__codelineno-474-1"></a><span class="c1">-- Simple: Log loaded items</span>
</span><span id="__span-474-2"><a id="__codelineno-474-2" name="__codelineno-474-2" href="#__codelineno-474-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSavedItemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span>
</span><span id="__span-474-3"><a id="__codelineno-474-3" name="__codelineno-474-3" href="#__codelineno-474-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; items&quot;</span><span class="p">)</span>
</span><span id="__span-474-4"><a id="__codelineno-474-4" name="__codelineno-474-4" href="#__codelineno-474-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-475-1"><a id="__codelineno-475-1" name="__codelineno-475-1" href="#__codelineno-475-1"></a><span class="c1">-- Medium: Track loaded items</span>
</span><span id="__span-475-2"><a id="__codelineno-475-2" name="__codelineno-475-2" href="#__codelineno-475-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSavedItemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackLoadedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span>
</span><span id="__span-475-3"><a id="__codelineno-475-3" name="__codelineno-475-3" href="#__codelineno-475-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedItems</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-475-4"><a id="__codelineno-475-4" name="__codelineno-475-4" href="#__codelineno-475-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-475-5"><a id="__codelineno-475-5" name="__codelineno-475-5" href="#__codelineno-475-5"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">loadedItems</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-475-6"><a id="__codelineno-475-6" name="__codelineno-475-6" href="#__codelineno-475-6"></a><span class="w">    </span><span class="nv">uniqueID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span>
</span><span id="__span-475-7"><a id="__codelineno-475-7" name="__codelineno-475-7" href="#__codelineno-475-7"></a><span class="w">    </span><span class="nv">loaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-475-8"><a id="__codelineno-475-8" name="__codelineno-475-8" href="#__codelineno-475-8"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-475-9"><a id="__codelineno-475-9" name="__codelineno-475-9" href="#__codelineno-475-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-475-10"><a id="__codelineno-475-10" name="__codelineno-475-10" href="#__codelineno-475-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-476-1"><a id="__codelineno-476-1" name="__codelineno-476-1" href="#__codelineno-476-1"></a><span class="c1">-- High: Complex item loading management</span>
</span><span id="__span-476-2"><a id="__codelineno-476-2" name="__codelineno-476-2" href="#__codelineno-476-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnSavedItemLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span>
</span><span id="__span-476-3"><a id="__codelineno-476-3" name="__codelineno-476-3" href="#__codelineno-476-3"></a><span class="c1">-- Log item loading</span>
</span><span id="__span-476-4"><a id="__codelineno-476-4" name="__codelineno-476-4" href="#__codelineno-476-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;items_loaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-476-5"><a id="__codelineno-476-5" name="__codelineno-476-5" href="#__codelineno-476-5"></a><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">),</span>
</span><span id="__span-476-6"><a id="__codelineno-476-6" name="__codelineno-476-6" href="#__codelineno-476-6"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-476-7"><a id="__codelineno-476-7" name="__codelineno-476-7" href="#__codelineno-476-7"></a><span class="p">})</span>
</span><span id="__span-476-8"><a id="__codelineno-476-8" name="__codelineno-476-8" href="#__codelineno-476-8"></a><span class="c1">-- Validate loaded items</span>
</span><span id="__span-476-9"><a id="__codelineno-476-9" name="__codelineno-476-9" href="#__codelineno-476-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-476-10"><a id="__codelineno-476-10" name="__codelineno-476-10" href="#__codelineno-476-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">isValid</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-476-11"><a id="__codelineno-476-11" name="__codelineno-476-11" href="#__codelineno-476-11"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Invalid item loaded: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">))</span>
</span><span id="__span-476-12"><a id="__codelineno-476-12" name="__codelineno-476-12" href="#__codelineno-476-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-476-13"><a id="__codelineno-476-13" name="__codelineno-476-13" href="#__codelineno-476-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-476-14"><a id="__codelineno-476-14" name="__codelineno-476-14" href="#__codelineno-476-14"></a><span class="c1">-- Update item statistics</span>
</span><span id="__span-476-15"><a id="__codelineno-476-15" name="__codelineno-476-15" href="#__codelineno-476-15"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">itemStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">itemStats</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-476-16"><a id="__codelineno-476-16" name="__codelineno-476-16" href="#__codelineno-476-16"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">loadedItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-476-17"><a id="__codelineno-476-17" name="__codelineno-476-17" href="#__codelineno-476-17"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">itemStats</span><span class="p">[</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">itemStats</span><span class="p">[</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-476-18"><a id="__codelineno-476-18" name="__codelineno-476-18" href="#__codelineno-476-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-476-19"><a id="__codelineno-476-19" name="__codelineno-476-19" href="#__codelineno-476-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onserverlog">OnServerLog</h3>
<p><strong>Purpose</strong></p>
<p>Called when a server log entry is created</p>
<p><strong>When Called</strong></p>
<p>When a log message is written to the server log</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player associated with the log (can be nil)</li>
<li><code>logType</code> (<em>string</em>): The type of log entry</li>
<li><code>logString</code> (<em>string</em>): The log message</li>
<li><code>category</code> (<em>string</em>): The log category</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-477-1"><a id="__codelineno-477-1" name="__codelineno-477-1" href="#__codelineno-477-1"></a><span class="c1">-- Simple: Print server logs</span>
</span><span id="__span-477-2"><a id="__codelineno-477-2" name="__codelineno-477-2" href="#__codelineno-477-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnServerLog&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">logType</span><span class="p">,</span><span class="w"> </span><span class="nv">logString</span><span class="p">,</span><span class="w"> </span><span class="nv">category</span><span class="p">)</span>
</span><span id="__span-477-3"><a id="__codelineno-477-3" name="__codelineno-477-3" href="#__codelineno-477-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">logType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">logString</span><span class="p">)</span>
</span><span id="__span-477-4"><a id="__codelineno-477-4" name="__codelineno-477-4" href="#__codelineno-477-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-478-1"><a id="__codelineno-478-1" name="__codelineno-478-1" href="#__codelineno-478-1"></a><span class="c1">-- Medium: Filter and store logs</span>
</span><span id="__span-478-2"><a id="__codelineno-478-2" name="__codelineno-478-2" href="#__codelineno-478-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnServerLog&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FilterLogs&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">logType</span><span class="p">,</span><span class="w"> </span><span class="nv">logString</span><span class="p">,</span><span class="w"> </span><span class="nv">category</span><span class="p">)</span>
</span><span id="__span-478-3"><a id="__codelineno-478-3" name="__codelineno-478-3" href="#__codelineno-478-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-478-4"><a id="__codelineno-478-4" name="__codelineno-478-4" href="#__codelineno-478-4"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">adminLogs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">adminLogs</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-478-5"><a id="__codelineno-478-5" name="__codelineno-478-5" href="#__codelineno-478-5"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">adminLogs</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-478-6"><a id="__codelineno-478-6" name="__codelineno-478-6" href="#__codelineno-478-6"></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logType</span><span class="p">,</span>
</span><span id="__span-478-7"><a id="__codelineno-478-7" name="__codelineno-478-7" href="#__codelineno-478-7"></a><span class="w">    </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logString</span><span class="p">,</span>
</span><span id="__span-478-8"><a id="__codelineno-478-8" name="__codelineno-478-8" href="#__codelineno-478-8"></a><span class="w">    </span><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Server&quot;</span><span class="p">,</span>
</span><span id="__span-478-9"><a id="__codelineno-478-9" name="__codelineno-478-9" href="#__codelineno-478-9"></a><span class="w">    </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-478-10"><a id="__codelineno-478-10" name="__codelineno-478-10" href="#__codelineno-478-10"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-478-11"><a id="__codelineno-478-11" name="__codelineno-478-11" href="#__codelineno-478-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-478-12"><a id="__codelineno-478-12" name="__codelineno-478-12" href="#__codelineno-478-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-479-1"><a id="__codelineno-479-1" name="__codelineno-479-1" href="#__codelineno-479-1"></a><span class="c1">-- High: Complex log management</span>
</span><span id="__span-479-2"><a id="__codelineno-479-2" name="__codelineno-479-2" href="#__codelineno-479-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnServerLog&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedLogManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">logType</span><span class="p">,</span><span class="w"> </span><span class="nv">logString</span><span class="p">,</span><span class="w"> </span><span class="nv">category</span><span class="p">)</span>
</span><span id="__span-479-3"><a id="__codelineno-479-3" name="__codelineno-479-3" href="#__codelineno-479-3"></a><span class="c1">-- Store log in database</span>
</span><span id="__span-479-4"><a id="__codelineno-479-4" name="__codelineno-479-4" href="#__codelineno-479-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO server_logs (player, type, message, category, timestamp) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-479-5"><a id="__codelineno-479-5" name="__codelineno-479-5" href="#__codelineno-479-5"></a><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;Server&quot;</span><span class="p">,</span>
</span><span id="__span-479-6"><a id="__codelineno-479-6" name="__codelineno-479-6" href="#__codelineno-479-6"></a><span class="nv">logType</span><span class="p">,</span>
</span><span id="__span-479-7"><a id="__codelineno-479-7" name="__codelineno-479-7" href="#__codelineno-479-7"></a><span class="nv">logString</span><span class="p">,</span>
</span><span id="__span-479-8"><a id="__codelineno-479-8" name="__codelineno-479-8" href="#__codelineno-479-8"></a><span class="nv">category</span><span class="p">,</span>
</span><span id="__span-479-9"><a id="__codelineno-479-9" name="__codelineno-479-9" href="#__codelineno-479-9"></a><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-479-10"><a id="__codelineno-479-10" name="__codelineno-479-10" href="#__codelineno-479-10"></a><span class="p">)</span>
</span><span id="__span-479-11"><a id="__codelineno-479-11" name="__codelineno-479-11" href="#__codelineno-479-11"></a><span class="c1">-- Send to external logging service</span>
</span><span id="__span-479-12"><a id="__codelineno-479-12" name="__codelineno-479-12" href="#__codelineno-479-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;critical&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-479-13"><a id="__codelineno-479-13" name="__codelineno-479-13" href="#__codelineno-479-13"></a><span class="w">    </span><span class="nv">http</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="s2">&quot;https://logging-service.com/api/log&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-479-14"><a id="__codelineno-479-14" name="__codelineno-479-14" href="#__codelineno-479-14"></a><span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logType</span><span class="p">,</span>
</span><span id="__span-479-15"><a id="__codelineno-479-15" name="__codelineno-479-15" href="#__codelineno-479-15"></a><span class="w">    </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logString</span><span class="p">,</span>
</span><span id="__span-479-16"><a id="__codelineno-479-16" name="__codelineno-479-16" href="#__codelineno-479-16"></a><span class="w">    </span><span class="nv">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">.</span><span class="nf">GetIPAddress</span><span class="p">()</span>
</span><span id="__span-479-17"><a id="__codelineno-479-17" name="__codelineno-479-17" href="#__codelineno-479-17"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-479-18"><a id="__codelineno-479-18" name="__codelineno-479-18" href="#__codelineno-479-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-479-19"><a id="__codelineno-479-19" name="__codelineno-479-19" href="#__codelineno-479-19"></a><span class="c1">-- Notify admins of important logs</span>
</span><span id="__span-479-20"><a id="__codelineno-479-20" name="__codelineno-479-20" href="#__codelineno-479-20"></a><span class="kr">if</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">category</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;critical&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-479-21"><a id="__codelineno-479-21" name="__codelineno-479-21" href="#__codelineno-479-21"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-479-22"><a id="__codelineno-479-22" name="__codelineno-479-22" href="#__codelineno-479-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-479-23"><a id="__codelineno-479-23" name="__codelineno-479-23" href="#__codelineno-479-23"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[LOG] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">logString</span><span class="p">)</span>
</span><span id="__span-479-24"><a id="__codelineno-479-24" name="__codelineno-479-24" href="#__codelineno-479-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-479-25"><a id="__codelineno-479-25" name="__codelineno-479-25" href="#__codelineno-479-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-479-26"><a id="__codelineno-479-26" name="__codelineno-479-26" href="#__codelineno-479-26"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-479-27"><a id="__codelineno-479-27" name="__codelineno-479-27" href="#__codelineno-479-27"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onticketclaimed">OnTicketClaimed</h3>
<p><strong>Purpose</strong></p>
<p>Called when a support ticket is claimed by an admin</p>
<p><strong>When Called</strong></p>
<p>When an admin claims a support ticket</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The admin claiming the ticket</li>
<li><code>requester</code> (<em>Player</em>): The player who created the ticket</li>
<li><code>ticketMessage</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-480-1"><a id="__codelineno-480-1" name="__codelineno-480-1" href="#__codelineno-480-1"></a><span class="c1">-- Simple: Log ticket claims</span>
</span><span id="__span-480-2"><a id="__codelineno-480-2" name="__codelineno-480-2" href="#__codelineno-480-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClaimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-480-3"><a id="__codelineno-480-3" name="__codelineno-480-3" href="#__codelineno-480-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; claimed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-480-4"><a id="__codelineno-480-4" name="__codelineno-480-4" href="#__codelineno-480-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-481-1"><a id="__codelineno-481-1" name="__codelineno-481-1" href="#__codelineno-481-1"></a><span class="c1">-- Medium: Track ticket claims</span>
</span><span id="__span-481-2"><a id="__codelineno-481-2" name="__codelineno-481-2" href="#__codelineno-481-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClaimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTicketClaims&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-481-3"><a id="__codelineno-481-3" name="__codelineno-481-3" href="#__codelineno-481-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-481-4"><a id="__codelineno-481-4" name="__codelineno-481-4" href="#__codelineno-481-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-481-5"><a id="__codelineno-481-5" name="__codelineno-481-5" href="#__codelineno-481-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketsClaimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-481-6"><a id="__codelineno-481-6" name="__codelineno-481-6" href="#__codelineno-481-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketsClaimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">claims</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-481-7"><a id="__codelineno-481-7" name="__codelineno-481-7" href="#__codelineno-481-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-481-8"><a id="__codelineno-481-8" name="__codelineno-481-8" href="#__codelineno-481-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-482-1"><a id="__codelineno-482-1" name="__codelineno-482-1" href="#__codelineno-482-1"></a><span class="c1">-- High: Complex ticket claim handling</span>
</span><span id="__span-482-2"><a id="__codelineno-482-2" name="__codelineno-482-2" href="#__codelineno-482-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClaimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-482-3"><a id="__codelineno-482-3" name="__codelineno-482-3" href="#__codelineno-482-3"></a><span class="c1">-- Log ticket claim</span>
</span><span id="__span-482-4"><a id="__codelineno-482-4" name="__codelineno-482-4" href="#__codelineno-482-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;ticket_claimed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-482-5"><a id="__codelineno-482-5" name="__codelineno-482-5" href="#__codelineno-482-5"></a><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-482-6"><a id="__codelineno-482-6" name="__codelineno-482-6" href="#__codelineno-482-6"></a><span class="nv">requester</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-482-7"><a id="__codelineno-482-7" name="__codelineno-482-7" href="#__codelineno-482-7"></a><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">,</span>
</span><span id="__span-482-8"><a id="__codelineno-482-8" name="__codelineno-482-8" href="#__codelineno-482-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-482-9"><a id="__codelineno-482-9" name="__codelineno-482-9" href="#__codelineno-482-9"></a><span class="p">})</span>
</span><span id="__span-482-10"><a id="__codelineno-482-10" name="__codelineno-482-10" href="#__codelineno-482-10"></a><span class="c1">-- Notify both parties</span>
</span><span id="__span-482-11"><a id="__codelineno-482-11" name="__codelineno-482-11" href="#__codelineno-482-11"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You claimed the ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-482-12"><a id="__codelineno-482-12" name="__codelineno-482-12" href="#__codelineno-482-12"></a><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is handling your ticket&quot;</span><span class="p">)</span>
</span><span id="__span-482-13"><a id="__codelineno-482-13" name="__codelineno-482-13" href="#__codelineno-482-13"></a><span class="c1">-- Update ticket statistics</span>
</span><span id="__span-482-14"><a id="__codelineno-482-14" name="__codelineno-482-14" href="#__codelineno-482-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-482-15"><a id="__codelineno-482-15" name="__codelineno-482-15" href="#__codelineno-482-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-482-16"><a id="__codelineno-482-16" name="__codelineno-482-16" href="#__codelineno-482-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">claimed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">resolved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-482-17"><a id="__codelineno-482-17" name="__codelineno-482-17" href="#__codelineno-482-17"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">claimed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">claimed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-482-18"><a id="__codelineno-482-18" name="__codelineno-482-18" href="#__codelineno-482-18"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-482-19"><a id="__codelineno-482-19" name="__codelineno-482-19" href="#__codelineno-482-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-482-20"><a id="__codelineno-482-20" name="__codelineno-482-20" href="#__codelineno-482-20"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onticketclosed">OnTicketClosed</h3>
<p><strong>Purpose</strong></p>
<p>Called when a support ticket is closed</p>
<p><strong>When Called</strong></p>
<p>When a support ticket is resolved and closed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The admin closing the ticket</li>
<li><code>requester</code> (<em>Player</em>): The player who created the ticket</li>
<li><code>ticketMessage</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-483-1"><a id="__codelineno-483-1" name="__codelineno-483-1" href="#__codelineno-483-1"></a><span class="c1">-- Simple: Log ticket closures</span>
</span><span id="__span-483-2"><a id="__codelineno-483-2" name="__codelineno-483-2" href="#__codelineno-483-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClosed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-483-3"><a id="__codelineno-483-3" name="__codelineno-483-3" href="#__codelineno-483-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; closed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-483-4"><a id="__codelineno-483-4" name="__codelineno-483-4" href="#__codelineno-483-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-484-1"><a id="__codelineno-484-1" name="__codelineno-484-1" href="#__codelineno-484-1"></a><span class="c1">-- Medium: Track ticket resolutions</span>
</span><span id="__span-484-2"><a id="__codelineno-484-2" name="__codelineno-484-2" href="#__codelineno-484-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClosed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTicketClosures&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-484-3"><a id="__codelineno-484-3" name="__codelineno-484-3" href="#__codelineno-484-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-484-4"><a id="__codelineno-484-4" name="__codelineno-484-4" href="#__codelineno-484-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-484-5"><a id="__codelineno-484-5" name="__codelineno-484-5" href="#__codelineno-484-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">resolved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketsResolved&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-484-6"><a id="__codelineno-484-6" name="__codelineno-484-6" href="#__codelineno-484-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketsResolved&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">resolved</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-484-7"><a id="__codelineno-484-7" name="__codelineno-484-7" href="#__codelineno-484-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-484-8"><a id="__codelineno-484-8" name="__codelineno-484-8" href="#__codelineno-484-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-485-1"><a id="__codelineno-485-1" name="__codelineno-485-1" href="#__codelineno-485-1"></a><span class="c1">-- High: Complex ticket closure handling</span>
</span><span id="__span-485-2"><a id="__codelineno-485-2" name="__codelineno-485-2" href="#__codelineno-485-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketClosed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketClosure&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-485-3"><a id="__codelineno-485-3" name="__codelineno-485-3" href="#__codelineno-485-3"></a><span class="c1">-- Log ticket closure</span>
</span><span id="__span-485-4"><a id="__codelineno-485-4" name="__codelineno-485-4" href="#__codelineno-485-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;ticket_closed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-485-5"><a id="__codelineno-485-5" name="__codelineno-485-5" href="#__codelineno-485-5"></a><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-485-6"><a id="__codelineno-485-6" name="__codelineno-485-6" href="#__codelineno-485-6"></a><span class="nv">requester</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-485-7"><a id="__codelineno-485-7" name="__codelineno-485-7" href="#__codelineno-485-7"></a><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">,</span>
</span><span id="__span-485-8"><a id="__codelineno-485-8" name="__codelineno-485-8" href="#__codelineno-485-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-485-9"><a id="__codelineno-485-9" name="__codelineno-485-9" href="#__codelineno-485-9"></a><span class="p">})</span>
</span><span id="__span-485-10"><a id="__codelineno-485-10" name="__codelineno-485-10" href="#__codelineno-485-10"></a><span class="c1">-- Notify both parties</span>
</span><span id="__span-485-11"><a id="__codelineno-485-11" name="__codelineno-485-11" href="#__codelineno-485-11"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You closed the ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-485-12"><a id="__codelineno-485-12" name="__codelineno-485-12" href="#__codelineno-485-12"></a><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been resolved by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-485-13"><a id="__codelineno-485-13" name="__codelineno-485-13" href="#__codelineno-485-13"></a><span class="c1">-- Update ticket statistics</span>
</span><span id="__span-485-14"><a id="__codelineno-485-14" name="__codelineno-485-14" href="#__codelineno-485-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-485-15"><a id="__codelineno-485-15" name="__codelineno-485-15" href="#__codelineno-485-15"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-485-16"><a id="__codelineno-485-16" name="__codelineno-485-16" href="#__codelineno-485-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">claimed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">resolved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-485-17"><a id="__codelineno-485-17" name="__codelineno-485-17" href="#__codelineno-485-17"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">resolved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">resolved</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-485-18"><a id="__codelineno-485-18" name="__codelineno-485-18" href="#__codelineno-485-18"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-485-19"><a id="__codelineno-485-19" name="__codelineno-485-19" href="#__codelineno-485-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-485-20"><a id="__codelineno-485-20" name="__codelineno-485-20" href="#__codelineno-485-20"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onticketcreated">OnTicketCreated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a new support ticket is created</p>
<p><strong>When Called</strong></p>
<p>When a player creates a support ticket</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>noob</code> (<em>Player</em>): The player creating the ticket</li>
<li><code>message</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-486-1"><a id="__codelineno-486-1" name="__codelineno-486-1" href="#__codelineno-486-1"></a><span class="c1">-- Simple: Log ticket creation</span>
</span><span id="__span-486-2"><a id="__codelineno-486-2" name="__codelineno-486-2" href="#__codelineno-486-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-486-3"><a id="__codelineno-486-3" name="__codelineno-486-3" href="#__codelineno-486-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; created a ticket: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-486-4"><a id="__codelineno-486-4" name="__codelineno-486-4" href="#__codelineno-486-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-487-1"><a id="__codelineno-487-1" name="__codelineno-487-1" href="#__codelineno-487-1"></a><span class="c1">-- Medium: Notify admins of new tickets</span>
</span><span id="__span-487-2"><a id="__codelineno-487-2" name="__codelineno-487-2" href="#__codelineno-487-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyAdmins&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-487-3"><a id="__codelineno-487-3" name="__codelineno-487-3" href="#__codelineno-487-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-487-4"><a id="__codelineno-487-4" name="__codelineno-487-4" href="#__codelineno-487-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-487-5"><a id="__codelineno-487-5" name="__codelineno-487-5" href="#__codelineno-487-5"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;New ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-487-6"><a id="__codelineno-487-6" name="__codelineno-487-6" href="#__codelineno-487-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-487-7"><a id="__codelineno-487-7" name="__codelineno-487-7" href="#__codelineno-487-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-487-8"><a id="__codelineno-487-8" name="__codelineno-487-8" href="#__codelineno-487-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-488-1"><a id="__codelineno-488-1" name="__codelineno-488-1" href="#__codelineno-488-1"></a><span class="c1">-- High: Complex ticket creation handling</span>
</span><span id="__span-488-2"><a id="__codelineno-488-2" name="__codelineno-488-2" href="#__codelineno-488-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTicketCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-488-3"><a id="__codelineno-488-3" name="__codelineno-488-3" href="#__codelineno-488-3"></a><span class="c1">-- Log ticket creation</span>
</span><span id="__span-488-4"><a id="__codelineno-488-4" name="__codelineno-488-4" href="#__codelineno-488-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;ticket_created&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-488-5"><a id="__codelineno-488-5" name="__codelineno-488-5" href="#__codelineno-488-5"></a><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-488-6"><a id="__codelineno-488-6" name="__codelineno-488-6" href="#__codelineno-488-6"></a><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span>
</span><span id="__span-488-7"><a id="__codelineno-488-7" name="__codelineno-488-7" href="#__codelineno-488-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-488-8"><a id="__codelineno-488-8" name="__codelineno-488-8" href="#__codelineno-488-8"></a><span class="p">})</span>
</span><span id="__span-488-9"><a id="__codelineno-488-9" name="__codelineno-488-9" href="#__codelineno-488-9"></a><span class="c1">-- Store ticket in database</span>
</span><span id="__span-488-10"><a id="__codelineno-488-10" name="__codelineno-488-10" href="#__codelineno-488-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO tickets (player, message, status, created) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-488-11"><a id="__codelineno-488-11" name="__codelineno-488-11" href="#__codelineno-488-11"></a><span class="nv">noob</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-488-12"><a id="__codelineno-488-12" name="__codelineno-488-12" href="#__codelineno-488-12"></a><span class="nv">message</span><span class="p">,</span>
</span><span id="__span-488-13"><a id="__codelineno-488-13" name="__codelineno-488-13" href="#__codelineno-488-13"></a><span class="s2">&quot;open&quot;</span><span class="p">,</span>
</span><span id="__span-488-14"><a id="__codelineno-488-14" name="__codelineno-488-14" href="#__codelineno-488-14"></a><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-488-15"><a id="__codelineno-488-15" name="__codelineno-488-15" href="#__codelineno-488-15"></a><span class="p">)</span>
</span><span id="__span-488-16"><a id="__codelineno-488-16" name="__codelineno-488-16" href="#__codelineno-488-16"></a><span class="c1">-- Notify all admins</span>
</span><span id="__span-488-17"><a id="__codelineno-488-17" name="__codelineno-488-17" href="#__codelineno-488-17"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-488-18"><a id="__codelineno-488-18" name="__codelineno-488-18" href="#__codelineno-488-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-488-19"><a id="__codelineno-488-19" name="__codelineno-488-19" href="#__codelineno-488-19"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[TICKET] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-488-20"><a id="__codelineno-488-20" name="__codelineno-488-20" href="#__codelineno-488-20"></a><span class="w">        </span><span class="nv">surface</span><span class="p">.</span><span class="nf">PlaySound</span><span class="p">(</span><span class="s2">&quot;buttons/button15.wav&quot;</span><span class="p">)</span>
</span><span id="__span-488-21"><a id="__codelineno-488-21" name="__codelineno-488-21" href="#__codelineno-488-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-488-22"><a id="__codelineno-488-22" name="__codelineno-488-22" href="#__codelineno-488-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-488-23"><a id="__codelineno-488-23" name="__codelineno-488-23" href="#__codelineno-488-23"></a><span class="c1">-- Confirm to player</span>
</span><span id="__span-488-24"><a id="__codelineno-488-24" name="__codelineno-488-24" href="#__codelineno-488-24"></a><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been submitted. An admin will assist you shortly.&quot;</span><span class="p">)</span>
</span><span id="__span-488-25"><a id="__codelineno-488-25" name="__codelineno-488-25" href="#__codelineno-488-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ontransferred">OnTransferred</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is transferred</p>
<p><strong>When Called</strong></p>
<p>When a player is successfully transferred</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>targetPlayer</code> (<em>Player</em>): The player who was transferred</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-489-1"><a id="__codelineno-489-1" name="__codelineno-489-1" href="#__codelineno-489-1"></a><span class="c1">-- Simple: Log player transfers</span>
</span><span id="__span-489-2"><a id="__codelineno-489-2" name="__codelineno-489-2" href="#__codelineno-489-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTransferred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetPlayer</span><span class="p">)</span>
</span><span id="__span-489-3"><a id="__codelineno-489-3" name="__codelineno-489-3" href="#__codelineno-489-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">targetPlayer</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was transferred&quot;</span><span class="p">)</span>
</span><span id="__span-489-4"><a id="__codelineno-489-4" name="__codelineno-489-4" href="#__codelineno-489-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-490-1"><a id="__codelineno-490-1" name="__codelineno-490-1" href="#__codelineno-490-1"></a><span class="c1">-- Medium: Track player transfers</span>
</span><span id="__span-490-2"><a id="__codelineno-490-2" name="__codelineno-490-2" href="#__codelineno-490-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTransferred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTransfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetPlayer</span><span class="p">)</span>
</span><span id="__span-490-3"><a id="__codelineno-490-3" name="__codelineno-490-3" href="#__codelineno-490-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetPlayer</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-490-4"><a id="__codelineno-490-4" name="__codelineno-490-4" href="#__codelineno-490-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-490-5"><a id="__codelineno-490-5" name="__codelineno-490-5" href="#__codelineno-490-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">transfers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-490-6"><a id="__codelineno-490-6" name="__codelineno-490-6" href="#__codelineno-490-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">transfers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-490-7"><a id="__codelineno-490-7" name="__codelineno-490-7" href="#__codelineno-490-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-490-8"><a id="__codelineno-490-8" name="__codelineno-490-8" href="#__codelineno-490-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-491-1"><a id="__codelineno-491-1" name="__codelineno-491-1" href="#__codelineno-491-1"></a><span class="c1">-- High: Complex transfer handling</span>
</span><span id="__span-491-2"><a id="__codelineno-491-2" name="__codelineno-491-2" href="#__codelineno-491-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnTransferred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">targetPlayer</span><span class="p">)</span>
</span><span id="__span-491-3"><a id="__codelineno-491-3" name="__codelineno-491-3" href="#__codelineno-491-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetPlayer</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-491-4"><a id="__codelineno-491-4" name="__codelineno-491-4" href="#__codelineno-491-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-491-5"><a id="__codelineno-491-5" name="__codelineno-491-5" href="#__codelineno-491-5"></a><span class="w">    </span><span class="c1">-- Log transfer</span>
</span><span id="__span-491-6"><a id="__codelineno-491-6" name="__codelineno-491-6" href="#__codelineno-491-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;player_transferred&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-491-7"><a id="__codelineno-491-7" name="__codelineno-491-7" href="#__codelineno-491-7"></a><span class="w">    </span><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetPlayer</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-491-8"><a id="__codelineno-491-8" name="__codelineno-491-8" href="#__codelineno-491-8"></a><span class="w">    </span><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-491-9"><a id="__codelineno-491-9" name="__codelineno-491-9" href="#__codelineno-491-9"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-491-10"><a id="__codelineno-491-10" name="__codelineno-491-10" href="#__codelineno-491-10"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-491-11"><a id="__codelineno-491-11" name="__codelineno-491-11" href="#__codelineno-491-11"></a><span class="w">    </span><span class="c1">-- Update transfer statistics</span>
</span><span id="__span-491-12"><a id="__codelineno-491-12" name="__codelineno-491-12" href="#__codelineno-491-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transferStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
</span><span id="__span-491-13"><a id="__codelineno-491-13" name="__codelineno-491-13" href="#__codelineno-491-13"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">stats</span><span class="p">.</span><span class="py">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-491-14"><a id="__codelineno-491-14" name="__codelineno-491-14" href="#__codelineno-491-14"></a><span class="w">    </span><span class="nv">stats</span><span class="p">.</span><span class="py">lastTransfer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-491-15"><a id="__codelineno-491-15" name="__codelineno-491-15" href="#__codelineno-491-15"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transferStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-491-16"><a id="__codelineno-491-16" name="__codelineno-491-16" href="#__codelineno-491-16"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-491-17"><a id="__codelineno-491-17" name="__codelineno-491-17" href="#__codelineno-491-17"></a><span class="w">    </span><span class="nv">targetPlayer</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been transferred&quot;</span><span class="p">)</span>
</span><span id="__span-491-18"><a id="__codelineno-491-18" name="__codelineno-491-18" href="#__codelineno-491-18"></a><span class="w">    </span><span class="c1">-- Sync character data</span>
</span><span id="__span-491-19"><a id="__codelineno-491-19" name="__codelineno-491-19" href="#__codelineno-491-19"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">sync</span><span class="p">()</span>
</span><span id="__span-491-20"><a id="__codelineno-491-20" name="__codelineno-491-20" href="#__codelineno-491-20"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onusergroupcreated">OnUsergroupCreated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a new usergroup is created</p>
<p><strong>When Called</strong></p>
<p>When a usergroup is added to the system</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>groupName</code> (<em>string</em>): The name of the usergroup</li>
<li><code>groupData</code> (<em>table</em>): The usergroup configuration data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-492-1"><a id="__codelineno-492-1" name="__codelineno-492-1" href="#__codelineno-492-1"></a><span class="c1">-- Simple: Log usergroup creation</span>
</span><span id="__span-492-2"><a id="__codelineno-492-2" name="__codelineno-492-2" href="#__codelineno-492-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">groupData</span><span class="p">)</span>
</span><span id="__span-492-3"><a id="__codelineno-492-3" name="__codelineno-492-3" href="#__codelineno-492-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usergroup created: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-492-4"><a id="__codelineno-492-4" name="__codelineno-492-4" href="#__codelineno-492-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-493-1"><a id="__codelineno-493-1" name="__codelineno-493-1" href="#__codelineno-493-1"></a><span class="c1">-- Medium: Track usergroups</span>
</span><span id="__span-493-2"><a id="__codelineno-493-2" name="__codelineno-493-2" href="#__codelineno-493-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackUsergroups&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">groupData</span><span class="p">)</span>
</span><span id="__span-493-3"><a id="__codelineno-493-3" name="__codelineno-493-3" href="#__codelineno-493-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-493-4"><a id="__codelineno-493-4" name="__codelineno-493-4" href="#__codelineno-493-4"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">groupName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-493-5"><a id="__codelineno-493-5" name="__codelineno-493-5" href="#__codelineno-493-5"></a><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupData</span><span class="p">,</span>
</span><span id="__span-493-6"><a id="__codelineno-493-6" name="__codelineno-493-6" href="#__codelineno-493-6"></a><span class="nv">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-493-7"><a id="__codelineno-493-7" name="__codelineno-493-7" href="#__codelineno-493-7"></a><span class="p">}</span>
</span><span id="__span-493-8"><a id="__codelineno-493-8" name="__codelineno-493-8" href="#__codelineno-493-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-494-1"><a id="__codelineno-494-1" name="__codelineno-494-1" href="#__codelineno-494-1"></a><span class="c1">-- High: Complex usergroup creation handling</span>
</span><span id="__span-494-2"><a id="__codelineno-494-2" name="__codelineno-494-2" href="#__codelineno-494-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUsergroupCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">groupData</span><span class="p">)</span>
</span><span id="__span-494-3"><a id="__codelineno-494-3" name="__codelineno-494-3" href="#__codelineno-494-3"></a><span class="c1">-- Log usergroup creation</span>
</span><span id="__span-494-4"><a id="__codelineno-494-4" name="__codelineno-494-4" href="#__codelineno-494-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;usergroup_created&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-494-5"><a id="__codelineno-494-5" name="__codelineno-494-5" href="#__codelineno-494-5"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupName</span><span class="p">,</span>
</span><span id="__span-494-6"><a id="__codelineno-494-6" name="__codelineno-494-6" href="#__codelineno-494-6"></a><span class="nv">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupData</span><span class="p">.</span><span class="py">permissions</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-494-7"><a id="__codelineno-494-7" name="__codelineno-494-7" href="#__codelineno-494-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-494-8"><a id="__codelineno-494-8" name="__codelineno-494-8" href="#__codelineno-494-8"></a><span class="p">})</span>
</span><span id="__span-494-9"><a id="__codelineno-494-9" name="__codelineno-494-9" href="#__codelineno-494-9"></a><span class="c1">-- Store usergroup in database</span>
</span><span id="__span-494-10"><a id="__codelineno-494-10" name="__codelineno-494-10" href="#__codelineno-494-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO usergroups (name, data, created) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-494-11"><a id="__codelineno-494-11" name="__codelineno-494-11" href="#__codelineno-494-11"></a><span class="nv">groupName</span><span class="p">,</span>
</span><span id="__span-494-12"><a id="__codelineno-494-12" name="__codelineno-494-12" href="#__codelineno-494-12"></a><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">groupData</span><span class="p">),</span>
</span><span id="__span-494-13"><a id="__codelineno-494-13" name="__codelineno-494-13" href="#__codelineno-494-13"></a><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-494-14"><a id="__codelineno-494-14" name="__codelineno-494-14" href="#__codelineno-494-14"></a><span class="p">)</span>
</span><span id="__span-494-15"><a id="__codelineno-494-15" name="__codelineno-494-15" href="#__codelineno-494-15"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-494-16"><a id="__codelineno-494-16" name="__codelineno-494-16" href="#__codelineno-494-16"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-494-17"><a id="__codelineno-494-17" name="__codelineno-494-17" href="#__codelineno-494-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-494-18"><a id="__codelineno-494-18" name="__codelineno-494-18" href="#__codelineno-494-18"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;New usergroup created: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-494-19"><a id="__codelineno-494-19" name="__codelineno-494-19" href="#__codelineno-494-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-494-20"><a id="__codelineno-494-20" name="__codelineno-494-20" href="#__codelineno-494-20"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-494-21"><a id="__codelineno-494-21" name="__codelineno-494-21" href="#__codelineno-494-21"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onusergrouppermissionschanged">OnUsergroupPermissionsChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when usergroup permissions are changed</p>
<p><strong>When Called</strong></p>
<p>When a usergroup's permissions are modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>groupName</code> (<em>string</em>): The name of the usergroup</li>
<li><code>permissions</code> (<em>table</em>): The new permissions table</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-495-1"><a id="__codelineno-495-1" name="__codelineno-495-1" href="#__codelineno-495-1"></a><span class="c1">-- Simple: Log permission changes</span>
</span><span id="__span-495-2"><a id="__codelineno-495-2" name="__codelineno-495-2" href="#__codelineno-495-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupPermissionsChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">permissions</span><span class="p">)</span>
</span><span id="__span-495-3"><a id="__codelineno-495-3" name="__codelineno-495-3" href="#__codelineno-495-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Permissions changed for: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-495-4"><a id="__codelineno-495-4" name="__codelineno-495-4" href="#__codelineno-495-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-496-1"><a id="__codelineno-496-1" name="__codelineno-496-1" href="#__codelineno-496-1"></a><span class="c1">-- Medium: Track permission changes</span>
</span><span id="__span-496-2"><a id="__codelineno-496-2" name="__codelineno-496-2" href="#__codelineno-496-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupPermissionsChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackPermissionChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">permissions</span><span class="p">)</span>
</span><span id="__span-496-3"><a id="__codelineno-496-3" name="__codelineno-496-3" href="#__codelineno-496-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">permissionHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">permissionHistory</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-496-4"><a id="__codelineno-496-4" name="__codelineno-496-4" href="#__codelineno-496-4"></a><span class="nb">table.insert</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">permissionHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-496-5"><a id="__codelineno-496-5" name="__codelineno-496-5" href="#__codelineno-496-5"></a><span class="nv">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupName</span><span class="p">,</span>
</span><span id="__span-496-6"><a id="__codelineno-496-6" name="__codelineno-496-6" href="#__codelineno-496-6"></a><span class="nv">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">permissions</span><span class="p">,</span>
</span><span id="__span-496-7"><a id="__codelineno-496-7" name="__codelineno-496-7" href="#__codelineno-496-7"></a><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-496-8"><a id="__codelineno-496-8" name="__codelineno-496-8" href="#__codelineno-496-8"></a><span class="p">})</span>
</span><span id="__span-496-9"><a id="__codelineno-496-9" name="__codelineno-496-9" href="#__codelineno-496-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-497-1"><a id="__codelineno-497-1" name="__codelineno-497-1" href="#__codelineno-497-1"></a><span class="c1">-- High: Complex permission change handling</span>
</span><span id="__span-497-2"><a id="__codelineno-497-2" name="__codelineno-497-2" href="#__codelineno-497-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupPermissionsChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPermissionChange&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">,</span><span class="w"> </span><span class="nv">permissions</span><span class="p">)</span>
</span><span id="__span-497-3"><a id="__codelineno-497-3" name="__codelineno-497-3" href="#__codelineno-497-3"></a><span class="c1">-- Log permission changes</span>
</span><span id="__span-497-4"><a id="__codelineno-497-4" name="__codelineno-497-4" href="#__codelineno-497-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;permissions_changed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-497-5"><a id="__codelineno-497-5" name="__codelineno-497-5" href="#__codelineno-497-5"></a><span class="nv">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupName</span><span class="p">,</span>
</span><span id="__span-497-6"><a id="__codelineno-497-6" name="__codelineno-497-6" href="#__codelineno-497-6"></a><span class="nv">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">permissions</span><span class="p">),</span>
</span><span id="__span-497-7"><a id="__codelineno-497-7" name="__codelineno-497-7" href="#__codelineno-497-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-497-8"><a id="__codelineno-497-8" name="__codelineno-497-8" href="#__codelineno-497-8"></a><span class="p">})</span>
</span><span id="__span-497-9"><a id="__codelineno-497-9" name="__codelineno-497-9" href="#__codelineno-497-9"></a><span class="c1">-- Update database</span>
</span><span id="__span-497-10"><a id="__codelineno-497-10" name="__codelineno-497-10" href="#__codelineno-497-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;UPDATE usergroups SET permissions = ? WHERE name = ?&quot;</span><span class="p">,</span>
</span><span id="__span-497-11"><a id="__codelineno-497-11" name="__codelineno-497-11" href="#__codelineno-497-11"></a><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">permissions</span><span class="p">),</span>
</span><span id="__span-497-12"><a id="__codelineno-497-12" name="__codelineno-497-12" href="#__codelineno-497-12"></a><span class="nv">groupName</span>
</span><span id="__span-497-13"><a id="__codelineno-497-13" name="__codelineno-497-13" href="#__codelineno-497-13"></a><span class="p">)</span>
</span><span id="__span-497-14"><a id="__codelineno-497-14" name="__codelineno-497-14" href="#__codelineno-497-14"></a><span class="c1">-- Notify affected players</span>
</span><span id="__span-497-15"><a id="__codelineno-497-15" name="__codelineno-497-15" href="#__codelineno-497-15"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-497-16"><a id="__codelineno-497-16" name="__codelineno-497-16" href="#__codelineno-497-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetUserGroup</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">groupName</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-497-17"><a id="__codelineno-497-17" name="__codelineno-497-17" href="#__codelineno-497-17"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your usergroup permissions have been updated&quot;</span><span class="p">)</span>
</span><span id="__span-497-18"><a id="__codelineno-497-18" name="__codelineno-497-18" href="#__codelineno-497-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-497-19"><a id="__codelineno-497-19" name="__codelineno-497-19" href="#__codelineno-497-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-497-20"><a id="__codelineno-497-20" name="__codelineno-497-20" href="#__codelineno-497-20"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-497-21"><a id="__codelineno-497-21" name="__codelineno-497-21" href="#__codelineno-497-21"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-497-22"><a id="__codelineno-497-22" name="__codelineno-497-22" href="#__codelineno-497-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-497-23"><a id="__codelineno-497-23" name="__codelineno-497-23" href="#__codelineno-497-23"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Permissions updated for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-497-24"><a id="__codelineno-497-24" name="__codelineno-497-24" href="#__codelineno-497-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-497-25"><a id="__codelineno-497-25" name="__codelineno-497-25" href="#__codelineno-497-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-497-26"><a id="__codelineno-497-26" name="__codelineno-497-26" href="#__codelineno-497-26"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onusergroupremoved">OnUsergroupRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when a usergroup is removed</p>
<p><strong>When Called</strong></p>
<p>When a usergroup is deleted from the system</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>groupName</code> (<em>string</em>): The name of the usergroup being removed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-498-1"><a id="__codelineno-498-1" name="__codelineno-498-1" href="#__codelineno-498-1"></a><span class="c1">-- Simple: Log usergroup removal</span>
</span><span id="__span-498-2"><a id="__codelineno-498-2" name="__codelineno-498-2" href="#__codelineno-498-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-498-3"><a id="__codelineno-498-3" name="__codelineno-498-3" href="#__codelineno-498-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usergroup removed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-498-4"><a id="__codelineno-498-4" name="__codelineno-498-4" href="#__codelineno-498-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-499-1"><a id="__codelineno-499-1" name="__codelineno-499-1" href="#__codelineno-499-1"></a><span class="c1">-- Medium: Clean up usergroup data</span>
</span><span id="__span-499-2"><a id="__codelineno-499-2" name="__codelineno-499-2" href="#__codelineno-499-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CleanupUsergroup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-499-3"><a id="__codelineno-499-3" name="__codelineno-499-3" href="#__codelineno-499-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">groupName</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-499-4"><a id="__codelineno-499-4" name="__codelineno-499-4" href="#__codelineno-499-4"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">groupName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-499-5"><a id="__codelineno-499-5" name="__codelineno-499-5" href="#__codelineno-499-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-499-6"><a id="__codelineno-499-6" name="__codelineno-499-6" href="#__codelineno-499-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-500-1"><a id="__codelineno-500-1" name="__codelineno-500-1" href="#__codelineno-500-1"></a><span class="c1">-- High: Complex usergroup removal handling</span>
</span><span id="__span-500-2"><a id="__codelineno-500-2" name="__codelineno-500-2" href="#__codelineno-500-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUsergroupRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-500-3"><a id="__codelineno-500-3" name="__codelineno-500-3" href="#__codelineno-500-3"></a><span class="c1">-- Log usergroup removal</span>
</span><span id="__span-500-4"><a id="__codelineno-500-4" name="__codelineno-500-4" href="#__codelineno-500-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;usergroup_removed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-500-5"><a id="__codelineno-500-5" name="__codelineno-500-5" href="#__codelineno-500-5"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">groupName</span><span class="p">,</span>
</span><span id="__span-500-6"><a id="__codelineno-500-6" name="__codelineno-500-6" href="#__codelineno-500-6"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-500-7"><a id="__codelineno-500-7" name="__codelineno-500-7" href="#__codelineno-500-7"></a><span class="p">})</span>
</span><span id="__span-500-8"><a id="__codelineno-500-8" name="__codelineno-500-8" href="#__codelineno-500-8"></a><span class="c1">-- Remove from database</span>
</span><span id="__span-500-9"><a id="__codelineno-500-9" name="__codelineno-500-9" href="#__codelineno-500-9"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM usergroups WHERE name = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-500-10"><a id="__codelineno-500-10" name="__codelineno-500-10" href="#__codelineno-500-10"></a><span class="c1">-- Reassign affected players</span>
</span><span id="__span-500-11"><a id="__codelineno-500-11" name="__codelineno-500-11" href="#__codelineno-500-11"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-500-12"><a id="__codelineno-500-12" name="__codelineno-500-12" href="#__codelineno-500-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetUserGroup</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">groupName</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-500-13"><a id="__codelineno-500-13" name="__codelineno-500-13" href="#__codelineno-500-13"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetUserGroup</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
</span><span id="__span-500-14"><a id="__codelineno-500-14" name="__codelineno-500-14" href="#__codelineno-500-14"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your usergroup has been removed. You have been reassigned to &#39;user&#39;.&quot;</span><span class="p">)</span>
</span><span id="__span-500-15"><a id="__codelineno-500-15" name="__codelineno-500-15" href="#__codelineno-500-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-500-16"><a id="__codelineno-500-16" name="__codelineno-500-16" href="#__codelineno-500-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-500-17"><a id="__codelineno-500-17" name="__codelineno-500-17" href="#__codelineno-500-17"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-500-18"><a id="__codelineno-500-18" name="__codelineno-500-18" href="#__codelineno-500-18"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-500-19"><a id="__codelineno-500-19" name="__codelineno-500-19" href="#__codelineno-500-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-500-20"><a id="__codelineno-500-20" name="__codelineno-500-20" href="#__codelineno-500-20"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Usergroup removed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">groupName</span><span class="p">)</span>
</span><span id="__span-500-21"><a id="__codelineno-500-21" name="__codelineno-500-21" href="#__codelineno-500-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-500-22"><a id="__codelineno-500-22" name="__codelineno-500-22" href="#__codelineno-500-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-500-23"><a id="__codelineno-500-23" name="__codelineno-500-23" href="#__codelineno-500-23"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onusergrouprenamed">OnUsergroupRenamed</h3>
<p><strong>Purpose</strong></p>
<p>Called when a usergroup is renamed</p>
<p><strong>When Called</strong></p>
<p>When a usergroup's name is changed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>oldName</code> (<em>string</em>): The old name of the usergroup</li>
<li><code>newName</code> (<em>string</em>): The new name of the usergroup</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-501-1"><a id="__codelineno-501-1" name="__codelineno-501-1" href="#__codelineno-501-1"></a><span class="c1">-- Simple: Log usergroup rename</span>
</span><span id="__span-501-2"><a id="__codelineno-501-2" name="__codelineno-501-2" href="#__codelineno-501-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRenamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">oldName</span><span class="p">,</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-501-3"><a id="__codelineno-501-3" name="__codelineno-501-3" href="#__codelineno-501-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usergroup renamed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; -&gt; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-501-4"><a id="__codelineno-501-4" name="__codelineno-501-4" href="#__codelineno-501-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-502-1"><a id="__codelineno-502-1" name="__codelineno-502-1" href="#__codelineno-502-1"></a><span class="c1">-- Medium: Update usergroup tracking</span>
</span><span id="__span-502-2"><a id="__codelineno-502-2" name="__codelineno-502-2" href="#__codelineno-502-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRenamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UpdateUsergroupTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">oldName</span><span class="p">,</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-502-3"><a id="__codelineno-502-3" name="__codelineno-502-3" href="#__codelineno-502-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">oldName</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-502-4"><a id="__codelineno-502-4" name="__codelineno-502-4" href="#__codelineno-502-4"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">newName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">oldName</span><span class="p">]</span>
</span><span id="__span-502-5"><a id="__codelineno-502-5" name="__codelineno-502-5" href="#__codelineno-502-5"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">usergroups</span><span class="p">[</span><span class="nv">oldName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-502-6"><a id="__codelineno-502-6" name="__codelineno-502-6" href="#__codelineno-502-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-502-7"><a id="__codelineno-502-7" name="__codelineno-502-7" href="#__codelineno-502-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-503-1"><a id="__codelineno-503-1" name="__codelineno-503-1" href="#__codelineno-503-1"></a><span class="c1">-- High: Complex usergroup rename handling</span>
</span><span id="__span-503-2"><a id="__codelineno-503-2" name="__codelineno-503-2" href="#__codelineno-503-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnUsergroupRenamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUsergroupRename&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">oldName</span><span class="p">,</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-503-3"><a id="__codelineno-503-3" name="__codelineno-503-3" href="#__codelineno-503-3"></a><span class="c1">-- Log usergroup rename</span>
</span><span id="__span-503-4"><a id="__codelineno-503-4" name="__codelineno-503-4" href="#__codelineno-503-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;usergroup_renamed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-503-5"><a id="__codelineno-503-5" name="__codelineno-503-5" href="#__codelineno-503-5"></a><span class="nv">oldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">oldName</span><span class="p">,</span>
</span><span id="__span-503-6"><a id="__codelineno-503-6" name="__codelineno-503-6" href="#__codelineno-503-6"></a><span class="nv">newName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newName</span><span class="p">,</span>
</span><span id="__span-503-7"><a id="__codelineno-503-7" name="__codelineno-503-7" href="#__codelineno-503-7"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-503-8"><a id="__codelineno-503-8" name="__codelineno-503-8" href="#__codelineno-503-8"></a><span class="p">})</span>
</span><span id="__span-503-9"><a id="__codelineno-503-9" name="__codelineno-503-9" href="#__codelineno-503-9"></a><span class="c1">-- Update database</span>
</span><span id="__span-503-10"><a id="__codelineno-503-10" name="__codelineno-503-10" href="#__codelineno-503-10"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;UPDATE usergroups SET name = ? WHERE name = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">newName</span><span class="p">,</span><span class="w"> </span><span class="nv">oldName</span><span class="p">)</span>
</span><span id="__span-503-11"><a id="__codelineno-503-11" name="__codelineno-503-11" href="#__codelineno-503-11"></a><span class="c1">-- Update all players in this usergroup</span>
</span><span id="__span-503-12"><a id="__codelineno-503-12" name="__codelineno-503-12" href="#__codelineno-503-12"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-503-13"><a id="__codelineno-503-13" name="__codelineno-503-13" href="#__codelineno-503-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetUserGroup</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">oldName</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-503-14"><a id="__codelineno-503-14" name="__codelineno-503-14" href="#__codelineno-503-14"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetUserGroup</span><span class="p">(</span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-503-15"><a id="__codelineno-503-15" name="__codelineno-503-15" href="#__codelineno-503-15"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your usergroup has been renamed to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-503-16"><a id="__codelineno-503-16" name="__codelineno-503-16" href="#__codelineno-503-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-503-17"><a id="__codelineno-503-17" name="__codelineno-503-17" href="#__codelineno-503-17"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-503-18"><a id="__codelineno-503-18" name="__codelineno-503-18" href="#__codelineno-503-18"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-503-19"><a id="__codelineno-503-19" name="__codelineno-503-19" href="#__codelineno-503-19"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-503-20"><a id="__codelineno-503-20" name="__codelineno-503-20" href="#__codelineno-503-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-503-21"><a id="__codelineno-503-21" name="__codelineno-503-21" href="#__codelineno-503-21"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Usergroup renamed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">oldName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; -&gt; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span>
</span><span id="__span-503-22"><a id="__codelineno-503-22" name="__codelineno-503-22" href="#__codelineno-503-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-503-23"><a id="__codelineno-503-23" name="__codelineno-503-23" href="#__codelineno-503-23"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-503-24"><a id="__codelineno-503-24" name="__codelineno-503-24" href="#__codelineno-503-24"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onvendoredited">OnVendorEdited</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor is edited</p>
<p><strong>When Called</strong></p>
<p>When a vendor's properties are modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player editing the vendor</li>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity being edited</li>
<li><code>key</code> (<em>string</em>): The property being modified</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-504-1"><a id="__codelineno-504-1" name="__codelineno-504-1" href="#__codelineno-504-1"></a><span class="c1">-- Simple: Log vendor edits</span>
</span><span id="__span-504-2"><a id="__codelineno-504-2" name="__codelineno-504-2" href="#__codelineno-504-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnVendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-504-3"><a id="__codelineno-504-3" name="__codelineno-504-3" href="#__codelineno-504-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; edited vendor property: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-504-4"><a id="__codelineno-504-4" name="__codelineno-504-4" href="#__codelineno-504-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-505-1"><a id="__codelineno-505-1" name="__codelineno-505-1" href="#__codelineno-505-1"></a><span class="c1">-- Medium: Validate vendor edits</span>
</span><span id="__span-505-2"><a id="__codelineno-505-2" name="__codelineno-505-2" href="#__codelineno-505-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnVendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-505-3"><a id="__codelineno-505-3" name="__codelineno-505-3" href="#__codelineno-505-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-505-4"><a id="__codelineno-505-4" name="__codelineno-505-4" href="#__codelineno-505-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">newPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-505-5"><a id="__codelineno-505-5" name="__codelineno-505-5" href="#__codelineno-505-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">newPrice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-505-6"><a id="__codelineno-505-6" name="__codelineno-505-6" href="#__codelineno-505-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price cannot be negative&quot;</span><span class="p">)</span>
</span><span id="__span-505-7"><a id="__codelineno-505-7" name="__codelineno-505-7" href="#__codelineno-505-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-505-8"><a id="__codelineno-505-8" name="__codelineno-505-8" href="#__codelineno-505-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-505-9"><a id="__codelineno-505-9" name="__codelineno-505-9" href="#__codelineno-505-9"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stock&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-505-10"><a id="__codelineno-505-10" name="__codelineno-505-10" href="#__codelineno-505-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">newStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-505-11"><a id="__codelineno-505-11" name="__codelineno-505-11" href="#__codelineno-505-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">newStock</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-505-12"><a id="__codelineno-505-12" name="__codelineno-505-12" href="#__codelineno-505-12"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Stock cannot be negative&quot;</span><span class="p">)</span>
</span><span id="__span-505-13"><a id="__codelineno-505-13" name="__codelineno-505-13" href="#__codelineno-505-13"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-505-14"><a id="__codelineno-505-14" name="__codelineno-505-14" href="#__codelineno-505-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-505-15"><a id="__codelineno-505-15" name="__codelineno-505-15" href="#__codelineno-505-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-505-16"><a id="__codelineno-505-16" name="__codelineno-505-16" href="#__codelineno-505-16"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-506-1"><a id="__codelineno-506-1" name="__codelineno-506-1" href="#__codelineno-506-1"></a><span class="c1">-- High: Complex vendor editing system</span>
</span><span id="__span-506-2"><a id="__codelineno-506-2" name="__codelineno-506-2" href="#__codelineno-506-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnVendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorEditing&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-506-3"><a id="__codelineno-506-3" name="__codelineno-506-3" href="#__codelineno-506-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-506-4"><a id="__codelineno-506-4" name="__codelineno-506-4" href="#__codelineno-506-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-506-5"><a id="__codelineno-506-5" name="__codelineno-506-5" href="#__codelineno-506-5"></a><span class="w">    </span><span class="c1">-- Check if player has permission to edit vendors</span>
</span><span id="__span-506-6"><a id="__codelineno-506-6" name="__codelineno-506-6" href="#__codelineno-506-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">hasFlags</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-7"><a id="__codelineno-506-7" name="__codelineno-506-7" href="#__codelineno-506-7"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to edit vendors&quot;</span><span class="p">)</span>
</span><span id="__span-506-8"><a id="__codelineno-506-8" name="__codelineno-506-8" href="#__codelineno-506-8"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-9"><a id="__codelineno-506-9" name="__codelineno-506-9" href="#__codelineno-506-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-506-10"><a id="__codelineno-506-10" name="__codelineno-506-10" href="#__codelineno-506-10"></a><span class="w">    </span><span class="c1">-- Validate specific properties</span>
</span><span id="__span-506-11"><a id="__codelineno-506-11" name="__codelineno-506-11" href="#__codelineno-506-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-12"><a id="__codelineno-506-12" name="__codelineno-506-12" href="#__codelineno-506-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">newPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-506-13"><a id="__codelineno-506-13" name="__codelineno-506-13" href="#__codelineno-506-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newPrice</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-14"><a id="__codelineno-506-14" name="__codelineno-506-14" href="#__codelineno-506-14"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price cannot be negative&quot;</span><span class="p">)</span>
</span><span id="__span-506-15"><a id="__codelineno-506-15" name="__codelineno-506-15" href="#__codelineno-506-15"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-16"><a id="__codelineno-506-16" name="__codelineno-506-16" href="#__codelineno-506-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-17"><a id="__codelineno-506-17" name="__codelineno-506-17" href="#__codelineno-506-17"></a><span class="w">        </span><span class="c1">-- Check for price limits based on faction</span>
</span><span id="__span-506-18"><a id="__codelineno-506-18" name="__codelineno-506-18" href="#__codelineno-506-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-506-19"><a id="__codelineno-506-19" name="__codelineno-506-19" href="#__codelineno-506-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-506-20"><a id="__codelineno-506-20" name="__codelineno-506-20" href="#__codelineno-506-20"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
</span><span id="__span-506-21"><a id="__codelineno-506-21" name="__codelineno-506-21" href="#__codelineno-506-21"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span>
</span><span id="__span-506-22"><a id="__codelineno-506-22" name="__codelineno-506-22" href="#__codelineno-506-22"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span>
</span><span id="__span-506-23"><a id="__codelineno-506-23" name="__codelineno-506-23" href="#__codelineno-506-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-506-24"><a id="__codelineno-506-24" name="__codelineno-506-24" href="#__codelineno-506-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">maxPrice</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">5000</span>
</span><span id="__span-506-25"><a id="__codelineno-506-25" name="__codelineno-506-25" href="#__codelineno-506-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newPrice</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-26"><a id="__codelineno-506-26" name="__codelineno-506-26" href="#__codelineno-506-26"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price exceeds your faction limit of $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">limit</span><span class="p">)</span>
</span><span id="__span-506-27"><a id="__codelineno-506-27" name="__codelineno-506-27" href="#__codelineno-506-27"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-28"><a id="__codelineno-506-28" name="__codelineno-506-28" href="#__codelineno-506-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-29"><a id="__codelineno-506-29" name="__codelineno-506-29" href="#__codelineno-506-29"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stock&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-30"><a id="__codelineno-506-30" name="__codelineno-506-30" href="#__codelineno-506-30"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">newStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-506-31"><a id="__codelineno-506-31" name="__codelineno-506-31" href="#__codelineno-506-31"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newStock</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-32"><a id="__codelineno-506-32" name="__codelineno-506-32" href="#__codelineno-506-32"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Stock cannot be negative&quot;</span><span class="p">)</span>
</span><span id="__span-506-33"><a id="__codelineno-506-33" name="__codelineno-506-33" href="#__codelineno-506-33"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-34"><a id="__codelineno-506-34" name="__codelineno-506-34" href="#__codelineno-506-34"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-35"><a id="__codelineno-506-35" name="__codelineno-506-35" href="#__codelineno-506-35"></a><span class="w">        </span><span class="c1">-- Check for stock limits</span>
</span><span id="__span-506-36"><a id="__codelineno-506-36" name="__codelineno-506-36" href="#__codelineno-506-36"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span>
</span><span id="__span-506-37"><a id="__codelineno-506-37" name="__codelineno-506-37" href="#__codelineno-506-37"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">newStock</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxStock</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-38"><a id="__codelineno-506-38" name="__codelineno-506-38" href="#__codelineno-506-38"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Stock cannot exceed &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">maxStock</span><span class="p">)</span>
</span><span id="__span-506-39"><a id="__codelineno-506-39" name="__codelineno-506-39" href="#__codelineno-506-39"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-40"><a id="__codelineno-506-40" name="__codelineno-506-40" href="#__codelineno-506-40"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-41"><a id="__codelineno-506-41" name="__codelineno-506-41" href="#__codelineno-506-41"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;faction&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-42"><a id="__codelineno-506-42" name="__codelineno-506-42" href="#__codelineno-506-42"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">newFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="p">)</span>
</span><span id="__span-506-43"><a id="__codelineno-506-43" name="__codelineno-506-43" href="#__codelineno-506-43"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;police&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;citizen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="p">}</span>
</span><span id="__span-506-44"><a id="__codelineno-506-44" name="__codelineno-506-44" href="#__codelineno-506-44"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">allowedFactions</span><span class="p">,</span><span class="w"> </span><span class="nv">newFaction</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-45"><a id="__codelineno-506-45" name="__codelineno-506-45" href="#__codelineno-506-45"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Invalid faction: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">newFaction</span><span class="p">)</span>
</span><span id="__span-506-46"><a id="__codelineno-506-46" name="__codelineno-506-46" href="#__codelineno-506-46"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-506-47"><a id="__codelineno-506-47" name="__codelineno-506-47" href="#__codelineno-506-47"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-48"><a id="__codelineno-506-48" name="__codelineno-506-48" href="#__codelineno-506-48"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-506-49"><a id="__codelineno-506-49" name="__codelineno-506-49" href="#__codelineno-506-49"></a><span class="w">    </span><span class="c1">-- Log the edit</span>
</span><span id="__span-506-50"><a id="__codelineno-506-50" name="__codelineno-506-50" href="#__codelineno-506-50"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s edited vendor %s property %s to %s&quot;</span><span class="p">,</span>
</span><span id="__span-506-51"><a id="__codelineno-506-51" name="__codelineno-506-51" href="#__codelineno-506-51"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="nv">key</span><span class="p">))))</span>
</span><span id="__span-506-52"><a id="__codelineno-506-52" name="__codelineno-506-52" href="#__codelineno-506-52"></a><span class="w">    </span><span class="c1">-- Notify other admins</span>
</span><span id="__span-506-53"><a id="__codelineno-506-53" name="__codelineno-506-53" href="#__codelineno-506-53"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-506-54"><a id="__codelineno-506-54" name="__codelineno-506-54" href="#__codelineno-506-54"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-506-55"><a id="__codelineno-506-55" name="__codelineno-506-55" href="#__codelineno-506-55"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; edited vendor &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-506-56"><a id="__codelineno-506-56" name="__codelineno-506-56" href="#__codelineno-506-56"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-506-57"><a id="__codelineno-506-57" name="__codelineno-506-57" href="#__codelineno-506-57"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-506-58"><a id="__codelineno-506-58" name="__codelineno-506-58" href="#__codelineno-506-58"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="onlinestaffdatareceived">OnlineStaffDataReceived</h3>
<p><strong>Purpose</strong></p>
<p>Called when online staff data is received</p>
<p><strong>When Called</strong></p>
<p>When the server receives updated staff information</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>staffData</code> (<em>table</em>): The staff data containing online staff information</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-507-1"><a id="__codelineno-507-1" name="__codelineno-507-1" href="#__codelineno-507-1"></a><span class="c1">-- Simple: Log staff data</span>
</span><span id="__span-507-2"><a id="__codelineno-507-2" name="__codelineno-507-2" href="#__codelineno-507-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnlineStaffDataReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span>
</span><span id="__span-507-3"><a id="__codelineno-507-3" name="__codelineno-507-3" href="#__codelineno-507-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received staff data for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; staff members&quot;</span><span class="p">)</span>
</span><span id="__span-507-4"><a id="__codelineno-507-4" name="__codelineno-507-4" href="#__codelineno-507-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-508-1"><a id="__codelineno-508-1" name="__codelineno-508-1" href="#__codelineno-508-1"></a><span class="c1">-- Medium: Track online staff</span>
</span><span id="__span-508-2"><a id="__codelineno-508-2" name="__codelineno-508-2" href="#__codelineno-508-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnlineStaffDataReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackStaff&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span>
</span><span id="__span-508-3"><a id="__codelineno-508-3" name="__codelineno-508-3" href="#__codelineno-508-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="py">onlineStaff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">onlineStaff</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-508-4"><a id="__codelineno-508-4" name="__codelineno-508-4" href="#__codelineno-508-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-508-5"><a id="__codelineno-508-5" name="__codelineno-508-5" href="#__codelineno-508-5"></a><span class="w">    </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">onlineStaff</span><span class="p">[</span><span class="nv">steamID</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-508-6"><a id="__codelineno-508-6" name="__codelineno-508-6" href="#__codelineno-508-6"></a><span class="w">    </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="p">,</span>
</span><span id="__span-508-7"><a id="__codelineno-508-7" name="__codelineno-508-7" href="#__codelineno-508-7"></a><span class="w">    </span><span class="nv">rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="p">.</span><span class="py">rank</span><span class="p">,</span>
</span><span id="__span-508-8"><a id="__codelineno-508-8" name="__codelineno-508-8" href="#__codelineno-508-8"></a><span class="w">    </span><span class="nv">lastSeen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-508-9"><a id="__codelineno-508-9" name="__codelineno-508-9" href="#__codelineno-508-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-508-10"><a id="__codelineno-508-10" name="__codelineno-508-10" href="#__codelineno-508-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-508-11"><a id="__codelineno-508-11" name="__codelineno-508-11" href="#__codelineno-508-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-509-1"><a id="__codelineno-509-1" name="__codelineno-509-1" href="#__codelineno-509-1"></a><span class="c1">-- High: Complex staff management</span>
</span><span id="__span-509-2"><a id="__codelineno-509-2" name="__codelineno-509-2" href="#__codelineno-509-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OnlineStaffDataReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStaffManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span>
</span><span id="__span-509-3"><a id="__codelineno-509-3" name="__codelineno-509-3" href="#__codelineno-509-3"></a><span class="c1">-- Log staff data update</span>
</span><span id="__span-509-4"><a id="__codelineno-509-4" name="__codelineno-509-4" href="#__codelineno-509-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;staff_data_received&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-509-5"><a id="__codelineno-509-5" name="__codelineno-509-5" href="#__codelineno-509-5"></a><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nv">staffData</span><span class="p">),</span>
</span><span id="__span-509-6"><a id="__codelineno-509-6" name="__codelineno-509-6" href="#__codelineno-509-6"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-509-7"><a id="__codelineno-509-7" name="__codelineno-509-7" href="#__codelineno-509-7"></a><span class="p">})</span>
</span><span id="__span-509-8"><a id="__codelineno-509-8" name="__codelineno-509-8" href="#__codelineno-509-8"></a><span class="c1">-- Update staff database</span>
</span><span id="__span-509-9"><a id="__codelineno-509-9" name="__codelineno-509-9" href="#__codelineno-509-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">steamID</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">staffData</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-509-10"><a id="__codelineno-509-10" name="__codelineno-509-10" href="#__codelineno-509-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT OR REPLACE INTO staff_data (steamid, name, rank, last_seen) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-509-11"><a id="__codelineno-509-11" name="__codelineno-509-11" href="#__codelineno-509-11"></a><span class="w">    </span><span class="nv">steamID</span><span class="p">,</span>
</span><span id="__span-509-12"><a id="__codelineno-509-12" name="__codelineno-509-12" href="#__codelineno-509-12"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">name</span><span class="p">,</span>
</span><span id="__span-509-13"><a id="__codelineno-509-13" name="__codelineno-509-13" href="#__codelineno-509-13"></a><span class="w">    </span><span class="nv">data</span><span class="p">.</span><span class="py">rank</span><span class="p">,</span>
</span><span id="__span-509-14"><a id="__codelineno-509-14" name="__codelineno-509-14" href="#__codelineno-509-14"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-509-15"><a id="__codelineno-509-15" name="__codelineno-509-15" href="#__codelineno-509-15"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-509-16"><a id="__codelineno-509-16" name="__codelineno-509-16" href="#__codelineno-509-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-509-17"><a id="__codelineno-509-17" name="__codelineno-509-17" href="#__codelineno-509-17"></a><span class="c1">-- Notify players of staff changes</span>
</span><span id="__span-509-18"><a id="__codelineno-509-18" name="__codelineno-509-18" href="#__codelineno-509-18"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-509-19"><a id="__codelineno-509-19" name="__codelineno-509-19" href="#__codelineno-509-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-509-20"><a id="__codelineno-509-20" name="__codelineno-509-20" href="#__codelineno-509-20"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Staff data updated&quot;</span><span class="p">)</span>
</span><span id="__span-509-21"><a id="__codelineno-509-21" name="__codelineno-509-21" href="#__codelineno-509-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-509-22"><a id="__codelineno-509-22" name="__codelineno-509-22" href="#__codelineno-509-22"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-509-23"><a id="__codelineno-509-23" name="__codelineno-509-23" href="#__codelineno-509-23"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="optionreceived">OptionReceived</h3>
<p><strong>Purpose</strong></p>
<p>Called when a client option is received</p>
<p><strong>When Called</strong></p>
<p>When the server receives an option setting from a client</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who sent the option</li>
<li><code>key</code> (<em>string</em>): The option key</li>
<li><code>value</code> (<em>any</em>): The option value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-510-1"><a id="__codelineno-510-1" name="__codelineno-510-1" href="#__codelineno-510-1"></a><span class="c1">-- Simple: Log option changes</span>
</span><span id="__span-510-2"><a id="__codelineno-510-2" name="__codelineno-510-2" href="#__codelineno-510-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OptionReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-510-3"><a id="__codelineno-510-3" name="__codelineno-510-3" href="#__codelineno-510-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; changed option &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-510-4"><a id="__codelineno-510-4" name="__codelineno-510-4" href="#__codelineno-510-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-511-1"><a id="__codelineno-511-1" name="__codelineno-511-1" href="#__codelineno-511-1"></a><span class="c1">-- Medium: Track option changes</span>
</span><span id="__span-511-2"><a id="__codelineno-511-2" name="__codelineno-511-2" href="#__codelineno-511-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OptionReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackOptions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-511-3"><a id="__codelineno-511-3" name="__codelineno-511-3" href="#__codelineno-511-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-511-4"><a id="__codelineno-511-4" name="__codelineno-511-4" href="#__codelineno-511-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-511-5"><a id="__codelineno-511-5" name="__codelineno-511-5" href="#__codelineno-511-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-511-6"><a id="__codelineno-511-6" name="__codelineno-511-6" href="#__codelineno-511-6"></a><span class="w">    </span><span class="nv">options</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-511-7"><a id="__codelineno-511-7" name="__codelineno-511-7" href="#__codelineno-511-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">options</span><span class="p">)</span>
</span><span id="__span-511-8"><a id="__codelineno-511-8" name="__codelineno-511-8" href="#__codelineno-511-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-511-9"><a id="__codelineno-511-9" name="__codelineno-511-9" href="#__codelineno-511-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-512-1"><a id="__codelineno-512-1" name="__codelineno-512-1" href="#__codelineno-512-1"></a><span class="c1">-- High: Complex option handling</span>
</span><span id="__span-512-2"><a id="__codelineno-512-2" name="__codelineno-512-2" href="#__codelineno-512-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OptionReceived&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedOptionHandling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-512-3"><a id="__codelineno-512-3" name="__codelineno-512-3" href="#__codelineno-512-3"></a><span class="c1">-- Log option change</span>
</span><span id="__span-512-4"><a id="__codelineno-512-4" name="__codelineno-512-4" href="#__codelineno-512-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;option_changed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-512-5"><a id="__codelineno-512-5" name="__codelineno-512-5" href="#__codelineno-512-5"></a><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-512-6"><a id="__codelineno-512-6" name="__codelineno-512-6" href="#__codelineno-512-6"></a><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span>
</span><span id="__span-512-7"><a id="__codelineno-512-7" name="__codelineno-512-7" href="#__codelineno-512-7"></a><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">),</span>
</span><span id="__span-512-8"><a id="__codelineno-512-8" name="__codelineno-512-8" href="#__codelineno-512-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-512-9"><a id="__codelineno-512-9" name="__codelineno-512-9" href="#__codelineno-512-9"></a><span class="p">})</span>
</span><span id="__span-512-10"><a id="__codelineno-512-10" name="__codelineno-512-10" href="#__codelineno-512-10"></a><span class="c1">-- Validate option value</span>
</span><span id="__span-512-11"><a id="__codelineno-512-11" name="__codelineno-512-11" href="#__codelineno-512-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;volume&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-512-12"><a id="__codelineno-512-12" name="__codelineno-512-12" href="#__codelineno-512-12"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Invalid volume value&quot;</span><span class="p">)</span>
</span><span id="__span-512-13"><a id="__codelineno-512-13" name="__codelineno-512-13" href="#__codelineno-512-13"></a><span class="w">    </span><span class="kr">return</span>
</span><span id="__span-512-14"><a id="__codelineno-512-14" name="__codelineno-512-14" href="#__codelineno-512-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-512-15"><a id="__codelineno-512-15" name="__codelineno-512-15" href="#__codelineno-512-15"></a><span class="c1">-- Store option in character data</span>
</span><span id="__span-512-16"><a id="__codelineno-512-16" name="__codelineno-512-16" href="#__codelineno-512-16"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-512-17"><a id="__codelineno-512-17" name="__codelineno-512-17" href="#__codelineno-512-17"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-512-18"><a id="__codelineno-512-18" name="__codelineno-512-18" href="#__codelineno-512-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-512-19"><a id="__codelineno-512-19" name="__codelineno-512-19" href="#__codelineno-512-19"></a><span class="w">    </span><span class="nv">options</span><span class="p">[</span><span class="nv">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-512-20"><a id="__codelineno-512-20" name="__codelineno-512-20" href="#__codelineno-512-20"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">options</span><span class="p">)</span>
</span><span id="__span-512-21"><a id="__codelineno-512-21" name="__codelineno-512-21" href="#__codelineno-512-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-512-22"><a id="__codelineno-512-22" name="__codelineno-512-22" href="#__codelineno-512-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="overridespawntime">OverrideSpawnTime</h3>
<p><strong>Purpose</strong></p>
<p>Called to override a player's respawn time</p>
<p><strong>When Called</strong></p>
<p>When a player's respawn time needs to be modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player respawning</li>
<li><code>respawnTime</code> (<em>number</em>): The current respawn time in seconds</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>number - The overridden respawn time (or nil to use default)</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-513-1"><a id="__codelineno-513-1" name="__codelineno-513-1" href="#__codelineno-513-1"></a><span class="c1">-- Simple: Reduce respawn time</span>
</span><span id="__span-513-2"><a id="__codelineno-513-2" name="__codelineno-513-2" href="#__codelineno-513-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OverrideSpawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">respawnTime</span><span class="p">)</span>
</span><span id="__span-513-3"><a id="__codelineno-513-3" name="__codelineno-513-3" href="#__codelineno-513-3"></a><span class="kr">return</span><span class="w"> </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-513-4"><a id="__codelineno-513-4" name="__codelineno-513-4" href="#__codelineno-513-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-514-1"><a id="__codelineno-514-1" name="__codelineno-514-1" href="#__codelineno-514-1"></a><span class="c1">-- Medium: Faction-based respawn times</span>
</span><span id="__span-514-2"><a id="__codelineno-514-2" name="__codelineno-514-2" href="#__codelineno-514-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OverrideSpawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionRespawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">respawnTime</span><span class="p">)</span>
</span><span id="__span-514-3"><a id="__codelineno-514-3" name="__codelineno-514-3" href="#__codelineno-514-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-514-4"><a id="__codelineno-514-4" name="__codelineno-514-4" href="#__codelineno-514-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-514-5"><a id="__codelineno-514-5" name="__codelineno-514-5" href="#__codelineno-514-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-514-6"><a id="__codelineno-514-6" name="__codelineno-514-6" href="#__codelineno-514-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">FACTION_POLICE</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-514-7"><a id="__codelineno-514-7" name="__codelineno-514-7" href="#__codelineno-514-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-514-8"><a id="__codelineno-514-8" name="__codelineno-514-8" href="#__codelineno-514-8"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">FACTION_MEDIC</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-514-9"><a id="__codelineno-514-9" name="__codelineno-514-9" href="#__codelineno-514-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-514-10"><a id="__codelineno-514-10" name="__codelineno-514-10" href="#__codelineno-514-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-514-11"><a id="__codelineno-514-11" name="__codelineno-514-11" href="#__codelineno-514-11"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-515-1"><a id="__codelineno-515-1" name="__codelineno-515-1" href="#__codelineno-515-1"></a><span class="c1">-- High: Dynamic respawn time system</span>
</span><span id="__span-515-2"><a id="__codelineno-515-2" name="__codelineno-515-2" href="#__codelineno-515-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;OverrideSpawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DynamicRespawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">respawnTime</span><span class="p">)</span>
</span><span id="__span-515-3"><a id="__codelineno-515-3" name="__codelineno-515-3" href="#__codelineno-515-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-515-4"><a id="__codelineno-515-4" name="__codelineno-515-4" href="#__codelineno-515-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-515-5"><a id="__codelineno-515-5" name="__codelineno-515-5" href="#__codelineno-515-5"></a><span class="w">    </span><span class="c1">-- Check for respawn time reduction items</span>
</span><span id="__span-515-6"><a id="__codelineno-515-6" name="__codelineno-515-6" href="#__codelineno-515-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-515-7"><a id="__codelineno-515-7" name="__codelineno-515-7" href="#__codelineno-515-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-515-8"><a id="__codelineno-515-8" name="__codelineno-515-8" href="#__codelineno-515-8"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-515-9"><a id="__codelineno-515-9" name="__codelineno-515-9" href="#__codelineno-515-9"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">reduceRespawnTime</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-515-10"><a id="__codelineno-515-10" name="__codelineno-515-10" href="#__codelineno-515-10"></a><span class="w">                </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.75</span>
</span><span id="__span-515-11"><a id="__codelineno-515-11" name="__codelineno-515-11" href="#__codelineno-515-11"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-515-12"><a id="__codelineno-515-12" name="__codelineno-515-12" href="#__codelineno-515-12"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-515-13"><a id="__codelineno-515-13" name="__codelineno-515-13" href="#__codelineno-515-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-515-14"><a id="__codelineno-515-14" name="__codelineno-515-14" href="#__codelineno-515-14"></a><span class="w">    </span><span class="c1">-- Check for VIP status</span>
</span><span id="__span-515-15"><a id="__codelineno-515-15" name="__codelineno-515-15" href="#__codelineno-515-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsUserGroup</span><span class="p">(</span><span class="s2">&quot;vip&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-515-16"><a id="__codelineno-515-16" name="__codelineno-515-16" href="#__codelineno-515-16"></a><span class="w">        </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span>
</span><span id="__span-515-17"><a id="__codelineno-515-17" name="__codelineno-515-17" href="#__codelineno-515-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-515-18"><a id="__codelineno-515-18" name="__codelineno-515-18" href="#__codelineno-515-18"></a><span class="w">    </span><span class="c1">-- Check death count</span>
</span><span id="__span-515-19"><a id="__codelineno-515-19" name="__codelineno-515-19" href="#__codelineno-515-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;deaths&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-515-20"><a id="__codelineno-515-20" name="__codelineno-515-20" href="#__codelineno-515-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">deaths</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-515-21"><a id="__codelineno-515-21" name="__codelineno-515-21" href="#__codelineno-515-21"></a><span class="w">        </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">respawnTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">deaths</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-515-22"><a id="__codelineno-515-22" name="__codelineno-515-22" href="#__codelineno-515-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-515-23"><a id="__codelineno-515-23" name="__codelineno-515-23" href="#__codelineno-515-23"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="nv">respawnTime</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-515-24"><a id="__codelineno-515-24" name="__codelineno-515-24" href="#__codelineno-515-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playeraccessvendor">PlayerAccessVendor</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player accesses a vendor</p>
<p><strong>When Called</strong></p>
<p>When a player interacts with a vendor entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>activator</code> (<em>Player</em>): The player accessing the vendor</li>
<li><code>self</code> (<em>Entity</em>): The vendor entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-516-1"><a id="__codelineno-516-1" name="__codelineno-516-1" href="#__codelineno-516-1"></a><span class="c1">-- Simple: Log vendor access</span>
</span><span id="__span-516-2"><a id="__codelineno-516-2" name="__codelineno-516-2" href="#__codelineno-516-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-516-3"><a id="__codelineno-516-3" name="__codelineno-516-3" href="#__codelineno-516-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">activator</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; accessed a vendor&quot;</span><span class="p">)</span>
</span><span id="__span-516-4"><a id="__codelineno-516-4" name="__codelineno-516-4" href="#__codelineno-516-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-517-1"><a id="__codelineno-517-1" name="__codelineno-517-1" href="#__codelineno-517-1"></a><span class="c1">-- Medium: Track vendor usage</span>
</span><span id="__span-517-2"><a id="__codelineno-517-2" name="__codelineno-517-2" href="#__codelineno-517-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackVendorUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-517-3"><a id="__codelineno-517-3" name="__codelineno-517-3" href="#__codelineno-517-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-517-4"><a id="__codelineno-517-4" name="__codelineno-517-4" href="#__codelineno-517-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-517-5"><a id="__codelineno-517-5" name="__codelineno-517-5" href="#__codelineno-517-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-517-6"><a id="__codelineno-517-6" name="__codelineno-517-6" href="#__codelineno-517-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-517-7"><a id="__codelineno-517-7" name="__codelineno-517-7" href="#__codelineno-517-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-517-8"><a id="__codelineno-517-8" name="__codelineno-517-8" href="#__codelineno-517-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-518-1"><a id="__codelineno-518-1" name="__codelineno-518-1" href="#__codelineno-518-1"></a><span class="c1">-- High: Complex vendor access tracking</span>
</span><span id="__span-518-2"><a id="__codelineno-518-2" name="__codelineno-518-2" href="#__codelineno-518-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerAccessVendor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorAccess&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-518-3"><a id="__codelineno-518-3" name="__codelineno-518-3" href="#__codelineno-518-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-518-4"><a id="__codelineno-518-4" name="__codelineno-518-4" href="#__codelineno-518-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-518-5"><a id="__codelineno-518-5" name="__codelineno-518-5" href="#__codelineno-518-5"></a><span class="w">    </span><span class="c1">-- Track vendor usage</span>
</span><span id="__span-518-6"><a id="__codelineno-518-6" name="__codelineno-518-6" href="#__codelineno-518-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-518-7"><a id="__codelineno-518-7" name="__codelineno-518-7" href="#__codelineno-518-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-518-8"><a id="__codelineno-518-8" name="__codelineno-518-8" href="#__codelineno-518-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-518-9"><a id="__codelineno-518-9" name="__codelineno-518-9" href="#__codelineno-518-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorID&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-518-10"><a id="__codelineno-518-10" name="__codelineno-518-10" href="#__codelineno-518-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_logs (timestamp, charid, vendorid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-518-11"><a id="__codelineno-518-11" name="__codelineno-518-11" href="#__codelineno-518-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendorID</span><span class="p">)</span>
</span><span id="__span-518-12"><a id="__codelineno-518-12" name="__codelineno-518-12" href="#__codelineno-518-12"></a><span class="w">    </span><span class="c1">-- Apply first-time bonus</span>
</span><span id="__span-518-13"><a id="__codelineno-518-13" name="__codelineno-518-13" href="#__codelineno-518-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-518-14"><a id="__codelineno-518-14" name="__codelineno-518-14" href="#__codelineno-518-14"></a><span class="w">        </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;First time using a vendor! Here&#39;s a discount.&quot;</span><span class="p">)</span>
</span><span id="__span-518-15"><a id="__codelineno-518-15" name="__codelineno-518-15" href="#__codelineno-518-15"></a><span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;discount_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-518-16"><a id="__codelineno-518-16" name="__codelineno-518-16" href="#__codelineno-518-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-518-17"><a id="__codelineno-518-17" name="__codelineno-518-17" href="#__codelineno-518-17"></a><span class="w">    </span><span class="c1">-- Check for achievements</span>
</span><span id="__span-518-18"><a id="__codelineno-518-18" name="__codelineno-518-18" href="#__codelineno-518-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">vendorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-518-19"><a id="__codelineno-518-19" name="__codelineno-518-19" href="#__codelineno-518-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_shopaholic&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-518-20"><a id="__codelineno-518-20" name="__codelineno-518-20" href="#__codelineno-518-20"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_shopaholic&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-518-21"><a id="__codelineno-518-21" name="__codelineno-518-21" href="#__codelineno-518-21"></a><span class="w">            </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Shopaholic!&quot;</span><span class="p">)</span>
</span><span id="__span-518-22"><a id="__codelineno-518-22" name="__codelineno-518-22" href="#__codelineno-518-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-518-23"><a id="__codelineno-518-23" name="__codelineno-518-23" href="#__codelineno-518-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-518-24"><a id="__codelineno-518-24" name="__codelineno-518-24" href="#__codelineno-518-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playercheatdetected">PlayerCheatDetected</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is detected cheating</p>
<p><strong>When Called</strong></p>
<p>When anti-cheat systems detect suspicious behavior</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who was detected cheating</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-519-1"><a id="__codelineno-519-1" name="__codelineno-519-1" href="#__codelineno-519-1"></a><span class="c1">-- Simple: Log cheat detection</span>
</span><span id="__span-519-2"><a id="__codelineno-519-2" name="__codelineno-519-2" href="#__codelineno-519-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerCheatDetected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-519-3"><a id="__codelineno-519-3" name="__codelineno-519-3" href="#__codelineno-519-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cheat detected: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-519-4"><a id="__codelineno-519-4" name="__codelineno-519-4" href="#__codelineno-519-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-520-1"><a id="__codelineno-520-1" name="__codelineno-520-1" href="#__codelineno-520-1"></a><span class="c1">-- Medium: Handle cheat detection</span>
</span><span id="__span-520-2"><a id="__codelineno-520-2" name="__codelineno-520-2" href="#__codelineno-520-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerCheatDetected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HandleCheating&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-520-3"><a id="__codelineno-520-3" name="__codelineno-520-3" href="#__codelineno-520-3"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Cheating detected&quot;</span><span class="p">)</span>
</span><span id="__span-520-4"><a id="__codelineno-520-4" name="__codelineno-520-4" href="#__codelineno-520-4"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-520-5"><a id="__codelineno-520-5" name="__codelineno-520-5" href="#__codelineno-520-5"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-520-6"><a id="__codelineno-520-6" name="__codelineno-520-6" href="#__codelineno-520-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-520-7"><a id="__codelineno-520-7" name="__codelineno-520-7" href="#__codelineno-520-7"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Player &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was kicked for cheating&quot;</span><span class="p">)</span>
</span><span id="__span-520-8"><a id="__codelineno-520-8" name="__codelineno-520-8" href="#__codelineno-520-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-520-9"><a id="__codelineno-520-9" name="__codelineno-520-9" href="#__codelineno-520-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-520-10"><a id="__codelineno-520-10" name="__codelineno-520-10" href="#__codelineno-520-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-521-1"><a id="__codelineno-521-1" name="__codelineno-521-1" href="#__codelineno-521-1"></a><span class="c1">-- High: Complex cheat detection handling</span>
</span><span id="__span-521-2"><a id="__codelineno-521-2" name="__codelineno-521-2" href="#__codelineno-521-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerCheatDetected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCheatDetection&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-521-3"><a id="__codelineno-521-3" name="__codelineno-521-3" href="#__codelineno-521-3"></a><span class="c1">-- Log cheat detection</span>
</span><span id="__span-521-4"><a id="__codelineno-521-4" name="__codelineno-521-4" href="#__codelineno-521-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;cheat_detected&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-521-5"><a id="__codelineno-521-5" name="__codelineno-521-5" href="#__codelineno-521-5"></a><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-521-6"><a id="__codelineno-521-6" name="__codelineno-521-6" href="#__codelineno-521-6"></a><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-521-7"><a id="__codelineno-521-7" name="__codelineno-521-7" href="#__codelineno-521-7"></a><span class="nv">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IPAddress</span><span class="p">(),</span>
</span><span id="__span-521-8"><a id="__codelineno-521-8" name="__codelineno-521-8" href="#__codelineno-521-8"></a><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-521-9"><a id="__codelineno-521-9" name="__codelineno-521-9" href="#__codelineno-521-9"></a><span class="p">})</span>
</span><span id="__span-521-10"><a id="__codelineno-521-10" name="__codelineno-521-10" href="#__codelineno-521-10"></a><span class="c1">-- Record cheat attempt</span>
</span><span id="__span-521-11"><a id="__codelineno-521-11" name="__codelineno-521-11" href="#__codelineno-521-11"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO cheat_logs (steamid, name, ip, timestamp) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-521-12"><a id="__codelineno-521-12" name="__codelineno-521-12" href="#__codelineno-521-12"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-521-13"><a id="__codelineno-521-13" name="__codelineno-521-13" href="#__codelineno-521-13"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-521-14"><a id="__codelineno-521-14" name="__codelineno-521-14" href="#__codelineno-521-14"></a><span class="nv">client</span><span class="p">:</span><span class="nf">IPAddress</span><span class="p">(),</span>
</span><span id="__span-521-15"><a id="__codelineno-521-15" name="__codelineno-521-15" href="#__codelineno-521-15"></a><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-521-16"><a id="__codelineno-521-16" name="__codelineno-521-16" href="#__codelineno-521-16"></a><span class="p">)</span>
</span><span id="__span-521-17"><a id="__codelineno-521-17" name="__codelineno-521-17" href="#__codelineno-521-17"></a><span class="c1">-- Apply punishment based on history</span>
</span><span id="__span-521-18"><a id="__codelineno-521-18" name="__codelineno-521-18" href="#__codelineno-521-18"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-521-19"><a id="__codelineno-521-19" name="__codelineno-521-19" href="#__codelineno-521-19"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-521-20"><a id="__codelineno-521-20" name="__codelineno-521-20" href="#__codelineno-521-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">cheatCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;cheatCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-521-21"><a id="__codelineno-521-21" name="__codelineno-521-21" href="#__codelineno-521-21"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;cheatCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">cheatCount</span><span class="p">)</span>
</span><span id="__span-521-22"><a id="__codelineno-521-22" name="__codelineno-521-22" href="#__codelineno-521-22"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">cheatCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-521-23"><a id="__codelineno-521-23" name="__codelineno-521-23" href="#__codelineno-521-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Ban</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Multiple cheat violations&quot;</span><span class="p">)</span>
</span><span id="__span-521-24"><a id="__codelineno-521-24" name="__codelineno-521-24" href="#__codelineno-521-24"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-521-25"><a id="__codelineno-521-25" name="__codelineno-521-25" href="#__codelineno-521-25"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Cheating detected (Warning &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">cheatCount</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;/3)&quot;</span><span class="p">)</span>
</span><span id="__span-521-26"><a id="__codelineno-521-26" name="__codelineno-521-26" href="#__codelineno-521-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-521-27"><a id="__codelineno-521-27" name="__codelineno-521-27" href="#__codelineno-521-27"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-521-28"><a id="__codelineno-521-28" name="__codelineno-521-28" href="#__codelineno-521-28"></a><span class="c1">-- Notify all admins</span>
</span><span id="__span-521-29"><a id="__codelineno-521-29" name="__codelineno-521-29" href="#__codelineno-521-29"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-521-30"><a id="__codelineno-521-30" name="__codelineno-521-30" href="#__codelineno-521-30"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-521-31"><a id="__codelineno-521-31" name="__codelineno-521-31" href="#__codelineno-521-31"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[CHEAT] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; detected and punished&quot;</span><span class="p">)</span>
</span><span id="__span-521-32"><a id="__codelineno-521-32" name="__codelineno-521-32" href="#__codelineno-521-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-521-33"><a id="__codelineno-521-33" name="__codelineno-521-33" href="#__codelineno-521-33"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-521-34"><a id="__codelineno-521-34" name="__codelineno-521-34" href="#__codelineno-521-34"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerdisconnect">PlayerDisconnect</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player disconnects</p>
<p><strong>When Called</strong></p>
<p>When a player leaves the server</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player disconnecting</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-522-1"><a id="__codelineno-522-1" name="__codelineno-522-1" href="#__codelineno-522-1"></a><span class="c1">-- Simple: Log disconnect</span>
</span><span id="__span-522-2"><a id="__codelineno-522-2" name="__codelineno-522-2" href="#__codelineno-522-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-522-3"><a id="__codelineno-522-3" name="__codelineno-522-3" href="#__codelineno-522-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; disconnected&quot;</span><span class="p">)</span>
</span><span id="__span-522-4"><a id="__codelineno-522-4" name="__codelineno-522-4" href="#__codelineno-522-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-523-1"><a id="__codelineno-523-1" name="__codelineno-523-1" href="#__codelineno-523-1"></a><span class="c1">-- Medium: Save player data on disconnect</span>
</span><span id="__span-523-2"><a id="__codelineno-523-2" name="__codelineno-523-2" href="#__codelineno-523-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SaveOnDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-523-3"><a id="__codelineno-523-3" name="__codelineno-523-3" href="#__codelineno-523-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-523-4"><a id="__codelineno-523-4" name="__codelineno-523-4" href="#__codelineno-523-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-523-5"><a id="__codelineno-523-5" name="__codelineno-523-5" href="#__codelineno-523-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">save</span><span class="p">()</span>
</span><span id="__span-523-6"><a id="__codelineno-523-6" name="__codelineno-523-6" href="#__codelineno-523-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-523-7"><a id="__codelineno-523-7" name="__codelineno-523-7" href="#__codelineno-523-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-524-1"><a id="__codelineno-524-1" name="__codelineno-524-1" href="#__codelineno-524-1"></a><span class="c1">-- High: Complex disconnect handling</span>
</span><span id="__span-524-2"><a id="__codelineno-524-2" name="__codelineno-524-2" href="#__codelineno-524-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDisconnect&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-524-3"><a id="__codelineno-524-3" name="__codelineno-524-3" href="#__codelineno-524-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-524-4"><a id="__codelineno-524-4" name="__codelineno-524-4" href="#__codelineno-524-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-524-5"><a id="__codelineno-524-5" name="__codelineno-524-5" href="#__codelineno-524-5"></a><span class="w">    </span><span class="c1">-- Save character data</span>
</span><span id="__span-524-6"><a id="__codelineno-524-6" name="__codelineno-524-6" href="#__codelineno-524-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">save</span><span class="p">()</span>
</span><span id="__span-524-7"><a id="__codelineno-524-7" name="__codelineno-524-7" href="#__codelineno-524-7"></a><span class="w">    </span><span class="c1">-- Update playtime</span>
</span><span id="__span-524-8"><a id="__codelineno-524-8" name="__codelineno-524-8" href="#__codelineno-524-8"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sessionStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;sessionStart&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-524-9"><a id="__codelineno-524-9" name="__codelineno-524-9" href="#__codelineno-524-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sessionTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">sessionStart</span>
</span><span id="__span-524-10"><a id="__codelineno-524-10" name="__codelineno-524-10" href="#__codelineno-524-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">totalPlaytime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;playTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-524-11"><a id="__codelineno-524-11" name="__codelineno-524-11" href="#__codelineno-524-11"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;playTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">totalPlaytime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">sessionTime</span><span class="p">)</span>
</span><span id="__span-524-12"><a id="__codelineno-524-12" name="__codelineno-524-12" href="#__codelineno-524-12"></a><span class="w">    </span><span class="c1">-- Log disconnect</span>
</span><span id="__span-524-13"><a id="__codelineno-524-13" name="__codelineno-524-13" href="#__codelineno-524-13"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO disconnect_logs (timestamp, steamid, charid, playtime) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-524-14"><a id="__codelineno-524-14" name="__codelineno-524-14" href="#__codelineno-524-14"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">sessionTime</span><span class="p">)</span>
</span><span id="__span-524-15"><a id="__codelineno-524-15" name="__codelineno-524-15" href="#__codelineno-524-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-524-16"><a id="__codelineno-524-16" name="__codelineno-524-16" href="#__codelineno-524-16"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-524-17"><a id="__codelineno-524-17" name="__codelineno-524-17" href="#__codelineno-524-17"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-524-18"><a id="__codelineno-524-18" name="__codelineno-524-18" href="#__codelineno-524-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-524-19"><a id="__codelineno-524-19" name="__codelineno-524-19" href="#__codelineno-524-19"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has disconnected&quot;</span><span class="p">)</span>
</span><span id="__span-524-20"><a id="__codelineno-524-20" name="__codelineno-524-20" href="#__codelineno-524-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-524-21"><a id="__codelineno-524-21" name="__codelineno-524-21" href="#__codelineno-524-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-524-22"><a id="__codelineno-524-22" name="__codelineno-524-22" href="#__codelineno-524-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playergagged">PlayerGagged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is gagged</p>
<p><strong>When Called</strong></p>
<p>When a player's voice chat is disabled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player being gagged</li>
<li><code>admin</code> (<em>Player</em>): The admin issuing the gag</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-525-1"><a id="__codelineno-525-1" name="__codelineno-525-1" href="#__codelineno-525-1"></a><span class="c1">-- Simple: Log gag</span>
</span><span id="__span-525-2"><a id="__codelineno-525-2" name="__codelineno-525-2" href="#__codelineno-525-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerGagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-525-3"><a id="__codelineno-525-3" name="__codelineno-525-3" href="#__codelineno-525-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was gagged by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-525-4"><a id="__codelineno-525-4" name="__codelineno-525-4" href="#__codelineno-525-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-526-1"><a id="__codelineno-526-1" name="__codelineno-526-1" href="#__codelineno-526-1"></a><span class="c1">-- Medium: Track gag history</span>
</span><span id="__span-526-2"><a id="__codelineno-526-2" name="__codelineno-526-2" href="#__codelineno-526-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerGagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackGagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-526-3"><a id="__codelineno-526-3" name="__codelineno-526-3" href="#__codelineno-526-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-526-4"><a id="__codelineno-526-4" name="__codelineno-526-4" href="#__codelineno-526-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-526-5"><a id="__codelineno-526-5" name="__codelineno-526-5" href="#__codelineno-526-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">gagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;gagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-526-6"><a id="__codelineno-526-6" name="__codelineno-526-6" href="#__codelineno-526-6"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">gagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-526-7"><a id="__codelineno-526-7" name="__codelineno-526-7" href="#__codelineno-526-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;gagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">gagHistory</span><span class="p">)</span>
</span><span id="__span-526-8"><a id="__codelineno-526-8" name="__codelineno-526-8" href="#__codelineno-526-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-526-9"><a id="__codelineno-526-9" name="__codelineno-526-9" href="#__codelineno-526-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-527-1"><a id="__codelineno-527-1" name="__codelineno-527-1" href="#__codelineno-527-1"></a><span class="c1">-- High: Complex gag management</span>
</span><span id="__span-527-2"><a id="__codelineno-527-2" name="__codelineno-527-2" href="#__codelineno-527-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerGagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedGagManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-527-3"><a id="__codelineno-527-3" name="__codelineno-527-3" href="#__codelineno-527-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-527-4"><a id="__codelineno-527-4" name="__codelineno-527-4" href="#__codelineno-527-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-527-5"><a id="__codelineno-527-5" name="__codelineno-527-5" href="#__codelineno-527-5"></a><span class="w">    </span><span class="c1">-- Track gag history</span>
</span><span id="__span-527-6"><a id="__codelineno-527-6" name="__codelineno-527-6" href="#__codelineno-527-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">gagHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;gagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-527-7"><a id="__codelineno-527-7" name="__codelineno-527-7" href="#__codelineno-527-7"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">gagHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-527-8"><a id="__codelineno-527-8" name="__codelineno-527-8" href="#__codelineno-527-8"></a><span class="w">    </span><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-527-9"><a id="__codelineno-527-9" name="__codelineno-527-9" href="#__codelineno-527-9"></a><span class="w">    </span><span class="nv">adminName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-527-10"><a id="__codelineno-527-10" name="__codelineno-527-10" href="#__codelineno-527-10"></a><span class="w">    </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-527-11"><a id="__codelineno-527-11" name="__codelineno-527-11" href="#__codelineno-527-11"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-527-12"><a id="__codelineno-527-12" name="__codelineno-527-12" href="#__codelineno-527-12"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;gagHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">gagHistory</span><span class="p">)</span>
</span><span id="__span-527-13"><a id="__codelineno-527-13" name="__codelineno-527-13" href="#__codelineno-527-13"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-527-14"><a id="__codelineno-527-14" name="__codelineno-527-14" href="#__codelineno-527-14"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO gag_logs (timestamp, target_steamid, admin_steamid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-527-15"><a id="__codelineno-527-15" name="__codelineno-527-15" href="#__codelineno-527-15"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-527-16"><a id="__codelineno-527-16" name="__codelineno-527-16" href="#__codelineno-527-16"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-527-17"><a id="__codelineno-527-17" name="__codelineno-527-17" href="#__codelineno-527-17"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been gagged by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-527-18"><a id="__codelineno-527-18" name="__codelineno-527-18" href="#__codelineno-527-18"></a><span class="w">    </span><span class="c1">-- Notify other admins</span>
</span><span id="__span-527-19"><a id="__codelineno-527-19" name="__codelineno-527-19" href="#__codelineno-527-19"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-527-20"><a id="__codelineno-527-20" name="__codelineno-527-20" href="#__codelineno-527-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-527-21"><a id="__codelineno-527-21" name="__codelineno-527-21" href="#__codelineno-527-21"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; gagged &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-527-22"><a id="__codelineno-527-22" name="__codelineno-527-22" href="#__codelineno-527-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-527-23"><a id="__codelineno-527-23" name="__codelineno-527-23" href="#__codelineno-527-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-527-24"><a id="__codelineno-527-24" name="__codelineno-527-24" href="#__codelineno-527-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerliliadataloaded">PlayerLiliaDataLoaded</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player's Lilia data is loaded</p>
<p><strong>When Called</strong></p>
<p>When a player's framework data has been loaded from the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose data was loaded</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-528-1"><a id="__codelineno-528-1" name="__codelineno-528-1" href="#__codelineno-528-1"></a><span class="c1">-- Simple: Log data loading</span>
</span><span id="__span-528-2"><a id="__codelineno-528-2" name="__codelineno-528-2" href="#__codelineno-528-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLiliaDataLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-528-3"><a id="__codelineno-528-3" name="__codelineno-528-3" href="#__codelineno-528-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lilia data loaded for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-528-4"><a id="__codelineno-528-4" name="__codelineno-528-4" href="#__codelineno-528-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-529-1"><a id="__codelineno-529-1" name="__codelineno-529-1" href="#__codelineno-529-1"></a><span class="c1">-- Medium: Initialize player after data load</span>
</span><span id="__span-529-2"><a id="__codelineno-529-2" name="__codelineno-529-2" href="#__codelineno-529-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLiliaDataLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InitPlayer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-529-3"><a id="__codelineno-529-3" name="__codelineno-529-3" href="#__codelineno-529-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-529-4"><a id="__codelineno-529-4" name="__codelineno-529-4" href="#__codelineno-529-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-529-5"><a id="__codelineno-529-5" name="__codelineno-529-5" href="#__codelineno-529-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;addonInitialized&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-529-6"><a id="__codelineno-529-6" name="__codelineno-529-6" href="#__codelineno-529-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-529-7"><a id="__codelineno-529-7" name="__codelineno-529-7" href="#__codelineno-529-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-530-1"><a id="__codelineno-530-1" name="__codelineno-530-1" href="#__codelineno-530-1"></a><span class="c1">-- High: Complex data loading handling</span>
</span><span id="__span-530-2"><a id="__codelineno-530-2" name="__codelineno-530-2" href="#__codelineno-530-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLiliaDataLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-530-3"><a id="__codelineno-530-3" name="__codelineno-530-3" href="#__codelineno-530-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-530-4"><a id="__codelineno-530-4" name="__codelineno-530-4" href="#__codelineno-530-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-530-5"><a id="__codelineno-530-5" name="__codelineno-530-5" href="#__codelineno-530-5"></a><span class="w">    </span><span class="c1">-- Log data loading</span>
</span><span id="__span-530-6"><a id="__codelineno-530-6" name="__codelineno-530-6" href="#__codelineno-530-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;player_data_loaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-530-7"><a id="__codelineno-530-7" name="__codelineno-530-7" href="#__codelineno-530-7"></a><span class="w">    </span><span class="nv">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-530-8"><a id="__codelineno-530-8" name="__codelineno-530-8" href="#__codelineno-530-8"></a><span class="w">    </span><span class="nv">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-530-9"><a id="__codelineno-530-9" name="__codelineno-530-9" href="#__codelineno-530-9"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-530-10"><a id="__codelineno-530-10" name="__codelineno-530-10" href="#__codelineno-530-10"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-530-11"><a id="__codelineno-530-11" name="__codelineno-530-11" href="#__codelineno-530-11"></a><span class="w">    </span><span class="c1">-- Load custom player data</span>
</span><span id="__span-530-12"><a id="__codelineno-530-12" name="__codelineno-530-12" href="#__codelineno-530-12"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;player_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-530-13"><a id="__codelineno-530-13" name="__codelineno-530-13" href="#__codelineno-530-13"></a><span class="w">    </span><span class="nv">client</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span>
</span><span id="__span-530-14"><a id="__codelineno-530-14" name="__codelineno-530-14" href="#__codelineno-530-14"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-530-15"><a id="__codelineno-530-15" name="__codelineno-530-15" href="#__codelineno-530-15"></a><span class="w">    </span><span class="c1">-- Initialize player systems</span>
</span><span id="__span-530-16"><a id="__codelineno-530-16" name="__codelineno-530-16" href="#__codelineno-530-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">playerSystems</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-530-17"><a id="__codelineno-530-17" name="__codelineno-530-17" href="#__codelineno-530-17"></a><span class="w">        </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">playerSystems</span><span class="p">:</span><span class="nf">InitializePlayer</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-530-18"><a id="__codelineno-530-18" name="__codelineno-530-18" href="#__codelineno-530-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-530-19"><a id="__codelineno-530-19" name="__codelineno-530-19" href="#__codelineno-530-19"></a><span class="w">    </span><span class="c1">-- Sync data to client</span>
</span><span id="__span-530-20"><a id="__codelineno-530-20" name="__codelineno-530-20" href="#__codelineno-530-20"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;liaPlayerDataSync&quot;</span><span class="p">)</span>
</span><span id="__span-530-21"><a id="__codelineno-530-21" name="__codelineno-530-21" href="#__codelineno-530-21"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteTable</span><span class="p">(</span><span class="nv">client</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-530-22"><a id="__codelineno-530-22" name="__codelineno-530-22" href="#__codelineno-530-22"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-530-23"><a id="__codelineno-530-23" name="__codelineno-530-23" href="#__codelineno-530-23"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerloadedchar">PlayerLoadedChar</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player loads a character</p>
<p><strong>When Called</strong></p>
<p>When a player successfully loads a character</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player loading the character</li>
<li><code>character</code> (<em>Character</em>): The character being loaded</li>
<li><code>currentChar</code> (<em>Character</em>): The previously loaded character (if any)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-531-1"><a id="__codelineno-531-1" name="__codelineno-531-1" href="#__codelineno-531-1"></a><span class="c1">-- Simple: Log character loading</span>
</span><span id="__span-531-2"><a id="__codelineno-531-2" name="__codelineno-531-2" href="#__codelineno-531-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-531-3"><a id="__codelineno-531-3" name="__codelineno-531-3" href="#__codelineno-531-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; loaded character: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-531-4"><a id="__codelineno-531-4" name="__codelineno-531-4" href="#__codelineno-531-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-532-1"><a id="__codelineno-532-1" name="__codelineno-532-1" href="#__codelineno-532-1"></a><span class="c1">-- Medium: Handle character switching</span>
</span><span id="__span-532-2"><a id="__codelineno-532-2" name="__codelineno-532-2" href="#__codelineno-532-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CharSwitching&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-532-3"><a id="__codelineno-532-3" name="__codelineno-532-3" href="#__codelineno-532-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-532-4"><a id="__codelineno-532-4" name="__codelineno-532-4" href="#__codelineno-532-4"></a><span class="w">    </span><span class="c1">-- Save previous character data</span>
</span><span id="__span-532-5"><a id="__codelineno-532-5" name="__codelineno-532-5" href="#__codelineno-532-5"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-532-6"><a id="__codelineno-532-6" name="__codelineno-532-6" href="#__codelineno-532-6"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;switchPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-532-7"><a id="__codelineno-532-7" name="__codelineno-532-7" href="#__codelineno-532-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-532-8"><a id="__codelineno-532-8" name="__codelineno-532-8" href="#__codelineno-532-8"></a><span class="c1">-- Set up new character</span>
</span><span id="__span-532-9"><a id="__codelineno-532-9" name="__codelineno-532-9" href="#__codelineno-532-9"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-532-10"><a id="__codelineno-532-10" name="__codelineno-532-10" href="#__codelineno-532-10"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-532-11"><a id="__codelineno-532-11" name="__codelineno-532-11" href="#__codelineno-532-11"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character loaded: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-532-12"><a id="__codelineno-532-12" name="__codelineno-532-12" href="#__codelineno-532-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-533-1"><a id="__codelineno-533-1" name="__codelineno-533-1" href="#__codelineno-533-1"></a><span class="c1">-- High: Complex character loading system</span>
</span><span id="__span-533-2"><a id="__codelineno-533-2" name="__codelineno-533-2" href="#__codelineno-533-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharLoading&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-533-3"><a id="__codelineno-533-3" name="__codelineno-533-3" href="#__codelineno-533-3"></a><span class="c1">-- Handle previous character cleanup</span>
</span><span id="__span-533-4"><a id="__codelineno-533-4" name="__codelineno-533-4" href="#__codelineno-533-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-5"><a id="__codelineno-533-5" name="__codelineno-533-5" href="#__codelineno-533-5"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSwitch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-533-6"><a id="__codelineno-533-6" name="__codelineno-533-6" href="#__codelineno-533-6"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;switchPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-533-7"><a id="__codelineno-533-7" name="__codelineno-533-7" href="#__codelineno-533-7"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;switchHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-533-8"><a id="__codelineno-533-8" name="__codelineno-533-8" href="#__codelineno-533-8"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;switchArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-533-9"><a id="__codelineno-533-9" name="__codelineno-533-9" href="#__codelineno-533-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-533-10"><a id="__codelineno-533-10" name="__codelineno-533-10" href="#__codelineno-533-10"></a><span class="c1">-- Set up new character</span>
</span><span id="__span-533-11"><a id="__codelineno-533-11" name="__codelineno-533-11" href="#__codelineno-533-11"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-533-12"><a id="__codelineno-533-12" name="__codelineno-533-12" href="#__codelineno-533-12"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-533-13"><a id="__codelineno-533-13" name="__codelineno-533-13" href="#__codelineno-533-13"></a><span class="c1">-- Apply faction bonuses</span>
</span><span id="__span-533-14"><a id="__codelineno-533-14" name="__codelineno-533-14" href="#__codelineno-533-14"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-533-15"><a id="__codelineno-533-15" name="__codelineno-533-15" href="#__codelineno-533-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-533-16"><a id="__codelineno-533-16" name="__codelineno-533-16" href="#__codelineno-533-16"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-533-17"><a id="__codelineno-533-17" name="__codelineno-533-17" href="#__codelineno-533-17"></a><span class="nv">authority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-533-18"><a id="__codelineno-533-18" name="__codelineno-533-18" href="#__codelineno-533-18"></a><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-533-19"><a id="__codelineno-533-19" name="__codelineno-533-19" href="#__codelineno-533-19"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;police_badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;handcuffs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;radio&quot;</span><span class="p">}</span>
</span><span id="__span-533-20"><a id="__codelineno-533-20" name="__codelineno-533-20" href="#__codelineno-533-20"></a><span class="p">},</span>
</span><span id="__span-533-21"><a id="__codelineno-533-21" name="__codelineno-533-21" href="#__codelineno-533-21"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-533-22"><a id="__codelineno-533-22" name="__codelineno-533-22" href="#__codelineno-533-22"></a><span class="nv">healingBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="__span-533-23"><a id="__codelineno-533-23" name="__codelineno-533-23" href="#__codelineno-533-23"></a><span class="nv">medicalKnowledge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-533-24"><a id="__codelineno-533-24" name="__codelineno-533-24" href="#__codelineno-533-24"></a><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
</span><span id="__span-533-25"><a id="__codelineno-533-25" name="__codelineno-533-25" href="#__codelineno-533-25"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;medkit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stethoscope&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bandage&quot;</span><span class="p">}</span>
</span><span id="__span-533-26"><a id="__codelineno-533-26" name="__codelineno-533-26" href="#__codelineno-533-26"></a><span class="p">},</span>
</span><span id="__span-533-27"><a id="__codelineno-533-27" name="__codelineno-533-27" href="#__codelineno-533-27"></a><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-533-28"><a id="__codelineno-533-28" name="__codelineno-533-28" href="#__codelineno-533-28"></a><span class="nv">authority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-533-29"><a id="__codelineno-533-29" name="__codelineno-533-29" href="#__codelineno-533-29"></a><span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
</span><span id="__span-533-30"><a id="__codelineno-533-30" name="__codelineno-533-30" href="#__codelineno-533-30"></a><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;wallet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="p">}</span>
</span><span id="__span-533-31"><a id="__codelineno-533-31" name="__codelineno-533-31" href="#__codelineno-533-31"></a><span class="p">}</span>
</span><span id="__span-533-32"><a id="__codelineno-533-32" name="__codelineno-533-32" href="#__codelineno-533-32"></a><span class="p">}</span>
</span><span id="__span-533-33"><a id="__codelineno-533-33" name="__codelineno-533-33" href="#__codelineno-533-33"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionBonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-533-34"><a id="__codelineno-533-34" name="__codelineno-533-34" href="#__codelineno-533-34"></a><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-35"><a id="__codelineno-533-35" name="__codelineno-533-35" href="#__codelineno-533-35"></a><span class="w">    </span><span class="c1">-- Apply stat bonuses</span>
</span><span id="__span-533-36"><a id="__codelineno-533-36" name="__codelineno-533-36" href="#__codelineno-533-36"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-533-37"><a id="__codelineno-533-37" name="__codelineno-533-37" href="#__codelineno-533-37"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">stat</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;items&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-38"><a id="__codelineno-533-38" name="__codelineno-533-38" href="#__codelineno-533-38"></a><span class="w">            </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="nv">stat</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-533-39"><a id="__codelineno-533-39" name="__codelineno-533-39" href="#__codelineno-533-39"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-533-40"><a id="__codelineno-533-40" name="__codelineno-533-40" href="#__codelineno-533-40"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-533-41"><a id="__codelineno-533-41" name="__codelineno-533-41" href="#__codelineno-533-41"></a><span class="w">    </span><span class="c1">-- Give faction items</span>
</span><span id="__span-533-42"><a id="__codelineno-533-42" name="__codelineno-533-42" href="#__codelineno-533-42"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-43"><a id="__codelineno-533-43" name="__codelineno-533-43" href="#__codelineno-533-43"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-533-44"><a id="__codelineno-533-44" name="__codelineno-533-44" href="#__codelineno-533-44"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bonuses</span><span class="p">.</span><span class="py">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-533-45"><a id="__codelineno-533-45" name="__codelineno-533-45" href="#__codelineno-533-45"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-533-46"><a id="__codelineno-533-46" name="__codelineno-533-46" href="#__codelineno-533-46"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-47"><a id="__codelineno-533-47" name="__codelineno-533-47" href="#__codelineno-533-47"></a><span class="w">                </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-533-48"><a id="__codelineno-533-48" name="__codelineno-533-48" href="#__codelineno-533-48"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-533-49"><a id="__codelineno-533-49" name="__codelineno-533-49" href="#__codelineno-533-49"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-533-50"><a id="__codelineno-533-50" name="__codelineno-533-50" href="#__codelineno-533-50"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-533-51"><a id="__codelineno-533-51" name="__codelineno-533-51" href="#__codelineno-533-51"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-533-52"><a id="__codelineno-533-52" name="__codelineno-533-52" href="#__codelineno-533-52"></a><span class="c1">-- Check for returning player bonuses</span>
</span><span id="__span-533-53"><a id="__codelineno-533-53" name="__codelineno-533-53" href="#__codelineno-533-53"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-533-54"><a id="__codelineno-533-54" name="__codelineno-533-54" href="#__codelineno-533-54"></a><span class="kd">local</span><span class="w"> </span><span class="nv">timeSinceLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastLoad</span>
</span><span id="__span-533-55"><a id="__codelineno-533-55" name="__codelineno-533-55" href="#__codelineno-533-55"></a><span class="kr">if</span><span class="w"> </span><span class="nv">timeSinceLoad</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">86400</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="c1">-- 24 hours</span>
</span><span id="__span-533-56"><a id="__codelineno-533-56" name="__codelineno-533-56" href="#__codelineno-533-56"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;returningPlayerBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-533-57"><a id="__codelineno-533-57" name="__codelineno-533-57" href="#__codelineno-533-57"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Welcome back! You have a returning player bonus.&quot;</span><span class="p">)</span>
</span><span id="__span-533-58"><a id="__codelineno-533-58" name="__codelineno-533-58" href="#__codelineno-533-58"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-533-59"><a id="__codelineno-533-59" name="__codelineno-533-59" href="#__codelineno-533-59"></a><span class="c1">-- Update character appearance</span>
</span><span id="__span-533-60"><a id="__codelineno-533-60" name="__codelineno-533-60" href="#__codelineno-533-60"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-533-61"><a id="__codelineno-533-61" name="__codelineno-533-61" href="#__codelineno-533-61"></a><span class="c1">-- Notify other players</span>
</span><span id="__span-533-62"><a id="__codelineno-533-62" name="__codelineno-533-62" href="#__codelineno-533-62"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-533-63"><a id="__codelineno-533-63" name="__codelineno-533-63" href="#__codelineno-533-63"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-533-64"><a id="__codelineno-533-64" name="__codelineno-533-64" href="#__codelineno-533-64"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is now playing as &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-533-65"><a id="__codelineno-533-65" name="__codelineno-533-65" href="#__codelineno-533-65"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-533-66"><a id="__codelineno-533-66" name="__codelineno-533-66" href="#__codelineno-533-66"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-533-67"><a id="__codelineno-533-67" name="__codelineno-533-67" href="#__codelineno-533-67"></a><span class="c1">-- Log character load</span>
</span><span id="__span-533-68"><a id="__codelineno-533-68" name="__codelineno-533-68" href="#__codelineno-533-68"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;%s loaded character %s (Faction: %s)&quot;</span><span class="p">,</span>
</span><span id="__span-533-69"><a id="__codelineno-533-69" name="__codelineno-533-69" href="#__codelineno-533-69"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">))</span>
</span><span id="__span-533-70"><a id="__codelineno-533-70" name="__codelineno-533-70" href="#__codelineno-533-70"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playermessagesend">PlayerMessageSend</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player sends a message</p>
<p><strong>When Called</strong></p>
<p>When a chat message is being sent</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>speaker</code> (<em>Player</em>): The player sending the message</li>
<li><code>chatType</code> (<em>string</em>): The type of chat</li>
<li><code>text</code> (<em>string</em>): The message text</li>
<li><code>anonymous</code> (<em>boolean</em>): Whether the message is anonymous</li>
<li><code>receivers</code> (<em>table</em>): The players receiving the message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-534-1"><a id="__codelineno-534-1" name="__codelineno-534-1" href="#__codelineno-534-1"></a><span class="c1">-- Simple: Log messages</span>
</span><span id="__span-534-2"><a id="__codelineno-534-2" name="__codelineno-534-2" href="#__codelineno-534-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMessageSend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">text</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">,</span><span class="w"> </span><span class="nv">receivers</span><span class="p">)</span>
</span><span id="__span-534-3"><a id="__codelineno-534-3" name="__codelineno-534-3" href="#__codelineno-534-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">speaker</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; sent: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">text</span><span class="p">)</span>
</span><span id="__span-534-4"><a id="__codelineno-534-4" name="__codelineno-534-4" href="#__codelineno-534-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-535-1"><a id="__codelineno-535-1" name="__codelineno-535-1" href="#__codelineno-535-1"></a><span class="c1">-- Medium: Filter inappropriate messages</span>
</span><span id="__span-535-2"><a id="__codelineno-535-2" name="__codelineno-535-2" href="#__codelineno-535-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMessageSend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FilterMessages&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">text</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">,</span><span class="w"> </span><span class="nv">receivers</span><span class="p">)</span>
</span><span id="__span-535-3"><a id="__codelineno-535-3" name="__codelineno-535-3" href="#__codelineno-535-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bannedWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hack&quot;</span><span class="p">}</span>
</span><span id="__span-535-4"><a id="__codelineno-535-4" name="__codelineno-535-4" href="#__codelineno-535-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bannedWords</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-535-5"><a id="__codelineno-535-5" name="__codelineno-535-5" href="#__codelineno-535-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">text</span><span class="p">),</span><span class="w"> </span><span class="nv">word</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-535-6"><a id="__codelineno-535-6" name="__codelineno-535-6" href="#__codelineno-535-6"></a><span class="w">        </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your message was blocked&quot;</span><span class="p">)</span>
</span><span id="__span-535-7"><a id="__codelineno-535-7" name="__codelineno-535-7" href="#__codelineno-535-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-535-8"><a id="__codelineno-535-8" name="__codelineno-535-8" href="#__codelineno-535-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-535-9"><a id="__codelineno-535-9" name="__codelineno-535-9" href="#__codelineno-535-9"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-535-10"><a id="__codelineno-535-10" name="__codelineno-535-10" href="#__codelineno-535-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-536-1"><a id="__codelineno-536-1" name="__codelineno-536-1" href="#__codelineno-536-1"></a><span class="c1">-- High: Complex message handling</span>
</span><span id="__span-536-2"><a id="__codelineno-536-2" name="__codelineno-536-2" href="#__codelineno-536-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMessageSend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedMessageHandling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">speaker</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">text</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">,</span><span class="w"> </span><span class="nv">receivers</span><span class="p">)</span>
</span><span id="__span-536-3"><a id="__codelineno-536-3" name="__codelineno-536-3" href="#__codelineno-536-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-536-4"><a id="__codelineno-536-4" name="__codelineno-536-4" href="#__codelineno-536-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-536-5"><a id="__codelineno-536-5" name="__codelineno-536-5" href="#__codelineno-536-5"></a><span class="w">    </span><span class="c1">-- Filter inappropriate content</span>
</span><span id="__span-536-6"><a id="__codelineno-536-6" name="__codelineno-536-6" href="#__codelineno-536-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bannedWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cheat&quot;</span><span class="p">}</span>
</span><span id="__span-536-7"><a id="__codelineno-536-7" name="__codelineno-536-7" href="#__codelineno-536-7"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bannedWords</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-536-8"><a id="__codelineno-536-8" name="__codelineno-536-8" href="#__codelineno-536-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nb">string.find</span><span class="p">(</span><span class="nb">string.lower</span><span class="p">(</span><span class="nv">text</span><span class="p">),</span><span class="w"> </span><span class="nv">word</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-536-9"><a id="__codelineno-536-9" name="__codelineno-536-9" href="#__codelineno-536-9"></a><span class="w">            </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your message was blocked for inappropriate content&quot;</span><span class="p">)</span>
</span><span id="__span-536-10"><a id="__codelineno-536-10" name="__codelineno-536-10" href="#__codelineno-536-10"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-536-11"><a id="__codelineno-536-11" name="__codelineno-536-11" href="#__codelineno-536-11"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-536-12"><a id="__codelineno-536-12" name="__codelineno-536-12" href="#__codelineno-536-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-536-13"><a id="__codelineno-536-13" name="__codelineno-536-13" href="#__codelineno-536-13"></a><span class="w">    </span><span class="c1">-- Check spam protection</span>
</span><span id="__span-536-14"><a id="__codelineno-536-14" name="__codelineno-536-14" href="#__codelineno-536-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastMessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-536-15"><a id="__codelineno-536-15" name="__codelineno-536-15" href="#__codelineno-536-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastMessage</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-536-16"><a id="__codelineno-536-16" name="__codelineno-536-16" href="#__codelineno-536-16"></a><span class="w">        </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before sending another message&quot;</span><span class="p">)</span>
</span><span id="__span-536-17"><a id="__codelineno-536-17" name="__codelineno-536-17" href="#__codelineno-536-17"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-536-18"><a id="__codelineno-536-18" name="__codelineno-536-18" href="#__codelineno-536-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-536-19"><a id="__codelineno-536-19" name="__codelineno-536-19" href="#__codelineno-536-19"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastMessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-536-20"><a id="__codelineno-536-20" name="__codelineno-536-20" href="#__codelineno-536-20"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-536-21"><a id="__codelineno-536-21" name="__codelineno-536-21" href="#__codelineno-536-21"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO chat_logs (timestamp, steamid, chattype, message) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-536-22"><a id="__codelineno-536-22" name="__codelineno-536-22" href="#__codelineno-536-22"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">speaker</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">text</span><span class="p">)</span>
</span><span id="__span-536-23"><a id="__codelineno-536-23" name="__codelineno-536-23" href="#__codelineno-536-23"></a><span class="w">    </span><span class="c1">-- Track message count</span>
</span><span id="__span-536-24"><a id="__codelineno-536-24" name="__codelineno-536-24" href="#__codelineno-536-24"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-536-25"><a id="__codelineno-536-25" name="__codelineno-536-25" href="#__codelineno-536-25"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-536-26"><a id="__codelineno-536-26" name="__codelineno-536-26" href="#__codelineno-536-26"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playermodelchanged">PlayerModelChanged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player's model changes</p>
<p><strong>When Called</strong></p>
<p>When a player's character model is changed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player whose model changed</li>
<li><code>value</code> (<em>string</em>): The new model path</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-537-1"><a id="__codelineno-537-1" name="__codelineno-537-1" href="#__codelineno-537-1"></a><span class="c1">-- Simple: Log model change</span>
</span><span id="__span-537-2"><a id="__codelineno-537-2" name="__codelineno-537-2" href="#__codelineno-537-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerModelChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-537-3"><a id="__codelineno-537-3" name="__codelineno-537-3" href="#__codelineno-537-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; model changed to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-537-4"><a id="__codelineno-537-4" name="__codelineno-537-4" href="#__codelineno-537-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-538-1"><a id="__codelineno-538-1" name="__codelineno-538-1" href="#__codelineno-538-1"></a><span class="c1">-- Medium: Track model changes</span>
</span><span id="__span-538-2"><a id="__codelineno-538-2" name="__codelineno-538-2" href="#__codelineno-538-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerModelChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackModelChanges&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-538-3"><a id="__codelineno-538-3" name="__codelineno-538-3" href="#__codelineno-538-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-538-4"><a id="__codelineno-538-4" name="__codelineno-538-4" href="#__codelineno-538-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-538-5"><a id="__codelineno-538-5" name="__codelineno-538-5" href="#__codelineno-538-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">modelHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;modelHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-538-6"><a id="__codelineno-538-6" name="__codelineno-538-6" href="#__codelineno-538-6"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">modelHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-538-7"><a id="__codelineno-538-7" name="__codelineno-538-7" href="#__codelineno-538-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;modelHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">modelHistory</span><span class="p">)</span>
</span><span id="__span-538-8"><a id="__codelineno-538-8" name="__codelineno-538-8" href="#__codelineno-538-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-538-9"><a id="__codelineno-538-9" name="__codelineno-538-9" href="#__codelineno-538-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-539-1"><a id="__codelineno-539-1" name="__codelineno-539-1" href="#__codelineno-539-1"></a><span class="c1">-- High: Complex model change tracking</span>
</span><span id="__span-539-2"><a id="__codelineno-539-2" name="__codelineno-539-2" href="#__codelineno-539-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerModelChanged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedModelTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-539-3"><a id="__codelineno-539-3" name="__codelineno-539-3" href="#__codelineno-539-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-539-4"><a id="__codelineno-539-4" name="__codelineno-539-4" href="#__codelineno-539-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-539-5"><a id="__codelineno-539-5" name="__codelineno-539-5" href="#__codelineno-539-5"></a><span class="w">    </span><span class="c1">-- Track model history</span>
</span><span id="__span-539-6"><a id="__codelineno-539-6" name="__codelineno-539-6" href="#__codelineno-539-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">modelHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;modelHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-539-7"><a id="__codelineno-539-7" name="__codelineno-539-7" href="#__codelineno-539-7"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">modelHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-539-8"><a id="__codelineno-539-8" name="__codelineno-539-8" href="#__codelineno-539-8"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;modelHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">modelHistory</span><span class="p">)</span>
</span><span id="__span-539-9"><a id="__codelineno-539-9" name="__codelineno-539-9" href="#__codelineno-539-9"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-539-10"><a id="__codelineno-539-10" name="__codelineno-539-10" href="#__codelineno-539-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO model_logs (timestamp, charid, model) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-539-11"><a id="__codelineno-539-11" name="__codelineno-539-11" href="#__codelineno-539-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-539-12"><a id="__codelineno-539-12" name="__codelineno-539-12" href="#__codelineno-539-12"></a><span class="w">    </span><span class="c1">-- Apply model-specific effects</span>
</span><span id="__span-539-13"><a id="__codelineno-539-13" name="__codelineno-539-13" href="#__codelineno-539-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;GetModelGender&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;male&quot;</span>
</span><span id="__span-539-14"><a id="__codelineno-539-14" name="__codelineno-539-14" href="#__codelineno-539-14"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">gender</span><span class="p">)</span>
</span><span id="__span-539-15"><a id="__codelineno-539-15" name="__codelineno-539-15" href="#__codelineno-539-15"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-539-16"><a id="__codelineno-539-16" name="__codelineno-539-16" href="#__codelineno-539-16"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-539-17"><a id="__codelineno-539-17" name="__codelineno-539-17" href="#__codelineno-539-17"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-539-18"><a id="__codelineno-539-18" name="__codelineno-539-18" href="#__codelineno-539-18"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; changed their appearance&quot;</span><span class="p">)</span>
</span><span id="__span-539-19"><a id="__codelineno-539-19" name="__codelineno-539-19" href="#__codelineno-539-19"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-539-20"><a id="__codelineno-539-20" name="__codelineno-539-20" href="#__codelineno-539-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-539-21"><a id="__codelineno-539-21" name="__codelineno-539-21" href="#__codelineno-539-21"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playermuted">PlayerMuted</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is muted</p>
<p><strong>When Called</strong></p>
<p>When a player's chat is disabled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player being muted</li>
<li><code>admin</code> (<em>Player</em>): The admin issuing the mute</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-540-1"><a id="__codelineno-540-1" name="__codelineno-540-1" href="#__codelineno-540-1"></a><span class="c1">-- Simple: Log mute</span>
</span><span id="__span-540-2"><a id="__codelineno-540-2" name="__codelineno-540-2" href="#__codelineno-540-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-540-3"><a id="__codelineno-540-3" name="__codelineno-540-3" href="#__codelineno-540-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was muted by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-540-4"><a id="__codelineno-540-4" name="__codelineno-540-4" href="#__codelineno-540-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-541-1"><a id="__codelineno-541-1" name="__codelineno-541-1" href="#__codelineno-541-1"></a><span class="c1">-- Medium: Track mute history</span>
</span><span id="__span-541-2"><a id="__codelineno-541-2" name="__codelineno-541-2" href="#__codelineno-541-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackMuteHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-541-3"><a id="__codelineno-541-3" name="__codelineno-541-3" href="#__codelineno-541-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-541-4"><a id="__codelineno-541-4" name="__codelineno-541-4" href="#__codelineno-541-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-541-5"><a id="__codelineno-541-5" name="__codelineno-541-5" href="#__codelineno-541-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">muteHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;muteHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-541-6"><a id="__codelineno-541-6" name="__codelineno-541-6" href="#__codelineno-541-6"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">muteHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()})</span>
</span><span id="__span-541-7"><a id="__codelineno-541-7" name="__codelineno-541-7" href="#__codelineno-541-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;muteHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">muteHistory</span><span class="p">)</span>
</span><span id="__span-541-8"><a id="__codelineno-541-8" name="__codelineno-541-8" href="#__codelineno-541-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-541-9"><a id="__codelineno-541-9" name="__codelineno-541-9" href="#__codelineno-541-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-542-1"><a id="__codelineno-542-1" name="__codelineno-542-1" href="#__codelineno-542-1"></a><span class="c1">-- High: Complex mute management</span>
</span><span id="__span-542-2"><a id="__codelineno-542-2" name="__codelineno-542-2" href="#__codelineno-542-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerMuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedMuteManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-542-3"><a id="__codelineno-542-3" name="__codelineno-542-3" href="#__codelineno-542-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-542-4"><a id="__codelineno-542-4" name="__codelineno-542-4" href="#__codelineno-542-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-542-5"><a id="__codelineno-542-5" name="__codelineno-542-5" href="#__codelineno-542-5"></a><span class="w">    </span><span class="c1">-- Track mute history</span>
</span><span id="__span-542-6"><a id="__codelineno-542-6" name="__codelineno-542-6" href="#__codelineno-542-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">muteHistory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;muteHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-542-7"><a id="__codelineno-542-7" name="__codelineno-542-7" href="#__codelineno-542-7"></a><span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">muteHistory</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-542-8"><a id="__codelineno-542-8" name="__codelineno-542-8" href="#__codelineno-542-8"></a><span class="w">    </span><span class="nv">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-542-9"><a id="__codelineno-542-9" name="__codelineno-542-9" href="#__codelineno-542-9"></a><span class="w">    </span><span class="nv">adminName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">(),</span>
</span><span id="__span-542-10"><a id="__codelineno-542-10" name="__codelineno-542-10" href="#__codelineno-542-10"></a><span class="w">    </span><span class="nv">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-542-11"><a id="__codelineno-542-11" name="__codelineno-542-11" href="#__codelineno-542-11"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-542-12"><a id="__codelineno-542-12" name="__codelineno-542-12" href="#__codelineno-542-12"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;muteHistory&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">muteHistory</span><span class="p">)</span>
</span><span id="__span-542-13"><a id="__codelineno-542-13" name="__codelineno-542-13" href="#__codelineno-542-13"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-542-14"><a id="__codelineno-542-14" name="__codelineno-542-14" href="#__codelineno-542-14"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO mute_logs (timestamp, target_steamid, admin_steamid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-542-15"><a id="__codelineno-542-15" name="__codelineno-542-15" href="#__codelineno-542-15"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-542-16"><a id="__codelineno-542-16" name="__codelineno-542-16" href="#__codelineno-542-16"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-542-17"><a id="__codelineno-542-17" name="__codelineno-542-17" href="#__codelineno-542-17"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been muted by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-542-18"><a id="__codelineno-542-18" name="__codelineno-542-18" href="#__codelineno-542-18"></a><span class="w">    </span><span class="c1">-- Notify other admins</span>
</span><span id="__span-542-19"><a id="__codelineno-542-19" name="__codelineno-542-19" href="#__codelineno-542-19"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-542-20"><a id="__codelineno-542-20" name="__codelineno-542-20" href="#__codelineno-542-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-542-21"><a id="__codelineno-542-21" name="__codelineno-542-21" href="#__codelineno-542-21"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; muted &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-542-22"><a id="__codelineno-542-22" name="__codelineno-542-22" href="#__codelineno-542-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-542-23"><a id="__codelineno-542-23" name="__codelineno-542-23" href="#__codelineno-542-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-542-24"><a id="__codelineno-542-24" name="__codelineno-542-24" href="#__codelineno-542-24"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playershouldact">PlayerShouldAct</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player should perform an action</p>
<p><strong>When Called</strong></p>
<p>When validating player actions</p>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-543-1"><a id="__codelineno-543-1" name="__codelineno-543-1" href="#__codelineno-543-1"></a><span class="c1">-- Simple: Always allow</span>
</span><span id="__span-543-2"><a id="__codelineno-543-2" name="__codelineno-543-2" href="#__codelineno-543-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldAct&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-543-3"><a id="__codelineno-543-3" name="__codelineno-543-3" href="#__codelineno-543-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-543-4"><a id="__codelineno-543-4" name="__codelineno-543-4" href="#__codelineno-543-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-544-1"><a id="__codelineno-544-1" name="__codelineno-544-1" href="#__codelineno-544-1"></a><span class="c1">-- Medium: Check player state</span>
</span><span id="__span-544-2"><a id="__codelineno-544-2" name="__codelineno-544-2" href="#__codelineno-544-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldAct&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CheckPlayerState&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-544-3"><a id="__codelineno-544-3" name="__codelineno-544-3" href="#__codelineno-544-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">()</span>
</span><span id="__span-544-4"><a id="__codelineno-544-4" name="__codelineno-544-4" href="#__codelineno-544-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-544-5"><a id="__codelineno-544-5" name="__codelineno-544-5" href="#__codelineno-544-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-544-6"><a id="__codelineno-544-6" name="__codelineno-544-6" href="#__codelineno-544-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-544-7"><a id="__codelineno-544-7" name="__codelineno-544-7" href="#__codelineno-544-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-545-1"><a id="__codelineno-545-1" name="__codelineno-545-1" href="#__codelineno-545-1"></a><span class="c1">-- High: Complex action validation</span>
</span><span id="__span-545-2"><a id="__codelineno-545-2" name="__codelineno-545-2" href="#__codelineno-545-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldAct&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedActionValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-545-3"><a id="__codelineno-545-3" name="__codelineno-545-3" href="#__codelineno-545-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">()</span>
</span><span id="__span-545-4"><a id="__codelineno-545-4" name="__codelineno-545-4" href="#__codelineno-545-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-545-5"><a id="__codelineno-545-5" name="__codelineno-545-5" href="#__codelineno-545-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-545-6"><a id="__codelineno-545-6" name="__codelineno-545-6" href="#__codelineno-545-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-545-7"><a id="__codelineno-545-7" name="__codelineno-545-7" href="#__codelineno-545-7"></a><span class="w">        </span><span class="c1">-- Check if player is tied</span>
</span><span id="__span-545-8"><a id="__codelineno-545-8" name="__codelineno-545-8" href="#__codelineno-545-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;tied&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-545-9"><a id="__codelineno-545-9" name="__codelineno-545-9" href="#__codelineno-545-9"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-545-10"><a id="__codelineno-545-10" name="__codelineno-545-10" href="#__codelineno-545-10"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-545-11"><a id="__codelineno-545-11" name="__codelineno-545-11" href="#__codelineno-545-11"></a><span class="w">        </span><span class="c1">-- Check if player is stunned</span>
</span><span id="__span-545-12"><a id="__codelineno-545-12" name="__codelineno-545-12" href="#__codelineno-545-12"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;stunned&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-545-13"><a id="__codelineno-545-13" name="__codelineno-545-13" href="#__codelineno-545-13"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-545-14"><a id="__codelineno-545-14" name="__codelineno-545-14" href="#__codelineno-545-14"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-545-15"><a id="__codelineno-545-15" name="__codelineno-545-15" href="#__codelineno-545-15"></a><span class="w">        </span><span class="c1">-- Check if player is in cutscene</span>
</span><span id="__span-545-16"><a id="__codelineno-545-16" name="__codelineno-545-16" href="#__codelineno-545-16"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;inCutscene&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-545-17"><a id="__codelineno-545-17" name="__codelineno-545-17" href="#__codelineno-545-17"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-545-18"><a id="__codelineno-545-18" name="__codelineno-545-18" href="#__codelineno-545-18"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-545-19"><a id="__codelineno-545-19" name="__codelineno-545-19" href="#__codelineno-545-19"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-545-20"><a id="__codelineno-545-20" name="__codelineno-545-20" href="#__codelineno-545-20"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playershouldpermakill">PlayerShouldPermaKill</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if a player should be permakilled</p>
<p><strong>When Called</strong></p>
<p>When a player dies and permakill is being considered</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The dying player</li>
<li><code>inflictor</code> (<em>Entity</em>): The entity that caused death</li>
<li><code>attacker</code> (<em>Entity</em>): The attacker</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to permakill, false otherwise</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-546-1"><a id="__codelineno-546-1" name="__codelineno-546-1" href="#__codelineno-546-1"></a><span class="c1">-- Simple: Never permakill</span>
</span><span id="__span-546-2"><a id="__codelineno-546-2" name="__codelineno-546-2" href="#__codelineno-546-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldPermaKill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">inflictor</span><span class="p">,</span><span class="w"> </span><span class="nv">attacker</span><span class="p">)</span>
</span><span id="__span-546-3"><a id="__codelineno-546-3" name="__codelineno-546-3" href="#__codelineno-546-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-546-4"><a id="__codelineno-546-4" name="__codelineno-546-4" href="#__codelineno-546-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-547-1"><a id="__codelineno-547-1" name="__codelineno-547-1" href="#__codelineno-547-1"></a><span class="c1">-- Medium: Permakill on admin command</span>
</span><span id="__span-547-2"><a id="__codelineno-547-2" name="__codelineno-547-2" href="#__codelineno-547-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldPermaKill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdminPermakill&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">inflictor</span><span class="p">,</span><span class="w"> </span><span class="nv">attacker</span><span class="p">)</span>
</span><span id="__span-547-3"><a id="__codelineno-547-3" name="__codelineno-547-3" href="#__codelineno-547-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-547-4"><a id="__codelineno-547-4" name="__codelineno-547-4" href="#__codelineno-547-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;markedForPK&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-547-5"><a id="__codelineno-547-5" name="__codelineno-547-5" href="#__codelineno-547-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-547-6"><a id="__codelineno-547-6" name="__codelineno-547-6" href="#__codelineno-547-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-547-7"><a id="__codelineno-547-7" name="__codelineno-547-7" href="#__codelineno-547-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-547-8"><a id="__codelineno-547-8" name="__codelineno-547-8" href="#__codelineno-547-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-548-1"><a id="__codelineno-548-1" name="__codelineno-548-1" href="#__codelineno-548-1"></a><span class="c1">-- High: Complex permakill system</span>
</span><span id="__span-548-2"><a id="__codelineno-548-2" name="__codelineno-548-2" href="#__codelineno-548-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldPermaKill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPermakill&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">inflictor</span><span class="p">,</span><span class="w"> </span><span class="nv">attacker</span><span class="p">)</span>
</span><span id="__span-548-3"><a id="__codelineno-548-3" name="__codelineno-548-3" href="#__codelineno-548-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-548-4"><a id="__codelineno-548-4" name="__codelineno-548-4" href="#__codelineno-548-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-548-5"><a id="__codelineno-548-5" name="__codelineno-548-5" href="#__codelineno-548-5"></a><span class="w">    </span><span class="c1">-- Check if marked for PK</span>
</span><span id="__span-548-6"><a id="__codelineno-548-6" name="__codelineno-548-6" href="#__codelineno-548-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;markedForPK&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-548-7"><a id="__codelineno-548-7" name="__codelineno-548-7" href="#__codelineno-548-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-548-8"><a id="__codelineno-548-8" name="__codelineno-548-8" href="#__codelineno-548-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-548-9"><a id="__codelineno-548-9" name="__codelineno-548-9" href="#__codelineno-548-9"></a><span class="w">    </span><span class="c1">-- Check faction-specific rules</span>
</span><span id="__span-548-10"><a id="__codelineno-548-10" name="__codelineno-548-10" href="#__codelineno-548-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-548-11"><a id="__codelineno-548-11" name="__codelineno-548-11" href="#__codelineno-548-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-548-12"><a id="__codelineno-548-12" name="__codelineno-548-12" href="#__codelineno-548-12"></a><span class="w">        </span><span class="c1">-- Police can only be PKed by admins</span>
</span><span id="__span-548-13"><a id="__codelineno-548-13" name="__codelineno-548-13" href="#__codelineno-548-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">attacker</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attacker</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attacker</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-548-14"><a id="__codelineno-548-14" name="__codelineno-548-14" href="#__codelineno-548-14"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-548-15"><a id="__codelineno-548-15" name="__codelineno-548-15" href="#__codelineno-548-15"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-548-16"><a id="__codelineno-548-16" name="__codelineno-548-16" href="#__codelineno-548-16"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-548-17"><a id="__codelineno-548-17" name="__codelineno-548-17" href="#__codelineno-548-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-548-18"><a id="__codelineno-548-18" name="__codelineno-548-18" href="#__codelineno-548-18"></a><span class="w">    </span><span class="c1">-- Check death count</span>
</span><span id="__span-548-19"><a id="__codelineno-548-19" name="__codelineno-548-19" href="#__codelineno-548-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">deathCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;deathCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-548-20"><a id="__codelineno-548-20" name="__codelineno-548-20" href="#__codelineno-548-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">deathCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-548-21"><a id="__codelineno-548-21" name="__codelineno-548-21" href="#__codelineno-548-21"></a><span class="w">        </span><span class="c1">-- Too many deaths, permakill</span>
</span><span id="__span-548-22"><a id="__codelineno-548-22" name="__codelineno-548-22" href="#__codelineno-548-22"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-548-23"><a id="__codelineno-548-23" name="__codelineno-548-23" href="#__codelineno-548-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-548-24"><a id="__codelineno-548-24" name="__codelineno-548-24" href="#__codelineno-548-24"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-548-25"><a id="__codelineno-548-25" name="__codelineno-548-25" href="#__codelineno-548-25"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerspawnpointselected">PlayerSpawnPointSelected</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player spawn point is selected</p>
<p><strong>When Called</strong></p>
<p>When determining where a player should spawn</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player spawning</li>
<li><code>pos</code> (<em>Vector</em>): The spawn position</li>
<li><code>ang</code> (<em>Angle</em>): The spawn angle</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-549-1"><a id="__codelineno-549-1" name="__codelineno-549-1" href="#__codelineno-549-1"></a><span class="c1">-- Simple: Log spawn point</span>
</span><span id="__span-549-2"><a id="__codelineno-549-2" name="__codelineno-549-2" href="#__codelineno-549-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawnPointSelected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">)</span>
</span><span id="__span-549-3"><a id="__codelineno-549-3" name="__codelineno-549-3" href="#__codelineno-549-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; spawning at &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">pos</span><span class="p">))</span>
</span><span id="__span-549-4"><a id="__codelineno-549-4" name="__codelineno-549-4" href="#__codelineno-549-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-550-1"><a id="__codelineno-550-1" name="__codelineno-550-1" href="#__codelineno-550-1"></a><span class="c1">-- Medium: Track spawn locations</span>
</span><span id="__span-550-2"><a id="__codelineno-550-2" name="__codelineno-550-2" href="#__codelineno-550-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawnPointSelected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackSpawnLocations&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">)</span>
</span><span id="__span-550-3"><a id="__codelineno-550-3" name="__codelineno-550-3" href="#__codelineno-550-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-550-4"><a id="__codelineno-550-4" name="__codelineno-550-4" href="#__codelineno-550-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-550-5"><a id="__codelineno-550-5" name="__codelineno-550-5" href="#__codelineno-550-5"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSpawnPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">)</span>
</span><span id="__span-550-6"><a id="__codelineno-550-6" name="__codelineno-550-6" href="#__codelineno-550-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSpawnAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">)</span>
</span><span id="__span-550-7"><a id="__codelineno-550-7" name="__codelineno-550-7" href="#__codelineno-550-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-550-8"><a id="__codelineno-550-8" name="__codelineno-550-8" href="#__codelineno-550-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-551-1"><a id="__codelineno-551-1" name="__codelineno-551-1" href="#__codelineno-551-1"></a><span class="c1">-- High: Complex spawn tracking</span>
</span><span id="__span-551-2"><a id="__codelineno-551-2" name="__codelineno-551-2" href="#__codelineno-551-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawnPointSelected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSpawnTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">)</span>
</span><span id="__span-551-3"><a id="__codelineno-551-3" name="__codelineno-551-3" href="#__codelineno-551-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-551-4"><a id="__codelineno-551-4" name="__codelineno-551-4" href="#__codelineno-551-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-551-5"><a id="__codelineno-551-5" name="__codelineno-551-5" href="#__codelineno-551-5"></a><span class="w">    </span><span class="c1">-- Track spawn location</span>
</span><span id="__span-551-6"><a id="__codelineno-551-6" name="__codelineno-551-6" href="#__codelineno-551-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSpawnPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">)</span>
</span><span id="__span-551-7"><a id="__codelineno-551-7" name="__codelineno-551-7" href="#__codelineno-551-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSpawnAng&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">)</span>
</span><span id="__span-551-8"><a id="__codelineno-551-8" name="__codelineno-551-8" href="#__codelineno-551-8"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastSpawnTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-551-9"><a id="__codelineno-551-9" name="__codelineno-551-9" href="#__codelineno-551-9"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-551-10"><a id="__codelineno-551-10" name="__codelineno-551-10" href="#__codelineno-551-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO spawn_logs (timestamp, charid, x, y, z) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-551-11"><a id="__codelineno-551-11" name="__codelineno-551-11" href="#__codelineno-551-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">pos</span><span class="p">.</span><span class="py">x</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">.</span><span class="py">y</span><span class="p">,</span><span class="w"> </span><span class="nv">pos</span><span class="p">.</span><span class="py">z</span><span class="p">)</span>
</span><span id="__span-551-12"><a id="__codelineno-551-12" name="__codelineno-551-12" href="#__codelineno-551-12"></a><span class="w">    </span><span class="c1">-- Track spawn count</span>
</span><span id="__span-551-13"><a id="__codelineno-551-13" name="__codelineno-551-13" href="#__codelineno-551-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">spawnCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;spawnCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-551-14"><a id="__codelineno-551-14" name="__codelineno-551-14" href="#__codelineno-551-14"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;spawnCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">spawnCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-551-15"><a id="__codelineno-551-15" name="__codelineno-551-15" href="#__codelineno-551-15"></a><span class="w">    </span><span class="c1">-- Apply spawn effects</span>
</span><span id="__span-551-16"><a id="__codelineno-551-16" name="__codelineno-551-16" href="#__codelineno-551-16"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-551-17"><a id="__codelineno-551-17" name="__codelineno-551-17" href="#__codelineno-551-17"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-551-18"><a id="__codelineno-551-18" name="__codelineno-551-18" href="#__codelineno-551-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerthrowpunch">PlayerThrowPunch</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player throws a punch</p>
<p><strong>When Called</strong></p>
<p>When a player uses their fists to attack</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player throwing the punch</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-552-1"><a id="__codelineno-552-1" name="__codelineno-552-1" href="#__codelineno-552-1"></a><span class="c1">-- Simple: Log punch</span>
</span><span id="__span-552-2"><a id="__codelineno-552-2" name="__codelineno-552-2" href="#__codelineno-552-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-552-3"><a id="__codelineno-552-3" name="__codelineno-552-3" href="#__codelineno-552-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; threw a punch&quot;</span><span class="p">)</span>
</span><span id="__span-552-4"><a id="__codelineno-552-4" name="__codelineno-552-4" href="#__codelineno-552-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-553-1"><a id="__codelineno-553-1" name="__codelineno-553-1" href="#__codelineno-553-1"></a><span class="c1">-- Medium: Track punch count</span>
</span><span id="__span-553-2"><a id="__codelineno-553-2" name="__codelineno-553-2" href="#__codelineno-553-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackPunches&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-553-3"><a id="__codelineno-553-3" name="__codelineno-553-3" href="#__codelineno-553-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-553-4"><a id="__codelineno-553-4" name="__codelineno-553-4" href="#__codelineno-553-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-553-5"><a id="__codelineno-553-5" name="__codelineno-553-5" href="#__codelineno-553-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">punchCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;punchCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-553-6"><a id="__codelineno-553-6" name="__codelineno-553-6" href="#__codelineno-553-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;punchCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">punchCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-553-7"><a id="__codelineno-553-7" name="__codelineno-553-7" href="#__codelineno-553-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-553-8"><a id="__codelineno-553-8" name="__codelineno-553-8" href="#__codelineno-553-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-554-1"><a id="__codelineno-554-1" name="__codelineno-554-1" href="#__codelineno-554-1"></a><span class="c1">-- High: Complex punch tracking system</span>
</span><span id="__span-554-2"><a id="__codelineno-554-2" name="__codelineno-554-2" href="#__codelineno-554-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerThrowPunch&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPunchTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-554-3"><a id="__codelineno-554-3" name="__codelineno-554-3" href="#__codelineno-554-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-554-4"><a id="__codelineno-554-4" name="__codelineno-554-4" href="#__codelineno-554-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-554-5"><a id="__codelineno-554-5" name="__codelineno-554-5" href="#__codelineno-554-5"></a><span class="w">    </span><span class="c1">-- Track punch count</span>
</span><span id="__span-554-6"><a id="__codelineno-554-6" name="__codelineno-554-6" href="#__codelineno-554-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">punchCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;punchCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-554-7"><a id="__codelineno-554-7" name="__codelineno-554-7" href="#__codelineno-554-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;punchCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">punchCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-554-8"><a id="__codelineno-554-8" name="__codelineno-554-8" href="#__codelineno-554-8"></a><span class="w">    </span><span class="c1">-- Drain stamina</span>
</span><span id="__span-554-9"><a id="__codelineno-554-9" name="__codelineno-554-9" href="#__codelineno-554-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-554-10"><a id="__codelineno-554-10" name="__codelineno-554-10" href="#__codelineno-554-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">stamina</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-554-11"><a id="__codelineno-554-11" name="__codelineno-554-11" href="#__codelineno-554-11"></a><span class="w">    </span><span class="c1">-- Check for achievements</span>
</span><span id="__span-554-12"><a id="__codelineno-554-12" name="__codelineno-554-12" href="#__codelineno-554-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">punchCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-554-13"><a id="__codelineno-554-13" name="__codelineno-554-13" href="#__codelineno-554-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_brawler&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-554-14"><a id="__codelineno-554-14" name="__codelineno-554-14" href="#__codelineno-554-14"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_brawler&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-554-15"><a id="__codelineno-554-15" name="__codelineno-554-15" href="#__codelineno-554-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Brawler!&quot;</span><span class="p">)</span>
</span><span id="__span-554-16"><a id="__codelineno-554-16" name="__codelineno-554-16" href="#__codelineno-554-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-554-17"><a id="__codelineno-554-17" name="__codelineno-554-17" href="#__codelineno-554-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-554-18"><a id="__codelineno-554-18" name="__codelineno-554-18" href="#__codelineno-554-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerungagged">PlayerUngagged</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is ungagged</p>
<p><strong>When Called</strong></p>
<p>When a player's voice chat is re-enabled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player being ungagged</li>
<li><code>admin</code> (<em>Player</em>): The admin removing the gag</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-555-1"><a id="__codelineno-555-1" name="__codelineno-555-1" href="#__codelineno-555-1"></a><span class="c1">-- Simple: Log ungag</span>
</span><span id="__span-555-2"><a id="__codelineno-555-2" name="__codelineno-555-2" href="#__codelineno-555-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUngagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-555-3"><a id="__codelineno-555-3" name="__codelineno-555-3" href="#__codelineno-555-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was ungagged by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-555-4"><a id="__codelineno-555-4" name="__codelineno-555-4" href="#__codelineno-555-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-556-1"><a id="__codelineno-556-1" name="__codelineno-556-1" href="#__codelineno-556-1"></a><span class="c1">-- Medium: Notify player</span>
</span><span id="__span-556-2"><a id="__codelineno-556-2" name="__codelineno-556-2" href="#__codelineno-556-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUngagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyUngag&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-556-3"><a id="__codelineno-556-3" name="__codelineno-556-3" href="#__codelineno-556-3"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been ungagged by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-556-4"><a id="__codelineno-556-4" name="__codelineno-556-4" href="#__codelineno-556-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-557-1"><a id="__codelineno-557-1" name="__codelineno-557-1" href="#__codelineno-557-1"></a><span class="c1">-- High: Complex ungag management</span>
</span><span id="__span-557-2"><a id="__codelineno-557-2" name="__codelineno-557-2" href="#__codelineno-557-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUngagged&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUngagManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-557-3"><a id="__codelineno-557-3" name="__codelineno-557-3" href="#__codelineno-557-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-557-4"><a id="__codelineno-557-4" name="__codelineno-557-4" href="#__codelineno-557-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ungag_logs (timestamp, target_steamid, admin_steamid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-557-5"><a id="__codelineno-557-5" name="__codelineno-557-5" href="#__codelineno-557-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-557-6"><a id="__codelineno-557-6" name="__codelineno-557-6" href="#__codelineno-557-6"></a><span class="c1">-- Notify player</span>
</span><span id="__span-557-7"><a id="__codelineno-557-7" name="__codelineno-557-7" href="#__codelineno-557-7"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been ungagged by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-557-8"><a id="__codelineno-557-8" name="__codelineno-557-8" href="#__codelineno-557-8"></a><span class="c1">-- Notify other admins</span>
</span><span id="__span-557-9"><a id="__codelineno-557-9" name="__codelineno-557-9" href="#__codelineno-557-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-557-10"><a id="__codelineno-557-10" name="__codelineno-557-10" href="#__codelineno-557-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-557-11"><a id="__codelineno-557-11" name="__codelineno-557-11" href="#__codelineno-557-11"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; ungagged &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-557-12"><a id="__codelineno-557-12" name="__codelineno-557-12" href="#__codelineno-557-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-557-13"><a id="__codelineno-557-13" name="__codelineno-557-13" href="#__codelineno-557-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-557-14"><a id="__codelineno-557-14" name="__codelineno-557-14" href="#__codelineno-557-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerunmuted">PlayerUnmuted</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player is unmuted</p>
<p><strong>When Called</strong></p>
<p>When a player's chat is re-enabled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>target</code> (<em>Player</em>): The player being unmuted</li>
<li><code>admin</code> (<em>Player</em>): The admin removing the mute</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-558-1"><a id="__codelineno-558-1" name="__codelineno-558-1" href="#__codelineno-558-1"></a><span class="c1">-- Simple: Log unmute</span>
</span><span id="__span-558-2"><a id="__codelineno-558-2" name="__codelineno-558-2" href="#__codelineno-558-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUnmuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-558-3"><a id="__codelineno-558-3" name="__codelineno-558-3" href="#__codelineno-558-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was unmuted by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-558-4"><a id="__codelineno-558-4" name="__codelineno-558-4" href="#__codelineno-558-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-559-1"><a id="__codelineno-559-1" name="__codelineno-559-1" href="#__codelineno-559-1"></a><span class="c1">-- Medium: Notify player</span>
</span><span id="__span-559-2"><a id="__codelineno-559-2" name="__codelineno-559-2" href="#__codelineno-559-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUnmuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyUnmute&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-559-3"><a id="__codelineno-559-3" name="__codelineno-559-3" href="#__codelineno-559-3"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been unmuted by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-559-4"><a id="__codelineno-559-4" name="__codelineno-559-4" href="#__codelineno-559-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-560-1"><a id="__codelineno-560-1" name="__codelineno-560-1" href="#__codelineno-560-1"></a><span class="c1">-- High: Complex unmute management</span>
</span><span id="__span-560-2"><a id="__codelineno-560-2" name="__codelineno-560-2" href="#__codelineno-560-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUnmuted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedUnmuteManagement&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">)</span>
</span><span id="__span-560-3"><a id="__codelineno-560-3" name="__codelineno-560-3" href="#__codelineno-560-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-560-4"><a id="__codelineno-560-4" name="__codelineno-560-4" href="#__codelineno-560-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO unmute_logs (timestamp, target_steamid, admin_steamid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-560-5"><a id="__codelineno-560-5" name="__codelineno-560-5" href="#__codelineno-560-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-560-6"><a id="__codelineno-560-6" name="__codelineno-560-6" href="#__codelineno-560-6"></a><span class="c1">-- Notify player</span>
</span><span id="__span-560-7"><a id="__codelineno-560-7" name="__codelineno-560-7" href="#__codelineno-560-7"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been unmuted by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-560-8"><a id="__codelineno-560-8" name="__codelineno-560-8" href="#__codelineno-560-8"></a><span class="c1">-- Notify other admins</span>
</span><span id="__span-560-9"><a id="__codelineno-560-9" name="__codelineno-560-9" href="#__codelineno-560-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-560-10"><a id="__codelineno-560-10" name="__codelineno-560-10" href="#__codelineno-560-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-560-11"><a id="__codelineno-560-11" name="__codelineno-560-11" href="#__codelineno-560-11"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; unmuted &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-560-12"><a id="__codelineno-560-12" name="__codelineno-560-12" href="#__codelineno-560-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-560-13"><a id="__codelineno-560-13" name="__codelineno-560-13" href="#__codelineno-560-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-560-14"><a id="__codelineno-560-14" name="__codelineno-560-14" href="#__codelineno-560-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="playerusedoor">PlayerUseDoor</h3>
<p><strong>Purpose</strong></p>
<p>Called when a player uses a door</p>
<p><strong>When Called</strong></p>
<p>When a player interacts with a door entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player using the door</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-561-1"><a id="__codelineno-561-1" name="__codelineno-561-1" href="#__codelineno-561-1"></a><span class="c1">-- Simple: Log door usage</span>
</span><span id="__span-561-2"><a id="__codelineno-561-2" name="__codelineno-561-2" href="#__codelineno-561-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-561-3"><a id="__codelineno-561-3" name="__codelineno-561-3" href="#__codelineno-561-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; used a door&quot;</span><span class="p">)</span>
</span><span id="__span-561-4"><a id="__codelineno-561-4" name="__codelineno-561-4" href="#__codelineno-561-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-562-1"><a id="__codelineno-562-1" name="__codelineno-562-1" href="#__codelineno-562-1"></a><span class="c1">-- Medium: Track door usage</span>
</span><span id="__span-562-2"><a id="__codelineno-562-2" name="__codelineno-562-2" href="#__codelineno-562-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackDoorUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-562-3"><a id="__codelineno-562-3" name="__codelineno-562-3" href="#__codelineno-562-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-562-4"><a id="__codelineno-562-4" name="__codelineno-562-4" href="#__codelineno-562-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-562-5"><a id="__codelineno-562-5" name="__codelineno-562-5" href="#__codelineno-562-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorUses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-562-6"><a id="__codelineno-562-6" name="__codelineno-562-6" href="#__codelineno-562-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-562-7"><a id="__codelineno-562-7" name="__codelineno-562-7" href="#__codelineno-562-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-562-8"><a id="__codelineno-562-8" name="__codelineno-562-8" href="#__codelineno-562-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-563-1"><a id="__codelineno-563-1" name="__codelineno-563-1" href="#__codelineno-563-1"></a><span class="c1">-- High: Complex door usage tracking</span>
</span><span id="__span-563-2"><a id="__codelineno-563-2" name="__codelineno-563-2" href="#__codelineno-563-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerUseDoor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">)</span>
</span><span id="__span-563-3"><a id="__codelineno-563-3" name="__codelineno-563-3" href="#__codelineno-563-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-563-4"><a id="__codelineno-563-4" name="__codelineno-563-4" href="#__codelineno-563-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-563-5"><a id="__codelineno-563-5" name="__codelineno-563-5" href="#__codelineno-563-5"></a><span class="w">    </span><span class="c1">-- Track door usage</span>
</span><span id="__span-563-6"><a id="__codelineno-563-6" name="__codelineno-563-6" href="#__codelineno-563-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorUses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-563-7"><a id="__codelineno-563-7" name="__codelineno-563-7" href="#__codelineno-563-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorUses&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-563-8"><a id="__codelineno-563-8" name="__codelineno-563-8" href="#__codelineno-563-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-563-9"><a id="__codelineno-563-9" name="__codelineno-563-9" href="#__codelineno-563-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">MapCreationID</span><span class="p">()</span>
</span><span id="__span-563-10"><a id="__codelineno-563-10" name="__codelineno-563-10" href="#__codelineno-563-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_usage_logs (timestamp, charid, doorid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-563-11"><a id="__codelineno-563-11" name="__codelineno-563-11" href="#__codelineno-563-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">doorID</span><span class="p">)</span>
</span><span id="__span-563-12"><a id="__codelineno-563-12" name="__codelineno-563-12" href="#__codelineno-563-12"></a><span class="w">    </span><span class="c1">-- Check for achievements</span>
</span><span id="__span-563-13"><a id="__codelineno-563-13" name="__codelineno-563-13" href="#__codelineno-563-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorUses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-563-14"><a id="__codelineno-563-14" name="__codelineno-563-14" href="#__codelineno-563-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_doorman&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-563-15"><a id="__codelineno-563-15" name="__codelineno-563-15" href="#__codelineno-563-15"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_doorman&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-563-16"><a id="__codelineno-563-16" name="__codelineno-563-16" href="#__codelineno-563-16"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Doorman!&quot;</span><span class="p">)</span>
</span><span id="__span-563-17"><a id="__codelineno-563-17" name="__codelineno-563-17" href="#__codelineno-563-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-563-18"><a id="__codelineno-563-18" name="__codelineno-563-18" href="#__codelineno-563-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-563-19"><a id="__codelineno-563-19" name="__codelineno-563-19" href="#__codelineno-563-19"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postdoordataload">PostDoorDataLoad</h3>
<p><strong>Purpose</strong></p>
<p>Called after door data is loaded</p>
<p><strong>When Called</strong></p>
<p>After door configuration data is loaded from the database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The door entity</li>
<li><code>doorData</code> (<em>table</em>): The door data that was loaded</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-564-1"><a id="__codelineno-564-1" name="__codelineno-564-1" href="#__codelineno-564-1"></a><span class="c1">-- Simple: Log door data load</span>
</span><span id="__span-564-2"><a id="__codelineno-564-2" name="__codelineno-564-2" href="#__codelineno-564-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostDoorDataLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-564-3"><a id="__codelineno-564-3" name="__codelineno-564-3" href="#__codelineno-564-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Door data loaded for entity &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-564-4"><a id="__codelineno-564-4" name="__codelineno-564-4" href="#__codelineno-564-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-565-1"><a id="__codelineno-565-1" name="__codelineno-565-1" href="#__codelineno-565-1"></a><span class="c1">-- Medium: Apply custom door settings</span>
</span><span id="__span-565-2"><a id="__codelineno-565-2" name="__codelineno-565-2" href="#__codelineno-565-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostDoorDataLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CustomDoorSettings&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-565-3"><a id="__codelineno-565-3" name="__codelineno-565-3" href="#__codelineno-565-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">customLocked</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-565-4"><a id="__codelineno-565-4" name="__codelineno-565-4" href="#__codelineno-565-4"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">Fire</span><span class="p">(</span><span class="s2">&quot;Lock&quot;</span><span class="p">)</span>
</span><span id="__span-565-5"><a id="__codelineno-565-5" name="__codelineno-565-5" href="#__codelineno-565-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-565-6"><a id="__codelineno-565-6" name="__codelineno-565-6" href="#__codelineno-565-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-566-1"><a id="__codelineno-566-1" name="__codelineno-566-1" href="#__codelineno-566-1"></a><span class="c1">-- High: Complex door data processing</span>
</span><span id="__span-566-2"><a id="__codelineno-566-2" name="__codelineno-566-2" href="#__codelineno-566-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostDoorDataLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorDataProcessing&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-566-3"><a id="__codelineno-566-3" name="__codelineno-566-3" href="#__codelineno-566-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">doorData</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-566-4"><a id="__codelineno-566-4" name="__codelineno-566-4" href="#__codelineno-566-4"></a><span class="w">    </span><span class="c1">-- Apply door settings</span>
</span><span id="__span-566-5"><a id="__codelineno-566-5" name="__codelineno-566-5" href="#__codelineno-566-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">locked</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-566-6"><a id="__codelineno-566-6" name="__codelineno-566-6" href="#__codelineno-566-6"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">Fire</span><span class="p">(</span><span class="s2">&quot;Lock&quot;</span><span class="p">)</span>
</span><span id="__span-566-7"><a id="__codelineno-566-7" name="__codelineno-566-7" href="#__codelineno-566-7"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-566-8"><a id="__codelineno-566-8" name="__codelineno-566-8" href="#__codelineno-566-8"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">Fire</span><span class="p">(</span><span class="s2">&quot;Unlock&quot;</span><span class="p">)</span>
</span><span id="__span-566-9"><a id="__codelineno-566-9" name="__codelineno-566-9" href="#__codelineno-566-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-566-10"><a id="__codelineno-566-10" name="__codelineno-566-10" href="#__codelineno-566-10"></a><span class="w">    </span><span class="c1">-- Set door title</span>
</span><span id="__span-566-11"><a id="__codelineno-566-11" name="__codelineno-566-11" href="#__codelineno-566-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-566-12"><a id="__codelineno-566-12" name="__codelineno-566-12" href="#__codelineno-566-12"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="p">)</span>
</span><span id="__span-566-13"><a id="__codelineno-566-13" name="__codelineno-566-13" href="#__codelineno-566-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-566-14"><a id="__codelineno-566-14" name="__codelineno-566-14" href="#__codelineno-566-14"></a><span class="w">    </span><span class="c1">-- Set door price</span>
</span><span id="__span-566-15"><a id="__codelineno-566-15" name="__codelineno-566-15" href="#__codelineno-566-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-566-16"><a id="__codelineno-566-16" name="__codelineno-566-16" href="#__codelineno-566-16"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="p">)</span>
</span><span id="__span-566-17"><a id="__codelineno-566-17" name="__codelineno-566-17" href="#__codelineno-566-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-566-18"><a id="__codelineno-566-18" name="__codelineno-566-18" href="#__codelineno-566-18"></a><span class="w">    </span><span class="c1">-- Set door owner</span>
</span><span id="__span-566-19"><a id="__codelineno-566-19" name="__codelineno-566-19" href="#__codelineno-566-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-566-20"><a id="__codelineno-566-20" name="__codelineno-566-20" href="#__codelineno-566-20"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">owner</span><span class="p">)</span>
</span><span id="__span-566-21"><a id="__codelineno-566-21" name="__codelineno-566-21" href="#__codelineno-566-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-566-22"><a id="__codelineno-566-22" name="__codelineno-566-22" href="#__codelineno-566-22"></a><span class="w">    </span><span class="c1">-- Apply faction restrictions</span>
</span><span id="__span-566-23"><a id="__codelineno-566-23" name="__codelineno-566-23" href="#__codelineno-566-23"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">allowedFactions</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-566-24"><a id="__codelineno-566-24" name="__codelineno-566-24" href="#__codelineno-566-24"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;allowedFactions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">allowedFactions</span><span class="p">)</span>
</span><span id="__span-566-25"><a id="__codelineno-566-25" name="__codelineno-566-25" href="#__codelineno-566-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-566-26"><a id="__codelineno-566-26" name="__codelineno-566-26" href="#__codelineno-566-26"></a><span class="w">    </span><span class="c1">-- Log door data load</span>
</span><span id="__span-566-27"><a id="__codelineno-566-27" name="__codelineno-566-27" href="#__codelineno-566-27"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Door data loaded for entity %d: Title=%s, Price=%s, Owner=%s&quot;</span><span class="p">,</span>
</span><span id="__span-566-28"><a id="__codelineno-566-28" name="__codelineno-566-28" href="#__codelineno-566-28"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span>
</span><span id="__span-566-29"><a id="__codelineno-566-29" name="__codelineno-566-29" href="#__codelineno-566-29"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="__span-566-30"><a id="__codelineno-566-30" name="__codelineno-566-30" href="#__codelineno-566-30"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="__span-566-31"><a id="__codelineno-566-31" name="__codelineno-566-31" href="#__codelineno-566-31"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">owner</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">))</span>
</span><span id="__span-566-32"><a id="__codelineno-566-32" name="__codelineno-566-32" href="#__codelineno-566-32"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postloaddata">PostLoadData</h3>
<p><strong>Purpose</strong></p>
<p>Called after data is loaded</p>
<p><strong>When Called</strong></p>
<p>After all persistent data has been loaded</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-567-1"><a id="__codelineno-567-1" name="__codelineno-567-1" href="#__codelineno-567-1"></a><span class="c1">-- Simple: Log data load completion</span>
</span><span id="__span-567-2"><a id="__codelineno-567-2" name="__codelineno-567-2" href="#__codelineno-567-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostLoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-567-3"><a id="__codelineno-567-3" name="__codelineno-567-3" href="#__codelineno-567-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data loaded&quot;</span><span class="p">)</span>
</span><span id="__span-567-4"><a id="__codelineno-567-4" name="__codelineno-567-4" href="#__codelineno-567-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-568-1"><a id="__codelineno-568-1" name="__codelineno-568-1" href="#__codelineno-568-1"></a><span class="c1">-- Medium: Initialize systems after data load</span>
</span><span id="__span-568-2"><a id="__codelineno-568-2" name="__codelineno-568-2" href="#__codelineno-568-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostLoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InitializeSystems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-568-3"><a id="__codelineno-568-3" name="__codelineno-568-3" href="#__codelineno-568-3"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">()</span>
</span><span id="__span-568-4"><a id="__codelineno-568-4" name="__codelineno-568-4" href="#__codelineno-568-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Systems initialized after data load&quot;</span><span class="p">)</span>
</span><span id="__span-568-5"><a id="__codelineno-568-5" name="__codelineno-568-5" href="#__codelineno-568-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-569-1"><a id="__codelineno-569-1" name="__codelineno-569-1" href="#__codelineno-569-1"></a><span class="c1">-- High: Complex post-load initialization</span>
</span><span id="__span-569-2"><a id="__codelineno-569-2" name="__codelineno-569-2" href="#__codelineno-569-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostLoadData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPostLoadInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-569-3"><a id="__codelineno-569-3" name="__codelineno-569-3" href="#__codelineno-569-3"></a><span class="c1">-- Initialize custom systems</span>
</span><span id="__span-569-4"><a id="__codelineno-569-4" name="__codelineno-569-4" href="#__codelineno-569-4"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">()</span>
</span><span id="__span-569-5"><a id="__codelineno-569-5" name="__codelineno-569-5" href="#__codelineno-569-5"></a><span class="c1">-- Validate loaded data</span>
</span><span id="__span-569-6"><a id="__codelineno-569-6" name="__codelineno-569-6" href="#__codelineno-569-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-569-7"><a id="__codelineno-569-7" name="__codelineno-569-7" href="#__codelineno-569-7"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="nv">data</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-569-8"><a id="__codelineno-569-8" name="__codelineno-569-8" href="#__codelineno-569-8"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: No data found, using defaults&quot;</span><span class="p">)</span>
</span><span id="__span-569-9"><a id="__codelineno-569-9" name="__codelineno-569-9" href="#__codelineno-569-9"></a><span class="w">    </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="nf">GetDefaultData</span><span class="p">()</span>
</span><span id="__span-569-10"><a id="__codelineno-569-10" name="__codelineno-569-10" href="#__codelineno-569-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span>
</span><span id="__span-569-11"><a id="__codelineno-569-11" name="__codelineno-569-11" href="#__codelineno-569-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-569-12"><a id="__codelineno-569-12" name="__codelineno-569-12" href="#__codelineno-569-12"></a><span class="c1">-- Set up timers</span>
</span><span id="__span-569-13"><a id="__codelineno-569-13" name="__codelineno-569-13" href="#__codelineno-569-13"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;MyAddonDataSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-569-14"><a id="__codelineno-569-14" name="__codelineno-569-14" href="#__codelineno-569-14"></a><span class="nv">MyAddon</span><span class="p">.</span><span class="nf">SaveData</span><span class="p">()</span>
</span><span id="__span-569-15"><a id="__codelineno-569-15" name="__codelineno-569-15" href="#__codelineno-569-15"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-569-16"><a id="__codelineno-569-16" name="__codelineno-569-16" href="#__codelineno-569-16"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Post-load initialization completed&quot;</span><span class="p">)</span>
</span><span id="__span-569-17"><a id="__codelineno-569-17" name="__codelineno-569-17" href="#__codelineno-569-17"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postplayerinitialspawn">PostPlayerInitialSpawn</h3>
<p><strong>Purpose</strong></p>
<p>Called after a player's initial spawn</p>
<p><strong>When Called</strong></p>
<p>After a player has fully spawned for the first time</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who spawned</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-570-1"><a id="__codelineno-570-1" name="__codelineno-570-1" href="#__codelineno-570-1"></a><span class="c1">-- Simple: Welcome message</span>
</span><span id="__span-570-2"><a id="__codelineno-570-2" name="__codelineno-570-2" href="#__codelineno-570-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-570-3"><a id="__codelineno-570-3" name="__codelineno-570-3" href="#__codelineno-570-3"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Welcome to the server!&quot;</span><span class="p">)</span>
</span><span id="__span-570-4"><a id="__codelineno-570-4" name="__codelineno-570-4" href="#__codelineno-570-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-571-1"><a id="__codelineno-571-1" name="__codelineno-571-1" href="#__codelineno-571-1"></a><span class="c1">-- Medium: Give starting items</span>
</span><span id="__span-571-2"><a id="__codelineno-571-2" name="__codelineno-571-2" href="#__codelineno-571-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GiveStartingItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-571-3"><a id="__codelineno-571-3" name="__codelineno-571-3" href="#__codelineno-571-3"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-571-4"><a id="__codelineno-571-4" name="__codelineno-571-4" href="#__codelineno-571-4"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-571-5"><a id="__codelineno-571-5" name="__codelineno-571-5" href="#__codelineno-571-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-571-6"><a id="__codelineno-571-6" name="__codelineno-571-6" href="#__codelineno-571-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-571-7"><a id="__codelineno-571-7" name="__codelineno-571-7" href="#__codelineno-571-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-571-8"><a id="__codelineno-571-8" name="__codelineno-571-8" href="#__codelineno-571-8"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-571-9"><a id="__codelineno-571-9" name="__codelineno-571-9" href="#__codelineno-571-9"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="s2">&quot;item_bandage&quot;</span><span class="p">)</span>
</span><span id="__span-571-10"><a id="__codelineno-571-10" name="__codelineno-571-10" href="#__codelineno-571-10"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-571-11"><a id="__codelineno-571-11" name="__codelineno-571-11" href="#__codelineno-571-11"></a><span class="w">                </span><span class="nv">inv</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-571-12"><a id="__codelineno-571-12" name="__codelineno-571-12" href="#__codelineno-571-12"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-571-13"><a id="__codelineno-571-13" name="__codelineno-571-13" href="#__codelineno-571-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-571-14"><a id="__codelineno-571-14" name="__codelineno-571-14" href="#__codelineno-571-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-571-15"><a id="__codelineno-571-15" name="__codelineno-571-15" href="#__codelineno-571-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-571-16"><a id="__codelineno-571-16" name="__codelineno-571-16" href="#__codelineno-571-16"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-571-17"><a id="__codelineno-571-17" name="__codelineno-571-17" href="#__codelineno-571-17"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-572-1"><a id="__codelineno-572-1" name="__codelineno-572-1" href="#__codelineno-572-1"></a><span class="c1">-- High: Complex spawn initialization</span>
</span><span id="__span-572-2"><a id="__codelineno-572-2" name="__codelineno-572-2" href="#__codelineno-572-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSpawnInit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-572-3"><a id="__codelineno-572-3" name="__codelineno-572-3" href="#__codelineno-572-3"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-572-4"><a id="__codelineno-572-4" name="__codelineno-572-4" href="#__codelineno-572-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-572-5"><a id="__codelineno-572-5" name="__codelineno-572-5" href="#__codelineno-572-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-572-6"><a id="__codelineno-572-6" name="__codelineno-572-6" href="#__codelineno-572-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-572-7"><a id="__codelineno-572-7" name="__codelineno-572-7" href="#__codelineno-572-7"></a><span class="w">        </span><span class="c1">-- Give starting items</span>
</span><span id="__span-572-8"><a id="__codelineno-572-8" name="__codelineno-572-8" href="#__codelineno-572-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-572-9"><a id="__codelineno-572-9" name="__codelineno-572-9" href="#__codelineno-572-9"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-572-10"><a id="__codelineno-572-10" name="__codelineno-572-10" href="#__codelineno-572-10"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">startingItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;item_bandage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;item_water&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;item_food&quot;</span><span class="p">}</span>
</span><span id="__span-572-11"><a id="__codelineno-572-11" name="__codelineno-572-11" href="#__codelineno-572-11"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">startingItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-572-12"><a id="__codelineno-572-12" name="__codelineno-572-12" href="#__codelineno-572-12"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">instance</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-572-13"><a id="__codelineno-572-13" name="__codelineno-572-13" href="#__codelineno-572-13"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-572-14"><a id="__codelineno-572-14" name="__codelineno-572-14" href="#__codelineno-572-14"></a><span class="w">                    </span><span class="nv">inv</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-572-15"><a id="__codelineno-572-15" name="__codelineno-572-15" href="#__codelineno-572-15"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-572-16"><a id="__codelineno-572-16" name="__codelineno-572-16" href="#__codelineno-572-16"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-572-17"><a id="__codelineno-572-17" name="__codelineno-572-17" href="#__codelineno-572-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-572-18"><a id="__codelineno-572-18" name="__codelineno-572-18" href="#__codelineno-572-18"></a><span class="w">        </span><span class="c1">-- Set starting money</span>
</span><span id="__span-572-19"><a id="__codelineno-572-19" name="__codelineno-572-19" href="#__codelineno-572-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getMoney</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-572-20"><a id="__codelineno-572-20" name="__codelineno-572-20" href="#__codelineno-572-20"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">giveMoney</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-572-21"><a id="__codelineno-572-21" name="__codelineno-572-21" href="#__codelineno-572-21"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You received $500 starting money&quot;</span><span class="p">)</span>
</span><span id="__span-572-22"><a id="__codelineno-572-22" name="__codelineno-572-22" href="#__codelineno-572-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-572-23"><a id="__codelineno-572-23" name="__codelineno-572-23" href="#__codelineno-572-23"></a><span class="w">        </span><span class="c1">-- Apply first-time bonuses</span>
</span><span id="__span-572-24"><a id="__codelineno-572-24" name="__codelineno-572-24" href="#__codelineno-572-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetUTimeTotalTime</span><span class="p">()</span>
</span><span id="__span-572-25"><a id="__codelineno-572-25" name="__codelineno-572-25" href="#__codelineno-572-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">playTime</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-572-26"><a id="__codelineno-572-26" name="__codelineno-572-26" href="#__codelineno-572-26"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;firstTimeBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-572-27"><a id="__codelineno-572-27" name="__codelineno-572-27" href="#__codelineno-572-27"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Welcome! You received a first-time bonus!&quot;</span><span class="p">)</span>
</span><span id="__span-572-28"><a id="__codelineno-572-28" name="__codelineno-572-28" href="#__codelineno-572-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-572-29"><a id="__codelineno-572-29" name="__codelineno-572-29" href="#__codelineno-572-29"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-572-30"><a id="__codelineno-572-30" name="__codelineno-572-30" href="#__codelineno-572-30"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postplayerloadedchar">PostPlayerLoadedChar</h3>
<p><strong>Purpose</strong></p>
<p>Called after a player has loaded a character</p>
<p><strong>When Called</strong></p>
<p>After a character has been fully loaded for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>character</code> (<em>Character</em>): The character that was loaded</li>
<li><code>currentChar</code> (<em>Character</em>): The previous character (if any)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-573-1"><a id="__codelineno-573-1" name="__codelineno-573-1" href="#__codelineno-573-1"></a><span class="c1">-- Simple: Welcome message</span>
</span><span id="__span-573-2"><a id="__codelineno-573-2" name="__codelineno-573-2" href="#__codelineno-573-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-573-3"><a id="__codelineno-573-3" name="__codelineno-573-3" href="#__codelineno-573-3"></a><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Welcome back, &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-573-4"><a id="__codelineno-573-4" name="__codelineno-573-4" href="#__codelineno-573-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-574-1"><a id="__codelineno-574-1" name="__codelineno-574-1" href="#__codelineno-574-1"></a><span class="c1">-- Medium: Restore character state</span>
</span><span id="__span-574-2"><a id="__codelineno-574-2" name="__codelineno-574-2" href="#__codelineno-574-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RestoreCharState&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-574-3"><a id="__codelineno-574-3" name="__codelineno-574-3" href="#__codelineno-574-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;savedHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-574-4"><a id="__codelineno-574-4" name="__codelineno-574-4" href="#__codelineno-574-4"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nv">health</span><span class="p">)</span>
</span><span id="__span-574-5"><a id="__codelineno-574-5" name="__codelineno-574-5" href="#__codelineno-574-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;savedArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-574-6"><a id="__codelineno-574-6" name="__codelineno-574-6" href="#__codelineno-574-6"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="nv">armor</span><span class="p">)</span>
</span><span id="__span-574-7"><a id="__codelineno-574-7" name="__codelineno-574-7" href="#__codelineno-574-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-575-1"><a id="__codelineno-575-1" name="__codelineno-575-1" href="#__codelineno-575-1"></a><span class="c1">-- High: Complex character load handling</span>
</span><span id="__span-575-2"><a id="__codelineno-575-2" name="__codelineno-575-2" href="#__codelineno-575-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharLoad&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-575-3"><a id="__codelineno-575-3" name="__codelineno-575-3" href="#__codelineno-575-3"></a><span class="c1">-- Restore character state</span>
</span><span id="__span-575-4"><a id="__codelineno-575-4" name="__codelineno-575-4" href="#__codelineno-575-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;savedHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-575-5"><a id="__codelineno-575-5" name="__codelineno-575-5" href="#__codelineno-575-5"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nv">health</span><span class="p">)</span>
</span><span id="__span-575-6"><a id="__codelineno-575-6" name="__codelineno-575-6" href="#__codelineno-575-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;savedArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-575-7"><a id="__codelineno-575-7" name="__codelineno-575-7" href="#__codelineno-575-7"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="nv">armor</span><span class="p">)</span>
</span><span id="__span-575-8"><a id="__codelineno-575-8" name="__codelineno-575-8" href="#__codelineno-575-8"></a><span class="c1">-- Restore position if saved</span>
</span><span id="__span-575-9"><a id="__codelineno-575-9" name="__codelineno-575-9" href="#__codelineno-575-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">savedPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;savedPosition&quot;</span><span class="p">)</span>
</span><span id="__span-575-10"><a id="__codelineno-575-10" name="__codelineno-575-10" href="#__codelineno-575-10"></a><span class="kr">if</span><span class="w"> </span><span class="nv">savedPos</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-575-11"><a id="__codelineno-575-11" name="__codelineno-575-11" href="#__codelineno-575-11"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nv">savedPos</span><span class="p">)</span>
</span><span id="__span-575-12"><a id="__codelineno-575-12" name="__codelineno-575-12" href="#__codelineno-575-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-575-13"><a id="__codelineno-575-13" name="__codelineno-575-13" href="#__codelineno-575-13"></a><span class="c1">-- Update session data</span>
</span><span id="__span-575-14"><a id="__codelineno-575-14" name="__codelineno-575-14" href="#__codelineno-575-14"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sessionStart&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-575-15"><a id="__codelineno-575-15" name="__codelineno-575-15" href="#__codelineno-575-15"></a><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastLogin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-575-16"><a id="__codelineno-575-16" name="__codelineno-575-16" href="#__codelineno-575-16"></a><span class="c1">-- Notify faction members</span>
</span><span id="__span-575-17"><a id="__codelineno-575-17" name="__codelineno-575-17" href="#__codelineno-575-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-575-18"><a id="__codelineno-575-18" name="__codelineno-575-18" href="#__codelineno-575-18"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-575-19"><a id="__codelineno-575-19" name="__codelineno-575-19" href="#__codelineno-575-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-575-20"><a id="__codelineno-575-20" name="__codelineno-575-20" href="#__codelineno-575-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-575-21"><a id="__codelineno-575-21" name="__codelineno-575-21" href="#__codelineno-575-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">plyChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">plyChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-575-22"><a id="__codelineno-575-22" name="__codelineno-575-22" href="#__codelineno-575-22"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has joined the server&quot;</span><span class="p">)</span>
</span><span id="__span-575-23"><a id="__codelineno-575-23" name="__codelineno-575-23" href="#__codelineno-575-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-575-24"><a id="__codelineno-575-24" name="__codelineno-575-24" href="#__codelineno-575-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-575-25"><a id="__codelineno-575-25" name="__codelineno-575-25" href="#__codelineno-575-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-575-26"><a id="__codelineno-575-26" name="__codelineno-575-26" href="#__codelineno-575-26"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postplayerloadout">PostPlayerLoadout</h3>
<p><strong>Purpose</strong></p>
<p>Called after a player's loadout is given</p>
<p><strong>When Called</strong></p>
<p>After a player has received their weapons/equipment</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who received loadout</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-576-1"><a id="__codelineno-576-1" name="__codelineno-576-1" href="#__codelineno-576-1"></a><span class="c1">-- Simple: Log loadout</span>
</span><span id="__span-576-2"><a id="__codelineno-576-2" name="__codelineno-576-2" href="#__codelineno-576-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadout&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-576-3"><a id="__codelineno-576-3" name="__codelineno-576-3" href="#__codelineno-576-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; received loadout&quot;</span><span class="p">)</span>
</span><span id="__span-576-4"><a id="__codelineno-576-4" name="__codelineno-576-4" href="#__codelineno-576-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-577-1"><a id="__codelineno-577-1" name="__codelineno-577-1" href="#__codelineno-577-1"></a><span class="c1">-- Medium: Give additional items</span>
</span><span id="__span-577-2"><a id="__codelineno-577-2" name="__codelineno-577-2" href="#__codelineno-577-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadout&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GiveAdditionalItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-577-3"><a id="__codelineno-577-3" name="__codelineno-577-3" href="#__codelineno-577-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-577-4"><a id="__codelineno-577-4" name="__codelineno-577-4" href="#__codelineno-577-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vip&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-577-5"><a id="__codelineno-577-5" name="__codelineno-577-5" href="#__codelineno-577-5"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
</span><span id="__span-577-6"><a id="__codelineno-577-6" name="__codelineno-577-6" href="#__codelineno-577-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-577-7"><a id="__codelineno-577-7" name="__codelineno-577-7" href="#__codelineno-577-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-578-1"><a id="__codelineno-578-1" name="__codelineno-578-1" href="#__codelineno-578-1"></a><span class="c1">-- High: Complex loadout system</span>
</span><span id="__span-578-2"><a id="__codelineno-578-2" name="__codelineno-578-2" href="#__codelineno-578-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerLoadout&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedLoadout&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-578-3"><a id="__codelineno-578-3" name="__codelineno-578-3" href="#__codelineno-578-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-578-4"><a id="__codelineno-578-4" name="__codelineno-578-4" href="#__codelineno-578-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-578-5"><a id="__codelineno-578-5" name="__codelineno-578-5" href="#__codelineno-578-5"></a><span class="w">    </span><span class="c1">-- Give faction-specific weapons</span>
</span><span id="__span-578-6"><a id="__codelineno-578-6" name="__codelineno-578-6" href="#__codelineno-578-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-578-7"><a id="__codelineno-578-7" name="__codelineno-578-7" href="#__codelineno-578-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-578-8"><a id="__codelineno-578-8" name="__codelineno-578-8" href="#__codelineno-578-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
</span><span id="__span-578-9"><a id="__codelineno-578-9" name="__codelineno-578-9" href="#__codelineno-578-9"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">)</span>
</span><span id="__span-578-10"><a id="__codelineno-578-10" name="__codelineno-578-10" href="#__codelineno-578-10"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-578-11"><a id="__codelineno-578-11" name="__codelineno-578-11" href="#__codelineno-578-11"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_medkit&quot;</span><span class="p">)</span>
</span><span id="__span-578-12"><a id="__codelineno-578-12" name="__codelineno-578-12" href="#__codelineno-578-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-578-13"><a id="__codelineno-578-13" name="__codelineno-578-13" href="#__codelineno-578-13"></a><span class="w">    </span><span class="c1">-- Give VIP bonuses</span>
</span><span id="__span-578-14"><a id="__codelineno-578-14" name="__codelineno-578-14" href="#__codelineno-578-14"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vip&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-578-15"><a id="__codelineno-578-15" name="__codelineno-578-15" href="#__codelineno-578-15"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
</span><span id="__span-578-16"><a id="__codelineno-578-16" name="__codelineno-578-16" href="#__codelineno-578-16"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
</span><span id="__span-578-17"><a id="__codelineno-578-17" name="__codelineno-578-17" href="#__codelineno-578-17"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-578-18"><a id="__codelineno-578-18" name="__codelineno-578-18" href="#__codelineno-578-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-578-19"><a id="__codelineno-578-19" name="__codelineno-578-19" href="#__codelineno-578-19"></a><span class="w">    </span><span class="c1">-- Apply class bonuses</span>
</span><span id="__span-578-20"><a id="__codelineno-578-20" name="__codelineno-578-20" href="#__codelineno-578-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span>
</span><span id="__span-578-21"><a id="__codelineno-578-21" name="__codelineno-578-21" href="#__codelineno-578-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;warrior&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-578-22"><a id="__codelineno-578-22" name="__codelineno-578-22" href="#__codelineno-578-22"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-578-23"><a id="__codelineno-578-23" name="__codelineno-578-23" href="#__codelineno-578-23"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-578-24"><a id="__codelineno-578-24" name="__codelineno-578-24" href="#__codelineno-578-24"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;scout&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-578-25"><a id="__codelineno-578-25" name="__codelineno-578-25" href="#__codelineno-578-25"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetRunSpeed</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
</span><span id="__span-578-26"><a id="__codelineno-578-26" name="__codelineno-578-26" href="#__codelineno-578-26"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetWalkSpeed</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
</span><span id="__span-578-27"><a id="__codelineno-578-27" name="__codelineno-578-27" href="#__codelineno-578-27"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-578-28"><a id="__codelineno-578-28" name="__codelineno-578-28" href="#__codelineno-578-28"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postplayersay">PostPlayerSay</h3>
<p><strong>Purpose</strong></p>
<p>Called after a player says something in chat</p>
<p><strong>When Called</strong></p>
<p>After a chat message has been processed and sent</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who spoke</li>
<li><code>message</code> (<em>string</em>): The message that was sent</li>
<li><code>chatType</code> (<em>string</em>): The type of chat</li>
<li><code>anonymous</code> (<em>boolean</em>): Whether the message was anonymous</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-579-1"><a id="__codelineno-579-1" name="__codelineno-579-1" href="#__codelineno-579-1"></a><span class="c1">-- Simple: Log chat messages</span>
</span><span id="__span-579-2"><a id="__codelineno-579-2" name="__codelineno-579-2" href="#__codelineno-579-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerSay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-579-3"><a id="__codelineno-579-3" name="__codelineno-579-3" href="#__codelineno-579-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; said: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-579-4"><a id="__codelineno-579-4" name="__codelineno-579-4" href="#__codelineno-579-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-580-1"><a id="__codelineno-580-1" name="__codelineno-580-1" href="#__codelineno-580-1"></a><span class="c1">-- Medium: Track chat statistics</span>
</span><span id="__span-580-2"><a id="__codelineno-580-2" name="__codelineno-580-2" href="#__codelineno-580-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerSay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackChatStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-580-3"><a id="__codelineno-580-3" name="__codelineno-580-3" href="#__codelineno-580-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-580-4"><a id="__codelineno-580-4" name="__codelineno-580-4" href="#__codelineno-580-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-580-5"><a id="__codelineno-580-5" name="__codelineno-580-5" href="#__codelineno-580-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-580-6"><a id="__codelineno-580-6" name="__codelineno-580-6" href="#__codelineno-580-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-580-7"><a id="__codelineno-580-7" name="__codelineno-580-7" href="#__codelineno-580-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-580-8"><a id="__codelineno-580-8" name="__codelineno-580-8" href="#__codelineno-580-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-581-1"><a id="__codelineno-581-1" name="__codelineno-581-1" href="#__codelineno-581-1"></a><span class="c1">-- High: Complex chat tracking system</span>
</span><span id="__span-581-2"><a id="__codelineno-581-2" name="__codelineno-581-2" href="#__codelineno-581-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostPlayerSay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedChatTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="p">)</span>
</span><span id="__span-581-3"><a id="__codelineno-581-3" name="__codelineno-581-3" href="#__codelineno-581-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-581-4"><a id="__codelineno-581-4" name="__codelineno-581-4" href="#__codelineno-581-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-581-5"><a id="__codelineno-581-5" name="__codelineno-581-5" href="#__codelineno-581-5"></a><span class="w">    </span><span class="c1">-- Track message count</span>
</span><span id="__span-581-6"><a id="__codelineno-581-6" name="__codelineno-581-6" href="#__codelineno-581-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-581-7"><a id="__codelineno-581-7" name="__codelineno-581-7" href="#__codelineno-581-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;messageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-581-8"><a id="__codelineno-581-8" name="__codelineno-581-8" href="#__codelineno-581-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-581-9"><a id="__codelineno-581-9" name="__codelineno-581-9" href="#__codelineno-581-9"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO chat_logs (timestamp, charid, chattype, message, anonymous) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-581-10"><a id="__codelineno-581-10" name="__codelineno-581-10" href="#__codelineno-581-10"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">chatType</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="nv">anonymous</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-581-11"><a id="__codelineno-581-11" name="__codelineno-581-11" href="#__codelineno-581-11"></a><span class="w">    </span><span class="c1">-- Check for achievements</span>
</span><span id="__span-581-12"><a id="__codelineno-581-12" name="__codelineno-581-12" href="#__codelineno-581-12"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">messageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-581-13"><a id="__codelineno-581-13" name="__codelineno-581-13" href="#__codelineno-581-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;achievement_chatty&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-581-14"><a id="__codelineno-581-14" name="__codelineno-581-14" href="#__codelineno-581-14"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;achievement_chatty&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-581-15"><a id="__codelineno-581-15" name="__codelineno-581-15" href="#__codelineno-581-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Achievement unlocked: Chatty!&quot;</span><span class="p">)</span>
</span><span id="__span-581-16"><a id="__codelineno-581-16" name="__codelineno-581-16" href="#__codelineno-581-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-581-17"><a id="__codelineno-581-17" name="__codelineno-581-17" href="#__codelineno-581-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-581-18"><a id="__codelineno-581-18" name="__codelineno-581-18" href="#__codelineno-581-18"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="postscaledamage">PostScaleDamage</h3>
<p><strong>Purpose</strong></p>
<p>Called after damage scaling is calculated</p>
<p><strong>When Called</strong></p>
<p>After damage has been scaled but before it's applied</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>hitgroup</code> (<em>number</em>): The hitgroup that was hit</li>
<li><code>dmgInfo</code> (<em>CTakeDamageInfo</em>): The damage info</li>
<li><code>damageScale</code> (<em>number</em>): The calculated damage scale</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-582-1"><a id="__codelineno-582-1" name="__codelineno-582-1" href="#__codelineno-582-1"></a><span class="c1">-- Simple: Log damage scaling</span>
</span><span id="__span-582-2"><a id="__codelineno-582-2" name="__codelineno-582-2" href="#__codelineno-582-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-582-3"><a id="__codelineno-582-3" name="__codelineno-582-3" href="#__codelineno-582-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Damage scaled to: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-582-4"><a id="__codelineno-582-4" name="__codelineno-582-4" href="#__codelineno-582-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-583-1"><a id="__codelineno-583-1" name="__codelineno-583-1" href="#__codelineno-583-1"></a><span class="c1">-- Medium: Apply damage effects</span>
</span><span id="__span-583-2"><a id="__codelineno-583-2" name="__codelineno-583-2" href="#__codelineno-583-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ApplyDamageEffects&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-583-3"><a id="__codelineno-583-3" name="__codelineno-583-3" href="#__codelineno-583-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-583-4"><a id="__codelineno-583-4" name="__codelineno-583-4" href="#__codelineno-583-4"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-583-5"><a id="__codelineno-583-5" name="__codelineno-583-5" href="#__codelineno-583-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-583-6"><a id="__codelineno-583-6" name="__codelineno-583-6" href="#__codelineno-583-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-583-7"><a id="__codelineno-583-7" name="__codelineno-583-7" href="#__codelineno-583-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">damage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetDamage</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">damageScale</span>
</span><span id="__span-583-8"><a id="__codelineno-583-8" name="__codelineno-583-8" href="#__codelineno-583-8"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastDamageTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">damage</span><span class="p">)</span>
</span><span id="__span-583-9"><a id="__codelineno-583-9" name="__codelineno-583-9" href="#__codelineno-583-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-583-10"><a id="__codelineno-583-10" name="__codelineno-583-10" href="#__codelineno-583-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-583-11"><a id="__codelineno-583-11" name="__codelineno-583-11" href="#__codelineno-583-11"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-584-1"><a id="__codelineno-584-1" name="__codelineno-584-1" href="#__codelineno-584-1"></a><span class="c1">-- High: Complex damage tracking system</span>
</span><span id="__span-584-2"><a id="__codelineno-584-2" name="__codelineno-584-2" href="#__codelineno-584-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDamageTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-584-3"><a id="__codelineno-584-3" name="__codelineno-584-3" href="#__codelineno-584-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-584-4"><a id="__codelineno-584-4" name="__codelineno-584-4" href="#__codelineno-584-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-584-5"><a id="__codelineno-584-5" name="__codelineno-584-5" href="#__codelineno-584-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">attacker</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-584-6"><a id="__codelineno-584-6" name="__codelineno-584-6" href="#__codelineno-584-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-584-7"><a id="__codelineno-584-7" name="__codelineno-584-7" href="#__codelineno-584-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">attackerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">attacker</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-584-8"><a id="__codelineno-584-8" name="__codelineno-584-8" href="#__codelineno-584-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">attackerChar</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-584-9"><a id="__codelineno-584-9" name="__codelineno-584-9" href="#__codelineno-584-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">damage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetDamage</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">damageScale</span>
</span><span id="__span-584-10"><a id="__codelineno-584-10" name="__codelineno-584-10" href="#__codelineno-584-10"></a><span class="w">        </span><span class="c1">-- Log damage to database</span>
</span><span id="__span-584-11"><a id="__codelineno-584-11" name="__codelineno-584-11" href="#__codelineno-584-11"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO damage_logs (timestamp, target_charid, attacker_charid, damage, hitgroup) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-584-12"><a id="__codelineno-584-12" name="__codelineno-584-12" href="#__codelineno-584-12"></a><span class="w">        </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">attackerChar</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">damage</span><span class="p">,</span><span class="w"> </span><span class="nv">hitgroup</span><span class="p">)</span>
</span><span id="__span-584-13"><a id="__codelineno-584-13" name="__codelineno-584-13" href="#__codelineno-584-13"></a><span class="w">        </span><span class="c1">-- Track damage statistics</span>
</span><span id="__span-584-14"><a id="__codelineno-584-14" name="__codelineno-584-14" href="#__codelineno-584-14"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">damageDealt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">attackerChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;damageDealt&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-584-15"><a id="__codelineno-584-15" name="__codelineno-584-15" href="#__codelineno-584-15"></a><span class="w">        </span><span class="nv">attackerChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damageDealt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">damageDealt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">damage</span><span class="p">)</span>
</span><span id="__span-584-16"><a id="__codelineno-584-16" name="__codelineno-584-16" href="#__codelineno-584-16"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">damageTaken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;damageTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-584-17"><a id="__codelineno-584-17" name="__codelineno-584-17" href="#__codelineno-584-17"></a><span class="w">        </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;damageTaken&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">damageTaken</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">damage</span><span class="p">)</span>
</span><span id="__span-584-18"><a id="__codelineno-584-18" name="__codelineno-584-18" href="#__codelineno-584-18"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="prechardelete">PreCharDelete</h3>
<p><strong>Purpose</strong></p>
<p>Called before a character is deleted</p>
<p><strong>When Called</strong></p>
<p>Before a character deletion is processed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>id</code> (<em>number</em>): The character ID being deleted</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-585-1"><a id="__codelineno-585-1" name="__codelineno-585-1" href="#__codelineno-585-1"></a><span class="c1">-- Simple: Log character deletion</span>
</span><span id="__span-585-2"><a id="__codelineno-585-2" name="__codelineno-585-2" href="#__codelineno-585-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-585-3"><a id="__codelineno-585-3" name="__codelineno-585-3" href="#__codelineno-585-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is being deleted&quot;</span><span class="p">)</span>
</span><span id="__span-585-4"><a id="__codelineno-585-4" name="__codelineno-585-4" href="#__codelineno-585-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-586-1"><a id="__codelineno-586-1" name="__codelineno-586-1" href="#__codelineno-586-1"></a><span class="c1">-- Medium: Backup character data</span>
</span><span id="__span-586-2"><a id="__codelineno-586-2" name="__codelineno-586-2" href="#__codelineno-586-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BackupCharData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-586-3"><a id="__codelineno-586-3" name="__codelineno-586-3" href="#__codelineno-586-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">id</span><span class="p">]</span>
</span><span id="__span-586-4"><a id="__codelineno-586-4" name="__codelineno-586-4" href="#__codelineno-586-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-586-5"><a id="__codelineno-586-5" name="__codelineno-586-5" href="#__codelineno-586-5"></a><span class="w">    </span><span class="c1">-- Create backup</span>
</span><span id="__span-586-6"><a id="__codelineno-586-6" name="__codelineno-586-6" href="#__codelineno-586-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO char_backups SELECT * FROM characters WHERE id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-586-7"><a id="__codelineno-586-7" name="__codelineno-586-7" href="#__codelineno-586-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-586-8"><a id="__codelineno-586-8" name="__codelineno-586-8" href="#__codelineno-586-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-587-1"><a id="__codelineno-587-1" name="__codelineno-587-1" href="#__codelineno-587-1"></a><span class="c1">-- High: Complex character deletion preparation</span>
</span><span id="__span-587-2"><a id="__codelineno-587-2" name="__codelineno-587-2" href="#__codelineno-587-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreCharDelete&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharDeletePrep&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-587-3"><a id="__codelineno-587-3" name="__codelineno-587-3" href="#__codelineno-587-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">id</span><span class="p">]</span>
</span><span id="__span-587-4"><a id="__codelineno-587-4" name="__codelineno-587-4" href="#__codelineno-587-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-587-5"><a id="__codelineno-587-5" name="__codelineno-587-5" href="#__codelineno-587-5"></a><span class="w">    </span><span class="c1">-- Create comprehensive backup</span>
</span><span id="__span-587-6"><a id="__codelineno-587-6" name="__codelineno-587-6" href="#__codelineno-587-6"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO char_backups SELECT * FROM characters WHERE id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-587-7"><a id="__codelineno-587-7" name="__codelineno-587-7" href="#__codelineno-587-7"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO char_items_backup SELECT * FROM char_items WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-587-8"><a id="__codelineno-587-8" name="__codelineno-587-8" href="#__codelineno-587-8"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO char_data_backup SELECT * FROM char_data WHERE charid = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-587-9"><a id="__codelineno-587-9" name="__codelineno-587-9" href="#__codelineno-587-9"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-587-10"><a id="__codelineno-587-10" name="__codelineno-587-10" href="#__codelineno-587-10"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-587-11"><a id="__codelineno-587-11" name="__codelineno-587-11" href="#__codelineno-587-11"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-587-12"><a id="__codelineno-587-12" name="__codelineno-587-12" href="#__codelineno-587-12"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;) is being deleted&quot;</span><span class="p">)</span>
</span><span id="__span-587-13"><a id="__codelineno-587-13" name="__codelineno-587-13" href="#__codelineno-587-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-587-14"><a id="__codelineno-587-14" name="__codelineno-587-14" href="#__codelineno-587-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-587-15"><a id="__codelineno-587-15" name="__codelineno-587-15" href="#__codelineno-587-15"></a><span class="w">    </span><span class="c1">-- Log deletion</span>
</span><span id="__span-587-16"><a id="__codelineno-587-16" name="__codelineno-587-16" href="#__codelineno-587-16"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s2">&quot;Character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;) is being deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;character&quot;</span><span class="p">)</span>
</span><span id="__span-587-17"><a id="__codelineno-587-17" name="__codelineno-587-17" href="#__codelineno-587-17"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="predoordatasave">PreDoorDataSave</h3>
<p><strong>Purpose</strong></p>
<p>Called before door data is saved</p>
<p><strong>When Called</strong></p>
<p>Before door configuration data is saved to database</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>doorData</code> (<em>table</em>): The door data being saved</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-588-1"><a id="__codelineno-588-1" name="__codelineno-588-1" href="#__codelineno-588-1"></a><span class="c1">-- Simple: Log door save</span>
</span><span id="__span-588-2"><a id="__codelineno-588-2" name="__codelineno-588-2" href="#__codelineno-588-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreDoorDataSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-588-3"><a id="__codelineno-588-3" name="__codelineno-588-3" href="#__codelineno-588-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving door data for entity &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-588-4"><a id="__codelineno-588-4" name="__codelineno-588-4" href="#__codelineno-588-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-589-1"><a id="__codelineno-589-1" name="__codelineno-589-1" href="#__codelineno-589-1"></a><span class="c1">-- Medium: Validate door data</span>
</span><span id="__span-589-2"><a id="__codelineno-589-2" name="__codelineno-589-2" href="#__codelineno-589-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreDoorDataSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateDoorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-589-3"><a id="__codelineno-589-3" name="__codelineno-589-3" href="#__codelineno-589-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-589-4"><a id="__codelineno-589-4" name="__codelineno-589-4" href="#__codelineno-589-4"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-589-5"><a id="__codelineno-589-5" name="__codelineno-589-5" href="#__codelineno-589-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-589-6"><a id="__codelineno-589-6" name="__codelineno-589-6" href="#__codelineno-589-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-590-1"><a id="__codelineno-590-1" name="__codelineno-590-1" href="#__codelineno-590-1"></a><span class="c1">-- High: Complex door data validation</span>
</span><span id="__span-590-2"><a id="__codelineno-590-2" name="__codelineno-590-2" href="#__codelineno-590-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreDoorDataSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorDataValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">doorData</span><span class="p">)</span>
</span><span id="__span-590-3"><a id="__codelineno-590-3" name="__codelineno-590-3" href="#__codelineno-590-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">door</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-590-4"><a id="__codelineno-590-4" name="__codelineno-590-4" href="#__codelineno-590-4"></a><span class="w">    </span><span class="c1">-- Validate price</span>
</span><span id="__span-590-5"><a id="__codelineno-590-5" name="__codelineno-590-5" href="#__codelineno-590-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-590-6"><a id="__codelineno-590-6" name="__codelineno-590-6" href="#__codelineno-590-6"></a><span class="w">        </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-590-7"><a id="__codelineno-590-7" name="__codelineno-590-7" href="#__codelineno-590-7"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-590-8"><a id="__codelineno-590-8" name="__codelineno-590-8" href="#__codelineno-590-8"></a><span class="w">        </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100000</span>
</span><span id="__span-590-9"><a id="__codelineno-590-9" name="__codelineno-590-9" href="#__codelineno-590-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-590-10"><a id="__codelineno-590-10" name="__codelineno-590-10" href="#__codelineno-590-10"></a><span class="w">    </span><span class="c1">-- Validate title length</span>
</span><span id="__span-590-11"><a id="__codelineno-590-11" name="__codelineno-590-11" href="#__codelineno-590-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="o">#</span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-590-12"><a id="__codelineno-590-12" name="__codelineno-590-12" href="#__codelineno-590-12"></a><span class="w">        </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">string.sub</span><span class="p">(</span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-590-13"><a id="__codelineno-590-13" name="__codelineno-590-13" href="#__codelineno-590-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-590-14"><a id="__codelineno-590-14" name="__codelineno-590-14" href="#__codelineno-590-14"></a><span class="w">    </span><span class="c1">-- Add metadata</span>
</span><span id="__span-590-15"><a id="__codelineno-590-15" name="__codelineno-590-15" href="#__codelineno-590-15"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">lastSaved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-590-16"><a id="__codelineno-590-16" name="__codelineno-590-16" href="#__codelineno-590-16"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">.</span><span class="nf">GetMap</span><span class="p">()</span>
</span><span id="__span-590-17"><a id="__codelineno-590-17" name="__codelineno-590-17" href="#__codelineno-590-17"></a><span class="w">    </span><span class="c1">-- Log save</span>
</span><span id="__span-590-18"><a id="__codelineno-590-18" name="__codelineno-590-18" href="#__codelineno-590-18"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Saving door data: Entity=%d, Title=%s, Price=%s&quot;</span><span class="p">,</span>
</span><span id="__span-590-19"><a id="__codelineno-590-19" name="__codelineno-590-19" href="#__codelineno-590-19"></a><span class="w">    </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span>
</span><span id="__span-590-20"><a id="__codelineno-590-20" name="__codelineno-590-20" href="#__codelineno-590-20"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">title</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="__span-590-21"><a id="__codelineno-590-21" name="__codelineno-590-21" href="#__codelineno-590-21"></a><span class="w">    </span><span class="nv">doorData</span><span class="p">.</span><span class="py">price</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">))</span>
</span><span id="__span-590-22"><a id="__codelineno-590-22" name="__codelineno-590-22" href="#__codelineno-590-22"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="preplayerinteractitem">PrePlayerInteractItem</h3>
<p><strong>Purpose</strong></p>
<p>Called before a player interacts with an item</p>
<p><strong>When Called</strong></p>
<p>Before an item interaction is processed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player interacting</li>
<li><code>action</code> (<em>string</em>): The action being performed</li>
<li><code>self</code> (<em>Item</em>): The item being interacted with</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-591-1"><a id="__codelineno-591-1" name="__codelineno-591-1" href="#__codelineno-591-1"></a><span class="c1">-- Simple: Allow all interactions</span>
</span><span id="__span-591-2"><a id="__codelineno-591-2" name="__codelineno-591-2" href="#__codelineno-591-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-591-3"><a id="__codelineno-591-3" name="__codelineno-591-3" href="#__codelineno-591-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-591-4"><a id="__codelineno-591-4" name="__codelineno-591-4" href="#__codelineno-591-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-592-1"><a id="__codelineno-592-1" name="__codelineno-592-1" href="#__codelineno-592-1"></a><span class="c1">-- Medium: Check cooldown</span>
</span><span id="__span-592-2"><a id="__codelineno-592-2" name="__codelineno-592-2" href="#__codelineno-592-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CheckCooldown&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-592-3"><a id="__codelineno-592-3" name="__codelineno-592-3" href="#__codelineno-592-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-592-4"><a id="__codelineno-592-4" name="__codelineno-592-4" href="#__codelineno-592-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-592-5"><a id="__codelineno-592-5" name="__codelineno-592-5" href="#__codelineno-592-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastUse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastItemUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-592-6"><a id="__codelineno-592-6" name="__codelineno-592-6" href="#__codelineno-592-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastUse</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-592-7"><a id="__codelineno-592-7" name="__codelineno-592-7" href="#__codelineno-592-7"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-592-8"><a id="__codelineno-592-8" name="__codelineno-592-8" href="#__codelineno-592-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-592-9"><a id="__codelineno-592-9" name="__codelineno-592-9" href="#__codelineno-592-9"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastItemUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">())</span>
</span><span id="__span-592-10"><a id="__codelineno-592-10" name="__codelineno-592-10" href="#__codelineno-592-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-592-11"><a id="__codelineno-592-11" name="__codelineno-592-11" href="#__codelineno-592-11"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-593-1"><a id="__codelineno-593-1" name="__codelineno-593-1" href="#__codelineno-593-1"></a><span class="c1">-- High: Complex item interaction validation</span>
</span><span id="__span-593-2"><a id="__codelineno-593-2" name="__codelineno-593-2" href="#__codelineno-593-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerInteractItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemInteraction&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
</span><span id="__span-593-3"><a id="__codelineno-593-3" name="__codelineno-593-3" href="#__codelineno-593-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-593-4"><a id="__codelineno-593-4" name="__codelineno-593-4" href="#__codelineno-593-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-593-5"><a id="__codelineno-593-5" name="__codelineno-593-5" href="#__codelineno-593-5"></a><span class="w">    </span><span class="c1">-- Check cooldown</span>
</span><span id="__span-593-6"><a id="__codelineno-593-6" name="__codelineno-593-6" href="#__codelineno-593-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lastUse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;lastItemUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-593-7"><a id="__codelineno-593-7" name="__codelineno-593-7" href="#__codelineno-593-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastUse</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-593-8"><a id="__codelineno-593-8" name="__codelineno-593-8" href="#__codelineno-593-8"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please wait before using another item&quot;</span><span class="p">)</span>
</span><span id="__span-593-9"><a id="__codelineno-593-9" name="__codelineno-593-9" href="#__codelineno-593-9"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-593-10"><a id="__codelineno-593-10" name="__codelineno-593-10" href="#__codelineno-593-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-593-11"><a id="__codelineno-593-11" name="__codelineno-593-11" href="#__codelineno-593-11"></a><span class="w">    </span><span class="c1">-- Check if item is broken</span>
</span><span id="__span-593-12"><a id="__codelineno-593-12" name="__codelineno-593-12" href="#__codelineno-593-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-593-13"><a id="__codelineno-593-13" name="__codelineno-593-13" href="#__codelineno-593-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-593-14"><a id="__codelineno-593-14" name="__codelineno-593-14" href="#__codelineno-593-14"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;This item is broken and cannot be used&quot;</span><span class="p">)</span>
</span><span id="__span-593-15"><a id="__codelineno-593-15" name="__codelineno-593-15" href="#__codelineno-593-15"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-593-16"><a id="__codelineno-593-16" name="__codelineno-593-16" href="#__codelineno-593-16"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-593-17"><a id="__codelineno-593-17" name="__codelineno-593-17" href="#__codelineno-593-17"></a><span class="w">    </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-593-18"><a id="__codelineno-593-18" name="__codelineno-593-18" href="#__codelineno-593-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">requiredFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">requiredFaction</span>
</span><span id="__span-593-19"><a id="__codelineno-593-19" name="__codelineno-593-19" href="#__codelineno-593-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">requiredFaction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">requiredFaction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-593-20"><a id="__codelineno-593-20" name="__codelineno-593-20" href="#__codelineno-593-20"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your faction cannot use this item&quot;</span><span class="p">)</span>
</span><span id="__span-593-21"><a id="__codelineno-593-21" name="__codelineno-593-21" href="#__codelineno-593-21"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-593-22"><a id="__codelineno-593-22" name="__codelineno-593-22" href="#__codelineno-593-22"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-593-23"><a id="__codelineno-593-23" name="__codelineno-593-23" href="#__codelineno-593-23"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastItemUse&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">())</span>
</span><span id="__span-593-24"><a id="__codelineno-593-24" name="__codelineno-593-24" href="#__codelineno-593-24"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-593-25"><a id="__codelineno-593-25" name="__codelineno-593-25" href="#__codelineno-593-25"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="preplayerloadedchar">PrePlayerLoadedChar</h3>
<p><strong>Purpose</strong></p>
<p>Called before a player loads a character</p>
<p><strong>When Called</strong></p>
<p>Before a character is loaded for a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>character</code> (<em>Character</em>): The character being loaded</li>
<li><code>currentChar</code> (<em>Character</em>): The current character (if any)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-594-1"><a id="__codelineno-594-1" name="__codelineno-594-1" href="#__codelineno-594-1"></a><span class="c1">-- Simple: Log character load</span>
</span><span id="__span-594-2"><a id="__codelineno-594-2" name="__codelineno-594-2" href="#__codelineno-594-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-594-3"><a id="__codelineno-594-3" name="__codelineno-594-3" href="#__codelineno-594-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is loading character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-594-4"><a id="__codelineno-594-4" name="__codelineno-594-4" href="#__codelineno-594-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-595-1"><a id="__codelineno-595-1" name="__codelineno-595-1" href="#__codelineno-595-1"></a><span class="c1">-- Medium: Save current character state</span>
</span><span id="__span-595-2"><a id="__codelineno-595-2" name="__codelineno-595-2" href="#__codelineno-595-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SaveCurrentChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-595-3"><a id="__codelineno-595-3" name="__codelineno-595-3" href="#__codelineno-595-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-595-4"><a id="__codelineno-595-4" name="__codelineno-595-4" href="#__codelineno-595-4"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-595-5"><a id="__codelineno-595-5" name="__codelineno-595-5" href="#__codelineno-595-5"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-595-6"><a id="__codelineno-595-6" name="__codelineno-595-6" href="#__codelineno-595-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-595-7"><a id="__codelineno-595-7" name="__codelineno-595-7" href="#__codelineno-595-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-596-1"><a id="__codelineno-596-1" name="__codelineno-596-1" href="#__codelineno-596-1"></a><span class="c1">-- High: Complex character load preparation</span>
</span><span id="__span-596-2"><a id="__codelineno-596-2" name="__codelineno-596-2" href="#__codelineno-596-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PrePlayerLoadedChar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharLoadPrep&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">,</span><span class="w"> </span><span class="nv">currentChar</span><span class="p">)</span>
</span><span id="__span-596-3"><a id="__codelineno-596-3" name="__codelineno-596-3" href="#__codelineno-596-3"></a><span class="c1">-- Save current character state</span>
</span><span id="__span-596-4"><a id="__codelineno-596-4" name="__codelineno-596-4" href="#__codelineno-596-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">currentChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-596-5"><a id="__codelineno-596-5" name="__codelineno-596-5" href="#__codelineno-596-5"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastHealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
</span><span id="__span-596-6"><a id="__codelineno-596-6" name="__codelineno-596-6" href="#__codelineno-596-6"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastArmor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Armor</span><span class="p">())</span>
</span><span id="__span-596-7"><a id="__codelineno-596-7" name="__codelineno-596-7" href="#__codelineno-596-7"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastPosition&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-596-8"><a id="__codelineno-596-8" name="__codelineno-596-8" href="#__codelineno-596-8"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastAngles&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">())</span>
</span><span id="__span-596-9"><a id="__codelineno-596-9" name="__codelineno-596-9" href="#__codelineno-596-9"></a><span class="w">    </span><span class="nv">currentChar</span><span class="p">:</span><span class="nf">save</span><span class="p">()</span>
</span><span id="__span-596-10"><a id="__codelineno-596-10" name="__codelineno-596-10" href="#__codelineno-596-10"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-596-11"><a id="__codelineno-596-11" name="__codelineno-596-11" href="#__codelineno-596-11"></a><span class="c1">-- Validate character data</span>
</span><span id="__span-596-12"><a id="__codelineno-596-12" name="__codelineno-596-12" href="#__codelineno-596-12"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;validated&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-596-13"><a id="__codelineno-596-13" name="__codelineno-596-13" href="#__codelineno-596-13"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;validated&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-596-14"><a id="__codelineno-596-14" name="__codelineno-596-14" href="#__codelineno-596-14"></a><span class="w">    </span><span class="nv">character</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;loadCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-596-15"><a id="__codelineno-596-15" name="__codelineno-596-15" href="#__codelineno-596-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-596-16"><a id="__codelineno-596-16" name="__codelineno-596-16" href="#__codelineno-596-16"></a><span class="c1">-- Log character load</span>
</span><span id="__span-596-17"><a id="__codelineno-596-17" name="__codelineno-596-17" href="#__codelineno-596-17"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO char_load_logs (timestamp, charid, steamid) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-596-18"><a id="__codelineno-596-18" name="__codelineno-596-18" href="#__codelineno-596-18"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-596-19"><a id="__codelineno-596-19" name="__codelineno-596-19" href="#__codelineno-596-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="presalarygive">PreSalaryGive</h3>
<p><strong>Purpose</strong></p>
<p>Called before salary is given to a player</p>
<p><strong>When Called</strong></p>
<p>Before salary payment is processed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player receiving salary</li>
<li><code>char</code> (<em>Character</em>): The character receiving salary</li>
<li><code>pay</code> (<em>number</em>): The salary amount</li>
<li><code>faction</code> (<em>string</em>): The faction name</li>
<li><code>class</code> (<em>string</em>): The class name</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-597-1"><a id="__codelineno-597-1" name="__codelineno-597-1" href="#__codelineno-597-1"></a><span class="c1">-- Simple: Log salary</span>
</span><span id="__span-597-2"><a id="__codelineno-597-2" name="__codelineno-597-2" href="#__codelineno-597-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreSalaryGive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-597-3"><a id="__codelineno-597-3" name="__codelineno-597-3" href="#__codelineno-597-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is receiving $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; salary&quot;</span><span class="p">)</span>
</span><span id="__span-597-4"><a id="__codelineno-597-4" name="__codelineno-597-4" href="#__codelineno-597-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-598-1"><a id="__codelineno-598-1" name="__codelineno-598-1" href="#__codelineno-598-1"></a><span class="c1">-- Medium: Modify salary amount</span>
</span><span id="__span-598-2"><a id="__codelineno-598-2" name="__codelineno-598-2" href="#__codelineno-598-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreSalaryGive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ModifySalary&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-598-3"><a id="__codelineno-598-3" name="__codelineno-598-3" href="#__codelineno-598-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-598-4"><a id="__codelineno-598-4" name="__codelineno-598-4" href="#__codelineno-598-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-598-5"><a id="__codelineno-598-5" name="__codelineno-598-5" href="#__codelineno-598-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-598-6"><a id="__codelineno-598-6" name="__codelineno-598-6" href="#__codelineno-598-6"></a><span class="w">    </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-598-7"><a id="__codelineno-598-7" name="__codelineno-598-7" href="#__codelineno-598-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-598-8"><a id="__codelineno-598-8" name="__codelineno-598-8" href="#__codelineno-598-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-599-1"><a id="__codelineno-599-1" name="__codelineno-599-1" href="#__codelineno-599-1"></a><span class="c1">-- High: Complex salary calculation</span>
</span><span id="__span-599-2"><a id="__codelineno-599-2" name="__codelineno-599-2" href="#__codelineno-599-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreSalaryGive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSalaryCalculation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">,</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-599-3"><a id="__codelineno-599-3" name="__codelineno-599-3" href="#__codelineno-599-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-599-4"><a id="__codelineno-599-4" name="__codelineno-599-4" href="#__codelineno-599-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-599-5"><a id="__codelineno-599-5" name="__codelineno-599-5" href="#__codelineno-599-5"></a><span class="w">    </span><span class="c1">-- Base salary modifications</span>
</span><span id="__span-599-6"><a id="__codelineno-599-6" name="__codelineno-599-6" href="#__codelineno-599-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-599-7"><a id="__codelineno-599-7" name="__codelineno-599-7" href="#__codelineno-599-7"></a><span class="w">    </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-599-8"><a id="__codelineno-599-8" name="__codelineno-599-8" href="#__codelineno-599-8"></a><span class="w">    </span><span class="c1">-- Faction bonuses</span>
</span><span id="__span-599-9"><a id="__codelineno-599-9" name="__codelineno-599-9" href="#__codelineno-599-9"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-599-10"><a id="__codelineno-599-10" name="__codelineno-599-10" href="#__codelineno-599-10"></a><span class="w">        </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span>
</span><span id="__span-599-11"><a id="__codelineno-599-11" name="__codelineno-599-11" href="#__codelineno-599-11"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;medic&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-599-12"><a id="__codelineno-599-12" name="__codelineno-599-12" href="#__codelineno-599-12"></a><span class="w">        </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.1</span>
</span><span id="__span-599-13"><a id="__codelineno-599-13" name="__codelineno-599-13" href="#__codelineno-599-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-599-14"><a id="__codelineno-599-14" name="__codelineno-599-14" href="#__codelineno-599-14"></a><span class="w">    </span><span class="c1">-- Class bonuses</span>
</span><span id="__span-599-15"><a id="__codelineno-599-15" name="__codelineno-599-15" href="#__codelineno-599-15"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;officer&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-599-16"><a id="__codelineno-599-16" name="__codelineno-599-16" href="#__codelineno-599-16"></a><span class="w">        </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">50</span>
</span><span id="__span-599-17"><a id="__codelineno-599-17" name="__codelineno-599-17" href="#__codelineno-599-17"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;doctor&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-599-18"><a id="__codelineno-599-18" name="__codelineno-599-18" href="#__codelineno-599-18"></a><span class="w">        </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">75</span>
</span><span id="__span-599-19"><a id="__codelineno-599-19" name="__codelineno-599-19" href="#__codelineno-599-19"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-599-20"><a id="__codelineno-599-20" name="__codelineno-599-20" href="#__codelineno-599-20"></a><span class="w">    </span><span class="c1">-- VIP bonus</span>
</span><span id="__span-599-21"><a id="__codelineno-599-21" name="__codelineno-599-21" href="#__codelineno-599-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vip&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-599-22"><a id="__codelineno-599-22" name="__codelineno-599-22" href="#__codelineno-599-22"></a><span class="w">        </span><span class="nv">pay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pay</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span>
</span><span id="__span-599-23"><a id="__codelineno-599-23" name="__codelineno-599-23" href="#__codelineno-599-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-599-24"><a id="__codelineno-599-24" name="__codelineno-599-24" href="#__codelineno-599-24"></a><span class="w">    </span><span class="c1">-- Log salary calculation</span>
</span><span id="__span-599-25"><a id="__codelineno-599-25" name="__codelineno-599-25" href="#__codelineno-599-25"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO salary_logs (timestamp, charid, amount, faction, class) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-599-26"><a id="__codelineno-599-26" name="__codelineno-599-26" href="#__codelineno-599-26"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">pay</span><span class="p">,</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span>
</span><span id="__span-599-27"><a id="__codelineno-599-27" name="__codelineno-599-27" href="#__codelineno-599-27"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="prescaledamage">PreScaleDamage</h3>
<p><strong>Purpose</strong></p>
<p>Called before damage scaling is calculated</p>
<p><strong>When Called</strong></p>
<p>Before damage is scaled</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>hitgroup</code> (<em>number</em>): The hitgroup that was hit</li>
<li><code>dmgInfo</code> (<em>CTakeDamageInfo</em>): The damage info</li>
<li><code>damageScale</code> (<em>number</em>): The current damage scale</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-600-1"><a id="__codelineno-600-1" name="__codelineno-600-1" href="#__codelineno-600-1"></a><span class="c1">-- Simple: Log damage scaling</span>
</span><span id="__span-600-2"><a id="__codelineno-600-2" name="__codelineno-600-2" href="#__codelineno-600-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-600-3"><a id="__codelineno-600-3" name="__codelineno-600-3" href="#__codelineno-600-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scaling damage for hitgroup &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">hitgroup</span><span class="p">)</span>
</span><span id="__span-600-4"><a id="__codelineno-600-4" name="__codelineno-600-4" href="#__codelineno-600-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-601-1"><a id="__codelineno-601-1" name="__codelineno-601-1" href="#__codelineno-601-1"></a><span class="c1">-- Medium: Modify damage scale</span>
</span><span id="__span-601-2"><a id="__codelineno-601-2" name="__codelineno-601-2" href="#__codelineno-601-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ModifyDamageScale&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-601-3"><a id="__codelineno-601-3" name="__codelineno-601-3" href="#__codelineno-601-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">hitgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">HITGROUP_HEAD</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-601-4"><a id="__codelineno-601-4" name="__codelineno-601-4" href="#__codelineno-601-4"></a><span class="w">    </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span>
</span><span id="__span-601-5"><a id="__codelineno-601-5" name="__codelineno-601-5" href="#__codelineno-601-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-601-6"><a id="__codelineno-601-6" name="__codelineno-601-6" href="#__codelineno-601-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-602-1"><a id="__codelineno-602-1" name="__codelineno-602-1" href="#__codelineno-602-1"></a><span class="c1">-- High: Complex damage scaling system</span>
</span><span id="__span-602-2"><a id="__codelineno-602-2" name="__codelineno-602-2" href="#__codelineno-602-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PreScaleDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDamageScaling&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">hitgroup</span><span class="p">,</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">,</span><span class="w"> </span><span class="nv">damageScale</span><span class="p">)</span>
</span><span id="__span-602-3"><a id="__codelineno-602-3" name="__codelineno-602-3" href="#__codelineno-602-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-602-4"><a id="__codelineno-602-4" name="__codelineno-602-4" href="#__codelineno-602-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">attacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dmgInfo</span><span class="p">:</span><span class="nf">GetAttacker</span><span class="p">()</span>
</span><span id="__span-602-5"><a id="__codelineno-602-5" name="__codelineno-602-5" href="#__codelineno-602-5"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">target</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">attacker</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-602-6"><a id="__codelineno-602-6" name="__codelineno-602-6" href="#__codelineno-602-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-602-7"><a id="__codelineno-602-7" name="__codelineno-602-7" href="#__codelineno-602-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">attackerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">attacker</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-602-8"><a id="__codelineno-602-8" name="__codelineno-602-8" href="#__codelineno-602-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">targetChar</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">attackerChar</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-602-9"><a id="__codelineno-602-9" name="__codelineno-602-9" href="#__codelineno-602-9"></a><span class="w">        </span><span class="c1">-- Faction damage modifiers</span>
</span><span id="__span-602-10"><a id="__codelineno-602-10" name="__codelineno-602-10" href="#__codelineno-602-10"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-602-11"><a id="__codelineno-602-11" name="__codelineno-602-11" href="#__codelineno-602-11"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">attackerFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">attackerChar</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-602-12"><a id="__codelineno-602-12" name="__codelineno-602-12" href="#__codelineno-602-12"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attackerFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-602-13"><a id="__codelineno-602-13" name="__codelineno-602-13" href="#__codelineno-602-13"></a><span class="w">            </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span>
</span><span id="__span-602-14"><a id="__codelineno-602-14" name="__codelineno-602-14" href="#__codelineno-602-14"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">targetFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;criminal&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">attackerFaction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;police&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-602-15"><a id="__codelineno-602-15" name="__codelineno-602-15" href="#__codelineno-602-15"></a><span class="w">            </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.8</span>
</span><span id="__span-602-16"><a id="__codelineno-602-16" name="__codelineno-602-16" href="#__codelineno-602-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-602-17"><a id="__codelineno-602-17" name="__codelineno-602-17" href="#__codelineno-602-17"></a><span class="w">        </span><span class="c1">-- Armor protection</span>
</span><span id="__span-602-18"><a id="__codelineno-602-18" name="__codelineno-602-18" href="#__codelineno-602-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;armor&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-602-19"><a id="__codelineno-602-19" name="__codelineno-602-19" href="#__codelineno-602-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">armor</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-602-20"><a id="__codelineno-602-20" name="__codelineno-602-20" href="#__codelineno-602-20"></a><span class="w">            </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">damageScale</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">armor</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">200</span><span class="p">))</span>
</span><span id="__span-602-21"><a id="__codelineno-602-21" name="__codelineno-602-21" href="#__codelineno-602-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-602-22"><a id="__codelineno-602-22" name="__codelineno-602-22" href="#__codelineno-602-22"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="registerpreparedstatements">RegisterPreparedStatements</h3>
<p><strong>Purpose</strong></p>
<p>Called to register prepared SQL statements</p>
<p><strong>When Called</strong></p>
<p>When setting up database prepared statements</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-603-1"><a id="__codelineno-603-1" name="__codelineno-603-1" href="#__codelineno-603-1"></a><span class="c1">-- Simple: Log statement registration</span>
</span><span id="__span-603-2"><a id="__codelineno-603-2" name="__codelineno-603-2" href="#__codelineno-603-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RegisterPreparedStatements&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-603-3"><a id="__codelineno-603-3" name="__codelineno-603-3" href="#__codelineno-603-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Registering prepared statements&quot;</span><span class="p">)</span>
</span><span id="__span-603-4"><a id="__codelineno-603-4" name="__codelineno-603-4" href="#__codelineno-603-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-604-1"><a id="__codelineno-604-1" name="__codelineno-604-1" href="#__codelineno-604-1"></a><span class="c1">-- Medium: Register custom statements</span>
</span><span id="__span-604-2"><a id="__codelineno-604-2" name="__codelineno-604-2" href="#__codelineno-604-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RegisterPreparedStatements&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RegisterCustomStatements&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-604-3"><a id="__codelineno-604-3" name="__codelineno-604-3" href="#__codelineno-604-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;my_query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM my_table WHERE id = ?&quot;</span><span class="p">)</span>
</span><span id="__span-604-4"><a id="__codelineno-604-4" name="__codelineno-604-4" href="#__codelineno-604-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;my_insert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;INSERT INTO my_table (data) VALUES (?)&quot;</span><span class="p">)</span>
</span><span id="__span-604-5"><a id="__codelineno-604-5" name="__codelineno-604-5" href="#__codelineno-604-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-605-1"><a id="__codelineno-605-1" name="__codelineno-605-1" href="#__codelineno-605-1"></a><span class="c1">-- High: Complex statement registration</span>
</span><span id="__span-605-2"><a id="__codelineno-605-2" name="__codelineno-605-2" href="#__codelineno-605-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RegisterPreparedStatements&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStatementRegistration&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-605-3"><a id="__codelineno-605-3" name="__codelineno-605-3" href="#__codelineno-605-3"></a><span class="c1">-- Register custom queries</span>
</span><span id="__span-605-4"><a id="__codelineno-605-4" name="__codelineno-605-4" href="#__codelineno-605-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;get_player_stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM player_stats WHERE steamid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-5"><a id="__codelineno-605-5" name="__codelineno-605-5" href="#__codelineno-605-5"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;update_player_stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UPDATE player_stats SET kills = ?, deaths = ? WHERE steamid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-6"><a id="__codelineno-605-6" name="__codelineno-605-6" href="#__codelineno-605-6"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;insert_player_stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;INSERT INTO player_stats (steamid, kills, deaths) VALUES (?, ?, ?)&quot;</span><span class="p">)</span>
</span><span id="__span-605-7"><a id="__codelineno-605-7" name="__codelineno-605-7" href="#__codelineno-605-7"></a><span class="c1">-- Register character queries</span>
</span><span id="__span-605-8"><a id="__codelineno-605-8" name="__codelineno-605-8" href="#__codelineno-605-8"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;get_char_data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM char_data WHERE charid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-9"><a id="__codelineno-605-9" name="__codelineno-605-9" href="#__codelineno-605-9"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;update_char_data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UPDATE char_data SET value = ? WHERE charid = ? AND key = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-10"><a id="__codelineno-605-10" name="__codelineno-605-10" href="#__codelineno-605-10"></a><span class="c1">-- Register item queries</span>
</span><span id="__span-605-11"><a id="__codelineno-605-11" name="__codelineno-605-11" href="#__codelineno-605-11"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;get_item_data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM item_data WHERE itemid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-12"><a id="__codelineno-605-12" name="__codelineno-605-12" href="#__codelineno-605-12"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;update_item_data&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UPDATE item_data SET value = ? WHERE itemid = ? AND key = ?&quot;</span><span class="p">)</span>
</span><span id="__span-605-13"><a id="__codelineno-605-13" name="__codelineno-605-13" href="#__codelineno-605-13"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All prepared statements registered&quot;</span><span class="p">)</span>
</span><span id="__span-605-14"><a id="__codelineno-605-14" name="__codelineno-605-14" href="#__codelineno-605-14"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="removewarning">RemoveWarning</h3>
<p><strong>Purpose</strong></p>
<p>Called when a warning is removed</p>
<p><strong>When Called</strong></p>
<p>When a character warning is deleted</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>charID</code> (<em>number</em>): The character ID</li>
<li><code>index</code> (<em>number</em>): The warning index</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-606-1"><a id="__codelineno-606-1" name="__codelineno-606-1" href="#__codelineno-606-1"></a><span class="c1">-- Simple: Log warning removal</span>
</span><span id="__span-606-2"><a id="__codelineno-606-2" name="__codelineno-606-2" href="#__codelineno-606-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RemoveWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span>
</span><span id="__span-606-3"><a id="__codelineno-606-3" name="__codelineno-606-3" href="#__codelineno-606-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; removed for character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">charID</span><span class="p">)</span>
</span><span id="__span-606-4"><a id="__codelineno-606-4" name="__codelineno-606-4" href="#__codelineno-606-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-607-1"><a id="__codelineno-607-1" name="__codelineno-607-1" href="#__codelineno-607-1"></a><span class="c1">-- Medium: Track warning removals</span>
</span><span id="__span-607-2"><a id="__codelineno-607-2" name="__codelineno-607-2" href="#__codelineno-607-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RemoveWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackWarningRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span>
</span><span id="__span-607-3"><a id="__codelineno-607-3" name="__codelineno-607-3" href="#__codelineno-607-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">charID</span><span class="p">]</span>
</span><span id="__span-607-4"><a id="__codelineno-607-4" name="__codelineno-607-4" href="#__codelineno-607-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-607-5"><a id="__codelineno-607-5" name="__codelineno-607-5" href="#__codelineno-607-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">warningRemovals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;warningRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-607-6"><a id="__codelineno-607-6" name="__codelineno-607-6" href="#__codelineno-607-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;warningRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">warningRemovals</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-607-7"><a id="__codelineno-607-7" name="__codelineno-607-7" href="#__codelineno-607-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-607-8"><a id="__codelineno-607-8" name="__codelineno-607-8" href="#__codelineno-607-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-608-1"><a id="__codelineno-608-1" name="__codelineno-608-1" href="#__codelineno-608-1"></a><span class="c1">-- High: Complex warning removal system</span>
</span><span id="__span-608-2"><a id="__codelineno-608-2" name="__codelineno-608-2" href="#__codelineno-608-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RemoveWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWarningRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span>
</span><span id="__span-608-3"><a id="__codelineno-608-3" name="__codelineno-608-3" href="#__codelineno-608-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">charID</span><span class="p">]</span>
</span><span id="__span-608-4"><a id="__codelineno-608-4" name="__codelineno-608-4" href="#__codelineno-608-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-608-5"><a id="__codelineno-608-5" name="__codelineno-608-5" href="#__codelineno-608-5"></a><span class="w">    </span><span class="c1">-- Track warning removals</span>
</span><span id="__span-608-6"><a id="__codelineno-608-6" name="__codelineno-608-6" href="#__codelineno-608-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">warningRemovals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;warningRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-608-7"><a id="__codelineno-608-7" name="__codelineno-608-7" href="#__codelineno-608-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;warningRemovals&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">warningRemovals</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-608-8"><a id="__codelineno-608-8" name="__codelineno-608-8" href="#__codelineno-608-8"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-608-9"><a id="__codelineno-608-9" name="__codelineno-608-9" href="#__codelineno-608-9"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO warning_logs (timestamp, charid, action, warning_index) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-608-10"><a id="__codelineno-608-10" name="__codelineno-608-10" href="#__codelineno-608-10"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">charID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;removed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span>
</span><span id="__span-608-11"><a id="__codelineno-608-11" name="__codelineno-608-11" href="#__codelineno-608-11"></a><span class="w">    </span><span class="c1">-- Notify character owner</span>
</span><span id="__span-608-12"><a id="__codelineno-608-12" name="__codelineno-608-12" href="#__codelineno-608-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span>
</span><span id="__span-608-13"><a id="__codelineno-608-13" name="__codelineno-608-13" href="#__codelineno-608-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-608-14"><a id="__codelineno-608-14" name="__codelineno-608-14" href="#__codelineno-608-14"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Warning &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been removed&quot;</span><span class="p">)</span>
</span><span id="__span-608-15"><a id="__codelineno-608-15" name="__codelineno-608-15" href="#__codelineno-608-15"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-608-16"><a id="__codelineno-608-16" name="__codelineno-608-16" href="#__codelineno-608-16"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-608-17"><a id="__codelineno-608-17" name="__codelineno-608-17" href="#__codelineno-608-17"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-608-18"><a id="__codelineno-608-18" name="__codelineno-608-18" href="#__codelineno-608-18"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-608-19"><a id="__codelineno-608-19" name="__codelineno-608-19" href="#__codelineno-608-19"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] Warning &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; removed for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-608-20"><a id="__codelineno-608-20" name="__codelineno-608-20" href="#__codelineno-608-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-608-21"><a id="__codelineno-608-21" name="__codelineno-608-21" href="#__codelineno-608-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-608-22"><a id="__codelineno-608-22" name="__codelineno-608-22" href="#__codelineno-608-22"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="runadminsystemcommand">RunAdminSystemCommand</h3>
<p><strong>Purpose</strong></p>
<p>Called when an admin system command is run</p>
<p><strong>When Called</strong></p>
<p>When an admin command is executed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>cmd</code> (<em>string</em>): The command name</li>
<li><code>admin</code> (<em>Player</em>): The admin running the command</li>
<li><code>victim</code> (<em>Player</em>): The target player (if any)</li>
<li><code>dur</code> (<em>number</em>): The duration (if applicable)</li>
<li><code>reason</code> (<em>string</em>): The reason (if applicable)</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-609-1"><a id="__codelineno-609-1" name="__codelineno-609-1" href="#__codelineno-609-1"></a><span class="c1">-- Simple: Log admin commands</span>
</span><span id="__span-609-2"><a id="__codelineno-609-2" name="__codelineno-609-2" href="#__codelineno-609-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RunAdminSystemCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">cmd</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">,</span><span class="w"> </span><span class="nv">victim</span><span class="p">,</span><span class="w"> </span><span class="nv">dur</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-609-3"><a id="__codelineno-609-3" name="__codelineno-609-3" href="#__codelineno-609-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; ran command: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">cmd</span><span class="p">)</span>
</span><span id="__span-609-4"><a id="__codelineno-609-4" name="__codelineno-609-4" href="#__codelineno-609-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-610-1"><a id="__codelineno-610-1" name="__codelineno-610-1" href="#__codelineno-610-1"></a><span class="c1">-- Medium: Track command usage</span>
</span><span id="__span-610-2"><a id="__codelineno-610-2" name="__codelineno-610-2" href="#__codelineno-610-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RunAdminSystemCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackCommandUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">cmd</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">,</span><span class="w"> </span><span class="nv">victim</span><span class="p">,</span><span class="w"> </span><span class="nv">dur</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-610-3"><a id="__codelineno-610-3" name="__codelineno-610-3" href="#__codelineno-610-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-610-4"><a id="__codelineno-610-4" name="__codelineno-610-4" href="#__codelineno-610-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-610-5"><a id="__codelineno-610-5" name="__codelineno-610-5" href="#__codelineno-610-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;commandsUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-610-6"><a id="__codelineno-610-6" name="__codelineno-610-6" href="#__codelineno-610-6"></a><span class="w">    </span><span class="nv">commands</span><span class="p">[</span><span class="nv">cmd</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">commands</span><span class="p">[</span><span class="nv">cmd</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-610-7"><a id="__codelineno-610-7" name="__codelineno-610-7" href="#__codelineno-610-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;commandsUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">commands</span><span class="p">)</span>
</span><span id="__span-610-8"><a id="__codelineno-610-8" name="__codelineno-610-8" href="#__codelineno-610-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-610-9"><a id="__codelineno-610-9" name="__codelineno-610-9" href="#__codelineno-610-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-611-1"><a id="__codelineno-611-1" name="__codelineno-611-1" href="#__codelineno-611-1"></a><span class="c1">-- High: Complex admin command tracking</span>
</span><span id="__span-611-2"><a id="__codelineno-611-2" name="__codelineno-611-2" href="#__codelineno-611-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;RunAdminSystemCommand&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCommandTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">cmd</span><span class="p">,</span><span class="w"> </span><span class="nv">admin</span><span class="p">,</span><span class="w"> </span><span class="nv">victim</span><span class="p">,</span><span class="w"> </span><span class="nv">dur</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-611-3"><a id="__codelineno-611-3" name="__codelineno-611-3" href="#__codelineno-611-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-611-4"><a id="__codelineno-611-4" name="__codelineno-611-4" href="#__codelineno-611-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-611-5"><a id="__codelineno-611-5" name="__codelineno-611-5" href="#__codelineno-611-5"></a><span class="w">    </span><span class="c1">-- Track command usage</span>
</span><span id="__span-611-6"><a id="__codelineno-611-6" name="__codelineno-611-6" href="#__codelineno-611-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;commandsUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-611-7"><a id="__codelineno-611-7" name="__codelineno-611-7" href="#__codelineno-611-7"></a><span class="w">    </span><span class="nv">commands</span><span class="p">[</span><span class="nv">cmd</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">commands</span><span class="p">[</span><span class="nv">cmd</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-611-8"><a id="__codelineno-611-8" name="__codelineno-611-8" href="#__codelineno-611-8"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;commandsUsed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">commands</span><span class="p">)</span>
</span><span id="__span-611-9"><a id="__codelineno-611-9" name="__codelineno-611-9" href="#__codelineno-611-9"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-611-10"><a id="__codelineno-611-10" name="__codelineno-611-10" href="#__codelineno-611-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO admin_logs (timestamp, admin_steamid, command, target_steamid, duration, reason) VALUES (?, ?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-611-11"><a id="__codelineno-611-11" name="__codelineno-611-11" href="#__codelineno-611-11"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">cmd</span><span class="p">,</span><span class="w"> </span><span class="nv">victim</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">victim</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">dur</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-611-12"><a id="__codelineno-611-12" name="__codelineno-611-12" href="#__codelineno-611-12"></a><span class="w">    </span><span class="c1">-- Notify other admins</span>
</span><span id="__span-611-13"><a id="__codelineno-611-13" name="__codelineno-611-13" href="#__codelineno-611-13"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-611-14"><a id="__codelineno-611-14" name="__codelineno-611-14" href="#__codelineno-611-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">admin</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-611-15"><a id="__codelineno-611-15" name="__codelineno-611-15" href="#__codelineno-611-15"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">admin</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; used &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">cmd</span>
</span><span id="__span-611-16"><a id="__codelineno-611-16" name="__codelineno-611-16" href="#__codelineno-611-16"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">victim</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-611-17"><a id="__codelineno-611-17" name="__codelineno-611-17" href="#__codelineno-611-17"></a><span class="w">                </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">victim</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span>
</span><span id="__span-611-18"><a id="__codelineno-611-18" name="__codelineno-611-18" href="#__codelineno-611-18"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-611-19"><a id="__codelineno-611-19" name="__codelineno-611-19" href="#__codelineno-611-19"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-611-20"><a id="__codelineno-611-20" name="__codelineno-611-20" href="#__codelineno-611-20"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-611-21"><a id="__codelineno-611-21" name="__codelineno-611-21" href="#__codelineno-611-21"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-611-22"><a id="__codelineno-611-22" name="__codelineno-611-22" href="#__codelineno-611-22"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="savedata">SaveData</h3>
<p><strong>Purpose</strong></p>
<p>Called to save persistent data</p>
<p><strong>When Called</strong></p>
<p>When data needs to be saved to storage</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-612-1"><a id="__codelineno-612-1" name="__codelineno-612-1" href="#__codelineno-612-1"></a><span class="c1">-- Simple: Log data save</span>
</span><span id="__span-612-2"><a id="__codelineno-612-2" name="__codelineno-612-2" href="#__codelineno-612-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-612-3"><a id="__codelineno-612-3" name="__codelineno-612-3" href="#__codelineno-612-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving data&quot;</span><span class="p">)</span>
</span><span id="__span-612-4"><a id="__codelineno-612-4" name="__codelineno-612-4" href="#__codelineno-612-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-613-1"><a id="__codelineno-613-1" name="__codelineno-613-1" href="#__codelineno-613-1"></a><span class="c1">-- Medium: Save custom data</span>
</span><span id="__span-613-2"><a id="__codelineno-613-2" name="__codelineno-613-2" href="#__codelineno-613-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SaveCustomData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-613-3"><a id="__codelineno-613-3" name="__codelineno-613-3" href="#__codelineno-613-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">data</span><span class="p">)</span>
</span><span id="__span-613-4"><a id="__codelineno-613-4" name="__codelineno-613-4" href="#__codelineno-613-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-614-1"><a id="__codelineno-614-1" name="__codelineno-614-1" href="#__codelineno-614-1"></a><span class="c1">-- High: Complex data saving system</span>
</span><span id="__span-614-2"><a id="__codelineno-614-2" name="__codelineno-614-2" href="#__codelineno-614-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SaveData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataSaving&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-614-3"><a id="__codelineno-614-3" name="__codelineno-614-3" href="#__codelineno-614-3"></a><span class="c1">-- Save custom data</span>
</span><span id="__span-614-4"><a id="__codelineno-614-4" name="__codelineno-614-4" href="#__codelineno-614-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;myAddonData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">data</span><span class="p">)</span>
</span><span id="__span-614-5"><a id="__codelineno-614-5" name="__codelineno-614-5" href="#__codelineno-614-5"></a><span class="c1">-- Save player statistics</span>
</span><span id="__span-614-6"><a id="__codelineno-614-6" name="__codelineno-614-6" href="#__codelineno-614-6"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-614-7"><a id="__codelineno-614-7" name="__codelineno-614-7" href="#__codelineno-614-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-614-8"><a id="__codelineno-614-8" name="__codelineno-614-8" href="#__codelineno-614-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-614-9"><a id="__codelineno-614-9" name="__codelineno-614-9" href="#__codelineno-614-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;myAddonStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-614-10"><a id="__codelineno-614-10" name="__codelineno-614-10" href="#__codelineno-614-10"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="s2">&quot;playerStats_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">stats</span><span class="p">)</span>
</span><span id="__span-614-11"><a id="__codelineno-614-11" name="__codelineno-614-11" href="#__codelineno-614-11"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-614-12"><a id="__codelineno-614-12" name="__codelineno-614-12" href="#__codelineno-614-12"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-614-13"><a id="__codelineno-614-13" name="__codelineno-614-13" href="#__codelineno-614-13"></a><span class="c1">-- Save to database</span>
</span><span id="__span-614-14"><a id="__codelineno-614-14" name="__codelineno-614-14" href="#__codelineno-614-14"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO data_saves (timestamp, data) VALUES (?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-614-15"><a id="__codelineno-614-15" name="__codelineno-614-15" href="#__codelineno-614-15"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">MyAddon</span><span class="p">.</span><span class="py">data</span><span class="p">))</span>
</span><span id="__span-614-16"><a id="__codelineno-614-16" name="__codelineno-614-16" href="#__codelineno-614-16"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All data saved successfully&quot;</span><span class="p">)</span>
</span><span id="__span-614-17"><a id="__codelineno-614-17" name="__codelineno-614-17" href="#__codelineno-614-17"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="sendpopup">SendPopup</h3>
<p><strong>Purpose</strong></p>
<p>Called to send a popup message</p>
<p><strong>When Called</strong></p>
<p>When displaying a popup to a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>noob</code> (<em>Player</em>): The player receiving the popup</li>
<li><code>message</code> (<em>string</em>): The popup message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-615-1"><a id="__codelineno-615-1" name="__codelineno-615-1" href="#__codelineno-615-1"></a><span class="c1">-- Simple: Log popup</span>
</span><span id="__span-615-2"><a id="__codelineno-615-2" name="__codelineno-615-2" href="#__codelineno-615-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SendPopup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-615-3"><a id="__codelineno-615-3" name="__codelineno-615-3" href="#__codelineno-615-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending popup to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-615-4"><a id="__codelineno-615-4" name="__codelineno-615-4" href="#__codelineno-615-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-616-1"><a id="__codelineno-616-1" name="__codelineno-616-1" href="#__codelineno-616-1"></a><span class="c1">-- Medium: Customize popup message</span>
</span><span id="__span-616-2"><a id="__codelineno-616-2" name="__codelineno-616-2" href="#__codelineno-616-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SendPopup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CustomizePopup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-616-3"><a id="__codelineno-616-3" name="__codelineno-616-3" href="#__codelineno-616-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-616-4"><a id="__codelineno-616-4" name="__codelineno-616-4" href="#__codelineno-616-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-616-5"><a id="__codelineno-616-5" name="__codelineno-616-5" href="#__codelineno-616-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">customMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span>
</span><span id="__span-616-6"><a id="__codelineno-616-6" name="__codelineno-616-6" href="#__codelineno-616-6"></a><span class="w">    </span><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">customMessage</span><span class="p">)</span>
</span><span id="__span-616-7"><a id="__codelineno-616-7" name="__codelineno-616-7" href="#__codelineno-616-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-616-8"><a id="__codelineno-616-8" name="__codelineno-616-8" href="#__codelineno-616-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-617-1"><a id="__codelineno-617-1" name="__codelineno-617-1" href="#__codelineno-617-1"></a><span class="c1">-- High: Complex popup system</span>
</span><span id="__span-617-2"><a id="__codelineno-617-2" name="__codelineno-617-2" href="#__codelineno-617-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SendPopup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPopupSystem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-617-3"><a id="__codelineno-617-3" name="__codelineno-617-3" href="#__codelineno-617-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-617-4"><a id="__codelineno-617-4" name="__codelineno-617-4" href="#__codelineno-617-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-617-5"><a id="__codelineno-617-5" name="__codelineno-617-5" href="#__codelineno-617-5"></a><span class="w">    </span><span class="c1">-- Customize message based on faction</span>
</span><span id="__span-617-6"><a id="__codelineno-617-6" name="__codelineno-617-6" href="#__codelineno-617-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-617-7"><a id="__codelineno-617-7" name="__codelineno-617-7" href="#__codelineno-617-7"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-617-8"><a id="__codelineno-617-8" name="__codelineno-617-8" href="#__codelineno-617-8"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;[POLICE]&quot;</span><span class="p">,</span>
</span><span id="__span-617-9"><a id="__codelineno-617-9" name="__codelineno-617-9" href="#__codelineno-617-9"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;[MEDICAL]&quot;</span><span class="p">,</span>
</span><span id="__span-617-10"><a id="__codelineno-617-10" name="__codelineno-617-10" href="#__codelineno-617-10"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;criminal&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;[CRIMINAL]&quot;</span>
</span><span id="__span-617-11"><a id="__codelineno-617-11" name="__codelineno-617-11" href="#__codelineno-617-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-617-12"><a id="__codelineno-617-12" name="__codelineno-617-12" href="#__codelineno-617-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionPrefix</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;[SYSTEM]&quot;</span>
</span><span id="__span-617-13"><a id="__codelineno-617-13" name="__codelineno-617-13" href="#__codelineno-617-13"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">customMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">prefix</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span>
</span><span id="__span-617-14"><a id="__codelineno-617-14" name="__codelineno-617-14" href="#__codelineno-617-14"></a><span class="w">    </span><span class="c1">-- Send popup</span>
</span><span id="__span-617-15"><a id="__codelineno-617-15" name="__codelineno-617-15" href="#__codelineno-617-15"></a><span class="w">    </span><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">customMessage</span><span class="p">)</span>
</span><span id="__span-617-16"><a id="__codelineno-617-16" name="__codelineno-617-16" href="#__codelineno-617-16"></a><span class="w">    </span><span class="c1">-- Log popup</span>
</span><span id="__span-617-17"><a id="__codelineno-617-17" name="__codelineno-617-17" href="#__codelineno-617-17"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO popup_logs (timestamp, steamid, message) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-617-18"><a id="__codelineno-617-18" name="__codelineno-617-18" href="#__codelineno-617-18"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-617-19"><a id="__codelineno-617-19" name="__codelineno-617-19" href="#__codelineno-617-19"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="setupbaginventoryaccessrules">SetupBagInventoryAccessRules</h3>
<p><strong>Purpose</strong></p>
<p>Called to set up bag inventory access rules</p>
<p><strong>When Called</strong></p>
<p>When configuring access rules for a bag inventory</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>inventory</code> (<em>Inventory</em>): The bag inventory</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-618-1"><a id="__codelineno-618-1" name="__codelineno-618-1" href="#__codelineno-618-1"></a><span class="c1">-- Simple: Log access rules setup</span>
</span><span id="__span-618-2"><a id="__codelineno-618-2" name="__codelineno-618-2" href="#__codelineno-618-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBagInventoryAccessRules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-618-3"><a id="__codelineno-618-3" name="__codelineno-618-3" href="#__codelineno-618-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up bag access rules&quot;</span><span class="p">)</span>
</span><span id="__span-618-4"><a id="__codelineno-618-4" name="__codelineno-618-4" href="#__codelineno-618-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-619-1"><a id="__codelineno-619-1" name="__codelineno-619-1" href="#__codelineno-619-1"></a><span class="c1">-- Medium: Set basic access rules</span>
</span><span id="__span-619-2"><a id="__codelineno-619-2" name="__codelineno-619-2" href="#__codelineno-619-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBagInventoryAccessRules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BasicAccessRules&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-619-3"><a id="__codelineno-619-3" name="__codelineno-619-3" href="#__codelineno-619-3"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;accessLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-619-4"><a id="__codelineno-619-4" name="__codelineno-619-4" href="#__codelineno-619-4"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-619-5"><a id="__codelineno-619-5" name="__codelineno-619-5" href="#__codelineno-619-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-620-1"><a id="__codelineno-620-1" name="__codelineno-620-1" href="#__codelineno-620-1"></a><span class="c1">-- High: Complex access rule system</span>
</span><span id="__span-620-2"><a id="__codelineno-620-2" name="__codelineno-620-2" href="#__codelineno-620-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBagInventoryAccessRules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedAccessRules&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-620-3"><a id="__codelineno-620-3" name="__codelineno-620-3" href="#__codelineno-620-3"></a><span class="c1">-- Set access level</span>
</span><span id="__span-620-4"><a id="__codelineno-620-4" name="__codelineno-620-4" href="#__codelineno-620-4"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;accessLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-620-5"><a id="__codelineno-620-5" name="__codelineno-620-5" href="#__codelineno-620-5"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-620-6"><a id="__codelineno-620-6" name="__codelineno-620-6" href="#__codelineno-620-6"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowView&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-620-7"><a id="__codelineno-620-7" name="__codelineno-620-7" href="#__codelineno-620-7"></a><span class="c1">-- Set faction restrictions</span>
</span><span id="__span-620-8"><a id="__codelineno-620-8" name="__codelineno-620-8" href="#__codelineno-620-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-620-9"><a id="__codelineno-620-9" name="__codelineno-620-9" href="#__codelineno-620-9"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-620-10"><a id="__codelineno-620-10" name="__codelineno-620-10" href="#__codelineno-620-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-620-11"><a id="__codelineno-620-11" name="__codelineno-620-11" href="#__codelineno-620-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-620-12"><a id="__codelineno-620-12" name="__codelineno-620-12" href="#__codelineno-620-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-620-13"><a id="__codelineno-620-13" name="__codelineno-620-13" href="#__codelineno-620-13"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowedFactions&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">faction</span><span class="p">})</span>
</span><span id="__span-620-14"><a id="__codelineno-620-14" name="__codelineno-620-14" href="#__codelineno-620-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-620-15"><a id="__codelineno-620-15" name="__codelineno-620-15" href="#__codelineno-620-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-620-16"><a id="__codelineno-620-16" name="__codelineno-620-16" href="#__codelineno-620-16"></a><span class="c1">-- Set time restrictions</span>
</span><span id="__span-620-17"><a id="__codelineno-620-17" name="__codelineno-620-17" href="#__codelineno-620-17"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;accessTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-620-18"><a id="__codelineno-620-18" name="__codelineno-620-18" href="#__codelineno-620-18"></a><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;accessDuration&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3600</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 1 hour</span>
</span><span id="__span-620-19"><a id="__codelineno-620-19" name="__codelineno-620-19" href="#__codelineno-620-19"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="setupbotplayer">SetupBotPlayer</h3>
<p><strong>Purpose</strong></p>
<p>Called to set up a bot player</p>
<p><strong>When Called</strong></p>
<p>When initializing a bot player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The bot player</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-621-1"><a id="__codelineno-621-1" name="__codelineno-621-1" href="#__codelineno-621-1"></a><span class="c1">-- Simple: Log bot setup</span>
</span><span id="__span-621-2"><a id="__codelineno-621-2" name="__codelineno-621-2" href="#__codelineno-621-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBotPlayer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-621-3"><a id="__codelineno-621-3" name="__codelineno-621-3" href="#__codelineno-621-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up bot: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-621-4"><a id="__codelineno-621-4" name="__codelineno-621-4" href="#__codelineno-621-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-622-1"><a id="__codelineno-622-1" name="__codelineno-622-1" href="#__codelineno-622-1"></a><span class="c1">-- Medium: Configure bot behavior</span>
</span><span id="__span-622-2"><a id="__codelineno-622-2" name="__codelineno-622-2" href="#__codelineno-622-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBotPlayer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ConfigureBot&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-622-3"><a id="__codelineno-622-3" name="__codelineno-622-3" href="#__codelineno-622-3"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;isBot&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-622-4"><a id="__codelineno-622-4" name="__codelineno-622-4" href="#__codelineno-622-4"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;botType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;guard&quot;</span><span class="p">)</span>
</span><span id="__span-622-5"><a id="__codelineno-622-5" name="__codelineno-622-5" href="#__codelineno-622-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-623-1"><a id="__codelineno-623-1" name="__codelineno-623-1" href="#__codelineno-623-1"></a><span class="c1">-- High: Complex bot setup system</span>
</span><span id="__span-623-2"><a id="__codelineno-623-2" name="__codelineno-623-2" href="#__codelineno-623-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupBotPlayer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedBotSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-623-3"><a id="__codelineno-623-3" name="__codelineno-623-3" href="#__codelineno-623-3"></a><span class="c1">-- Mark as bot</span>
</span><span id="__span-623-4"><a id="__codelineno-623-4" name="__codelineno-623-4" href="#__codelineno-623-4"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;isBot&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-623-5"><a id="__codelineno-623-5" name="__codelineno-623-5" href="#__codelineno-623-5"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;botType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;guard&quot;</span><span class="p">)</span>
</span><span id="__span-623-6"><a id="__codelineno-623-6" name="__codelineno-623-6" href="#__codelineno-623-6"></a><span class="c1">-- Set up bot AI</span>
</span><span id="__span-623-7"><a id="__codelineno-623-7" name="__codelineno-623-7" href="#__codelineno-623-7"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;botState&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;patrol&quot;</span><span class="p">)</span>
</span><span id="__span-623-8"><a id="__codelineno-623-8" name="__codelineno-623-8" href="#__codelineno-623-8"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetNetVar</span><span class="p">(</span><span class="s2">&quot;botTarget&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-623-9"><a id="__codelineno-623-9" name="__codelineno-623-9" href="#__codelineno-623-9"></a><span class="c1">-- Give bot equipment</span>
</span><span id="__span-623-10"><a id="__codelineno-623-10" name="__codelineno-623-10" href="#__codelineno-623-10"></a><span class="nv">client</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
</span><span id="__span-623-11"><a id="__codelineno-623-11" name="__codelineno-623-11" href="#__codelineno-623-11"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-623-12"><a id="__codelineno-623-12" name="__codelineno-623-12" href="#__codelineno-623-12"></a><span class="c1">-- Set up bot behavior</span>
</span><span id="__span-623-13"><a id="__codelineno-623-13" name="__codelineno-623-13" href="#__codelineno-623-13"></a><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;BotAI_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-623-14"><a id="__codelineno-623-14" name="__codelineno-623-14" href="#__codelineno-623-14"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-623-15"><a id="__codelineno-623-15" name="__codelineno-623-15" href="#__codelineno-623-15"></a><span class="w">    </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;BotAIUpdate&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-623-16"><a id="__codelineno-623-16" name="__codelineno-623-16" href="#__codelineno-623-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-623-17"><a id="__codelineno-623-17" name="__codelineno-623-17" href="#__codelineno-623-17"></a><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-623-18"><a id="__codelineno-623-18" name="__codelineno-623-18" href="#__codelineno-623-18"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="setupdatabase">SetupDatabase</h3>
<p><strong>Purpose</strong></p>
<p>Called to set up the database</p>
<p><strong>When Called</strong></p>
<p>When initializing database connections and tables</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-624-1"><a id="__codelineno-624-1" name="__codelineno-624-1" href="#__codelineno-624-1"></a><span class="c1">-- Simple: Log database setup</span>
</span><span id="__span-624-2"><a id="__codelineno-624-2" name="__codelineno-624-2" href="#__codelineno-624-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupDatabase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-624-3"><a id="__codelineno-624-3" name="__codelineno-624-3" href="#__codelineno-624-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up database&quot;</span><span class="p">)</span>
</span><span id="__span-624-4"><a id="__codelineno-624-4" name="__codelineno-624-4" href="#__codelineno-624-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-625-1"><a id="__codelineno-625-1" name="__codelineno-625-1" href="#__codelineno-625-1"></a><span class="c1">-- Medium: Create custom tables</span>
</span><span id="__span-625-2"><a id="__codelineno-625-2" name="__codelineno-625-2" href="#__codelineno-625-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupDatabase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CreateCustomTables&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-625-3"><a id="__codelineno-625-3" name="__codelineno-625-3" href="#__codelineno-625-3"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_table (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">)</span>
</span><span id="__span-625-4"><a id="__codelineno-625-4" name="__codelineno-625-4" href="#__codelineno-625-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-626-1"><a id="__codelineno-626-1" name="__codelineno-626-1" href="#__codelineno-626-1"></a><span class="c1">-- High: Complex database setup</span>
</span><span id="__span-626-2"><a id="__codelineno-626-2" name="__codelineno-626-2" href="#__codelineno-626-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupDatabase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDatabaseSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-626-3"><a id="__codelineno-626-3" name="__codelineno-626-3" href="#__codelineno-626-3"></a><span class="c1">-- Create custom tables</span>
</span><span id="__span-626-4"><a id="__codelineno-626-4" name="__codelineno-626-4" href="#__codelineno-626-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-626-5"><a id="__codelineno-626-5" name="__codelineno-626-5" href="#__codelineno-626-5"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS my_table (id INTEGER PRIMARY KEY, data TEXT)&quot;</span><span class="p">,</span>
</span><span id="__span-626-6"><a id="__codelineno-626-6" name="__codelineno-626-6" href="#__codelineno-626-6"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS player_stats (steamid TEXT PRIMARY KEY, kills INTEGER, deaths INTEGER)&quot;</span><span class="p">,</span>
</span><span id="__span-626-7"><a id="__codelineno-626-7" name="__codelineno-626-7" href="#__codelineno-626-7"></a><span class="s2">&quot;CREATE TABLE IF NOT EXISTS achievements (id INTEGER PRIMARY KEY, name TEXT, description TEXT)&quot;</span>
</span><span id="__span-626-8"><a id="__codelineno-626-8" name="__codelineno-626-8" href="#__codelineno-626-8"></a><span class="p">}</span>
</span><span id="__span-626-9"><a id="__codelineno-626-9" name="__codelineno-626-9" href="#__codelineno-626-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">tables</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-626-10"><a id="__codelineno-626-10" name="__codelineno-626-10" href="#__codelineno-626-10"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">query</span><span class="p">)</span>
</span><span id="__span-626-11"><a id="__codelineno-626-11" name="__codelineno-626-11" href="#__codelineno-626-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-626-12"><a id="__codelineno-626-12" name="__codelineno-626-12" href="#__codelineno-626-12"></a><span class="c1">-- Create indexes</span>
</span><span id="__span-626-13"><a id="__codelineno-626-13" name="__codelineno-626-13" href="#__codelineno-626-13"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;CREATE INDEX IF NOT EXISTS idx_player_stats_steamid ON player_stats(steamid)&quot;</span><span class="p">)</span>
</span><span id="__span-626-14"><a id="__codelineno-626-14" name="__codelineno-626-14" href="#__codelineno-626-14"></a><span class="c1">-- Set up prepared statements</span>
</span><span id="__span-626-15"><a id="__codelineno-626-15" name="__codelineno-626-15" href="#__codelineno-626-15"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;get_player_stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM player_stats WHERE steamid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-626-16"><a id="__codelineno-626-16" name="__codelineno-626-16" href="#__codelineno-626-16"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">&quot;update_player_stats&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UPDATE player_stats SET kills = ?, deaths = ? WHERE steamid = ?&quot;</span><span class="p">)</span>
</span><span id="__span-626-17"><a id="__codelineno-626-17" name="__codelineno-626-17" href="#__codelineno-626-17"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="setupplayermodel">SetupPlayerModel</h3>
<p><strong>Purpose</strong></p>
<p>Called to set up a player's model</p>
<p><strong>When Called</strong></p>
<p>When configuring a player's character model</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player</li>
<li><code>character</code> (<em>Character</em>): The character</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-627-1"><a id="__codelineno-627-1" name="__codelineno-627-1" href="#__codelineno-627-1"></a><span class="c1">-- Simple: Log model setup</span>
</span><span id="__span-627-2"><a id="__codelineno-627-2" name="__codelineno-627-2" href="#__codelineno-627-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-627-3"><a id="__codelineno-627-3" name="__codelineno-627-3" href="#__codelineno-627-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up model for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-627-4"><a id="__codelineno-627-4" name="__codelineno-627-4" href="#__codelineno-627-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-628-1"><a id="__codelineno-628-1" name="__codelineno-628-1" href="#__codelineno-628-1"></a><span class="c1">-- Medium: Set faction-based model</span>
</span><span id="__span-628-2"><a id="__codelineno-628-2" name="__codelineno-628-2" href="#__codelineno-628-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FactionModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-628-3"><a id="__codelineno-628-3" name="__codelineno-628-3" href="#__codelineno-628-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-628-4"><a id="__codelineno-628-4" name="__codelineno-628-4" href="#__codelineno-628-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-628-5"><a id="__codelineno-628-5" name="__codelineno-628-5" href="#__codelineno-628-5"></a><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/player/police.mdl&quot;</span><span class="p">,</span>
</span><span id="__span-628-6"><a id="__codelineno-628-6" name="__codelineno-628-6" href="#__codelineno-628-6"></a><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/player/medic.mdl&quot;</span>
</span><span id="__span-628-7"><a id="__codelineno-628-7" name="__codelineno-628-7" href="#__codelineno-628-7"></a><span class="p">}</span>
</span><span id="__span-628-8"><a id="__codelineno-628-8" name="__codelineno-628-8" href="#__codelineno-628-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionModels</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span>
</span><span id="__span-628-9"><a id="__codelineno-628-9" name="__codelineno-628-9" href="#__codelineno-628-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-628-10"><a id="__codelineno-628-10" name="__codelineno-628-10" href="#__codelineno-628-10"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="nv">model</span><span class="p">)</span>
</span><span id="__span-628-11"><a id="__codelineno-628-11" name="__codelineno-628-11" href="#__codelineno-628-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-628-12"><a id="__codelineno-628-12" name="__codelineno-628-12" href="#__codelineno-628-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-629-1"><a id="__codelineno-629-1" name="__codelineno-629-1" href="#__codelineno-629-1"></a><span class="c1">-- High: Complex model setup system</span>
</span><span id="__span-629-2"><a id="__codelineno-629-2" name="__codelineno-629-2" href="#__codelineno-629-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SetupPlayerModel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedModelSetup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">character</span><span class="p">)</span>
</span><span id="__span-629-3"><a id="__codelineno-629-3" name="__codelineno-629-3" href="#__codelineno-629-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-629-4"><a id="__codelineno-629-4" name="__codelineno-629-4" href="#__codelineno-629-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span>
</span><span id="__span-629-5"><a id="__codelineno-629-5" name="__codelineno-629-5" href="#__codelineno-629-5"></a><span class="c1">-- Get model based on faction and class</span>
</span><span id="__span-629-6"><a id="__codelineno-629-6" name="__codelineno-629-6" href="#__codelineno-629-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getModel</span><span class="p">()</span>
</span><span id="__span-629-7"><a id="__codelineno-629-7" name="__codelineno-629-7" href="#__codelineno-629-7"></a><span class="c1">-- Apply faction-specific model overrides</span>
</span><span id="__span-629-8"><a id="__codelineno-629-8" name="__codelineno-629-8" href="#__codelineno-629-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">factionModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">indices</span><span class="p">[</span><span class="nv">faction</span><span class="p">].</span><span class="nv">models</span>
</span><span id="__span-629-9"><a id="__codelineno-629-9" name="__codelineno-629-9" href="#__codelineno-629-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">factionModels</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">factionModels</span><span class="p">[</span><span class="nv">class</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-629-10"><a id="__codelineno-629-10" name="__codelineno-629-10" href="#__codelineno-629-10"></a><span class="w">    </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">factionModels</span><span class="p">[</span><span class="nv">class</span><span class="p">]</span>
</span><span id="__span-629-11"><a id="__codelineno-629-11" name="__codelineno-629-11" href="#__codelineno-629-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-629-12"><a id="__codelineno-629-12" name="__codelineno-629-12" href="#__codelineno-629-12"></a><span class="c1">-- Apply outfit model override</span>
</span><span id="__span-629-13"><a id="__codelineno-629-13" name="__codelineno-629-13" href="#__codelineno-629-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">outfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;outfit&quot;</span><span class="p">)</span>
</span><span id="__span-629-14"><a id="__codelineno-629-14" name="__codelineno-629-14" href="#__codelineno-629-14"></a><span class="kr">if</span><span class="w"> </span><span class="nv">outfit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-629-15"><a id="__codelineno-629-15" name="__codelineno-629-15" href="#__codelineno-629-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">outfitItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">instances</span><span class="p">[</span><span class="nv">outfit</span><span class="p">]</span>
</span><span id="__span-629-16"><a id="__codelineno-629-16" name="__codelineno-629-16" href="#__codelineno-629-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">outfitItem</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">outfitItem</span><span class="p">.</span><span class="py">model</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-629-17"><a id="__codelineno-629-17" name="__codelineno-629-17" href="#__codelineno-629-17"></a><span class="w">        </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">outfitItem</span><span class="p">.</span><span class="py">model</span>
</span><span id="__span-629-18"><a id="__codelineno-629-18" name="__codelineno-629-18" href="#__codelineno-629-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-629-19"><a id="__codelineno-629-19" name="__codelineno-629-19" href="#__codelineno-629-19"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-629-20"><a id="__codelineno-629-20" name="__codelineno-629-20" href="#__codelineno-629-20"></a><span class="c1">-- Set model</span>
</span><span id="__span-629-21"><a id="__codelineno-629-21" name="__codelineno-629-21" href="#__codelineno-629-21"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="nv">model</span><span class="p">)</span>
</span><span id="__span-629-22"><a id="__codelineno-629-22" name="__codelineno-629-22" href="#__codelineno-629-22"></a><span class="c1">-- Apply skin and bodygroups</span>
</span><span id="__span-629-23"><a id="__codelineno-629-23" name="__codelineno-629-23" href="#__codelineno-629-23"></a><span class="kd">local</span><span class="w"> </span><span class="nv">skin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;skin&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-629-24"><a id="__codelineno-629-24" name="__codelineno-629-24" href="#__codelineno-629-24"></a><span class="nv">client</span><span class="p">:</span><span class="nf">SetSkin</span><span class="p">(</span><span class="nv">skin</span><span class="p">)</span>
</span><span id="__span-629-25"><a id="__codelineno-629-25" name="__codelineno-629-25" href="#__codelineno-629-25"></a><span class="kd">local</span><span class="w"> </span><span class="nv">bodygroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;bodygroups&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-629-26"><a id="__codelineno-629-26" name="__codelineno-629-26" href="#__codelineno-629-26"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">bodygroups</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-629-27"><a id="__codelineno-629-27" name="__codelineno-629-27" href="#__codelineno-629-27"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">SetBodygroup</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">group</span><span class="p">)</span>
</span><span id="__span-629-28"><a id="__codelineno-629-28" name="__codelineno-629-28" href="#__codelineno-629-28"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-629-29"><a id="__codelineno-629-29" name="__codelineno-629-29" href="#__codelineno-629-29"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="shoulddatabesaved">ShouldDataBeSaved</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if data should be saved</p>
<p><strong>When Called</strong></p>
<p>When determining if current data should be persisted</p>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to save, false to skip</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-630-1"><a id="__codelineno-630-1" name="__codelineno-630-1" href="#__codelineno-630-1"></a><span class="c1">-- Simple: Always save data</span>
</span><span id="__span-630-2"><a id="__codelineno-630-2" name="__codelineno-630-2" href="#__codelineno-630-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDataBeSaved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-630-3"><a id="__codelineno-630-3" name="__codelineno-630-3" href="#__codelineno-630-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-630-4"><a id="__codelineno-630-4" name="__codelineno-630-4" href="#__codelineno-630-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-631-1"><a id="__codelineno-631-1" name="__codelineno-631-1" href="#__codelineno-631-1"></a><span class="c1">-- Medium: Check save conditions</span>
</span><span id="__span-631-2"><a id="__codelineno-631-2" name="__codelineno-631-2" href="#__codelineno-631-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDataBeSaved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CheckSaveConditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-631-3"><a id="__codelineno-631-3" name="__codelineno-631-3" href="#__codelineno-631-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-631-4"><a id="__codelineno-631-4" name="__codelineno-631-4" href="#__codelineno-631-4"></a><span class="kr">return</span><span class="w"> </span><span class="o">#</span><span class="nv">players</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-631-5"><a id="__codelineno-631-5" name="__codelineno-631-5" href="#__codelineno-631-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-632-1"><a id="__codelineno-632-1" name="__codelineno-632-1" href="#__codelineno-632-1"></a><span class="c1">-- High: Complex save validation</span>
</span><span id="__span-632-2"><a id="__codelineno-632-2" name="__codelineno-632-2" href="#__codelineno-632-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDataBeSaved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSaveValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-632-3"><a id="__codelineno-632-3" name="__codelineno-632-3" href="#__codelineno-632-3"></a><span class="c1">-- Don&#39;t save if no players</span>
</span><span id="__span-632-4"><a id="__codelineno-632-4" name="__codelineno-632-4" href="#__codelineno-632-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-632-5"><a id="__codelineno-632-5" name="__codelineno-632-5" href="#__codelineno-632-5"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">players</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-632-6"><a id="__codelineno-632-6" name="__codelineno-632-6" href="#__codelineno-632-6"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-632-7"><a id="__codelineno-632-7" name="__codelineno-632-7" href="#__codelineno-632-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-632-8"><a id="__codelineno-632-8" name="__codelineno-632-8" href="#__codelineno-632-8"></a><span class="c1">-- Don&#39;t save if server is shutting down</span>
</span><span id="__span-632-9"><a id="__codelineno-632-9" name="__codelineno-632-9" href="#__codelineno-632-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">game</span><span class="p">.</span><span class="nf">IsDedicated</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">GetConVar</span><span class="p">(</span><span class="s2">&quot;sv_shutdown&quot;</span><span class="p">):</span><span class="nf">GetBool</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-632-10"><a id="__codelineno-632-10" name="__codelineno-632-10" href="#__codelineno-632-10"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-632-11"><a id="__codelineno-632-11" name="__codelineno-632-11" href="#__codelineno-632-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-632-12"><a id="__codelineno-632-12" name="__codelineno-632-12" href="#__codelineno-632-12"></a><span class="c1">-- Don&#39;t save if too frequent</span>
</span><span id="__span-632-13"><a id="__codelineno-632-13" name="__codelineno-632-13" href="#__codelineno-632-13"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastSave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;lastSave&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-632-14"><a id="__codelineno-632-14" name="__codelineno-632-14" href="#__codelineno-632-14"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastSave</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-632-15"><a id="__codelineno-632-15" name="__codelineno-632-15" href="#__codelineno-632-15"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-632-16"><a id="__codelineno-632-16" name="__codelineno-632-16" href="#__codelineno-632-16"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-632-17"><a id="__codelineno-632-17" name="__codelineno-632-17" href="#__codelineno-632-17"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-632-18"><a id="__codelineno-632-18" name="__codelineno-632-18" href="#__codelineno-632-18"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="shoulddeletesaveditems">ShouldDeleteSavedItems</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if saved items should be deleted</p>
<p><strong>When Called</strong></p>
<p>When determining if old saved items should be cleaned up</p>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to delete, false to keep</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-633-1"><a id="__codelineno-633-1" name="__codelineno-633-1" href="#__codelineno-633-1"></a><span class="c1">-- Simple: Never delete saved items</span>
</span><span id="__span-633-2"><a id="__codelineno-633-2" name="__codelineno-633-2" href="#__codelineno-633-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDeleteSavedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-633-3"><a id="__codelineno-633-3" name="__codelineno-633-3" href="#__codelineno-633-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-633-4"><a id="__codelineno-633-4" name="__codelineno-633-4" href="#__codelineno-633-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-634-1"><a id="__codelineno-634-1" name="__codelineno-634-1" href="#__codelineno-634-1"></a><span class="c1">-- Medium: Delete old items</span>
</span><span id="__span-634-2"><a id="__codelineno-634-2" name="__codelineno-634-2" href="#__codelineno-634-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDeleteSavedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeleteOldItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-634-3"><a id="__codelineno-634-3" name="__codelineno-634-3" href="#__codelineno-634-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastCleanup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;lastItemCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-634-4"><a id="__codelineno-634-4" name="__codelineno-634-4" href="#__codelineno-634-4"></a><span class="kr">return</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastCleanup</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">86400</span><span class="w"> </span><span class="c1">-- 24 hours</span>
</span><span id="__span-634-5"><a id="__codelineno-634-5" name="__codelineno-634-5" href="#__codelineno-634-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-635-1"><a id="__codelineno-635-1" name="__codelineno-635-1" href="#__codelineno-635-1"></a><span class="c1">-- High: Complex item cleanup system</span>
</span><span id="__span-635-2"><a id="__codelineno-635-2" name="__codelineno-635-2" href="#__codelineno-635-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ShouldDeleteSavedItems&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-635-3"><a id="__codelineno-635-3" name="__codelineno-635-3" href="#__codelineno-635-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">lastCleanup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;lastItemCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-635-4"><a id="__codelineno-635-4" name="__codelineno-635-4" href="#__codelineno-635-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">cleanupInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">86400</span><span class="w"> </span><span class="c1">-- 24 hours</span>
</span><span id="__span-635-5"><a id="__codelineno-635-5" name="__codelineno-635-5" href="#__codelineno-635-5"></a><span class="c1">-- Don&#39;t cleanup too frequently</span>
</span><span id="__span-635-6"><a id="__codelineno-635-6" name="__codelineno-635-6" href="#__codelineno-635-6"></a><span class="kr">if</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">lastCleanup</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">cleanupInterval</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-635-7"><a id="__codelineno-635-7" name="__codelineno-635-7" href="#__codelineno-635-7"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-635-8"><a id="__codelineno-635-8" name="__codelineno-635-8" href="#__codelineno-635-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-635-9"><a id="__codelineno-635-9" name="__codelineno-635-9" href="#__codelineno-635-9"></a><span class="c1">-- Check server load</span>
</span><span id="__span-635-10"><a id="__codelineno-635-10" name="__codelineno-635-10" href="#__codelineno-635-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">serverLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">GetConVar</span><span class="p">(</span><span class="s2">&quot;sv_stats&quot;</span><span class="p">):</span><span class="nf">GetFloat</span><span class="p">()</span>
</span><span id="__span-635-11"><a id="__codelineno-635-11" name="__codelineno-635-11" href="#__codelineno-635-11"></a><span class="kr">if</span><span class="w"> </span><span class="nv">serverLoad</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.8</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-635-12"><a id="__codelineno-635-12" name="__codelineno-635-12" href="#__codelineno-635-12"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-635-13"><a id="__codelineno-635-13" name="__codelineno-635-13" href="#__codelineno-635-13"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-635-14"><a id="__codelineno-635-14" name="__codelineno-635-14" href="#__codelineno-635-14"></a><span class="c1">-- Check player count</span>
</span><span id="__span-635-15"><a id="__codelineno-635-15" name="__codelineno-635-15" href="#__codelineno-635-15"></a><span class="kd">local</span><span class="w"> </span><span class="nv">players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span>
</span><span id="__span-635-16"><a id="__codelineno-635-16" name="__codelineno-635-16" href="#__codelineno-635-16"></a><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">players</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-635-17"><a id="__codelineno-635-17" name="__codelineno-635-17" href="#__codelineno-635-17"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-635-18"><a id="__codelineno-635-18" name="__codelineno-635-18" href="#__codelineno-635-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-635-19"><a id="__codelineno-635-19" name="__codelineno-635-19" href="#__codelineno-635-19"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-635-20"><a id="__codelineno-635-20" name="__codelineno-635-20" href="#__codelineno-635-20"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storagecantransferitem">StorageCanTransferItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to check if an item can be transferred to storage</p>
<p><strong>When Called</strong></p>
<p>When attempting to transfer an item to storage</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player transferring the item</li>
<li><code>storage</code> (<em>Entity</em>): The storage entity</li>
<li><code>item</code> (<em>Item</em>): The item being transferred</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>boolean - True to allow, false to deny</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-636-1"><a id="__codelineno-636-1" name="__codelineno-636-1" href="#__codelineno-636-1"></a><span class="c1">-- Simple: Allow all transfers</span>
</span><span id="__span-636-2"><a id="__codelineno-636-2" name="__codelineno-636-2" href="#__codelineno-636-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageCanTransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-636-3"><a id="__codelineno-636-3" name="__codelineno-636-3" href="#__codelineno-636-3"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-636-4"><a id="__codelineno-636-4" name="__codelineno-636-4" href="#__codelineno-636-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-637-1"><a id="__codelineno-637-1" name="__codelineno-637-1" href="#__codelineno-637-1"></a><span class="c1">-- Medium: Check item restrictions</span>
</span><span id="__span-637-2"><a id="__codelineno-637-2" name="__codelineno-637-2" href="#__codelineno-637-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageCanTransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ItemRestrictions&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-637-3"><a id="__codelineno-637-3" name="__codelineno-637-3" href="#__codelineno-637-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;weapon_crowbar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">}</span>
</span><span id="__span-637-4"><a id="__codelineno-637-4" name="__codelineno-637-4" href="#__codelineno-637-4"></a><span class="kr">return</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">restrictedItems</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">)</span>
</span><span id="__span-637-5"><a id="__codelineno-637-5" name="__codelineno-637-5" href="#__codelineno-637-5"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-638-1"><a id="__codelineno-638-1" name="__codelineno-638-1" href="#__codelineno-638-1"></a><span class="c1">-- High: Complex storage transfer system</span>
</span><span id="__span-638-2"><a id="__codelineno-638-2" name="__codelineno-638-2" href="#__codelineno-638-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageCanTransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
</span><span id="__span-638-3"><a id="__codelineno-638-3" name="__codelineno-638-3" href="#__codelineno-638-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">storage</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-4"><a id="__codelineno-638-4" name="__codelineno-638-4" href="#__codelineno-638-4"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-5"><a id="__codelineno-638-5" name="__codelineno-638-5" href="#__codelineno-638-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-638-6"><a id="__codelineno-638-6" name="__codelineno-638-6" href="#__codelineno-638-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-638-7"><a id="__codelineno-638-7" name="__codelineno-638-7" href="#__codelineno-638-7"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-638-8"><a id="__codelineno-638-8" name="__codelineno-638-8" href="#__codelineno-638-8"></a><span class="w">    </span><span class="c1">-- Check storage capacity</span>
</span><span id="__span-638-9"><a id="__codelineno-638-9" name="__codelineno-638-9" href="#__codelineno-638-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">storageInv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-638-10"><a id="__codelineno-638-10" name="__codelineno-638-10" href="#__codelineno-638-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">storageInv</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-638-11"><a id="__codelineno-638-11" name="__codelineno-638-11" href="#__codelineno-638-11"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storageInv</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span>
</span><span id="__span-638-12"><a id="__codelineno-638-12" name="__codelineno-638-12" href="#__codelineno-638-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storageInv</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-638-13"><a id="__codelineno-638-13" name="__codelineno-638-13" href="#__codelineno-638-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-638-14"><a id="__codelineno-638-14" name="__codelineno-638-14" href="#__codelineno-638-14"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemWeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxWeight</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-15"><a id="__codelineno-638-15" name="__codelineno-638-15" href="#__codelineno-638-15"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage is full&quot;</span><span class="p">)</span>
</span><span id="__span-638-16"><a id="__codelineno-638-16" name="__codelineno-638-16" href="#__codelineno-638-16"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-17"><a id="__codelineno-638-17" name="__codelineno-638-17" href="#__codelineno-638-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-638-18"><a id="__codelineno-638-18" name="__codelineno-638-18" href="#__codelineno-638-18"></a><span class="w">        </span><span class="c1">-- Check item restrictions</span>
</span><span id="__span-638-19"><a id="__codelineno-638-19" name="__codelineno-638-19" href="#__codelineno-638-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">restrictedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-638-20"><a id="__codelineno-638-20" name="__codelineno-638-20" href="#__codelineno-638-20"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;weapon_crowbar&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Weapons not allowed in storage&quot;</span><span class="p">,</span>
</span><span id="__span-638-21"><a id="__codelineno-638-21" name="__codelineno-638-21" href="#__codelineno-638-21"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;weapon_stunstick&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Weapons not allowed in storage&quot;</span>
</span><span id="__span-638-22"><a id="__codelineno-638-22" name="__codelineno-638-22" href="#__codelineno-638-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-638-23"><a id="__codelineno-638-23" name="__codelineno-638-23" href="#__codelineno-638-23"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">restrictedItems</span><span class="p">[</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-24"><a id="__codelineno-638-24" name="__codelineno-638-24" href="#__codelineno-638-24"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">restrictedItems</span><span class="p">[</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">])</span>
</span><span id="__span-638-25"><a id="__codelineno-638-25" name="__codelineno-638-25" href="#__codelineno-638-25"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-26"><a id="__codelineno-638-26" name="__codelineno-638-26" href="#__codelineno-638-26"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-638-27"><a id="__codelineno-638-27" name="__codelineno-638-27" href="#__codelineno-638-27"></a><span class="w">        </span><span class="c1">-- Check faction restrictions</span>
</span><span id="__span-638-28"><a id="__codelineno-638-28" name="__codelineno-638-28" href="#__codelineno-638-28"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-638-29"><a id="__codelineno-638-29" name="__codelineno-638-29" href="#__codelineno-638-29"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">storageFaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;faction&quot;</span><span class="p">)</span>
</span><span id="__span-638-30"><a id="__codelineno-638-30" name="__codelineno-638-30" href="#__codelineno-638-30"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">storageFaction</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">storageFaction</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-31"><a id="__codelineno-638-31" name="__codelineno-638-31" href="#__codelineno-638-31"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You cannot access this storage&quot;</span><span class="p">)</span>
</span><span id="__span-638-32"><a id="__codelineno-638-32" name="__codelineno-638-32" href="#__codelineno-638-32"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-33"><a id="__codelineno-638-33" name="__codelineno-638-33" href="#__codelineno-638-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-638-34"><a id="__codelineno-638-34" name="__codelineno-638-34" href="#__codelineno-638-34"></a><span class="w">        </span><span class="c1">-- Check distance</span>
</span><span id="__span-638-35"><a id="__codelineno-638-35" name="__codelineno-638-35" href="#__codelineno-638-35"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">storage</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
</span><span id="__span-638-36"><a id="__codelineno-638-36" name="__codelineno-638-36" href="#__codelineno-638-36"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-37"><a id="__codelineno-638-37" name="__codelineno-638-37" href="#__codelineno-638-37"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You are too far away from the storage&quot;</span><span class="p">)</span>
</span><span id="__span-638-38"><a id="__codelineno-638-38" name="__codelineno-638-38" href="#__codelineno-638-38"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-39"><a id="__codelineno-638-39" name="__codelineno-638-39" href="#__codelineno-638-39"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-638-40"><a id="__codelineno-638-40" name="__codelineno-638-40" href="#__codelineno-638-40"></a><span class="w">        </span><span class="c1">-- Check if storage is locked</span>
</span><span id="__span-638-41"><a id="__codelineno-638-41" name="__codelineno-638-41" href="#__codelineno-638-41"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-638-42"><a id="__codelineno-638-42" name="__codelineno-638-42" href="#__codelineno-638-42"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage is locked&quot;</span><span class="p">)</span>
</span><span id="__span-638-43"><a id="__codelineno-638-43" name="__codelineno-638-43" href="#__codelineno-638-43"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-638-44"><a id="__codelineno-638-44" name="__codelineno-638-44" href="#__codelineno-638-44"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-638-45"><a id="__codelineno-638-45" name="__codelineno-638-45" href="#__codelineno-638-45"></a><span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-638-46"><a id="__codelineno-638-46" name="__codelineno-638-46" href="#__codelineno-638-46"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storageentityremoved">StorageEntityRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when a storage entity is removed</p>
<p><strong>When Called</strong></p>
<p>When a storage entity is deleted or removed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>self</code> (<em>Entity</em>): The storage entity being removed</li>
<li><code>inventory</code> (<em>Inventory</em>): The inventory associated with the storage</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-639-1"><a id="__codelineno-639-1" name="__codelineno-639-1" href="#__codelineno-639-1"></a><span class="c1">-- Simple: Log storage removal</span>
</span><span id="__span-639-2"><a id="__codelineno-639-2" name="__codelineno-639-2" href="#__codelineno-639-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageEntityRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-639-3"><a id="__codelineno-639-3" name="__codelineno-639-3" href="#__codelineno-639-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage entity removed: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">self</span><span class="p">))</span>
</span><span id="__span-639-4"><a id="__codelineno-639-4" name="__codelineno-639-4" href="#__codelineno-639-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-640-1"><a id="__codelineno-640-1" name="__codelineno-640-1" href="#__codelineno-640-1"></a><span class="c1">-- Medium: Clean up storage data</span>
</span><span id="__span-640-2"><a id="__codelineno-640-2" name="__codelineno-640-2" href="#__codelineno-640-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageEntityRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CleanupStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-640-3"><a id="__codelineno-640-3" name="__codelineno-640-3" href="#__codelineno-640-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-640-4"><a id="__codelineno-640-4" name="__codelineno-640-4" href="#__codelineno-640-4"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">save</span><span class="p">()</span>
</span><span id="__span-640-5"><a id="__codelineno-640-5" name="__codelineno-640-5" href="#__codelineno-640-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-640-6"><a id="__codelineno-640-6" name="__codelineno-640-6" href="#__codelineno-640-6"></a><span class="c1">-- Remove from storage list</span>
</span><span id="__span-640-7"><a id="__codelineno-640-7" name="__codelineno-640-7" href="#__codelineno-640-7"></a><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">self</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-640-8"><a id="__codelineno-640-8" name="__codelineno-640-8" href="#__codelineno-640-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-641-1"><a id="__codelineno-641-1" name="__codelineno-641-1" href="#__codelineno-641-1"></a><span class="c1">-- High: Complex storage cleanup system</span>
</span><span id="__span-641-2"><a id="__codelineno-641-2" name="__codelineno-641-2" href="#__codelineno-641-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageEntityRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageCleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-641-3"><a id="__codelineno-641-3" name="__codelineno-641-3" href="#__codelineno-641-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-641-4"><a id="__codelineno-641-4" name="__codelineno-641-4" href="#__codelineno-641-4"></a><span class="w">    </span><span class="c1">-- Save inventory data</span>
</span><span id="__span-641-5"><a id="__codelineno-641-5" name="__codelineno-641-5" href="#__codelineno-641-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-641-6"><a id="__codelineno-641-6" name="__codelineno-641-6" href="#__codelineno-641-6"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">save</span><span class="p">()</span>
</span><span id="__span-641-7"><a id="__codelineno-641-7" name="__codelineno-641-7" href="#__codelineno-641-7"></a><span class="w">        </span><span class="c1">-- Log inventory contents</span>
</span><span id="__span-641-8"><a id="__codelineno-641-8" name="__codelineno-641-8" href="#__codelineno-641-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-641-9"><a id="__codelineno-641-9" name="__codelineno-641-9" href="#__codelineno-641-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-641-10"><a id="__codelineno-641-10" name="__codelineno-641-10" href="#__codelineno-641-10"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-641-11"><a id="__codelineno-641-11" name="__codelineno-641-11" href="#__codelineno-641-11"></a><span class="w">            </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-641-12"><a id="__codelineno-641-12" name="__codelineno-641-12" href="#__codelineno-641-12"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-641-13"><a id="__codelineno-641-13" name="__codelineno-641-13" href="#__codelineno-641-13"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Storage %s removed with %d items&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemCount</span><span class="p">))</span>
</span><span id="__span-641-14"><a id="__codelineno-641-14" name="__codelineno-641-14" href="#__codelineno-641-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-641-15"><a id="__codelineno-641-15" name="__codelineno-641-15" href="#__codelineno-641-15"></a><span class="w">    </span><span class="c1">-- Remove from storage list</span>
</span><span id="__span-641-16"><a id="__codelineno-641-16" name="__codelineno-641-16" href="#__codelineno-641-16"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">self</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-641-17"><a id="__codelineno-641-17" name="__codelineno-641-17" href="#__codelineno-641-17"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-641-18"><a id="__codelineno-641-18" name="__codelineno-641-18" href="#__codelineno-641-18"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-641-19"><a id="__codelineno-641-19" name="__codelineno-641-19" href="#__codelineno-641-19"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-641-20"><a id="__codelineno-641-20" name="__codelineno-641-20" href="#__codelineno-641-20"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-641-21"><a id="__codelineno-641-21" name="__codelineno-641-21" href="#__codelineno-641-21"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage has been removed&quot;</span><span class="p">)</span>
</span><span id="__span-641-22"><a id="__codelineno-641-22" name="__codelineno-641-22" href="#__codelineno-641-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-641-23"><a id="__codelineno-641-23" name="__codelineno-641-23" href="#__codelineno-641-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-641-24"><a id="__codelineno-641-24" name="__codelineno-641-24" href="#__codelineno-641-24"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-641-25"><a id="__codelineno-641-25" name="__codelineno-641-25" href="#__codelineno-641-25"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO storage_logs (timestamp, entityid, action) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-641-26"><a id="__codelineno-641-26" name="__codelineno-641-26" href="#__codelineno-641-26"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;removed&quot;</span><span class="p">)</span>
</span><span id="__span-641-27"><a id="__codelineno-641-27" name="__codelineno-641-27" href="#__codelineno-641-27"></a><span class="w">    </span><span class="c1">-- Clean up any associated data</span>
</span><span id="__span-641-28"><a id="__codelineno-641-28" name="__codelineno-641-28" href="#__codelineno-641-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">storageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-641-29"><a id="__codelineno-641-29" name="__codelineno-641-29" href="#__codelineno-641-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">storageData</span><span class="p">.</span><span class="py">owner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-641-30"><a id="__codelineno-641-30" name="__codelineno-641-30" href="#__codelineno-641-30"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">ownerChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">storageData</span><span class="p">.</span><span class="py">owner</span><span class="p">]</span>
</span><span id="__span-641-31"><a id="__codelineno-641-31" name="__codelineno-641-31" href="#__codelineno-641-31"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ownerChar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-641-32"><a id="__codelineno-641-32" name="__codelineno-641-32" href="#__codelineno-641-32"></a><span class="w">            </span><span class="nv">ownerChar</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;storageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nv">ownerChar</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;storageCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-641-33"><a id="__codelineno-641-33" name="__codelineno-641-33" href="#__codelineno-641-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-641-34"><a id="__codelineno-641-34" name="__codelineno-641-34" href="#__codelineno-641-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-641-35"><a id="__codelineno-641-35" name="__codelineno-641-35" href="#__codelineno-641-35"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storageinventoryset">StorageInventorySet</h3>
<p><strong>Purpose</strong></p>
<p>Called when a storage inventory is set</p>
<p><strong>When Called</strong></p>
<p>When a storage entity gets its inventory assigned</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>entity</code> (<em>Entity</em>): The storage entity</li>
<li><code>inventory</code> (<em>Inventory</em>): The inventory being set</li>
<li><code>isCar</code> (<em>boolean</em>): Whether this is a car storage</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-642-1"><a id="__codelineno-642-1" name="__codelineno-642-1" href="#__codelineno-642-1"></a><span class="c1">-- Simple: Log storage inventory set</span>
</span><span id="__span-642-2"><a id="__codelineno-642-2" name="__codelineno-642-2" href="#__codelineno-642-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageInventorySet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-642-3"><a id="__codelineno-642-3" name="__codelineno-642-3" href="#__codelineno-642-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage inventory set for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">entity</span><span class="p">))</span>
</span><span id="__span-642-4"><a id="__codelineno-642-4" name="__codelineno-642-4" href="#__codelineno-642-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-643-1"><a id="__codelineno-643-1" name="__codelineno-643-1" href="#__codelineno-643-1"></a><span class="c1">-- Medium: Set storage properties</span>
</span><span id="__span-643-2"><a id="__codelineno-643-2" name="__codelineno-643-2" href="#__codelineno-643-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageInventorySet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SetStorageProperties&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-643-3"><a id="__codelineno-643-3" name="__codelineno-643-3" href="#__codelineno-643-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-643-4"><a id="__codelineno-643-4" name="__codelineno-643-4" href="#__codelineno-643-4"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="nv">isCar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-643-5"><a id="__codelineno-643-5" name="__codelineno-643-5" href="#__codelineno-643-5"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="nv">isCar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-643-6"><a id="__codelineno-643-6" name="__codelineno-643-6" href="#__codelineno-643-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-643-7"><a id="__codelineno-643-7" name="__codelineno-643-7" href="#__codelineno-643-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-644-1"><a id="__codelineno-644-1" name="__codelineno-644-1" href="#__codelineno-644-1"></a><span class="c1">-- High: Complex storage inventory system</span>
</span><span id="__span-644-2"><a id="__codelineno-644-2" name="__codelineno-644-2" href="#__codelineno-644-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageInventorySet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageInventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-644-3"><a id="__codelineno-644-3" name="__codelineno-644-3" href="#__codelineno-644-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-644-4"><a id="__codelineno-644-4" name="__codelineno-644-4" href="#__codelineno-644-4"></a><span class="w">    </span><span class="c1">-- Set storage properties based on type</span>
</span><span id="__span-644-5"><a id="__codelineno-644-5" name="__codelineno-644-5" href="#__codelineno-644-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">isCar</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-644-6"><a id="__codelineno-644-6" name="__codelineno-644-6" href="#__codelineno-644-6"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-644-7"><a id="__codelineno-644-7" name="__codelineno-644-7" href="#__codelineno-644-7"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-644-8"><a id="__codelineno-644-8" name="__codelineno-644-8" href="#__codelineno-644-8"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;storageType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;car&quot;</span><span class="p">)</span>
</span><span id="__span-644-9"><a id="__codelineno-644-9" name="__codelineno-644-9" href="#__codelineno-644-9"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-644-10"><a id="__codelineno-644-10" name="__codelineno-644-10" href="#__codelineno-644-10"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-644-11"><a id="__codelineno-644-11" name="__codelineno-644-11" href="#__codelineno-644-11"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-644-12"><a id="__codelineno-644-12" name="__codelineno-644-12" href="#__codelineno-644-12"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;storageType&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;storage&quot;</span><span class="p">)</span>
</span><span id="__span-644-13"><a id="__codelineno-644-13" name="__codelineno-644-13" href="#__codelineno-644-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-644-14"><a id="__codelineno-644-14" name="__codelineno-644-14" href="#__codelineno-644-14"></a><span class="w">    </span><span class="c1">-- Set storage data</span>
</span><span id="__span-644-15"><a id="__codelineno-644-15" name="__codelineno-644-15" href="#__codelineno-644-15"></a><span class="w">    </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-644-16"><a id="__codelineno-644-16" name="__codelineno-644-16" href="#__codelineno-644-16"></a><span class="w">    </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-644-17"><a id="__codelineno-644-17" name="__codelineno-644-17" href="#__codelineno-644-17"></a><span class="w">    </span><span class="nv">isCar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">isCar</span><span class="p">,</span>
</span><span id="__span-644-18"><a id="__codelineno-644-18" name="__codelineno-644-18" href="#__codelineno-644-18"></a><span class="w">    </span><span class="nv">maxWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">(),</span>
</span><span id="__span-644-19"><a id="__codelineno-644-19" name="__codelineno-644-19" href="#__codelineno-644-19"></a><span class="w">    </span><span class="nv">maxItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxItems</span><span class="p">()</span>
</span><span id="__span-644-20"><a id="__codelineno-644-20" name="__codelineno-644-20" href="#__codelineno-644-20"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-644-21"><a id="__codelineno-644-21" name="__codelineno-644-21" href="#__codelineno-644-21"></a><span class="w">    </span><span class="c1">-- Add to storage list</span>
</span><span id="__span-644-22"><a id="__codelineno-644-22" name="__codelineno-644-22" href="#__codelineno-644-22"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">entity</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-644-23"><a id="__codelineno-644-23" name="__codelineno-644-23" href="#__codelineno-644-23"></a><span class="w">    </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">,</span>
</span><span id="__span-644-24"><a id="__codelineno-644-24" name="__codelineno-644-24" href="#__codelineno-644-24"></a><span class="w">    </span><span class="nv">isCar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">isCar</span><span class="p">,</span>
</span><span id="__span-644-25"><a id="__codelineno-644-25" name="__codelineno-644-25" href="#__codelineno-644-25"></a><span class="w">    </span><span class="nv">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-644-26"><a id="__codelineno-644-26" name="__codelineno-644-26" href="#__codelineno-644-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-644-27"><a id="__codelineno-644-27" name="__codelineno-644-27" href="#__codelineno-644-27"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-644-28"><a id="__codelineno-644-28" name="__codelineno-644-28" href="#__codelineno-644-28"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO storage_logs (timestamp, entityid, action, isCar) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-644-29"><a id="__codelineno-644-29" name="__codelineno-644-29" href="#__codelineno-644-29"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;inventory_set&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-644-30"><a id="__codelineno-644-30" name="__codelineno-644-30" href="#__codelineno-644-30"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-644-31"><a id="__codelineno-644-31" name="__codelineno-644-31" href="#__codelineno-644-31"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-644-32"><a id="__codelineno-644-32" name="__codelineno-644-32" href="#__codelineno-644-32"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-644-33"><a id="__codelineno-644-33" name="__codelineno-644-33" href="#__codelineno-644-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-644-34"><a id="__codelineno-644-34" name="__codelineno-644-34" href="#__codelineno-644-34"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage is now available&quot;</span><span class="p">)</span>
</span><span id="__span-644-35"><a id="__codelineno-644-35" name="__codelineno-644-35" href="#__codelineno-644-35"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-644-36"><a id="__codelineno-644-36" name="__codelineno-644-36" href="#__codelineno-644-36"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-644-37"><a id="__codelineno-644-37" name="__codelineno-644-37" href="#__codelineno-644-37"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storageitemremoved">StorageItemRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when an item is removed from storage</p>
<p><strong>When Called</strong></p>
<p>When an item is removed from a storage inventory</p>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-645-1"><a id="__codelineno-645-1" name="__codelineno-645-1" href="#__codelineno-645-1"></a><span class="c1">-- Simple: Log item removal</span>
</span><span id="__span-645-2"><a id="__codelineno-645-2" name="__codelineno-645-2" href="#__codelineno-645-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-645-3"><a id="__codelineno-645-3" name="__codelineno-645-3" href="#__codelineno-645-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item removed from storage&quot;</span><span class="p">)</span>
</span><span id="__span-645-4"><a id="__codelineno-645-4" name="__codelineno-645-4" href="#__codelineno-645-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-646-1"><a id="__codelineno-646-1" name="__codelineno-646-1" href="#__codelineno-646-1"></a><span class="c1">-- Medium: Update storage statistics</span>
</span><span id="__span-646-2"><a id="__codelineno-646-2" name="__codelineno-646-2" href="#__codelineno-646-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UpdateStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-646-3"><a id="__codelineno-646-3" name="__codelineno-646-3" href="#__codelineno-646-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">storageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-646-4"><a id="__codelineno-646-4" name="__codelineno-646-4" href="#__codelineno-646-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-646-5"><a id="__codelineno-646-5" name="__codelineno-646-5" href="#__codelineno-646-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">storage</span><span class="p">.</span><span class="py">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-646-6"><a id="__codelineno-646-6" name="__codelineno-646-6" href="#__codelineno-646-6"></a><span class="w">        </span><span class="nv">storageCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storageCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-646-7"><a id="__codelineno-646-7" name="__codelineno-646-7" href="#__codelineno-646-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-646-8"><a id="__codelineno-646-8" name="__codelineno-646-8" href="#__codelineno-646-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-646-9"><a id="__codelineno-646-9" name="__codelineno-646-9" href="#__codelineno-646-9"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Active storages: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">storageCount</span><span class="p">)</span>
</span><span id="__span-646-10"><a id="__codelineno-646-10" name="__codelineno-646-10" href="#__codelineno-646-10"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-647-1"><a id="__codelineno-647-1" name="__codelineno-647-1" href="#__codelineno-647-1"></a><span class="c1">-- High: Complex storage item removal system</span>
</span><span id="__span-647-2"><a id="__codelineno-647-2" name="__codelineno-647-2" href="#__codelineno-647-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageItemRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageItemRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-647-3"><a id="__codelineno-647-3" name="__codelineno-647-3" href="#__codelineno-647-3"></a><span class="c1">-- Update storage statistics</span>
</span><span id="__span-647-4"><a id="__codelineno-647-4" name="__codelineno-647-4" href="#__codelineno-647-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">totalItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-647-5"><a id="__codelineno-647-5" name="__codelineno-647-5" href="#__codelineno-647-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-647-6"><a id="__codelineno-647-6" name="__codelineno-647-6" href="#__codelineno-647-6"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-7"><a id="__codelineno-647-7" name="__codelineno-647-7" href="#__codelineno-647-7"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">storage</span><span class="p">.</span><span class="py">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-647-8"><a id="__codelineno-647-8" name="__codelineno-647-8" href="#__codelineno-647-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">.</span><span class="py">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-647-9"><a id="__codelineno-647-9" name="__codelineno-647-9" href="#__codelineno-647-9"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-10"><a id="__codelineno-647-10" name="__codelineno-647-10" href="#__codelineno-647-10"></a><span class="w">            </span><span class="nv">totalItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">totalItems</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-647-11"><a id="__codelineno-647-11" name="__codelineno-647-11" href="#__codelineno-647-11"></a><span class="w">            </span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">totalWeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getWeight</span><span class="p">()</span>
</span><span id="__span-647-12"><a id="__codelineno-647-12" name="__codelineno-647-12" href="#__codelineno-647-12"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-647-13"><a id="__codelineno-647-13" name="__codelineno-647-13" href="#__codelineno-647-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-647-14"><a id="__codelineno-647-14" name="__codelineno-647-14" href="#__codelineno-647-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-647-15"><a id="__codelineno-647-15" name="__codelineno-647-15" href="#__codelineno-647-15"></a><span class="c1">-- Log statistics</span>
</span><span id="__span-647-16"><a id="__codelineno-647-16" name="__codelineno-647-16" href="#__codelineno-647-16"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Storage statistics: %d items, %.2f weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">totalItems</span><span class="p">,</span><span class="w"> </span><span class="nv">totalWeight</span><span class="p">))</span>
</span><span id="__span-647-17"><a id="__codelineno-647-17" name="__codelineno-647-17" href="#__codelineno-647-17"></a><span class="c1">-- Update storage data</span>
</span><span id="__span-647-18"><a id="__codelineno-647-18" name="__codelineno-647-18" href="#__codelineno-647-18"></a><span class="kr">for</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-19"><a id="__codelineno-647-19" name="__codelineno-647-19" href="#__codelineno-647-19"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">storage</span><span class="p">.</span><span class="py">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-647-20"><a id="__codelineno-647-20" name="__codelineno-647-20" href="#__codelineno-647-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">.</span><span class="py">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-647-21"><a id="__codelineno-647-21" name="__codelineno-647-21" href="#__codelineno-647-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-647-22"><a id="__codelineno-647-22" name="__codelineno-647-22" href="#__codelineno-647-22"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-23"><a id="__codelineno-647-23" name="__codelineno-647-23" href="#__codelineno-647-23"></a><span class="w">            </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-647-24"><a id="__codelineno-647-24" name="__codelineno-647-24" href="#__codelineno-647-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-647-25"><a id="__codelineno-647-25" name="__codelineno-647-25" href="#__codelineno-647-25"></a><span class="w">        </span><span class="nv">entity</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemCount</span><span class="p">)</span>
</span><span id="__span-647-26"><a id="__codelineno-647-26" name="__codelineno-647-26" href="#__codelineno-647-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-647-27"><a id="__codelineno-647-27" name="__codelineno-647-27" href="#__codelineno-647-27"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-647-28"><a id="__codelineno-647-28" name="__codelineno-647-28" href="#__codelineno-647-28"></a><span class="c1">-- Notify nearby players</span>
</span><span id="__span-647-29"><a id="__codelineno-647-29" name="__codelineno-647-29" href="#__codelineno-647-29"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-30"><a id="__codelineno-647-30" name="__codelineno-647-30" href="#__codelineno-647-30"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-647-31"><a id="__codelineno-647-31" name="__codelineno-647-31" href="#__codelineno-647-31"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-647-32"><a id="__codelineno-647-32" name="__codelineno-647-32" href="#__codelineno-647-32"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-647-33"><a id="__codelineno-647-33" name="__codelineno-647-33" href="#__codelineno-647-33"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-647-34"><a id="__codelineno-647-34" name="__codelineno-647-34" href="#__codelineno-647-34"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">entity</span><span class="p">,</span><span class="w"> </span><span class="nv">storage</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-647-35"><a id="__codelineno-647-35" name="__codelineno-647-35" href="#__codelineno-647-35"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">entity</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-647-36"><a id="__codelineno-647-36" name="__codelineno-647-36" href="#__codelineno-647-36"></a><span class="w">                    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage contents updated&quot;</span><span class="p">)</span>
</span><span id="__span-647-37"><a id="__codelineno-647-37" name="__codelineno-647-37" href="#__codelineno-647-37"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-647-38"><a id="__codelineno-647-38" name="__codelineno-647-38" href="#__codelineno-647-38"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-647-39"><a id="__codelineno-647-39" name="__codelineno-647-39" href="#__codelineno-647-39"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-647-40"><a id="__codelineno-647-40" name="__codelineno-647-40" href="#__codelineno-647-40"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-647-41"><a id="__codelineno-647-41" name="__codelineno-647-41" href="#__codelineno-647-41"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-647-42"><a id="__codelineno-647-42" name="__codelineno-647-42" href="#__codelineno-647-42"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storageopen">StorageOpen</h3>
<p><strong>Purpose</strong></p>
<p>Called when storage is opened</p>
<p><strong>When Called</strong></p>
<p>When a player opens a storage entity</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>storage</code> (<em>Entity</em>): The storage entity being opened</li>
<li><code>isCar</code> (<em>boolean</em>): Whether this is a car storage</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-648-1"><a id="__codelineno-648-1" name="__codelineno-648-1" href="#__codelineno-648-1"></a><span class="c1">-- Simple: Log storage opening</span>
</span><span id="__span-648-2"><a id="__codelineno-648-2" name="__codelineno-648-2" href="#__codelineno-648-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageOpen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-648-3"><a id="__codelineno-648-3" name="__codelineno-648-3" href="#__codelineno-648-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage opened: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">storage</span><span class="p">))</span>
</span><span id="__span-648-4"><a id="__codelineno-648-4" name="__codelineno-648-4" href="#__codelineno-648-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-649-1"><a id="__codelineno-649-1" name="__codelineno-649-1" href="#__codelineno-649-1"></a><span class="c1">-- Medium: Track storage usage</span>
</span><span id="__span-649-2"><a id="__codelineno-649-2" name="__codelineno-649-2" href="#__codelineno-649-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageOpen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackUsage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-649-3"><a id="__codelineno-649-3" name="__codelineno-649-3" href="#__codelineno-649-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">storageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-649-4"><a id="__codelineno-649-4" name="__codelineno-649-4" href="#__codelineno-649-4"></a><span class="nv">storageData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">storageData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-649-5"><a id="__codelineno-649-5" name="__codelineno-649-5" href="#__codelineno-649-5"></a><span class="nv">storageData</span><span class="p">.</span><span class="py">lastOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-649-6"><a id="__codelineno-649-6" name="__codelineno-649-6" href="#__codelineno-649-6"></a><span class="nv">storage</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">storageData</span><span class="p">)</span>
</span><span id="__span-649-7"><a id="__codelineno-649-7" name="__codelineno-649-7" href="#__codelineno-649-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-650-1"><a id="__codelineno-650-1" name="__codelineno-650-1" href="#__codelineno-650-1"></a><span class="c1">-- High: Complex storage opening system</span>
</span><span id="__span-650-2"><a id="__codelineno-650-2" name="__codelineno-650-2" href="#__codelineno-650-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageOpen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageOpening&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">storage</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="p">)</span>
</span><span id="__span-650-3"><a id="__codelineno-650-3" name="__codelineno-650-3" href="#__codelineno-650-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">storage</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-650-4"><a id="__codelineno-650-4" name="__codelineno-650-4" href="#__codelineno-650-4"></a><span class="w">    </span><span class="c1">-- Update storage statistics</span>
</span><span id="__span-650-5"><a id="__codelineno-650-5" name="__codelineno-650-5" href="#__codelineno-650-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">storageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-650-6"><a id="__codelineno-650-6" name="__codelineno-650-6" href="#__codelineno-650-6"></a><span class="w">    </span><span class="nv">storageData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">storageData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-650-7"><a id="__codelineno-650-7" name="__codelineno-650-7" href="#__codelineno-650-7"></a><span class="w">    </span><span class="nv">storageData</span><span class="p">.</span><span class="py">lastOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-650-8"><a id="__codelineno-650-8" name="__codelineno-650-8" href="#__codelineno-650-8"></a><span class="w">    </span><span class="nv">storage</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">storageData</span><span class="p">)</span>
</span><span id="__span-650-9"><a id="__codelineno-650-9" name="__codelineno-650-9" href="#__codelineno-650-9"></a><span class="w">    </span><span class="c1">-- Check storage capacity</span>
</span><span id="__span-650-10"><a id="__codelineno-650-10" name="__codelineno-650-10" href="#__codelineno-650-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-650-11"><a id="__codelineno-650-11" name="__codelineno-650-11" href="#__codelineno-650-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-650-12"><a id="__codelineno-650-12" name="__codelineno-650-12" href="#__codelineno-650-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-650-13"><a id="__codelineno-650-13" name="__codelineno-650-13" href="#__codelineno-650-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-650-14"><a id="__codelineno-650-14" name="__codelineno-650-14" href="#__codelineno-650-14"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-650-15"><a id="__codelineno-650-15" name="__codelineno-650-15" href="#__codelineno-650-15"></a><span class="w">            </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-650-16"><a id="__codelineno-650-16" name="__codelineno-650-16" href="#__codelineno-650-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-650-17"><a id="__codelineno-650-17" name="__codelineno-650-17" href="#__codelineno-650-17"></a><span class="w">        </span><span class="nv">storage</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">itemCount</span><span class="p">)</span>
</span><span id="__span-650-18"><a id="__codelineno-650-18" name="__codelineno-650-18" href="#__codelineno-650-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-650-19"><a id="__codelineno-650-19" name="__codelineno-650-19" href="#__codelineno-650-19"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-650-20"><a id="__codelineno-650-20" name="__codelineno-650-20" href="#__codelineno-650-20"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO storage_logs (timestamp, entityid, action, isCar) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-650-21"><a id="__codelineno-650-21" name="__codelineno-650-21" href="#__codelineno-650-21"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;opened&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">isCar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-650-22"><a id="__codelineno-650-22" name="__codelineno-650-22" href="#__codelineno-650-22"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-650-23"><a id="__codelineno-650-23" name="__codelineno-650-23" href="#__codelineno-650-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storage</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-650-24"><a id="__codelineno-650-24" name="__codelineno-650-24" href="#__codelineno-650-24"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-650-25"><a id="__codelineno-650-25" name="__codelineno-650-25" href="#__codelineno-650-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-650-26"><a id="__codelineno-650-26" name="__codelineno-650-26" href="#__codelineno-650-26"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage has been opened&quot;</span><span class="p">)</span>
</span><span id="__span-650-27"><a id="__codelineno-650-27" name="__codelineno-650-27" href="#__codelineno-650-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-650-28"><a id="__codelineno-650-28" name="__codelineno-650-28" href="#__codelineno-650-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-650-29"><a id="__codelineno-650-29" name="__codelineno-650-29" href="#__codelineno-650-29"></a><span class="w">    </span><span class="c1">-- Check for storage upgrades</span>
</span><span id="__span-650-30"><a id="__codelineno-650-30" name="__codelineno-650-30" href="#__codelineno-650-30"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">storageData</span><span class="p">.</span><span class="py">openCount</span>
</span><span id="__span-650-31"><a id="__codelineno-650-31" name="__codelineno-650-31" href="#__codelineno-650-31"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">openCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">storageData</span><span class="p">.</span><span class="py">upgraded</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-650-32"><a id="__codelineno-650-32" name="__codelineno-650-32" href="#__codelineno-650-32"></a><span class="w">        </span><span class="nv">storageData</span><span class="p">.</span><span class="py">upgraded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-650-33"><a id="__codelineno-650-33" name="__codelineno-650-33" href="#__codelineno-650-33"></a><span class="w">        </span><span class="nv">storage</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">storageData</span><span class="p">)</span>
</span><span id="__span-650-34"><a id="__codelineno-650-34" name="__codelineno-650-34" href="#__codelineno-650-34"></a><span class="w">        </span><span class="c1">-- Increase storage capacity</span>
</span><span id="__span-650-35"><a id="__codelineno-650-35" name="__codelineno-650-35" href="#__codelineno-650-35"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-650-36"><a id="__codelineno-650-36" name="__codelineno-650-36" href="#__codelineno-650-36"></a><span class="w">            </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="__span-650-37"><a id="__codelineno-650-37" name="__codelineno-650-37" href="#__codelineno-650-37"></a><span class="w">            </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxItems</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="__span-650-38"><a id="__codelineno-650-38" name="__codelineno-650-38" href="#__codelineno-650-38"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-650-39"><a id="__codelineno-650-39" name="__codelineno-650-39" href="#__codelineno-650-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-650-40"><a id="__codelineno-650-40" name="__codelineno-650-40" href="#__codelineno-650-40"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storagerestored">StorageRestored</h3>
<p><strong>Purpose</strong></p>
<p>Called when storage is restored</p>
<p><strong>When Called</strong></p>
<p>When a storage entity is restored from save data</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The storage entity being restored</li>
<li><code>inventory</code> (<em>Inventory</em>): The inventory being restored</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-651-1"><a id="__codelineno-651-1" name="__codelineno-651-1" href="#__codelineno-651-1"></a><span class="c1">-- Simple: Log storage restoration</span>
</span><span id="__span-651-2"><a id="__codelineno-651-2" name="__codelineno-651-2" href="#__codelineno-651-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-651-3"><a id="__codelineno-651-3" name="__codelineno-651-3" href="#__codelineno-651-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage restored: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-651-4"><a id="__codelineno-651-4" name="__codelineno-651-4" href="#__codelineno-651-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-652-1"><a id="__codelineno-652-1" name="__codelineno-652-1" href="#__codelineno-652-1"></a><span class="c1">-- Medium: Validate storage data</span>
</span><span id="__span-652-2"><a id="__codelineno-652-2" name="__codelineno-652-2" href="#__codelineno-652-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-652-3"><a id="__codelineno-652-3" name="__codelineno-652-3" href="#__codelineno-652-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-652-4"><a id="__codelineno-652-4" name="__codelineno-652-4" href="#__codelineno-652-4"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-652-5"><a id="__codelineno-652-5" name="__codelineno-652-5" href="#__codelineno-652-5"></a><span class="w">    </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-652-6"><a id="__codelineno-652-6" name="__codelineno-652-6" href="#__codelineno-652-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-652-7"><a id="__codelineno-652-7" name="__codelineno-652-7" href="#__codelineno-652-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-653-1"><a id="__codelineno-653-1" name="__codelineno-653-1" href="#__codelineno-653-1"></a><span class="c1">-- High: Complex storage restoration system</span>
</span><span id="__span-653-2"><a id="__codelineno-653-2" name="__codelineno-653-2" href="#__codelineno-653-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StorageRestored&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedStorageRestoration&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="nv">inventory</span><span class="p">)</span>
</span><span id="__span-653-3"><a id="__codelineno-653-3" name="__codelineno-653-3" href="#__codelineno-653-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-653-4"><a id="__codelineno-653-4" name="__codelineno-653-4" href="#__codelineno-653-4"></a><span class="w">    </span><span class="c1">-- Validate inventory data</span>
</span><span id="__span-653-5"><a id="__codelineno-653-5" name="__codelineno-653-5" href="#__codelineno-653-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxWeight</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-653-6"><a id="__codelineno-653-6" name="__codelineno-653-6" href="#__codelineno-653-6"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxWeight</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-653-7"><a id="__codelineno-653-7" name="__codelineno-653-7" href="#__codelineno-653-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-653-8"><a id="__codelineno-653-8" name="__codelineno-653-8" href="#__codelineno-653-8"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getMaxItems</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-653-9"><a id="__codelineno-653-9" name="__codelineno-653-9" href="#__codelineno-653-9"></a><span class="w">        </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">setMaxItems</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</span><span id="__span-653-10"><a id="__codelineno-653-10" name="__codelineno-653-10" href="#__codelineno-653-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-653-11"><a id="__codelineno-653-11" name="__codelineno-653-11" href="#__codelineno-653-11"></a><span class="w">    </span><span class="c1">-- Set storage data</span>
</span><span id="__span-653-12"><a id="__codelineno-653-12" name="__codelineno-653-12" href="#__codelineno-653-12"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;storageData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-653-13"><a id="__codelineno-653-13" name="__codelineno-653-13" href="#__codelineno-653-13"></a><span class="w">    </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span>
</span><span id="__span-653-14"><a id="__codelineno-653-14" name="__codelineno-653-14" href="#__codelineno-653-14"></a><span class="w">    </span><span class="nv">restored</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-653-15"><a id="__codelineno-653-15" name="__codelineno-653-15" href="#__codelineno-653-15"></a><span class="w">    </span><span class="nv">restoredAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-653-16"><a id="__codelineno-653-16" name="__codelineno-653-16" href="#__codelineno-653-16"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-653-17"><a id="__codelineno-653-17" name="__codelineno-653-17" href="#__codelineno-653-17"></a><span class="w">    </span><span class="c1">-- Add to storage list</span>
</span><span id="__span-653-18"><a id="__codelineno-653-18" name="__codelineno-653-18" href="#__codelineno-653-18"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">storage</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">ent</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-653-19"><a id="__codelineno-653-19" name="__codelineno-653-19" href="#__codelineno-653-19"></a><span class="w">    </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">,</span>
</span><span id="__span-653-20"><a id="__codelineno-653-20" name="__codelineno-653-20" href="#__codelineno-653-20"></a><span class="w">    </span><span class="nv">restored</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-653-21"><a id="__codelineno-653-21" name="__codelineno-653-21" href="#__codelineno-653-21"></a><span class="w">    </span><span class="nv">restoredAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-653-22"><a id="__codelineno-653-22" name="__codelineno-653-22" href="#__codelineno-653-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-653-23"><a id="__codelineno-653-23" name="__codelineno-653-23" href="#__codelineno-653-23"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-653-24"><a id="__codelineno-653-24" name="__codelineno-653-24" href="#__codelineno-653-24"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO storage_logs (timestamp, entityid, action) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-653-25"><a id="__codelineno-653-25" name="__codelineno-653-25" href="#__codelineno-653-25"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="s2">&quot;restored&quot;</span><span class="p">)</span>
</span><span id="__span-653-26"><a id="__codelineno-653-26" name="__codelineno-653-26" href="#__codelineno-653-26"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-653-27"><a id="__codelineno-653-27" name="__codelineno-653-27" href="#__codelineno-653-27"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-653-28"><a id="__codelineno-653-28" name="__codelineno-653-28" href="#__codelineno-653-28"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-653-29"><a id="__codelineno-653-29" name="__codelineno-653-29" href="#__codelineno-653-29"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-653-30"><a id="__codelineno-653-30" name="__codelineno-653-30" href="#__codelineno-653-30"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Storage has been restored&quot;</span><span class="p">)</span>
</span><span id="__span-653-31"><a id="__codelineno-653-31" name="__codelineno-653-31" href="#__codelineno-653-31"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-653-32"><a id="__codelineno-653-32" name="__codelineno-653-32" href="#__codelineno-653-32"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-653-33"><a id="__codelineno-653-33" name="__codelineno-653-33" href="#__codelineno-653-33"></a><span class="w">    </span><span class="c1">-- Check for corrupted items</span>
</span><span id="__span-653-34"><a id="__codelineno-653-34" name="__codelineno-653-34" href="#__codelineno-653-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-653-35"><a id="__codelineno-653-35" name="__codelineno-653-35" href="#__codelineno-653-35"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">corruptedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-653-36"><a id="__codelineno-653-36" name="__codelineno-653-36" href="#__codelineno-653-36"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-653-37"><a id="__codelineno-653-37" name="__codelineno-653-37" href="#__codelineno-653-37"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-653-38"><a id="__codelineno-653-38" name="__codelineno-653-38" href="#__codelineno-653-38"></a><span class="w">            </span><span class="nv">corruptedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">corruptedItems</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-653-39"><a id="__codelineno-653-39" name="__codelineno-653-39" href="#__codelineno-653-39"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-653-40"><a id="__codelineno-653-40" name="__codelineno-653-40" href="#__codelineno-653-40"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-653-41"><a id="__codelineno-653-41" name="__codelineno-653-41" href="#__codelineno-653-41"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">corruptedItems</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-653-42"><a id="__codelineno-653-42" name="__codelineno-653-42" href="#__codelineno-653-42"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Storage %s restored with %d corrupted items&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">corruptedItems</span><span class="p">))</span>
</span><span id="__span-653-43"><a id="__codelineno-653-43" name="__codelineno-653-43" href="#__codelineno-653-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-653-44"><a id="__codelineno-653-44" name="__codelineno-653-44" href="#__codelineno-653-44"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="storespawns">StoreSpawns</h3>
<p><strong>Purpose</strong></p>
<p>Called to store spawn points</p>
<p><strong>When Called</strong></p>
<p>When spawn points are being stored</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>spawns</code> (<em>table</em>): The spawn points to store</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-654-1"><a id="__codelineno-654-1" name="__codelineno-654-1" href="#__codelineno-654-1"></a><span class="c1">-- Simple: Log spawn storage</span>
</span><span id="__span-654-2"><a id="__codelineno-654-2" name="__codelineno-654-2" href="#__codelineno-654-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StoreSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span>
</span><span id="__span-654-3"><a id="__codelineno-654-3" name="__codelineno-654-3" href="#__codelineno-654-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storing &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">#</span><span class="nv">spawns</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; spawn points&quot;</span><span class="p">)</span>
</span><span id="__span-654-4"><a id="__codelineno-654-4" name="__codelineno-654-4" href="#__codelineno-654-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-655-1"><a id="__codelineno-655-1" name="__codelineno-655-1" href="#__codelineno-655-1"></a><span class="c1">-- Medium: Validate spawn points</span>
</span><span id="__span-655-2"><a id="__codelineno-655-2" name="__codelineno-655-2" href="#__codelineno-655-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StoreSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span>
</span><span id="__span-655-3"><a id="__codelineno-655-3" name="__codelineno-655-3" href="#__codelineno-655-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-655-4"><a id="__codelineno-655-4" name="__codelineno-655-4" href="#__codelineno-655-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-655-5"><a id="__codelineno-655-5" name="__codelineno-655-5" href="#__codelineno-655-5"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid spawn point at index &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
</span><span id="__span-655-6"><a id="__codelineno-655-6" name="__codelineno-655-6" href="#__codelineno-655-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-655-7"><a id="__codelineno-655-7" name="__codelineno-655-7" href="#__codelineno-655-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-655-8"><a id="__codelineno-655-8" name="__codelineno-655-8" href="#__codelineno-655-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-656-1"><a id="__codelineno-656-1" name="__codelineno-656-1" href="#__codelineno-656-1"></a><span class="c1">-- High: Complex spawn storage system</span>
</span><span id="__span-656-2"><a id="__codelineno-656-2" name="__codelineno-656-2" href="#__codelineno-656-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;StoreSpawns&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedSpawnStorage&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span>
</span><span id="__span-656-3"><a id="__codelineno-656-3" name="__codelineno-656-3" href="#__codelineno-656-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">spawns</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">#</span><span class="nv">spawns</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-656-4"><a id="__codelineno-656-4" name="__codelineno-656-4" href="#__codelineno-656-4"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spawn points to store&quot;</span><span class="p">)</span>
</span><span id="__span-656-5"><a id="__codelineno-656-5" name="__codelineno-656-5" href="#__codelineno-656-5"></a><span class="w">    </span><span class="kr">return</span>
</span><span id="__span-656-6"><a id="__codelineno-656-6" name="__codelineno-656-6" href="#__codelineno-656-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-656-7"><a id="__codelineno-656-7" name="__codelineno-656-7" href="#__codelineno-656-7"></a><span class="c1">-- Validate spawn points</span>
</span><span id="__span-656-8"><a id="__codelineno-656-8" name="__codelineno-656-8" href="#__codelineno-656-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">validSpawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-656-9"><a id="__codelineno-656-9" name="__codelineno-656-9" href="#__codelineno-656-9"></a><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">spawns</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-656-10"><a id="__codelineno-656-10" name="__codelineno-656-10" href="#__codelineno-656-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-656-11"><a id="__codelineno-656-11" name="__codelineno-656-11" href="#__codelineno-656-11"></a><span class="w">        </span><span class="c1">-- Check if spawn is valid</span>
</span><span id="__span-656-12"><a id="__codelineno-656-12" name="__codelineno-656-12" href="#__codelineno-656-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TraceLine</span><span class="p">({</span>
</span><span id="__span-656-13"><a id="__codelineno-656-13" name="__codelineno-656-13" href="#__codelineno-656-13"></a><span class="w">        </span><span class="nv">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="p">,</span>
</span><span id="__span-656-14"><a id="__codelineno-656-14" name="__codelineno-656-14" href="#__codelineno-656-14"></a><span class="w">        </span><span class="nv">endpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">),</span>
</span><span id="__span-656-15"><a id="__codelineno-656-15" name="__codelineno-656-15" href="#__codelineno-656-15"></a><span class="w">        </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MASK_SOLID</span>
</span><span id="__span-656-16"><a id="__codelineno-656-16" name="__codelineno-656-16" href="#__codelineno-656-16"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-656-17"><a id="__codelineno-656-17" name="__codelineno-656-17" href="#__codelineno-656-17"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">trace</span><span class="p">.</span><span class="py">Hit</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-656-18"><a id="__codelineno-656-18" name="__codelineno-656-18" href="#__codelineno-656-18"></a><span class="w">            </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">validSpawns</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">)</span>
</span><span id="__span-656-19"><a id="__codelineno-656-19" name="__codelineno-656-19" href="#__codelineno-656-19"></a><span class="w">        </span><span class="kr">else</span>
</span><span id="__span-656-20"><a id="__codelineno-656-20" name="__codelineno-656-20" href="#__codelineno-656-20"></a><span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spawn point &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is not on solid ground&quot;</span><span class="p">)</span>
</span><span id="__span-656-21"><a id="__codelineno-656-21" name="__codelineno-656-21" href="#__codelineno-656-21"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-656-22"><a id="__codelineno-656-22" name="__codelineno-656-22" href="#__codelineno-656-22"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-656-23"><a id="__codelineno-656-23" name="__codelineno-656-23" href="#__codelineno-656-23"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid spawn point at index &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
</span><span id="__span-656-24"><a id="__codelineno-656-24" name="__codelineno-656-24" href="#__codelineno-656-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-656-25"><a id="__codelineno-656-25" name="__codelineno-656-25" href="#__codelineno-656-25"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-656-26"><a id="__codelineno-656-26" name="__codelineno-656-26" href="#__codelineno-656-26"></a><span class="c1">-- Store valid spawns</span>
</span><span id="__span-656-27"><a id="__codelineno-656-27" name="__codelineno-656-27" href="#__codelineno-656-27"></a><span class="nv">lia</span><span class="p">.</span><span class="py">spawns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">validSpawns</span>
</span><span id="__span-656-28"><a id="__codelineno-656-28" name="__codelineno-656-28" href="#__codelineno-656-28"></a><span class="c1">-- Log to database</span>
</span><span id="__span-656-29"><a id="__codelineno-656-29" name="__codelineno-656-29" href="#__codelineno-656-29"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;DELETE FROM spawns&quot;</span><span class="p">)</span>
</span><span id="__span-656-30"><a id="__codelineno-656-30" name="__codelineno-656-30" href="#__codelineno-656-30"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">validSpawns</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-656-31"><a id="__codelineno-656-31" name="__codelineno-656-31" href="#__codelineno-656-31"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO spawns (pos_x, pos_y, pos_z, ang_p, ang_y, ang_r) VALUES (?, ?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-656-32"><a id="__codelineno-656-32" name="__codelineno-656-32" href="#__codelineno-656-32"></a><span class="w">    </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="p">.</span><span class="py">x</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="p">.</span><span class="py">y</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">pos</span><span class="p">.</span><span class="py">z</span><span class="p">,</span>
</span><span id="__span-656-33"><a id="__codelineno-656-33" name="__codelineno-656-33" href="#__codelineno-656-33"></a><span class="w">    </span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="p">.</span><span class="py">p</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="p">.</span><span class="py">y</span><span class="p">,</span><span class="w"> </span><span class="nv">spawn</span><span class="p">.</span><span class="py">ang</span><span class="p">.</span><span class="py">r</span><span class="p">)</span>
</span><span id="__span-656-34"><a id="__codelineno-656-34" name="__codelineno-656-34" href="#__codelineno-656-34"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-656-35"><a id="__codelineno-656-35" name="__codelineno-656-35" href="#__codelineno-656-35"></a><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Stored %d valid spawn points&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="nv">validSpawns</span><span class="p">))</span>
</span><span id="__span-656-36"><a id="__codelineno-656-36" name="__codelineno-656-36" href="#__codelineno-656-36"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="synccharlist">SyncCharList</h3>
<p><strong>Purpose</strong></p>
<p>Called to sync character list with client</p>
<p><strong>When Called</strong></p>
<p>When character list needs to be synchronized</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The client to sync with</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-657-1"><a id="__codelineno-657-1" name="__codelineno-657-1" href="#__codelineno-657-1"></a><span class="c1">-- Simple: Log character list sync</span>
</span><span id="__span-657-2"><a id="__codelineno-657-2" name="__codelineno-657-2" href="#__codelineno-657-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SyncCharList&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-657-3"><a id="__codelineno-657-3" name="__codelineno-657-3" href="#__codelineno-657-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Syncing character list with &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-657-4"><a id="__codelineno-657-4" name="__codelineno-657-4" href="#__codelineno-657-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-658-1"><a id="__codelineno-658-1" name="__codelineno-658-1" href="#__codelineno-658-1"></a><span class="c1">-- Medium: Validate character data</span>
</span><span id="__span-658-2"><a id="__codelineno-658-2" name="__codelineno-658-2" href="#__codelineno-658-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SyncCharList&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateChars&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-658-3"><a id="__codelineno-658-3" name="__codelineno-658-3" href="#__codelineno-658-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">charList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getCharList</span><span class="p">()</span>
</span><span id="__span-658-4"><a id="__codelineno-658-4" name="__codelineno-658-4" href="#__codelineno-658-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">charList</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-658-5"><a id="__codelineno-658-5" name="__codelineno-658-5" href="#__codelineno-658-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-658-6"><a id="__codelineno-658-6" name="__codelineno-658-6" href="#__codelineno-658-6"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid character data for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-658-7"><a id="__codelineno-658-7" name="__codelineno-658-7" href="#__codelineno-658-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-658-8"><a id="__codelineno-658-8" name="__codelineno-658-8" href="#__codelineno-658-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-658-9"><a id="__codelineno-658-9" name="__codelineno-658-9" href="#__codelineno-658-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-659-1"><a id="__codelineno-659-1" name="__codelineno-659-1" href="#__codelineno-659-1"></a><span class="c1">-- High: Complex character list sync system</span>
</span><span id="__span-659-2"><a id="__codelineno-659-2" name="__codelineno-659-2" href="#__codelineno-659-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;SyncCharList&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedCharSync&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-659-3"><a id="__codelineno-659-3" name="__codelineno-659-3" href="#__codelineno-659-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-659-4"><a id="__codelineno-659-4" name="__codelineno-659-4" href="#__codelineno-659-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">charList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getCharList</span><span class="p">()</span>
</span><span id="__span-659-5"><a id="__codelineno-659-5" name="__codelineno-659-5" href="#__codelineno-659-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">charList</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-659-6"><a id="__codelineno-659-6" name="__codelineno-659-6" href="#__codelineno-659-6"></a><span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No character list for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-659-7"><a id="__codelineno-659-7" name="__codelineno-659-7" href="#__codelineno-659-7"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-659-8"><a id="__codelineno-659-8" name="__codelineno-659-8" href="#__codelineno-659-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-659-9"><a id="__codelineno-659-9" name="__codelineno-659-9" href="#__codelineno-659-9"></a><span class="w">    </span><span class="c1">-- Validate character data</span>
</span><span id="__span-659-10"><a id="__codelineno-659-10" name="__codelineno-659-10" href="#__codelineno-659-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">validChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-659-11"><a id="__codelineno-659-11" name="__codelineno-659-11" href="#__codelineno-659-11"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">charList</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-659-12"><a id="__codelineno-659-12" name="__codelineno-659-12" href="#__codelineno-659-12"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="p">.</span><span class="py">name</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-659-13"><a id="__codelineno-659-13" name="__codelineno-659-13" href="#__codelineno-659-13"></a><span class="w">            </span><span class="c1">-- Check if character is valid</span>
</span><span id="__span-659-14"><a id="__codelineno-659-14" name="__codelineno-659-14" href="#__codelineno-659-14"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">faction</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">char</span><span class="p">.</span><span class="py">faction</span><span class="p">]</span>
</span><span id="__span-659-15"><a id="__codelineno-659-15" name="__codelineno-659-15" href="#__codelineno-659-15"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-659-16"><a id="__codelineno-659-16" name="__codelineno-659-16" href="#__codelineno-659-16"></a><span class="w">                </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">validChars</span><span class="p">,</span><span class="w"> </span><span class="nv">char</span><span class="p">)</span>
</span><span id="__span-659-17"><a id="__codelineno-659-17" name="__codelineno-659-17" href="#__codelineno-659-17"></a><span class="w">            </span><span class="kr">else</span>
</span><span id="__span-659-18"><a id="__codelineno-659-18" name="__codelineno-659-18" href="#__codelineno-659-18"></a><span class="w">                </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid faction for character &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">char</span><span class="p">.</span><span class="py">name</span><span class="p">)</span>
</span><span id="__span-659-19"><a id="__codelineno-659-19" name="__codelineno-659-19" href="#__codelineno-659-19"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-659-20"><a id="__codelineno-659-20" name="__codelineno-659-20" href="#__codelineno-659-20"></a><span class="w">        </span><span class="kr">else</span>
</span><span id="__span-659-21"><a id="__codelineno-659-21" name="__codelineno-659-21" href="#__codelineno-659-21"></a><span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid character data for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-659-22"><a id="__codelineno-659-22" name="__codelineno-659-22" href="#__codelineno-659-22"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-659-23"><a id="__codelineno-659-23" name="__codelineno-659-23" href="#__codelineno-659-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-659-24"><a id="__codelineno-659-24" name="__codelineno-659-24" href="#__codelineno-659-24"></a><span class="w">    </span><span class="c1">-- Update client character list</span>
</span><span id="__span-659-25"><a id="__codelineno-659-25" name="__codelineno-659-25" href="#__codelineno-659-25"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">setCharList</span><span class="p">(</span><span class="nv">validChars</span><span class="p">)</span>
</span><span id="__span-659-26"><a id="__codelineno-659-26" name="__codelineno-659-26" href="#__codelineno-659-26"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-659-27"><a id="__codelineno-659-27" name="__codelineno-659-27" href="#__codelineno-659-27"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;UPDATE players SET char_list = ? WHERE steamid = ?&quot;</span><span class="p">,</span>
</span><span id="__span-659-28"><a id="__codelineno-659-28" name="__codelineno-659-28" href="#__codelineno-659-28"></a><span class="w">    </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">validChars</span><span class="p">),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-659-29"><a id="__codelineno-659-29" name="__codelineno-659-29" href="#__codelineno-659-29"></a><span class="w">    </span><span class="c1">-- Notify client</span>
</span><span id="__span-659-30"><a id="__codelineno-659-30" name="__codelineno-659-30" href="#__codelineno-659-30"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;liaCharListUpdated&quot;</span><span class="p">)</span>
</span><span id="__span-659-31"><a id="__codelineno-659-31" name="__codelineno-659-31" href="#__codelineno-659-31"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteTable</span><span class="p">(</span><span class="nv">validChars</span><span class="p">)</span>
</span><span id="__span-659-32"><a id="__codelineno-659-32" name="__codelineno-659-32" href="#__codelineno-659-32"></a><span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span>
</span><span id="__span-659-33"><a id="__codelineno-659-33" name="__codelineno-659-33" href="#__codelineno-659-33"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Synced %d characters for %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="nv">validChars</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()))</span>
</span><span id="__span-659-34"><a id="__codelineno-659-34" name="__codelineno-659-34" href="#__codelineno-659-34"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ticketsystemclaim">TicketSystemClaim</h3>
<p><strong>Purpose</strong></p>
<p>Called when a ticket is claimed</p>
<p><strong>When Called</strong></p>
<p>When a support ticket is claimed by an admin</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The admin claiming the ticket</li>
<li><code>requester</code> (<em>Player</em>): The player who requested the ticket</li>
<li><code>ticketMessage</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-660-1"><a id="__codelineno-660-1" name="__codelineno-660-1" href="#__codelineno-660-1"></a><span class="c1">-- Simple: Log ticket claim</span>
</span><span id="__span-660-2"><a id="__codelineno-660-2" name="__codelineno-660-2" href="#__codelineno-660-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-660-3"><a id="__codelineno-660-3" name="__codelineno-660-3" href="#__codelineno-660-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; claimed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-660-4"><a id="__codelineno-660-4" name="__codelineno-660-4" href="#__codelineno-660-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-661-1"><a id="__codelineno-661-1" name="__codelineno-661-1" href="#__codelineno-661-1"></a><span class="c1">-- Medium: Notify players</span>
</span><span id="__span-661-2"><a id="__codelineno-661-2" name="__codelineno-661-2" href="#__codelineno-661-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-661-3"><a id="__codelineno-661-3" name="__codelineno-661-3" href="#__codelineno-661-3"></a><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been claimed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-661-4"><a id="__codelineno-661-4" name="__codelineno-661-4" href="#__codelineno-661-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-661-5"><a id="__codelineno-661-5" name="__codelineno-661-5" href="#__codelineno-661-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-661-6"><a id="__codelineno-661-6" name="__codelineno-661-6" href="#__codelineno-661-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; claimed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-661-7"><a id="__codelineno-661-7" name="__codelineno-661-7" href="#__codelineno-661-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-661-8"><a id="__codelineno-661-8" name="__codelineno-661-8" href="#__codelineno-661-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-661-9"><a id="__codelineno-661-9" name="__codelineno-661-9" href="#__codelineno-661-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-662-1"><a id="__codelineno-662-1" name="__codelineno-662-1" href="#__codelineno-662-1"></a><span class="c1">-- High: Complex ticket claim system</span>
</span><span id="__span-662-2"><a id="__codelineno-662-2" name="__codelineno-662-2" href="#__codelineno-662-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketClaim&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-662-3"><a id="__codelineno-662-3" name="__codelineno-662-3" href="#__codelineno-662-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">requester</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-662-4"><a id="__codelineno-662-4" name="__codelineno-662-4" href="#__codelineno-662-4"></a><span class="w">    </span><span class="c1">-- Check if client is admin</span>
</span><span id="__span-662-5"><a id="__codelineno-662-5" name="__codelineno-662-5" href="#__codelineno-662-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-662-6"><a id="__codelineno-662-6" name="__codelineno-662-6" href="#__codelineno-662-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You do not have permission to claim tickets&quot;</span><span class="p">)</span>
</span><span id="__span-662-7"><a id="__codelineno-662-7" name="__codelineno-662-7" href="#__codelineno-662-7"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-662-8"><a id="__codelineno-662-8" name="__codelineno-662-8" href="#__codelineno-662-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-662-9"><a id="__codelineno-662-9" name="__codelineno-662-9" href="#__codelineno-662-9"></a><span class="w">    </span><span class="c1">-- Update ticket status</span>
</span><span id="__span-662-10"><a id="__codelineno-662-10" name="__codelineno-662-10" href="#__codelineno-662-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ticketData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-662-11"><a id="__codelineno-662-11" name="__codelineno-662-11" href="#__codelineno-662-11"></a><span class="w">    </span><span class="nv">claimed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-662-12"><a id="__codelineno-662-12" name="__codelineno-662-12" href="#__codelineno-662-12"></a><span class="w">    </span><span class="nv">claimedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span>
</span><span id="__span-662-13"><a id="__codelineno-662-13" name="__codelineno-662-13" href="#__codelineno-662-13"></a><span class="w">    </span><span class="nv">claimedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-662-14"><a id="__codelineno-662-14" name="__codelineno-662-14" href="#__codelineno-662-14"></a><span class="w">    </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticketMessage</span>
</span><span id="__span-662-15"><a id="__codelineno-662-15" name="__codelineno-662-15" href="#__codelineno-662-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-662-16"><a id="__codelineno-662-16" name="__codelineno-662-16" href="#__codelineno-662-16"></a><span class="w">    </span><span class="nv">requester</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketData</span><span class="p">)</span>
</span><span id="__span-662-17"><a id="__codelineno-662-17" name="__codelineno-662-17" href="#__codelineno-662-17"></a><span class="w">    </span><span class="c1">-- Notify requester</span>
</span><span id="__span-662-18"><a id="__codelineno-662-18" name="__codelineno-662-18" href="#__codelineno-662-18"></a><span class="w">    </span><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been claimed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-662-19"><a id="__codelineno-662-19" name="__codelineno-662-19" href="#__codelineno-662-19"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-662-20"><a id="__codelineno-662-20" name="__codelineno-662-20" href="#__codelineno-662-20"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-662-21"><a id="__codelineno-662-21" name="__codelineno-662-21" href="#__codelineno-662-21"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-662-22"><a id="__codelineno-662-22" name="__codelineno-662-22" href="#__codelineno-662-22"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; claimed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-662-23"><a id="__codelineno-662-23" name="__codelineno-662-23" href="#__codelineno-662-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-662-24"><a id="__codelineno-662-24" name="__codelineno-662-24" href="#__codelineno-662-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-662-25"><a id="__codelineno-662-25" name="__codelineno-662-25" href="#__codelineno-662-25"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-662-26"><a id="__codelineno-662-26" name="__codelineno-662-26" href="#__codelineno-662-26"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ticket_logs (timestamp, requester_steamid, claimer_steamid, message) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-662-27"><a id="__codelineno-662-27" name="__codelineno-662-27" href="#__codelineno-662-27"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-662-28"><a id="__codelineno-662-28" name="__codelineno-662-28" href="#__codelineno-662-28"></a><span class="w">    </span><span class="c1">-- Update client data</span>
</span><span id="__span-662-29"><a id="__codelineno-662-29" name="__codelineno-662-29" href="#__codelineno-662-29"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">clientData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-662-30"><a id="__codelineno-662-30" name="__codelineno-662-30" href="#__codelineno-662-30"></a><span class="w">    </span><span class="nv">clientData</span><span class="p">.</span><span class="py">claimed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">clientData</span><span class="p">.</span><span class="py">claimed</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-662-31"><a id="__codelineno-662-31" name="__codelineno-662-31" href="#__codelineno-662-31"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">clientData</span><span class="p">)</span>
</span><span id="__span-662-32"><a id="__codelineno-662-32" name="__codelineno-662-32" href="#__codelineno-662-32"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ticketsystemclose">TicketSystemClose</h3>
<p><strong>Purpose</strong></p>
<p>Called when a ticket is closed</p>
<p><strong>When Called</strong></p>
<p>When a support ticket is closed</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The admin closing the ticket</li>
<li><code>requester</code> (<em>Player</em>): The player who requested the ticket</li>
<li><code>ticketMessage</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-663-1"><a id="__codelineno-663-1" name="__codelineno-663-1" href="#__codelineno-663-1"></a><span class="c1">-- Simple: Log ticket close</span>
</span><span id="__span-663-2"><a id="__codelineno-663-2" name="__codelineno-663-2" href="#__codelineno-663-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-663-3"><a id="__codelineno-663-3" name="__codelineno-663-3" href="#__codelineno-663-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; closed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-663-4"><a id="__codelineno-663-4" name="__codelineno-663-4" href="#__codelineno-663-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-664-1"><a id="__codelineno-664-1" name="__codelineno-664-1" href="#__codelineno-664-1"></a><span class="c1">-- Medium: Notify players</span>
</span><span id="__span-664-2"><a id="__codelineno-664-2" name="__codelineno-664-2" href="#__codelineno-664-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-664-3"><a id="__codelineno-664-3" name="__codelineno-664-3" href="#__codelineno-664-3"></a><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been closed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-664-4"><a id="__codelineno-664-4" name="__codelineno-664-4" href="#__codelineno-664-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-664-5"><a id="__codelineno-664-5" name="__codelineno-664-5" href="#__codelineno-664-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-664-6"><a id="__codelineno-664-6" name="__codelineno-664-6" href="#__codelineno-664-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; closed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-664-7"><a id="__codelineno-664-7" name="__codelineno-664-7" href="#__codelineno-664-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-664-8"><a id="__codelineno-664-8" name="__codelineno-664-8" href="#__codelineno-664-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-664-9"><a id="__codelineno-664-9" name="__codelineno-664-9" href="#__codelineno-664-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-665-1"><a id="__codelineno-665-1" name="__codelineno-665-1" href="#__codelineno-665-1"></a><span class="c1">-- High: Complex ticket close system</span>
</span><span id="__span-665-2"><a id="__codelineno-665-2" name="__codelineno-665-2" href="#__codelineno-665-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">requester</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-665-3"><a id="__codelineno-665-3" name="__codelineno-665-3" href="#__codelineno-665-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">requester</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-665-4"><a id="__codelineno-665-4" name="__codelineno-665-4" href="#__codelineno-665-4"></a><span class="w">    </span><span class="c1">-- Check if client is admin</span>
</span><span id="__span-665-5"><a id="__codelineno-665-5" name="__codelineno-665-5" href="#__codelineno-665-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-665-6"><a id="__codelineno-665-6" name="__codelineno-665-6" href="#__codelineno-665-6"></a><span class="w">        </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You do not have permission to close tickets&quot;</span><span class="p">)</span>
</span><span id="__span-665-7"><a id="__codelineno-665-7" name="__codelineno-665-7" href="#__codelineno-665-7"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-665-8"><a id="__codelineno-665-8" name="__codelineno-665-8" href="#__codelineno-665-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-665-9"><a id="__codelineno-665-9" name="__codelineno-665-9" href="#__codelineno-665-9"></a><span class="w">    </span><span class="c1">-- Update ticket status</span>
</span><span id="__span-665-10"><a id="__codelineno-665-10" name="__codelineno-665-10" href="#__codelineno-665-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ticketData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-665-11"><a id="__codelineno-665-11" name="__codelineno-665-11" href="#__codelineno-665-11"></a><span class="w">    </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-665-12"><a id="__codelineno-665-12" name="__codelineno-665-12" href="#__codelineno-665-12"></a><span class="w">    </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">closedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span>
</span><span id="__span-665-13"><a id="__codelineno-665-13" name="__codelineno-665-13" href="#__codelineno-665-13"></a><span class="w">    </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">closedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-665-14"><a id="__codelineno-665-14" name="__codelineno-665-14" href="#__codelineno-665-14"></a><span class="w">    </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">closeMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ticketMessage</span>
</span><span id="__span-665-15"><a id="__codelineno-665-15" name="__codelineno-665-15" href="#__codelineno-665-15"></a><span class="w">    </span><span class="nv">requester</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ticketData</span><span class="p">)</span>
</span><span id="__span-665-16"><a id="__codelineno-665-16" name="__codelineno-665-16" href="#__codelineno-665-16"></a><span class="w">    </span><span class="c1">-- Notify requester</span>
</span><span id="__span-665-17"><a id="__codelineno-665-17" name="__codelineno-665-17" href="#__codelineno-665-17"></a><span class="w">    </span><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been closed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-665-18"><a id="__codelineno-665-18" name="__codelineno-665-18" href="#__codelineno-665-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-665-19"><a id="__codelineno-665-19" name="__codelineno-665-19" href="#__codelineno-665-19"></a><span class="w">        </span><span class="nv">requester</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Reason: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">)</span>
</span><span id="__span-665-20"><a id="__codelineno-665-20" name="__codelineno-665-20" href="#__codelineno-665-20"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-665-21"><a id="__codelineno-665-21" name="__codelineno-665-21" href="#__codelineno-665-21"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-665-22"><a id="__codelineno-665-22" name="__codelineno-665-22" href="#__codelineno-665-22"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-665-23"><a id="__codelineno-665-23" name="__codelineno-665-23" href="#__codelineno-665-23"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-665-24"><a id="__codelineno-665-24" name="__codelineno-665-24" href="#__codelineno-665-24"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; closed ticket from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-665-25"><a id="__codelineno-665-25" name="__codelineno-665-25" href="#__codelineno-665-25"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-665-26"><a id="__codelineno-665-26" name="__codelineno-665-26" href="#__codelineno-665-26"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-665-27"><a id="__codelineno-665-27" name="__codelineno-665-27" href="#__codelineno-665-27"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-665-28"><a id="__codelineno-665-28" name="__codelineno-665-28" href="#__codelineno-665-28"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ticket_logs (timestamp, requester_steamid, closer_steamid, message, action) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-665-29"><a id="__codelineno-665-29" name="__codelineno-665-29" href="#__codelineno-665-29"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">requester</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">ticketMessage</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="p">)</span>
</span><span id="__span-665-30"><a id="__codelineno-665-30" name="__codelineno-665-30" href="#__codelineno-665-30"></a><span class="w">    </span><span class="c1">-- Update client data</span>
</span><span id="__span-665-31"><a id="__codelineno-665-31" name="__codelineno-665-31" href="#__codelineno-665-31"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">clientData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-665-32"><a id="__codelineno-665-32" name="__codelineno-665-32" href="#__codelineno-665-32"></a><span class="w">    </span><span class="nv">clientData</span><span class="p">.</span><span class="py">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">clientData</span><span class="p">.</span><span class="py">closed</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-665-33"><a id="__codelineno-665-33" name="__codelineno-665-33" href="#__codelineno-665-33"></a><span class="w">    </span><span class="nv">client</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">clientData</span><span class="p">)</span>
</span><span id="__span-665-34"><a id="__codelineno-665-34" name="__codelineno-665-34" href="#__codelineno-665-34"></a><span class="w">    </span><span class="c1">-- Clear ticket data after delay</span>
</span><span id="__span-665-35"><a id="__codelineno-665-35" name="__codelineno-665-35" href="#__codelineno-665-35"></a><span class="w">    </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
</span><span id="__span-665-36"><a id="__codelineno-665-36" name="__codelineno-665-36" href="#__codelineno-665-36"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">requester</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-665-37"><a id="__codelineno-665-37" name="__codelineno-665-37" href="#__codelineno-665-37"></a><span class="w">        </span><span class="nv">requester</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-665-38"><a id="__codelineno-665-38" name="__codelineno-665-38" href="#__codelineno-665-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-665-39"><a id="__codelineno-665-39" name="__codelineno-665-39" href="#__codelineno-665-39"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span><span id="__span-665-40"><a id="__codelineno-665-40" name="__codelineno-665-40" href="#__codelineno-665-40"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="ticketsystemcreated">TicketSystemCreated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a ticket is created</p>
<p><strong>When Called</strong></p>
<p>When a player creates a support ticket</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>noob</code> (<em>Player</em>): The player creating the ticket</li>
<li><code>message</code> (<em>string</em>): The ticket message</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-666-1"><a id="__codelineno-666-1" name="__codelineno-666-1" href="#__codelineno-666-1"></a><span class="c1">-- Simple: Log ticket creation</span>
</span><span id="__span-666-2"><a id="__codelineno-666-2" name="__codelineno-666-2" href="#__codelineno-666-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-666-3"><a id="__codelineno-666-3" name="__codelineno-666-3" href="#__codelineno-666-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; created a ticket: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-666-4"><a id="__codelineno-666-4" name="__codelineno-666-4" href="#__codelineno-666-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-667-1"><a id="__codelineno-667-1" name="__codelineno-667-1" href="#__codelineno-667-1"></a><span class="c1">-- Medium: Notify admins</span>
</span><span id="__span-667-2"><a id="__codelineno-667-2" name="__codelineno-667-2" href="#__codelineno-667-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyAdmins&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-667-3"><a id="__codelineno-667-3" name="__codelineno-667-3" href="#__codelineno-667-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-667-4"><a id="__codelineno-667-4" name="__codelineno-667-4" href="#__codelineno-667-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-667-5"><a id="__codelineno-667-5" name="__codelineno-667-5" href="#__codelineno-667-5"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[TICKET] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-667-6"><a id="__codelineno-667-6" name="__codelineno-667-6" href="#__codelineno-667-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-667-7"><a id="__codelineno-667-7" name="__codelineno-667-7" href="#__codelineno-667-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-667-8"><a id="__codelineno-667-8" name="__codelineno-667-8" href="#__codelineno-667-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-668-1"><a id="__codelineno-668-1" name="__codelineno-668-1" href="#__codelineno-668-1"></a><span class="c1">-- High: Complex ticket creation system</span>
</span><span id="__span-668-2"><a id="__codelineno-668-2" name="__codelineno-668-2" href="#__codelineno-668-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TicketSystemCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedTicketCreation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">noob</span><span class="p">,</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-668-3"><a id="__codelineno-668-3" name="__codelineno-668-3" href="#__codelineno-668-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">noob</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-668-4"><a id="__codelineno-668-4" name="__codelineno-668-4" href="#__codelineno-668-4"></a><span class="w">    </span><span class="c1">-- Check if player already has an open ticket</span>
</span><span id="__span-668-5"><a id="__codelineno-668-5" name="__codelineno-668-5" href="#__codelineno-668-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ticketData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-668-6"><a id="__codelineno-668-6" name="__codelineno-668-6" href="#__codelineno-668-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">open</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ticketData</span><span class="p">.</span><span class="py">closed</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-668-7"><a id="__codelineno-668-7" name="__codelineno-668-7" href="#__codelineno-668-7"></a><span class="w">        </span><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You already have an open ticket. Please wait for it to be resolved.&quot;</span><span class="p">)</span>
</span><span id="__span-668-8"><a id="__codelineno-668-8" name="__codelineno-668-8" href="#__codelineno-668-8"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-668-9"><a id="__codelineno-668-9" name="__codelineno-668-9" href="#__codelineno-668-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-668-10"><a id="__codelineno-668-10" name="__codelineno-668-10" href="#__codelineno-668-10"></a><span class="w">    </span><span class="c1">-- Validate message</span>
</span><span id="__span-668-11"><a id="__codelineno-668-11" name="__codelineno-668-11" href="#__codelineno-668-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">#</span><span class="nv">message</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-668-12"><a id="__codelineno-668-12" name="__codelineno-668-12" href="#__codelineno-668-12"></a><span class="w">        </span><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Please provide a more detailed description of your issue.&quot;</span><span class="p">)</span>
</span><span id="__span-668-13"><a id="__codelineno-668-13" name="__codelineno-668-13" href="#__codelineno-668-13"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-668-14"><a id="__codelineno-668-14" name="__codelineno-668-14" href="#__codelineno-668-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-668-15"><a id="__codelineno-668-15" name="__codelineno-668-15" href="#__codelineno-668-15"></a><span class="w">    </span><span class="c1">-- Create ticket data</span>
</span><span id="__span-668-16"><a id="__codelineno-668-16" name="__codelineno-668-16" href="#__codelineno-668-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">newTicketData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-668-17"><a id="__codelineno-668-17" name="__codelineno-668-17" href="#__codelineno-668-17"></a><span class="w">    </span><span class="nv">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-668-18"><a id="__codelineno-668-18" name="__codelineno-668-18" href="#__codelineno-668-18"></a><span class="w">    </span><span class="nv">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-668-19"><a id="__codelineno-668-19" name="__codelineno-668-19" href="#__codelineno-668-19"></a><span class="w">    </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span>
</span><span id="__span-668-20"><a id="__codelineno-668-20" name="__codelineno-668-20" href="#__codelineno-668-20"></a><span class="w">    </span><span class="nv">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-668-21"><a id="__codelineno-668-21" name="__codelineno-668-21" href="#__codelineno-668-21"></a><span class="w">    </span><span class="nv">requester</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span>
</span><span id="__span-668-22"><a id="__codelineno-668-22" name="__codelineno-668-22" href="#__codelineno-668-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-668-23"><a id="__codelineno-668-23" name="__codelineno-668-23" href="#__codelineno-668-23"></a><span class="w">    </span><span class="nv">noob</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">newTicketData</span><span class="p">)</span>
</span><span id="__span-668-24"><a id="__codelineno-668-24" name="__codelineno-668-24" href="#__codelineno-668-24"></a><span class="w">    </span><span class="c1">-- Notify admins</span>
</span><span id="__span-668-25"><a id="__codelineno-668-25" name="__codelineno-668-25" href="#__codelineno-668-25"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-668-26"><a id="__codelineno-668-26" name="__codelineno-668-26" href="#__codelineno-668-26"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-668-27"><a id="__codelineno-668-27" name="__codelineno-668-27" href="#__codelineno-668-27"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[TICKET] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; created a new ticket&quot;</span><span class="p">)</span>
</span><span id="__span-668-28"><a id="__codelineno-668-28" name="__codelineno-668-28" href="#__codelineno-668-28"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[TICKET] Message: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">message</span><span class="p">)</span>
</span><span id="__span-668-29"><a id="__codelineno-668-29" name="__codelineno-668-29" href="#__codelineno-668-29"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-668-30"><a id="__codelineno-668-30" name="__codelineno-668-30" href="#__codelineno-668-30"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-668-31"><a id="__codelineno-668-31" name="__codelineno-668-31" href="#__codelineno-668-31"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-668-32"><a id="__codelineno-668-32" name="__codelineno-668-32" href="#__codelineno-668-32"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ticket_logs (timestamp, requester_steamid, message, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-668-33"><a id="__codelineno-668-33" name="__codelineno-668-33" href="#__codelineno-668-33"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">)</span>
</span><span id="__span-668-34"><a id="__codelineno-668-34" name="__codelineno-668-34" href="#__codelineno-668-34"></a><span class="w">    </span><span class="c1">-- Update player data</span>
</span><span id="__span-668-35"><a id="__codelineno-668-35" name="__codelineno-668-35" href="#__codelineno-668-35"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">playerData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">noob</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-668-36"><a id="__codelineno-668-36" name="__codelineno-668-36" href="#__codelineno-668-36"></a><span class="w">    </span><span class="nv">playerData</span><span class="p">.</span><span class="py">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">playerData</span><span class="p">.</span><span class="py">created</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-668-37"><a id="__codelineno-668-37" name="__codelineno-668-37" href="#__codelineno-668-37"></a><span class="w">    </span><span class="nv">noob</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;ticketStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">playerData</span><span class="p">)</span>
</span><span id="__span-668-38"><a id="__codelineno-668-38" name="__codelineno-668-38" href="#__codelineno-668-38"></a><span class="w">    </span><span class="c1">-- Notify player</span>
</span><span id="__span-668-39"><a id="__codelineno-668-39" name="__codelineno-668-39" href="#__codelineno-668-39"></a><span class="w">    </span><span class="nv">noob</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Your ticket has been created. An admin will respond soon.&quot;</span><span class="p">)</span>
</span><span id="__span-668-40"><a id="__codelineno-668-40" name="__codelineno-668-40" href="#__codelineno-668-40"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="togglelock">ToggleLock</h3>
<p><strong>Purpose</strong></p>
<p>Called when a door lock is toggled</p>
<p><strong>When Called</strong></p>
<p>When a door is locked or unlocked</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player toggling the lock</li>
<li><code>door</code> (<em>Entity</em>): The door entity</li>
<li><code>state</code> (<em>boolean</em>): The new lock state</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-669-1"><a id="__codelineno-669-1" name="__codelineno-669-1" href="#__codelineno-669-1"></a><span class="c1">-- Simple: Log door lock toggle</span>
</span><span id="__span-669-2"><a id="__codelineno-669-2" name="__codelineno-669-2" href="#__codelineno-669-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ToggleLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-669-3"><a id="__codelineno-669-3" name="__codelineno-669-3" href="#__codelineno-669-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; door&quot;</span><span class="p">)</span>
</span><span id="__span-669-4"><a id="__codelineno-669-4" name="__codelineno-669-4" href="#__codelineno-669-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-670-1"><a id="__codelineno-670-1" name="__codelineno-670-1" href="#__codelineno-670-1"></a><span class="c1">-- Medium: Notify nearby players</span>
</span><span id="__span-670-2"><a id="__codelineno-670-2" name="__codelineno-670-2" href="#__codelineno-670-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ToggleLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyToggle&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-670-3"><a id="__codelineno-670-3" name="__codelineno-670-3" href="#__codelineno-670-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-670-4"><a id="__codelineno-670-4" name="__codelineno-670-4" href="#__codelineno-670-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-670-5"><a id="__codelineno-670-5" name="__codelineno-670-5" href="#__codelineno-670-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-670-6"><a id="__codelineno-670-6" name="__codelineno-670-6" href="#__codelineno-670-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door has been &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">))</span>
</span><span id="__span-670-7"><a id="__codelineno-670-7" name="__codelineno-670-7" href="#__codelineno-670-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-670-8"><a id="__codelineno-670-8" name="__codelineno-670-8" href="#__codelineno-670-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-670-9"><a id="__codelineno-670-9" name="__codelineno-670-9" href="#__codelineno-670-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-671-1"><a id="__codelineno-671-1" name="__codelineno-671-1" href="#__codelineno-671-1"></a><span class="c1">-- High: Complex door lock system</span>
</span><span id="__span-671-2"><a id="__codelineno-671-2" name="__codelineno-671-2" href="#__codelineno-671-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;ToggleLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDoorLock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">door</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-671-3"><a id="__codelineno-671-3" name="__codelineno-671-3" href="#__codelineno-671-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">client</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">door</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-671-4"><a id="__codelineno-671-4" name="__codelineno-671-4" href="#__codelineno-671-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-671-5"><a id="__codelineno-671-5" name="__codelineno-671-5" href="#__codelineno-671-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-671-6"><a id="__codelineno-671-6" name="__codelineno-671-6" href="#__codelineno-671-6"></a><span class="w">        </span><span class="c1">-- Check permissions</span>
</span><span id="__span-671-7"><a id="__codelineno-671-7" name="__codelineno-671-7" href="#__codelineno-671-7"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-671-8"><a id="__codelineno-671-8" name="__codelineno-671-8" href="#__codelineno-671-8"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
</span><span id="__span-671-9"><a id="__codelineno-671-9" name="__codelineno-671-9" href="#__codelineno-671-9"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">doorOwner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getID</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-671-10"><a id="__codelineno-671-10" name="__codelineno-671-10" href="#__codelineno-671-10"></a><span class="w">                </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You do not have permission to lock this door&quot;</span><span class="p">)</span>
</span><span id="__span-671-11"><a id="__codelineno-671-11" name="__codelineno-671-11" href="#__codelineno-671-11"></a><span class="w">                </span><span class="kr">return</span>
</span><span id="__span-671-12"><a id="__codelineno-671-12" name="__codelineno-671-12" href="#__codelineno-671-12"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-671-13"><a id="__codelineno-671-13" name="__codelineno-671-13" href="#__codelineno-671-13"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-671-14"><a id="__codelineno-671-14" name="__codelineno-671-14" href="#__codelineno-671-14"></a><span class="w">        </span><span class="c1">-- Update door data</span>
</span><span id="__span-671-15"><a id="__codelineno-671-15" name="__codelineno-671-15" href="#__codelineno-671-15"></a><span class="w">        </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;locked&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">)</span>
</span><span id="__span-671-16"><a id="__codelineno-671-16" name="__codelineno-671-16" href="#__codelineno-671-16"></a><span class="w">        </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-671-17"><a id="__codelineno-671-17" name="__codelineno-671-17" href="#__codelineno-671-17"></a><span class="w">        </span><span class="nv">door</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;lastLockedBy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">())</span>
</span><span id="__span-671-18"><a id="__codelineno-671-18" name="__codelineno-671-18" href="#__codelineno-671-18"></a><span class="w">        </span><span class="c1">-- Log to database</span>
</span><span id="__span-671-19"><a id="__codelineno-671-19" name="__codelineno-671-19" href="#__codelineno-671-19"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO door_logs (timestamp, steamid, doorid, action) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-671-20"><a id="__codelineno-671-20" name="__codelineno-671-20" href="#__codelineno-671-20"></a><span class="w">        </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">)</span>
</span><span id="__span-671-21"><a id="__codelineno-671-21" name="__codelineno-671-21" href="#__codelineno-671-21"></a><span class="w">        </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-671-22"><a id="__codelineno-671-22" name="__codelineno-671-22" href="#__codelineno-671-22"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">door</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-671-23"><a id="__codelineno-671-23" name="__codelineno-671-23" href="#__codelineno-671-23"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-671-24"><a id="__codelineno-671-24" name="__codelineno-671-24" href="#__codelineno-671-24"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-671-25"><a id="__codelineno-671-25" name="__codelineno-671-25" href="#__codelineno-671-25"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;A door has been &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;unlocked&quot;</span><span class="p">))</span>
</span><span id="__span-671-26"><a id="__codelineno-671-26" name="__codelineno-671-26" href="#__codelineno-671-26"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-671-27"><a id="__codelineno-671-27" name="__codelineno-671-27" href="#__codelineno-671-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-671-28"><a id="__codelineno-671-28" name="__codelineno-671-28" href="#__codelineno-671-28"></a><span class="w">        </span><span class="c1">-- Update character stats</span>
</span><span id="__span-671-29"><a id="__codelineno-671-29" name="__codelineno-671-29" href="#__codelineno-671-29"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-671-30"><a id="__codelineno-671-30" name="__codelineno-671-30" href="#__codelineno-671-30"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">locks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-671-31"><a id="__codelineno-671-31" name="__codelineno-671-31" href="#__codelineno-671-31"></a><span class="w">        </span><span class="c1">-- Check for door upgrades</span>
</span><span id="__span-671-32"><a id="__codelineno-671-32" name="__codelineno-671-32" href="#__codelineno-671-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">lockCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorsLocked&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-671-33"><a id="__codelineno-671-33" name="__codelineno-671-33" href="#__codelineno-671-33"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">lockCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;doorMaster&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-671-34"><a id="__codelineno-671-34" name="__codelineno-671-34" href="#__codelineno-671-34"></a><span class="w">            </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;doorMaster&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-671-35"><a id="__codelineno-671-35" name="__codelineno-671-35" href="#__codelineno-671-35"></a><span class="w">            </span><span class="nv">client</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have mastered door locking!&quot;</span><span class="p">)</span>
</span><span id="__span-671-36"><a id="__codelineno-671-36" name="__codelineno-671-36" href="#__codelineno-671-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-671-37"><a id="__codelineno-671-37" name="__codelineno-671-37" href="#__codelineno-671-37"></a><span class="w">        </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="transferitem">TransferItem</h3>
<p><strong>Purpose</strong></p>
<p>Called to transfer an item</p>
<p><strong>When Called</strong></p>
<p>When an item is being transferred</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>itemID</code> (<em>string</em>): The ID of the item being transferred</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-672-1"><a id="__codelineno-672-1" name="__codelineno-672-1" href="#__codelineno-672-1"></a><span class="c1">-- Simple: Log item transfer</span>
</span><span id="__span-672-2"><a id="__codelineno-672-2" name="__codelineno-672-2" href="#__codelineno-672-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-672-3"><a id="__codelineno-672-3" name="__codelineno-672-3" href="#__codelineno-672-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item transferred: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-672-4"><a id="__codelineno-672-4" name="__codelineno-672-4" href="#__codelineno-672-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-673-1"><a id="__codelineno-673-1" name="__codelineno-673-1" href="#__codelineno-673-1"></a><span class="c1">-- Medium: Track item transfers</span>
</span><span id="__span-673-2"><a id="__codelineno-673-2" name="__codelineno-673-2" href="#__codelineno-673-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTransfers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-673-3"><a id="__codelineno-673-3" name="__codelineno-673-3" href="#__codelineno-673-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">instances</span><span class="p">[</span><span class="nv">itemID</span><span class="p">]</span>
</span><span id="__span-673-4"><a id="__codelineno-673-4" name="__codelineno-673-4" href="#__codelineno-673-4"></a><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-673-5"><a id="__codelineno-673-5" name="__codelineno-673-5" href="#__codelineno-673-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-673-6"><a id="__codelineno-673-6" name="__codelineno-673-6" href="#__codelineno-673-6"></a><span class="w">    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-673-7"><a id="__codelineno-673-7" name="__codelineno-673-7" href="#__codelineno-673-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-673-8"><a id="__codelineno-673-8" name="__codelineno-673-8" href="#__codelineno-673-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-674-1"><a id="__codelineno-674-1" name="__codelineno-674-1" href="#__codelineno-674-1"></a><span class="c1">-- High: Complex item transfer system</span>
</span><span id="__span-674-2"><a id="__codelineno-674-2" name="__codelineno-674-2" href="#__codelineno-674-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;TransferItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedItemTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
</span><span id="__span-674-3"><a id="__codelineno-674-3" name="__codelineno-674-3" href="#__codelineno-674-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-674-4"><a id="__codelineno-674-4" name="__codelineno-674-4" href="#__codelineno-674-4"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">instances</span><span class="p">[</span><span class="nv">itemID</span><span class="p">]</span>
</span><span id="__span-674-5"><a id="__codelineno-674-5" name="__codelineno-674-5" href="#__codelineno-674-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-674-6"><a id="__codelineno-674-6" name="__codelineno-674-6" href="#__codelineno-674-6"></a><span class="w">        </span><span class="c1">-- Get item data</span>
</span><span id="__span-674-7"><a id="__codelineno-674-7" name="__codelineno-674-7" href="#__codelineno-674-7"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">()</span>
</span><span id="__span-674-8"><a id="__codelineno-674-8" name="__codelineno-674-8" href="#__codelineno-674-8"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">fromInventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getInventory</span><span class="p">()</span>
</span><span id="__span-674-9"><a id="__codelineno-674-9" name="__codelineno-674-9" href="#__codelineno-674-9"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">toInventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;targetInventory&quot;</span><span class="p">)</span>
</span><span id="__span-674-10"><a id="__codelineno-674-10" name="__codelineno-674-10" href="#__codelineno-674-10"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">fromInventory</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">toInventory</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-674-11"><a id="__codelineno-674-11" name="__codelineno-674-11" href="#__codelineno-674-11"></a><span class="w">            </span><span class="c1">-- Check transfer permissions</span>
</span><span id="__span-674-12"><a id="__codelineno-674-12" name="__codelineno-674-12" href="#__codelineno-674-12"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">fromOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fromInventory</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-674-13"><a id="__codelineno-674-13" name="__codelineno-674-13" href="#__codelineno-674-13"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">toOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">:</span><span class="nf">getOwner</span><span class="p">()</span>
</span><span id="__span-674-14"><a id="__codelineno-674-14" name="__codelineno-674-14" href="#__codelineno-674-14"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">fromOwner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toOwner</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">fromOwner</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">toOwner</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-15"><a id="__codelineno-674-15" name="__codelineno-674-15" href="#__codelineno-674-15"></a><span class="w">                </span><span class="c1">-- Check if transfer is allowed between different owners</span>
</span><span id="__span-674-16"><a id="__codelineno-674-16" name="__codelineno-674-16" href="#__codelineno-674-16"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">transferAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transferable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-674-17"><a id="__codelineno-674-17" name="__codelineno-674-17" href="#__codelineno-674-17"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">transferAllowed</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-18"><a id="__codelineno-674-18" name="__codelineno-674-18" href="#__codelineno-674-18"></a><span class="w">                    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is not transferable&quot;</span><span class="p">)</span>
</span><span id="__span-674-19"><a id="__codelineno-674-19" name="__codelineno-674-19" href="#__codelineno-674-19"></a><span class="w">                    </span><span class="kr">return</span>
</span><span id="__span-674-20"><a id="__codelineno-674-20" name="__codelineno-674-20" href="#__codelineno-674-20"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-674-21"><a id="__codelineno-674-21" name="__codelineno-674-21" href="#__codelineno-674-21"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-674-22"><a id="__codelineno-674-22" name="__codelineno-674-22" href="#__codelineno-674-22"></a><span class="w">            </span><span class="c1">-- Update item data</span>
</span><span id="__span-674-23"><a id="__codelineno-674-23" name="__codelineno-674-23" href="#__codelineno-674-23"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-674-24"><a id="__codelineno-674-24" name="__codelineno-674-24" href="#__codelineno-674-24"></a><span class="w">            </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;transferCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">transferCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-674-25"><a id="__codelineno-674-25" name="__codelineno-674-25" href="#__codelineno-674-25"></a><span class="w">            </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastTransfer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-674-26"><a id="__codelineno-674-26" name="__codelineno-674-26" href="#__codelineno-674-26"></a><span class="w">            </span><span class="c1">-- Log to database</span>
</span><span id="__span-674-27"><a id="__codelineno-674-27" name="__codelineno-674-27" href="#__codelineno-674-27"></a><span class="w">            </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO item_transfer_logs (timestamp, itemid, from_inventory, to_inventory) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-674-28"><a id="__codelineno-674-28" name="__codelineno-674-28" href="#__codelineno-674-28"></a><span class="w">            </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemID</span><span class="p">,</span><span class="w"> </span><span class="nv">fromInventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">(),</span><span class="w"> </span><span class="nv">toInventory</span><span class="p">:</span><span class="nf">getID</span><span class="p">())</span>
</span><span id="__span-674-29"><a id="__codelineno-674-29" name="__codelineno-674-29" href="#__codelineno-674-29"></a><span class="w">            </span><span class="c1">-- Notify players</span>
</span><span id="__span-674-30"><a id="__codelineno-674-30" name="__codelineno-674-30" href="#__codelineno-674-30"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">fromOwner</span><span class="p">]</span>
</span><span id="__span-674-31"><a id="__codelineno-674-31" name="__codelineno-674-31" href="#__codelineno-674-31"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">char</span><span class="p">.</span><span class="py">loaded</span><span class="p">[</span><span class="nv">toOwner</span><span class="p">]</span>
</span><span id="__span-674-32"><a id="__codelineno-674-32" name="__codelineno-674-32" href="#__codelineno-674-32"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">fromChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-33"><a id="__codelineno-674-33" name="__codelineno-674-33" href="#__codelineno-674-33"></a><span class="w">                </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item transferred: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-674-34"><a id="__codelineno-674-34" name="__codelineno-674-34" href="#__codelineno-674-34"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-674-35"><a id="__codelineno-674-35" name="__codelineno-674-35" href="#__codelineno-674-35"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">toChar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">fromChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-36"><a id="__codelineno-674-36" name="__codelineno-674-36" href="#__codelineno-674-36"></a><span class="w">                </span><span class="nv">toChar</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Item received: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getName</span><span class="p">())</span>
</span><span id="__span-674-37"><a id="__codelineno-674-37" name="__codelineno-674-37" href="#__codelineno-674-37"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-674-38"><a id="__codelineno-674-38" name="__codelineno-674-38" href="#__codelineno-674-38"></a><span class="w">            </span><span class="c1">-- Check for item degradation</span>
</span><span id="__span-674-39"><a id="__codelineno-674-39" name="__codelineno-674-39" href="#__codelineno-674-39"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-674-40"><a id="__codelineno-674-40" name="__codelineno-674-40" href="#__codelineno-674-40"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-41"><a id="__codelineno-674-41" name="__codelineno-674-41" href="#__codelineno-674-41"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">newDurability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">durability</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-674-42"><a id="__codelineno-674-42" name="__codelineno-674-42" href="#__codelineno-674-42"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;durability&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">newDurability</span><span class="p">)</span>
</span><span id="__span-674-43"><a id="__codelineno-674-43" name="__codelineno-674-43" href="#__codelineno-674-43"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">newDurability</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-674-44"><a id="__codelineno-674-44" name="__codelineno-674-44" href="#__codelineno-674-44"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;broken&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-674-45"><a id="__codelineno-674-45" name="__codelineno-674-45" href="#__codelineno-674-45"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-674-46"><a id="__codelineno-674-46" name="__codelineno-674-46" href="#__codelineno-674-46"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-674-47"><a id="__codelineno-674-47" name="__codelineno-674-47" href="#__codelineno-674-47"></a><span class="w">            </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="updateentitypersistence">UpdateEntityPersistence</h3>
<p><strong>Purpose</strong></p>
<p>Called to update entity persistence</p>
<p><strong>When Called</strong></p>
<p>When an entity's persistence data needs to be updated</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>ent</code> (<em>Entity</em>): The entity to update</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-675-1"><a id="__codelineno-675-1" name="__codelineno-675-1" href="#__codelineno-675-1"></a><span class="c1">-- Simple: Log entity persistence update</span>
</span><span id="__span-675-2"><a id="__codelineno-675-2" name="__codelineno-675-2" href="#__codelineno-675-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;UpdateEntityPersistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-675-3"><a id="__codelineno-675-3" name="__codelineno-675-3" href="#__codelineno-675-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating persistence for &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">ent</span><span class="p">))</span>
</span><span id="__span-675-4"><a id="__codelineno-675-4" name="__codelineno-675-4" href="#__codelineno-675-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-676-1"><a id="__codelineno-676-1" name="__codelineno-676-1" href="#__codelineno-676-1"></a><span class="c1">-- Medium: Update entity data</span>
</span><span id="__span-676-2"><a id="__codelineno-676-2" name="__codelineno-676-2" href="#__codelineno-676-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;UpdateEntityPersistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UpdateData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-676-3"><a id="__codelineno-676-3" name="__codelineno-676-3" href="#__codelineno-676-3"></a><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-676-4"><a id="__codelineno-676-4" name="__codelineno-676-4" href="#__codelineno-676-4"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastUpdate&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-676-5"><a id="__codelineno-676-5" name="__codelineno-676-5" href="#__codelineno-676-5"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;persistent&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-676-6"><a id="__codelineno-676-6" name="__codelineno-676-6" href="#__codelineno-676-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-676-7"><a id="__codelineno-676-7" name="__codelineno-676-7" href="#__codelineno-676-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-677-1"><a id="__codelineno-677-1" name="__codelineno-677-1" href="#__codelineno-677-1"></a><span class="c1">-- High: Complex entity persistence system</span>
</span><span id="__span-677-2"><a id="__codelineno-677-2" name="__codelineno-677-2" href="#__codelineno-677-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;UpdateEntityPersistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedPersistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-677-3"><a id="__codelineno-677-3" name="__codelineno-677-3" href="#__codelineno-677-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-677-4"><a id="__codelineno-677-4" name="__codelineno-677-4" href="#__codelineno-677-4"></a><span class="w">    </span><span class="c1">-- Check if entity should be persistent</span>
</span><span id="__span-677-5"><a id="__codelineno-677-5" name="__codelineno-677-5" href="#__codelineno-677-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">shouldPersist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;CanPersistEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">ent</span><span class="p">)</span>
</span><span id="__span-677-6"><a id="__codelineno-677-6" name="__codelineno-677-6" href="#__codelineno-677-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">shouldPersist</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-677-7"><a id="__codelineno-677-7" name="__codelineno-677-7" href="#__codelineno-677-7"></a><span class="w">        </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;persistent&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-677-8"><a id="__codelineno-677-8" name="__codelineno-677-8" href="#__codelineno-677-8"></a><span class="w">        </span><span class="kr">return</span>
</span><span id="__span-677-9"><a id="__codelineno-677-9" name="__codelineno-677-9" href="#__codelineno-677-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-677-10"><a id="__codelineno-677-10" name="__codelineno-677-10" href="#__codelineno-677-10"></a><span class="w">    </span><span class="c1">-- Update entity data</span>
</span><span id="__span-677-11"><a id="__codelineno-677-11" name="__codelineno-677-11" href="#__codelineno-677-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">entityData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-677-12"><a id="__codelineno-677-12" name="__codelineno-677-12" href="#__codelineno-677-12"></a><span class="w">    </span><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-677-13"><a id="__codelineno-677-13" name="__codelineno-677-13" href="#__codelineno-677-13"></a><span class="w">    </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">(),</span>
</span><span id="__span-677-14"><a id="__codelineno-677-14" name="__codelineno-677-14" href="#__codelineno-677-14"></a><span class="w">    </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">(),</span>
</span><span id="__span-677-15"><a id="__codelineno-677-15" name="__codelineno-677-15" href="#__codelineno-677-15"></a><span class="w">    </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">(),</span>
</span><span id="__span-677-16"><a id="__codelineno-677-16" name="__codelineno-677-16" href="#__codelineno-677-16"></a><span class="w">    </span><span class="nv">lastUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">(),</span>
</span><span id="__span-677-17"><a id="__codelineno-677-17" name="__codelineno-677-17" href="#__codelineno-677-17"></a><span class="w">    </span><span class="nv">persistent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-677-18"><a id="__codelineno-677-18" name="__codelineno-677-18" href="#__codelineno-677-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-677-19"><a id="__codelineno-677-19" name="__codelineno-677-19" href="#__codelineno-677-19"></a><span class="w">    </span><span class="c1">-- Save custom data</span>
</span><span id="__span-677-20"><a id="__codelineno-677-20" name="__codelineno-677-20" href="#__codelineno-677-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;customData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-677-21"><a id="__codelineno-677-21" name="__codelineno-677-21" href="#__codelineno-677-21"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">customData</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nb">next</span><span class="p">(</span><span class="nv">customData</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-677-22"><a id="__codelineno-677-22" name="__codelineno-677-22" href="#__codelineno-677-22"></a><span class="w">        </span><span class="nv">entityData</span><span class="p">.</span><span class="py">customData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">customData</span>
</span><span id="__span-677-23"><a id="__codelineno-677-23" name="__codelineno-677-23" href="#__codelineno-677-23"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-677-24"><a id="__codelineno-677-24" name="__codelineno-677-24" href="#__codelineno-677-24"></a><span class="w">    </span><span class="c1">-- Save to database</span>
</span><span id="__span-677-25"><a id="__codelineno-677-25" name="__codelineno-677-25" href="#__codelineno-677-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">entityID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">()</span>
</span><span id="__span-677-26"><a id="__codelineno-677-26" name="__codelineno-677-26" href="#__codelineno-677-26"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT OR REPLACE INTO persistent_entities (entityid, data, lastupdate) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-677-27"><a id="__codelineno-677-27" name="__codelineno-677-27" href="#__codelineno-677-27"></a><span class="w">    </span><span class="nv">entityID</span><span class="p">,</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">entityData</span><span class="p">),</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-677-28"><a id="__codelineno-677-28" name="__codelineno-677-28" href="#__codelineno-677-28"></a><span class="w">    </span><span class="c1">-- Update entity</span>
</span><span id="__span-677-29"><a id="__codelineno-677-29" name="__codelineno-677-29" href="#__codelineno-677-29"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;persistent&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-677-30"><a id="__codelineno-677-30" name="__codelineno-677-30" href="#__codelineno-677-30"></a><span class="w">    </span><span class="nv">ent</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastUpdate&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-677-31"><a id="__codelineno-677-31" name="__codelineno-677-31" href="#__codelineno-677-31"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-677-32"><a id="__codelineno-677-32" name="__codelineno-677-32" href="#__codelineno-677-32"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-677-33"><a id="__codelineno-677-33" name="__codelineno-677-33" href="#__codelineno-677-33"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-677-34"><a id="__codelineno-677-34" name="__codelineno-677-34" href="#__codelineno-677-34"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-677-35"><a id="__codelineno-677-35" name="__codelineno-677-35" href="#__codelineno-677-35"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Entity persistence updated&quot;</span><span class="p">)</span>
</span><span id="__span-677-36"><a id="__codelineno-677-36" name="__codelineno-677-36" href="#__codelineno-677-36"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-677-37"><a id="__codelineno-677-37" name="__codelineno-677-37" href="#__codelineno-677-37"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-677-38"><a id="__codelineno-677-38" name="__codelineno-677-38" href="#__codelineno-677-38"></a><span class="w">    </span><span class="c1">-- Log to file</span>
</span><span id="__span-677-39"><a id="__codelineno-677-39" name="__codelineno-677-39" href="#__codelineno-677-39"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">log</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">&quot;entity_persistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-677-40"><a id="__codelineno-677-40" name="__codelineno-677-40" href="#__codelineno-677-40"></a><span class="w">    </span><span class="nv">entityID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">entityID</span><span class="p">,</span>
</span><span id="__span-677-41"><a id="__codelineno-677-41" name="__codelineno-677-41" href="#__codelineno-677-41"></a><span class="w">    </span><span class="nv">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">(),</span>
</span><span id="__span-677-42"><a id="__codelineno-677-42" name="__codelineno-677-42" href="#__codelineno-677-42"></a><span class="w">    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-677-43"><a id="__codelineno-677-43" name="__codelineno-677-43" href="#__codelineno-677-43"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-677-44"><a id="__codelineno-677-44" name="__codelineno-677-44" href="#__codelineno-677-44"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendorclassupdated">VendorClassUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor class is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor's allowed classes are modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>id</code> (<em>string</em>): The class ID being updated</li>
<li><code>allowed</code> (<em>boolean</em>): Whether the class is allowed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-678-1"><a id="__codelineno-678-1" name="__codelineno-678-1" href="#__codelineno-678-1"></a><span class="c1">-- Simple: Log vendor class update</span>
</span><span id="__span-678-2"><a id="__codelineno-678-2" name="__codelineno-678-2" href="#__codelineno-678-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorClassUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-678-3"><a id="__codelineno-678-3" name="__codelineno-678-3" href="#__codelineno-678-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor class &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;allowed&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;denied&quot;</span><span class="p">))</span>
</span><span id="__span-678-4"><a id="__codelineno-678-4" name="__codelineno-678-4" href="#__codelineno-678-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-679-1"><a id="__codelineno-679-1" name="__codelineno-679-1" href="#__codelineno-679-1"></a><span class="c1">-- Medium: Notify players</span>
</span><span id="__span-679-2"><a id="__codelineno-679-2" name="__codelineno-679-2" href="#__codelineno-679-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorClassUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyPlayers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-679-3"><a id="__codelineno-679-3" name="__codelineno-679-3" href="#__codelineno-679-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-679-4"><a id="__codelineno-679-4" name="__codelineno-679-4" href="#__codelineno-679-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-679-5"><a id="__codelineno-679-5" name="__codelineno-679-5" href="#__codelineno-679-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-679-6"><a id="__codelineno-679-6" name="__codelineno-679-6" href="#__codelineno-679-6"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor class &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;allowed&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;denied&quot;</span><span class="p">))</span>
</span><span id="__span-679-7"><a id="__codelineno-679-7" name="__codelineno-679-7" href="#__codelineno-679-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-679-8"><a id="__codelineno-679-8" name="__codelineno-679-8" href="#__codelineno-679-8"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-679-9"><a id="__codelineno-679-9" name="__codelineno-679-9" href="#__codelineno-679-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-680-1"><a id="__codelineno-680-1" name="__codelineno-680-1" href="#__codelineno-680-1"></a><span class="c1">-- High: Complex vendor class system</span>
</span><span id="__span-680-2"><a id="__codelineno-680-2" name="__codelineno-680-2" href="#__codelineno-680-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorClassUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-680-3"><a id="__codelineno-680-3" name="__codelineno-680-3" href="#__codelineno-680-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-680-4"><a id="__codelineno-680-4" name="__codelineno-680-4" href="#__codelineno-680-4"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-680-5"><a id="__codelineno-680-5" name="__codelineno-680-5" href="#__codelineno-680-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-680-6"><a id="__codelineno-680-6" name="__codelineno-680-6" href="#__codelineno-680-6"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedClasses</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-680-7"><a id="__codelineno-680-7" name="__codelineno-680-7" href="#__codelineno-680-7"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedClasses</span><span class="p">[</span><span class="nv">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">allowed</span>
</span><span id="__span-680-8"><a id="__codelineno-680-8" name="__codelineno-680-8" href="#__codelineno-680-8"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-680-9"><a id="__codelineno-680-9" name="__codelineno-680-9" href="#__codelineno-680-9"></a><span class="w">    </span><span class="c1">-- Update vendor inventory</span>
</span><span id="__span-680-10"><a id="__codelineno-680-10" name="__codelineno-680-10" href="#__codelineno-680-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-680-11"><a id="__codelineno-680-11" name="__codelineno-680-11" href="#__codelineno-680-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-680-12"><a id="__codelineno-680-12" name="__codelineno-680-12" href="#__codelineno-680-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-680-13"><a id="__codelineno-680-13" name="__codelineno-680-13" href="#__codelineno-680-13"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-680-14"><a id="__codelineno-680-14" name="__codelineno-680-14" href="#__codelineno-680-14"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-680-15"><a id="__codelineno-680-15" name="__codelineno-680-15" href="#__codelineno-680-15"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-680-16"><a id="__codelineno-680-16" name="__codelineno-680-16" href="#__codelineno-680-16"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-680-17"><a id="__codelineno-680-17" name="__codelineno-680-17" href="#__codelineno-680-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-680-18"><a id="__codelineno-680-18" name="__codelineno-680-18" href="#__codelineno-680-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-680-19"><a id="__codelineno-680-19" name="__codelineno-680-19" href="#__codelineno-680-19"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-680-20"><a id="__codelineno-680-20" name="__codelineno-680-20" href="#__codelineno-680-20"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_class_logs (timestamp, vendorid, classid, allowed) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-680-21"><a id="__codelineno-680-21" name="__codelineno-680-21" href="#__codelineno-680-21"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-680-22"><a id="__codelineno-680-22" name="__codelineno-680-22" href="#__codelineno-680-22"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-680-23"><a id="__codelineno-680-23" name="__codelineno-680-23" href="#__codelineno-680-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-680-24"><a id="__codelineno-680-24" name="__codelineno-680-24" href="#__codelineno-680-24"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-680-25"><a id="__codelineno-680-25" name="__codelineno-680-25" href="#__codelineno-680-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-680-26"><a id="__codelineno-680-26" name="__codelineno-680-26" href="#__codelineno-680-26"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-680-27"><a id="__codelineno-680-27" name="__codelineno-680-27" href="#__codelineno-680-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-680-28"><a id="__codelineno-680-28" name="__codelineno-680-28" href="#__codelineno-680-28"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor access &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;granted&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;revoked&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; for your class&quot;</span><span class="p">)</span>
</span><span id="__span-680-29"><a id="__codelineno-680-29" name="__codelineno-680-29" href="#__codelineno-680-29"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-680-30"><a id="__codelineno-680-30" name="__codelineno-680-30" href="#__codelineno-680-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-680-31"><a id="__codelineno-680-31" name="__codelineno-680-31" href="#__codelineno-680-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-680-32"><a id="__codelineno-680-32" name="__codelineno-680-32" href="#__codelineno-680-32"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-680-33"><a id="__codelineno-680-33" name="__codelineno-680-33" href="#__codelineno-680-33"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-680-34"><a id="__codelineno-680-34" name="__codelineno-680-34" href="#__codelineno-680-34"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-680-35"><a id="__codelineno-680-35" name="__codelineno-680-35" href="#__codelineno-680-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-680-36"><a id="__codelineno-680-36" name="__codelineno-680-36" href="#__codelineno-680-36"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoredited">VendorEdited</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor is edited</p>
<p><strong>When Called</strong></p>
<p>When a vendor's properties are modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>liaVendorEnt</code> (<em>Entity</em>): The vendor entity being edited</li>
<li><code>key</code> (<em>string</em>): The property key being edited</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-681-1"><a id="__codelineno-681-1" name="__codelineno-681-1" href="#__codelineno-681-1"></a><span class="c1">-- Simple: Log vendor edit</span>
</span><span id="__span-681-2"><a id="__codelineno-681-2" name="__codelineno-681-2" href="#__codelineno-681-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">liaVendorEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-681-3"><a id="__codelineno-681-3" name="__codelineno-681-3" href="#__codelineno-681-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor edited: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-681-4"><a id="__codelineno-681-4" name="__codelineno-681-4" href="#__codelineno-681-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-682-1"><a id="__codelineno-682-1" name="__codelineno-682-1" href="#__codelineno-682-1"></a><span class="c1">-- Medium: Validate vendor edits</span>
</span><span id="__span-682-2"><a id="__codelineno-682-2" name="__codelineno-682-2" href="#__codelineno-682-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateEdits&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">liaVendorEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-682-3"><a id="__codelineno-682-3" name="__codelineno-682-3" href="#__codelineno-682-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-682-4"><a id="__codelineno-682-4" name="__codelineno-682-4" href="#__codelineno-682-4"></a><span class="w">    </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unnamed Vendor&quot;</span><span class="p">)</span>
</span><span id="__span-682-5"><a id="__codelineno-682-5" name="__codelineno-682-5" href="#__codelineno-682-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-682-6"><a id="__codelineno-682-6" name="__codelineno-682-6" href="#__codelineno-682-6"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-683-1"><a id="__codelineno-683-1" name="__codelineno-683-1" href="#__codelineno-683-1"></a><span class="c1">-- High: Complex vendor editing system</span>
</span><span id="__span-683-2"><a id="__codelineno-683-2" name="__codelineno-683-2" href="#__codelineno-683-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorEdited&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorEdit&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">liaVendorEnt</span><span class="p">,</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span>
</span><span id="__span-683-3"><a id="__codelineno-683-3" name="__codelineno-683-3" href="#__codelineno-683-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">liaVendorEnt</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-683-4"><a id="__codelineno-683-4" name="__codelineno-683-4" href="#__codelineno-683-4"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-683-5"><a id="__codelineno-683-5" name="__codelineno-683-5" href="#__codelineno-683-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-683-6"><a id="__codelineno-683-6" name="__codelineno-683-6" href="#__codelineno-683-6"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">lastEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-683-7"><a id="__codelineno-683-7" name="__codelineno-683-7" href="#__codelineno-683-7"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">editedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span>
</span><span id="__span-683-8"><a id="__codelineno-683-8" name="__codelineno-683-8" href="#__codelineno-683-8"></a><span class="w">    </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-683-9"><a id="__codelineno-683-9" name="__codelineno-683-9" href="#__codelineno-683-9"></a><span class="w">    </span><span class="c1">-- Validate specific properties</span>
</span><span id="__span-683-10"><a id="__codelineno-683-10" name="__codelineno-683-10" href="#__codelineno-683-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-11"><a id="__codelineno-683-11" name="__codelineno-683-11" href="#__codelineno-683-11"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-683-12"><a id="__codelineno-683-12" name="__codelineno-683-12" href="#__codelineno-683-12"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-13"><a id="__codelineno-683-13" name="__codelineno-683-13" href="#__codelineno-683-13"></a><span class="w">            </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unnamed Vendor&quot;</span><span class="p">)</span>
</span><span id="__span-683-14"><a id="__codelineno-683-14" name="__codelineno-683-14" href="#__codelineno-683-14"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="o">#</span><span class="nv">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-15"><a id="__codelineno-683-15" name="__codelineno-683-15" href="#__codelineno-683-15"></a><span class="w">            </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string.sub</span><span class="p">(</span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">))</span>
</span><span id="__span-683-16"><a id="__codelineno-683-16" name="__codelineno-683-16" href="#__codelineno-683-16"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-683-17"><a id="__codelineno-683-17" name="__codelineno-683-17" href="#__codelineno-683-17"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;money&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-18"><a id="__codelineno-683-18" name="__codelineno-683-18" href="#__codelineno-683-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-683-19"><a id="__codelineno-683-19" name="__codelineno-683-19" href="#__codelineno-683-19"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-20"><a id="__codelineno-683-20" name="__codelineno-683-20" href="#__codelineno-683-20"></a><span class="w">            </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-683-21"><a id="__codelineno-683-21" name="__codelineno-683-21" href="#__codelineno-683-21"></a><span class="w">        </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">money</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-22"><a id="__codelineno-683-22" name="__codelineno-683-22" href="#__codelineno-683-22"></a><span class="w">            </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">)</span>
</span><span id="__span-683-23"><a id="__codelineno-683-23" name="__codelineno-683-23" href="#__codelineno-683-23"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-683-24"><a id="__codelineno-683-24" name="__codelineno-683-24" href="#__codelineno-683-24"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-683-25"><a id="__codelineno-683-25" name="__codelineno-683-25" href="#__codelineno-683-25"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-683-26"><a id="__codelineno-683-26" name="__codelineno-683-26" href="#__codelineno-683-26"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_edit_logs (timestamp, vendorid, property, value) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-683-27"><a id="__codelineno-683-27" name="__codelineno-683-27" href="#__codelineno-683-27"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
</span><span id="__span-683-28"><a id="__codelineno-683-28" name="__codelineno-683-28" href="#__codelineno-683-28"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-683-29"><a id="__codelineno-683-29" name="__codelineno-683-29" href="#__codelineno-683-29"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-683-30"><a id="__codelineno-683-30" name="__codelineno-683-30" href="#__codelineno-683-30"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-683-31"><a id="__codelineno-683-31" name="__codelineno-683-31" href="#__codelineno-683-31"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-32"><a id="__codelineno-683-32" name="__codelineno-683-32" href="#__codelineno-683-32"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has been updated&quot;</span><span class="p">)</span>
</span><span id="__span-683-33"><a id="__codelineno-683-33" name="__codelineno-683-33" href="#__codelineno-683-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-683-34"><a id="__codelineno-683-34" name="__codelineno-683-34" href="#__codelineno-683-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-683-35"><a id="__codelineno-683-35" name="__codelineno-683-35" href="#__codelineno-683-35"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-683-36"><a id="__codelineno-683-36" name="__codelineno-683-36" href="#__codelineno-683-36"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">liaVendorEnt</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-683-37"><a id="__codelineno-683-37" name="__codelineno-683-37" href="#__codelineno-683-37"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-683-38"><a id="__codelineno-683-38" name="__codelineno-683-38" href="#__codelineno-683-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-683-39"><a id="__codelineno-683-39" name="__codelineno-683-39" href="#__codelineno-683-39"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendorfactionupdated">VendorFactionUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor faction is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor's allowed factions are modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>id</code> (<em>string</em>): The faction ID being updated</li>
<li><code>allowed</code> (<em>boolean</em>): Whether the faction is allowed</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-684-1"><a id="__codelineno-684-1" name="__codelineno-684-1" href="#__codelineno-684-1"></a><span class="c1">-- Simple: Log vendor faction update</span>
</span><span id="__span-684-2"><a id="__codelineno-684-2" name="__codelineno-684-2" href="#__codelineno-684-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorFactionUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-684-3"><a id="__codelineno-684-3" name="__codelineno-684-3" href="#__codelineno-684-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor faction &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;allowed&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;denied&quot;</span><span class="p">))</span>
</span><span id="__span-684-4"><a id="__codelineno-684-4" name="__codelineno-684-4" href="#__codelineno-684-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-685-1"><a id="__codelineno-685-1" name="__codelineno-685-1" href="#__codelineno-685-1"></a><span class="c1">-- Medium: Notify players</span>
</span><span id="__span-685-2"><a id="__codelineno-685-2" name="__codelineno-685-2" href="#__codelineno-685-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorFactionUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyPlayers&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-685-3"><a id="__codelineno-685-3" name="__codelineno-685-3" href="#__codelineno-685-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-685-4"><a id="__codelineno-685-4" name="__codelineno-685-4" href="#__codelineno-685-4"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-685-5"><a id="__codelineno-685-5" name="__codelineno-685-5" href="#__codelineno-685-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-685-6"><a id="__codelineno-685-6" name="__codelineno-685-6" href="#__codelineno-685-6"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-685-7"><a id="__codelineno-685-7" name="__codelineno-685-7" href="#__codelineno-685-7"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-685-8"><a id="__codelineno-685-8" name="__codelineno-685-8" href="#__codelineno-685-8"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor access &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;granted&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;revoked&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; for your faction&quot;</span><span class="p">)</span>
</span><span id="__span-685-9"><a id="__codelineno-685-9" name="__codelineno-685-9" href="#__codelineno-685-9"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-685-10"><a id="__codelineno-685-10" name="__codelineno-685-10" href="#__codelineno-685-10"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-685-11"><a id="__codelineno-685-11" name="__codelineno-685-11" href="#__codelineno-685-11"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-685-12"><a id="__codelineno-685-12" name="__codelineno-685-12" href="#__codelineno-685-12"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-686-1"><a id="__codelineno-686-1" name="__codelineno-686-1" href="#__codelineno-686-1"></a><span class="c1">-- High: Complex vendor faction system</span>
</span><span id="__span-686-2"><a id="__codelineno-686-2" name="__codelineno-686-2" href="#__codelineno-686-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorFactionUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorFaction&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-686-3"><a id="__codelineno-686-3" name="__codelineno-686-3" href="#__codelineno-686-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-686-4"><a id="__codelineno-686-4" name="__codelineno-686-4" href="#__codelineno-686-4"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-686-5"><a id="__codelineno-686-5" name="__codelineno-686-5" href="#__codelineno-686-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-686-6"><a id="__codelineno-686-6" name="__codelineno-686-6" href="#__codelineno-686-6"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedFactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedFactions</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-686-7"><a id="__codelineno-686-7" name="__codelineno-686-7" href="#__codelineno-686-7"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">allowedFactions</span><span class="p">[</span><span class="nv">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">allowed</span>
</span><span id="__span-686-8"><a id="__codelineno-686-8" name="__codelineno-686-8" href="#__codelineno-686-8"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-686-9"><a id="__codelineno-686-9" name="__codelineno-686-9" href="#__codelineno-686-9"></a><span class="w">    </span><span class="c1">-- Update vendor inventory</span>
</span><span id="__span-686-10"><a id="__codelineno-686-10" name="__codelineno-686-10" href="#__codelineno-686-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-686-11"><a id="__codelineno-686-11" name="__codelineno-686-11" href="#__codelineno-686-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-12"><a id="__codelineno-686-12" name="__codelineno-686-12" href="#__codelineno-686-12"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-686-13"><a id="__codelineno-686-13" name="__codelineno-686-13" href="#__codelineno-686-13"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-686-14"><a id="__codelineno-686-14" name="__codelineno-686-14" href="#__codelineno-686-14"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">faction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-15"><a id="__codelineno-686-15" name="__codelineno-686-15" href="#__codelineno-686-15"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;allowed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="p">)</span>
</span><span id="__span-686-16"><a id="__codelineno-686-16" name="__codelineno-686-16" href="#__codelineno-686-16"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-686-17"><a id="__codelineno-686-17" name="__codelineno-686-17" href="#__codelineno-686-17"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-686-18"><a id="__codelineno-686-18" name="__codelineno-686-18" href="#__codelineno-686-18"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-686-19"><a id="__codelineno-686-19" name="__codelineno-686-19" href="#__codelineno-686-19"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-686-20"><a id="__codelineno-686-20" name="__codelineno-686-20" href="#__codelineno-686-20"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_faction_logs (timestamp, vendorid, factionid, allowed) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-686-21"><a id="__codelineno-686-21" name="__codelineno-686-21" href="#__codelineno-686-21"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">id</span><span class="p">,</span><span class="w"> </span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-686-22"><a id="__codelineno-686-22" name="__codelineno-686-22" href="#__codelineno-686-22"></a><span class="w">    </span><span class="c1">-- Notify affected players</span>
</span><span id="__span-686-23"><a id="__codelineno-686-23" name="__codelineno-686-23" href="#__codelineno-686-23"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-686-24"><a id="__codelineno-686-24" name="__codelineno-686-24" href="#__codelineno-686-24"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-686-25"><a id="__codelineno-686-25" name="__codelineno-686-25" href="#__codelineno-686-25"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-26"><a id="__codelineno-686-26" name="__codelineno-686-26" href="#__codelineno-686-26"></a><span class="w">            </span><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-686-27"><a id="__codelineno-686-27" name="__codelineno-686-27" href="#__codelineno-686-27"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-28"><a id="__codelineno-686-28" name="__codelineno-686-28" href="#__codelineno-686-28"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor access &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">allowed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;granted&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;revoked&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; for your faction&quot;</span><span class="p">)</span>
</span><span id="__span-686-29"><a id="__codelineno-686-29" name="__codelineno-686-29" href="#__codelineno-686-29"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-686-30"><a id="__codelineno-686-30" name="__codelineno-686-30" href="#__codelineno-686-30"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-686-31"><a id="__codelineno-686-31" name="__codelineno-686-31" href="#__codelineno-686-31"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-686-32"><a id="__codelineno-686-32" name="__codelineno-686-32" href="#__codelineno-686-32"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-686-33"><a id="__codelineno-686-33" name="__codelineno-686-33" href="#__codelineno-686-33"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-34"><a id="__codelineno-686-34" name="__codelineno-686-34" href="#__codelineno-686-34"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-686-35"><a id="__codelineno-686-35" name="__codelineno-686-35" href="#__codelineno-686-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-686-36"><a id="__codelineno-686-36" name="__codelineno-686-36" href="#__codelineno-686-36"></a><span class="w">    </span><span class="c1">-- Check for faction-specific items</span>
</span><span id="__span-686-37"><a id="__codelineno-686-37" name="__codelineno-686-37" href="#__codelineno-686-37"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">factionItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="nf">getByFaction</span><span class="p">(</span><span class="nv">id</span><span class="p">)</span>
</span><span id="__span-686-38"><a id="__codelineno-686-38" name="__codelineno-686-38" href="#__codelineno-686-38"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">factionItems</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-686-39"><a id="__codelineno-686-39" name="__codelineno-686-39" href="#__codelineno-686-39"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">allowed</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-686-40"><a id="__codelineno-686-40" name="__codelineno-686-40" href="#__codelineno-686-40"></a><span class="w">            </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">addItem</span><span class="p">(</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-686-41"><a id="__codelineno-686-41" name="__codelineno-686-41" href="#__codelineno-686-41"></a><span class="w">        </span><span class="kr">else</span>
</span><span id="__span-686-42"><a id="__codelineno-686-42" name="__codelineno-686-42" href="#__codelineno-686-42"></a><span class="w">            </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">removeItem</span><span class="p">(</span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-686-43"><a id="__codelineno-686-43" name="__codelineno-686-43" href="#__codelineno-686-43"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-686-44"><a id="__codelineno-686-44" name="__codelineno-686-44" href="#__codelineno-686-44"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-686-45"><a id="__codelineno-686-45" name="__codelineno-686-45" href="#__codelineno-686-45"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoritemmaxstockupdated">VendorItemMaxStockUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor item max stock is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor item's maximum stock is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>itemType</code> (<em>string</em>): The item type being updated</li>
<li><code>value</code> (<em>number</em>): The new maximum stock value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-687-1"><a id="__codelineno-687-1" name="__codelineno-687-1" href="#__codelineno-687-1"></a><span class="c1">-- Simple: Log max stock update</span>
</span><span id="__span-687-2"><a id="__codelineno-687-2" name="__codelineno-687-2" href="#__codelineno-687-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemMaxStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-687-3"><a id="__codelineno-687-3" name="__codelineno-687-3" href="#__codelineno-687-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; max stock set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-687-4"><a id="__codelineno-687-4" name="__codelineno-687-4" href="#__codelineno-687-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-688-1"><a id="__codelineno-688-1" name="__codelineno-688-1" href="#__codelineno-688-1"></a><span class="c1">-- Medium: Validate max stock value</span>
</span><span id="__span-688-2"><a id="__codelineno-688-2" name="__codelineno-688-2" href="#__codelineno-688-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemMaxStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateMaxStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-688-3"><a id="__codelineno-688-3" name="__codelineno-688-3" href="#__codelineno-688-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-688-4"><a id="__codelineno-688-4" name="__codelineno-688-4" href="#__codelineno-688-4"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-688-5"><a id="__codelineno-688-5" name="__codelineno-688-5" href="#__codelineno-688-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-688-6"><a id="__codelineno-688-6" name="__codelineno-688-6" href="#__codelineno-688-6"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span>
</span><span id="__span-688-7"><a id="__codelineno-688-7" name="__codelineno-688-7" href="#__codelineno-688-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-688-8"><a id="__codelineno-688-8" name="__codelineno-688-8" href="#__codelineno-688-8"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemMaxStock_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-688-9"><a id="__codelineno-688-9" name="__codelineno-688-9" href="#__codelineno-688-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-689-1"><a id="__codelineno-689-1" name="__codelineno-689-1" href="#__codelineno-689-1"></a><span class="c1">-- High: Complex vendor max stock system</span>
</span><span id="__span-689-2"><a id="__codelineno-689-2" name="__codelineno-689-2" href="#__codelineno-689-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemMaxStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorMaxStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-689-3"><a id="__codelineno-689-3" name="__codelineno-689-3" href="#__codelineno-689-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-689-4"><a id="__codelineno-689-4" name="__codelineno-689-4" href="#__codelineno-689-4"></a><span class="w">    </span><span class="c1">-- Validate value</span>
</span><span id="__span-689-5"><a id="__codelineno-689-5" name="__codelineno-689-5" href="#__codelineno-689-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-6"><a id="__codelineno-689-6" name="__codelineno-689-6" href="#__codelineno-689-6"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-689-7"><a id="__codelineno-689-7" name="__codelineno-689-7" href="#__codelineno-689-7"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-8"><a id="__codelineno-689-8" name="__codelineno-689-8" href="#__codelineno-689-8"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span>
</span><span id="__span-689-9"><a id="__codelineno-689-9" name="__codelineno-689-9" href="#__codelineno-689-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-689-10"><a id="__codelineno-689-10" name="__codelineno-689-10" href="#__codelineno-689-10"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-689-11"><a id="__codelineno-689-11" name="__codelineno-689-11" href="#__codelineno-689-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-689-12"><a id="__codelineno-689-12" name="__codelineno-689-12" href="#__codelineno-689-12"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemMaxStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemMaxStock</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-689-13"><a id="__codelineno-689-13" name="__codelineno-689-13" href="#__codelineno-689-13"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemMaxStock</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-689-14"><a id="__codelineno-689-14" name="__codelineno-689-14" href="#__codelineno-689-14"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-689-15"><a id="__codelineno-689-15" name="__codelineno-689-15" href="#__codelineno-689-15"></a><span class="w">    </span><span class="c1">-- Update item in inventory</span>
</span><span id="__span-689-16"><a id="__codelineno-689-16" name="__codelineno-689-16" href="#__codelineno-689-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-689-17"><a id="__codelineno-689-17" name="__codelineno-689-17" href="#__codelineno-689-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-18"><a id="__codelineno-689-18" name="__codelineno-689-18" href="#__codelineno-689-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-689-19"><a id="__codelineno-689-19" name="__codelineno-689-19" href="#__codelineno-689-19"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-689-20"><a id="__codelineno-689-20" name="__codelineno-689-20" href="#__codelineno-689-20"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-21"><a id="__codelineno-689-21" name="__codelineno-689-21" href="#__codelineno-689-21"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;maxStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-689-22"><a id="__codelineno-689-22" name="__codelineno-689-22" href="#__codelineno-689-22"></a><span class="w">                </span><span class="c1">-- Adjust current stock if it exceeds max</span>
</span><span id="__span-689-23"><a id="__codelineno-689-23" name="__codelineno-689-23" href="#__codelineno-689-23"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-689-24"><a id="__codelineno-689-24" name="__codelineno-689-24" href="#__codelineno-689-24"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentStock</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-25"><a id="__codelineno-689-25" name="__codelineno-689-25" href="#__codelineno-689-25"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-689-26"><a id="__codelineno-689-26" name="__codelineno-689-26" href="#__codelineno-689-26"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-689-27"><a id="__codelineno-689-27" name="__codelineno-689-27" href="#__codelineno-689-27"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-689-28"><a id="__codelineno-689-28" name="__codelineno-689-28" href="#__codelineno-689-28"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-689-29"><a id="__codelineno-689-29" name="__codelineno-689-29" href="#__codelineno-689-29"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-689-30"><a id="__codelineno-689-30" name="__codelineno-689-30" href="#__codelineno-689-30"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-689-31"><a id="__codelineno-689-31" name="__codelineno-689-31" href="#__codelineno-689-31"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_item_logs (timestamp, vendorid, itemtype, property, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-689-32"><a id="__codelineno-689-32" name="__codelineno-689-32" href="#__codelineno-689-32"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;maxStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-689-33"><a id="__codelineno-689-33" name="__codelineno-689-33" href="#__codelineno-689-33"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-689-34"><a id="__codelineno-689-34" name="__codelineno-689-34" href="#__codelineno-689-34"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-689-35"><a id="__codelineno-689-35" name="__codelineno-689-35" href="#__codelineno-689-35"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-689-36"><a id="__codelineno-689-36" name="__codelineno-689-36" href="#__codelineno-689-36"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-37"><a id="__codelineno-689-37" name="__codelineno-689-37" href="#__codelineno-689-37"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; max stock updated to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-689-38"><a id="__codelineno-689-38" name="__codelineno-689-38" href="#__codelineno-689-38"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-689-39"><a id="__codelineno-689-39" name="__codelineno-689-39" href="#__codelineno-689-39"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-689-40"><a id="__codelineno-689-40" name="__codelineno-689-40" href="#__codelineno-689-40"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-689-41"><a id="__codelineno-689-41" name="__codelineno-689-41" href="#__codelineno-689-41"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-689-42"><a id="__codelineno-689-42" name="__codelineno-689-42" href="#__codelineno-689-42"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-689-43"><a id="__codelineno-689-43" name="__codelineno-689-43" href="#__codelineno-689-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-689-44"><a id="__codelineno-689-44" name="__codelineno-689-44" href="#__codelineno-689-44"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoritemmodeupdated">VendorItemModeUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor item mode is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor item's mode is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>itemType</code> (<em>string</em>): The item type being updated</li>
<li><code>value</code> (<em>string</em>): The new mode value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-690-1"><a id="__codelineno-690-1" name="__codelineno-690-1" href="#__codelineno-690-1"></a><span class="c1">-- Simple: Log item mode update</span>
</span><span id="__span-690-2"><a id="__codelineno-690-2" name="__codelineno-690-2" href="#__codelineno-690-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemModeUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-690-3"><a id="__codelineno-690-3" name="__codelineno-690-3" href="#__codelineno-690-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; mode set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-690-4"><a id="__codelineno-690-4" name="__codelineno-690-4" href="#__codelineno-690-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-691-1"><a id="__codelineno-691-1" name="__codelineno-691-1" href="#__codelineno-691-1"></a><span class="c1">-- Medium: Validate mode value</span>
</span><span id="__span-691-2"><a id="__codelineno-691-2" name="__codelineno-691-2" href="#__codelineno-691-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemModeUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateMode&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-691-3"><a id="__codelineno-691-3" name="__codelineno-691-3" href="#__codelineno-691-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">validModes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;buy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;both&quot;</span><span class="p">}</span>
</span><span id="__span-691-4"><a id="__codelineno-691-4" name="__codelineno-691-4" href="#__codelineno-691-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">validModes</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-691-5"><a id="__codelineno-691-5" name="__codelineno-691-5" href="#__codelineno-691-5"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;both&quot;</span>
</span><span id="__span-691-6"><a id="__codelineno-691-6" name="__codelineno-691-6" href="#__codelineno-691-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-691-7"><a id="__codelineno-691-7" name="__codelineno-691-7" href="#__codelineno-691-7"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemMode_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-691-8"><a id="__codelineno-691-8" name="__codelineno-691-8" href="#__codelineno-691-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-692-1"><a id="__codelineno-692-1" name="__codelineno-692-1" href="#__codelineno-692-1"></a><span class="c1">-- High: Complex vendor item mode system</span>
</span><span id="__span-692-2"><a id="__codelineno-692-2" name="__codelineno-692-2" href="#__codelineno-692-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemModeUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorItemMode&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-692-3"><a id="__codelineno-692-3" name="__codelineno-692-3" href="#__codelineno-692-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-692-4"><a id="__codelineno-692-4" name="__codelineno-692-4" href="#__codelineno-692-4"></a><span class="w">    </span><span class="c1">-- Validate mode</span>
</span><span id="__span-692-5"><a id="__codelineno-692-5" name="__codelineno-692-5" href="#__codelineno-692-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">validModes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;buy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;both&quot;</span><span class="p">}</span>
</span><span id="__span-692-6"><a id="__codelineno-692-6" name="__codelineno-692-6" href="#__codelineno-692-6"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">table</span><span class="p">.</span><span class="nf">HasValue</span><span class="p">(</span><span class="nv">validModes</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-7"><a id="__codelineno-692-7" name="__codelineno-692-7" href="#__codelineno-692-7"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;both&quot;</span>
</span><span id="__span-692-8"><a id="__codelineno-692-8" name="__codelineno-692-8" href="#__codelineno-692-8"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-692-9"><a id="__codelineno-692-9" name="__codelineno-692-9" href="#__codelineno-692-9"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-692-10"><a id="__codelineno-692-10" name="__codelineno-692-10" href="#__codelineno-692-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-692-11"><a id="__codelineno-692-11" name="__codelineno-692-11" href="#__codelineno-692-11"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemModes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemModes</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-692-12"><a id="__codelineno-692-12" name="__codelineno-692-12" href="#__codelineno-692-12"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemModes</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-692-13"><a id="__codelineno-692-13" name="__codelineno-692-13" href="#__codelineno-692-13"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-692-14"><a id="__codelineno-692-14" name="__codelineno-692-14" href="#__codelineno-692-14"></a><span class="w">    </span><span class="c1">-- Update item in inventory</span>
</span><span id="__span-692-15"><a id="__codelineno-692-15" name="__codelineno-692-15" href="#__codelineno-692-15"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-692-16"><a id="__codelineno-692-16" name="__codelineno-692-16" href="#__codelineno-692-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-17"><a id="__codelineno-692-17" name="__codelineno-692-17" href="#__codelineno-692-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-692-18"><a id="__codelineno-692-18" name="__codelineno-692-18" href="#__codelineno-692-18"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-692-19"><a id="__codelineno-692-19" name="__codelineno-692-19" href="#__codelineno-692-19"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-20"><a id="__codelineno-692-20" name="__codelineno-692-20" href="#__codelineno-692-20"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-692-21"><a id="__codelineno-692-21" name="__codelineno-692-21" href="#__codelineno-692-21"></a><span class="w">                </span><span class="c1">-- Update item display based on mode</span>
</span><span id="__span-692-22"><a id="__codelineno-692-22" name="__codelineno-692-22" href="#__codelineno-692-22"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;buy&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-23"><a id="__codelineno-692-23" name="__codelineno-692-23" href="#__codelineno-692-23"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sellable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-692-24"><a id="__codelineno-692-24" name="__codelineno-692-24" href="#__codelineno-692-24"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;buyable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-692-25"><a id="__codelineno-692-25" name="__codelineno-692-25" href="#__codelineno-692-25"></a><span class="w">                </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;sell&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-26"><a id="__codelineno-692-26" name="__codelineno-692-26" href="#__codelineno-692-26"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sellable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-692-27"><a id="__codelineno-692-27" name="__codelineno-692-27" href="#__codelineno-692-27"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;buyable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-692-28"><a id="__codelineno-692-28" name="__codelineno-692-28" href="#__codelineno-692-28"></a><span class="w">                </span><span class="kr">else</span>
</span><span id="__span-692-29"><a id="__codelineno-692-29" name="__codelineno-692-29" href="#__codelineno-692-29"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;sellable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-692-30"><a id="__codelineno-692-30" name="__codelineno-692-30" href="#__codelineno-692-30"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;buyable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-692-31"><a id="__codelineno-692-31" name="__codelineno-692-31" href="#__codelineno-692-31"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-692-32"><a id="__codelineno-692-32" name="__codelineno-692-32" href="#__codelineno-692-32"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-692-33"><a id="__codelineno-692-33" name="__codelineno-692-33" href="#__codelineno-692-33"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-692-34"><a id="__codelineno-692-34" name="__codelineno-692-34" href="#__codelineno-692-34"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-692-35"><a id="__codelineno-692-35" name="__codelineno-692-35" href="#__codelineno-692-35"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-692-36"><a id="__codelineno-692-36" name="__codelineno-692-36" href="#__codelineno-692-36"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_item_logs (timestamp, vendorid, itemtype, property, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-692-37"><a id="__codelineno-692-37" name="__codelineno-692-37" href="#__codelineno-692-37"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mode&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-692-38"><a id="__codelineno-692-38" name="__codelineno-692-38" href="#__codelineno-692-38"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-692-39"><a id="__codelineno-692-39" name="__codelineno-692-39" href="#__codelineno-692-39"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-692-40"><a id="__codelineno-692-40" name="__codelineno-692-40" href="#__codelineno-692-40"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-692-41"><a id="__codelineno-692-41" name="__codelineno-692-41" href="#__codelineno-692-41"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-42"><a id="__codelineno-692-42" name="__codelineno-692-42" href="#__codelineno-692-42"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; mode updated to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-692-43"><a id="__codelineno-692-43" name="__codelineno-692-43" href="#__codelineno-692-43"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-692-44"><a id="__codelineno-692-44" name="__codelineno-692-44" href="#__codelineno-692-44"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-692-45"><a id="__codelineno-692-45" name="__codelineno-692-45" href="#__codelineno-692-45"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-692-46"><a id="__codelineno-692-46" name="__codelineno-692-46" href="#__codelineno-692-46"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-692-47"><a id="__codelineno-692-47" name="__codelineno-692-47" href="#__codelineno-692-47"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-692-48"><a id="__codelineno-692-48" name="__codelineno-692-48" href="#__codelineno-692-48"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-692-49"><a id="__codelineno-692-49" name="__codelineno-692-49" href="#__codelineno-692-49"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoritempriceupdated">VendorItemPriceUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor item price is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor item's price is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>itemType</code> (<em>string</em>): The item type being updated</li>
<li><code>value</code> (<em>number</em>): The new price value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-693-1"><a id="__codelineno-693-1" name="__codelineno-693-1" href="#__codelineno-693-1"></a><span class="c1">-- Simple: Log price update</span>
</span><span id="__span-693-2"><a id="__codelineno-693-2" name="__codelineno-693-2" href="#__codelineno-693-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemPriceUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-693-3"><a id="__codelineno-693-3" name="__codelineno-693-3" href="#__codelineno-693-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; price set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-693-4"><a id="__codelineno-693-4" name="__codelineno-693-4" href="#__codelineno-693-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-694-1"><a id="__codelineno-694-1" name="__codelineno-694-1" href="#__codelineno-694-1"></a><span class="c1">-- Medium: Validate price value</span>
</span><span id="__span-694-2"><a id="__codelineno-694-2" name="__codelineno-694-2" href="#__codelineno-694-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemPriceUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidatePrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-694-3"><a id="__codelineno-694-3" name="__codelineno-694-3" href="#__codelineno-694-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-694-4"><a id="__codelineno-694-4" name="__codelineno-694-4" href="#__codelineno-694-4"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-694-5"><a id="__codelineno-694-5" name="__codelineno-694-5" href="#__codelineno-694-5"></a><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-694-6"><a id="__codelineno-694-6" name="__codelineno-694-6" href="#__codelineno-694-6"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span>
</span><span id="__span-694-7"><a id="__codelineno-694-7" name="__codelineno-694-7" href="#__codelineno-694-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-694-8"><a id="__codelineno-694-8" name="__codelineno-694-8" href="#__codelineno-694-8"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemPrice_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-694-9"><a id="__codelineno-694-9" name="__codelineno-694-9" href="#__codelineno-694-9"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-695-1"><a id="__codelineno-695-1" name="__codelineno-695-1" href="#__codelineno-695-1"></a><span class="c1">-- High: Complex vendor price system</span>
</span><span id="__span-695-2"><a id="__codelineno-695-2" name="__codelineno-695-2" href="#__codelineno-695-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemPriceUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorPrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-3"><a id="__codelineno-695-3" name="__codelineno-695-3" href="#__codelineno-695-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-695-4"><a id="__codelineno-695-4" name="__codelineno-695-4" href="#__codelineno-695-4"></a><span class="w">    </span><span class="c1">-- Validate price</span>
</span><span id="__span-695-5"><a id="__codelineno-695-5" name="__codelineno-695-5" href="#__codelineno-695-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-6"><a id="__codelineno-695-6" name="__codelineno-695-6" href="#__codelineno-695-6"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-695-7"><a id="__codelineno-695-7" name="__codelineno-695-7" href="#__codelineno-695-7"></a><span class="w">    </span><span class="kr">elseif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-8"><a id="__codelineno-695-8" name="__codelineno-695-8" href="#__codelineno-695-8"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000000</span>
</span><span id="__span-695-9"><a id="__codelineno-695-9" name="__codelineno-695-9" href="#__codelineno-695-9"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-695-10"><a id="__codelineno-695-10" name="__codelineno-695-10" href="#__codelineno-695-10"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-695-11"><a id="__codelineno-695-11" name="__codelineno-695-11" href="#__codelineno-695-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-695-12"><a id="__codelineno-695-12" name="__codelineno-695-12" href="#__codelineno-695-12"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemPrices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemPrices</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-695-13"><a id="__codelineno-695-13" name="__codelineno-695-13" href="#__codelineno-695-13"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemPrices</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-695-14"><a id="__codelineno-695-14" name="__codelineno-695-14" href="#__codelineno-695-14"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-695-15"><a id="__codelineno-695-15" name="__codelineno-695-15" href="#__codelineno-695-15"></a><span class="w">    </span><span class="c1">-- Update item in inventory</span>
</span><span id="__span-695-16"><a id="__codelineno-695-16" name="__codelineno-695-16" href="#__codelineno-695-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-695-17"><a id="__codelineno-695-17" name="__codelineno-695-17" href="#__codelineno-695-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-18"><a id="__codelineno-695-18" name="__codelineno-695-18" href="#__codelineno-695-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-695-19"><a id="__codelineno-695-19" name="__codelineno-695-19" href="#__codelineno-695-19"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-695-20"><a id="__codelineno-695-20" name="__codelineno-695-20" href="#__codelineno-695-20"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-21"><a id="__codelineno-695-21" name="__codelineno-695-21" href="#__codelineno-695-21"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-22"><a id="__codelineno-695-22" name="__codelineno-695-22" href="#__codelineno-695-22"></a><span class="w">                </span><span class="c1">-- Calculate profit margin</span>
</span><span id="__span-695-23"><a id="__codelineno-695-23" name="__codelineno-695-23" href="#__codelineno-695-23"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">basePrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;basePrice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-24"><a id="__codelineno-695-24" name="__codelineno-695-24" href="#__codelineno-695-24"></a><span class="w">                </span><span class="kd">local</span><span class="w"> </span><span class="nv">profitMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nv">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">basePrice</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">basePrice</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-695-25"><a id="__codelineno-695-25" name="__codelineno-695-25" href="#__codelineno-695-25"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;profitMargin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">profitMargin</span><span class="p">)</span>
</span><span id="__span-695-26"><a id="__codelineno-695-26" name="__codelineno-695-26" href="#__codelineno-695-26"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-695-27"><a id="__codelineno-695-27" name="__codelineno-695-27" href="#__codelineno-695-27"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-695-28"><a id="__codelineno-695-28" name="__codelineno-695-28" href="#__codelineno-695-28"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-695-29"><a id="__codelineno-695-29" name="__codelineno-695-29" href="#__codelineno-695-29"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-695-30"><a id="__codelineno-695-30" name="__codelineno-695-30" href="#__codelineno-695-30"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_item_logs (timestamp, vendorid, itemtype, property, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-695-31"><a id="__codelineno-695-31" name="__codelineno-695-31" href="#__codelineno-695-31"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-32"><a id="__codelineno-695-32" name="__codelineno-695-32" href="#__codelineno-695-32"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-695-33"><a id="__codelineno-695-33" name="__codelineno-695-33" href="#__codelineno-695-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-695-34"><a id="__codelineno-695-34" name="__codelineno-695-34" href="#__codelineno-695-34"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-695-35"><a id="__codelineno-695-35" name="__codelineno-695-35" href="#__codelineno-695-35"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-36"><a id="__codelineno-695-36" name="__codelineno-695-36" href="#__codelineno-695-36"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; price updated to $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-37"><a id="__codelineno-695-37" name="__codelineno-695-37" href="#__codelineno-695-37"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-695-38"><a id="__codelineno-695-38" name="__codelineno-695-38" href="#__codelineno-695-38"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-695-39"><a id="__codelineno-695-39" name="__codelineno-695-39" href="#__codelineno-695-39"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-695-40"><a id="__codelineno-695-40" name="__codelineno-695-40" href="#__codelineno-695-40"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-41"><a id="__codelineno-695-41" name="__codelineno-695-41" href="#__codelineno-695-41"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-695-42"><a id="__codelineno-695-42" name="__codelineno-695-42" href="#__codelineno-695-42"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-695-43"><a id="__codelineno-695-43" name="__codelineno-695-43" href="#__codelineno-695-43"></a><span class="w">    </span><span class="c1">-- Check for price alerts</span>
</span><span id="__span-695-44"><a id="__codelineno-695-44" name="__codelineno-695-44" href="#__codelineno-695-44"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">priceAlerts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;priceAlerts&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-695-45"><a id="__codelineno-695-45" name="__codelineno-695-45" href="#__codelineno-695-45"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">alert</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">priceAlerts</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-695-46"><a id="__codelineno-695-46" name="__codelineno-695-46" href="#__codelineno-695-46"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">alert</span><span class="p">.</span><span class="py">itemType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">alert</span><span class="p">.</span><span class="py">priceThreshold</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">alert</span><span class="p">.</span><span class="py">priceThreshold</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-695-47"><a id="__codelineno-695-47" name="__codelineno-695-47" href="#__codelineno-695-47"></a><span class="w">            </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-695-48"><a id="__codelineno-695-48" name="__codelineno-695-48" href="#__codelineno-695-48"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Price alert: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; is now $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-695-49"><a id="__codelineno-695-49" name="__codelineno-695-49" href="#__codelineno-695-49"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-695-50"><a id="__codelineno-695-50" name="__codelineno-695-50" href="#__codelineno-695-50"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-695-51"><a id="__codelineno-695-51" name="__codelineno-695-51" href="#__codelineno-695-51"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-695-52"><a id="__codelineno-695-52" name="__codelineno-695-52" href="#__codelineno-695-52"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoritemstockupdated">VendorItemStockUpdated</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor item stock is updated</p>
<p><strong>When Called</strong></p>
<p>When a vendor item's stock is modified</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>itemType</code> (<em>string</em>): The item type being updated</li>
<li><code>value</code> (<em>number</em>): The new stock value</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-696-1"><a id="__codelineno-696-1" name="__codelineno-696-1" href="#__codelineno-696-1"></a><span class="c1">-- Simple: Log stock update</span>
</span><span id="__span-696-2"><a id="__codelineno-696-2" name="__codelineno-696-2" href="#__codelineno-696-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-696-3"><a id="__codelineno-696-3" name="__codelineno-696-3" href="#__codelineno-696-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; stock set to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-696-4"><a id="__codelineno-696-4" name="__codelineno-696-4" href="#__codelineno-696-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-697-1"><a id="__codelineno-697-1" name="__codelineno-697-1" href="#__codelineno-697-1"></a><span class="c1">-- Medium: Validate stock value</span>
</span><span id="__span-697-2"><a id="__codelineno-697-2" name="__codelineno-697-2" href="#__codelineno-697-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-697-3"><a id="__codelineno-697-3" name="__codelineno-697-3" href="#__codelineno-697-3"></a><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-697-4"><a id="__codelineno-697-4" name="__codelineno-697-4" href="#__codelineno-697-4"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-697-5"><a id="__codelineno-697-5" name="__codelineno-697-5" href="#__codelineno-697-5"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-697-6"><a id="__codelineno-697-6" name="__codelineno-697-6" href="#__codelineno-697-6"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;itemStock_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-697-7"><a id="__codelineno-697-7" name="__codelineno-697-7" href="#__codelineno-697-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-698-1"><a id="__codelineno-698-1" name="__codelineno-698-1" href="#__codelineno-698-1"></a><span class="c1">-- High: Complex vendor stock system</span>
</span><span id="__span-698-2"><a id="__codelineno-698-2" name="__codelineno-698-2" href="#__codelineno-698-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorItemStockUpdated&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-698-3"><a id="__codelineno-698-3" name="__codelineno-698-3" href="#__codelineno-698-3"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-698-4"><a id="__codelineno-698-4" name="__codelineno-698-4" href="#__codelineno-698-4"></a><span class="w">    </span><span class="c1">-- Validate stock</span>
</span><span id="__span-698-5"><a id="__codelineno-698-5" name="__codelineno-698-5" href="#__codelineno-698-5"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-6"><a id="__codelineno-698-6" name="__codelineno-698-6" href="#__codelineno-698-6"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-698-7"><a id="__codelineno-698-7" name="__codelineno-698-7" href="#__codelineno-698-7"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-8"><a id="__codelineno-698-8" name="__codelineno-698-8" href="#__codelineno-698-8"></a><span class="w">    </span><span class="c1">-- Get max stock</span>
</span><span id="__span-698-9"><a id="__codelineno-698-9" name="__codelineno-698-9" href="#__codelineno-698-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">maxStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;itemMaxStock_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-698-10"><a id="__codelineno-698-10" name="__codelineno-698-10" href="#__codelineno-698-10"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxStock</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-11"><a id="__codelineno-698-11" name="__codelineno-698-11" href="#__codelineno-698-11"></a><span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">maxStock</span>
</span><span id="__span-698-12"><a id="__codelineno-698-12" name="__codelineno-698-12" href="#__codelineno-698-12"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-13"><a id="__codelineno-698-13" name="__codelineno-698-13" href="#__codelineno-698-13"></a><span class="w">    </span><span class="c1">-- Update vendor data</span>
</span><span id="__span-698-14"><a id="__codelineno-698-14" name="__codelineno-698-14" href="#__codelineno-698-14"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-698-15"><a id="__codelineno-698-15" name="__codelineno-698-15" href="#__codelineno-698-15"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemStocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemStocks</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-698-16"><a id="__codelineno-698-16" name="__codelineno-698-16" href="#__codelineno-698-16"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">itemStocks</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">value</span>
</span><span id="__span-698-17"><a id="__codelineno-698-17" name="__codelineno-698-17" href="#__codelineno-698-17"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-698-18"><a id="__codelineno-698-18" name="__codelineno-698-18" href="#__codelineno-698-18"></a><span class="w">    </span><span class="c1">-- Update item in inventory</span>
</span><span id="__span-698-19"><a id="__codelineno-698-19" name="__codelineno-698-19" href="#__codelineno-698-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getInv</span><span class="p">()</span>
</span><span id="__span-698-20"><a id="__codelineno-698-20" name="__codelineno-698-20" href="#__codelineno-698-20"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-21"><a id="__codelineno-698-21" name="__codelineno-698-21" href="#__codelineno-698-21"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inventory</span><span class="p">:</span><span class="nf">getItems</span><span class="p">()</span>
</span><span id="__span-698-22"><a id="__codelineno-698-22" name="__codelineno-698-22" href="#__codelineno-698-22"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">items</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-698-23"><a id="__codelineno-698-23" name="__codelineno-698-23" href="#__codelineno-698-23"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">uniqueID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-24"><a id="__codelineno-698-24" name="__codelineno-698-24" href="#__codelineno-698-24"></a><span class="w">                </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-698-25"><a id="__codelineno-698-25" name="__codelineno-698-25" href="#__codelineno-698-25"></a><span class="w">                </span><span class="c1">-- Check if item is out of stock</span>
</span><span id="__span-698-26"><a id="__codelineno-698-26" name="__codelineno-698-26" href="#__codelineno-698-26"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-27"><a id="__codelineno-698-27" name="__codelineno-698-27" href="#__codelineno-698-27"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;outOfStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-698-28"><a id="__codelineno-698-28" name="__codelineno-698-28" href="#__codelineno-698-28"></a><span class="w">                </span><span class="kr">else</span>
</span><span id="__span-698-29"><a id="__codelineno-698-29" name="__codelineno-698-29" href="#__codelineno-698-29"></a><span class="w">                    </span><span class="nv">item</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;outOfStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-698-30"><a id="__codelineno-698-30" name="__codelineno-698-30" href="#__codelineno-698-30"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-698-31"><a id="__codelineno-698-31" name="__codelineno-698-31" href="#__codelineno-698-31"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-698-32"><a id="__codelineno-698-32" name="__codelineno-698-32" href="#__codelineno-698-32"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-698-33"><a id="__codelineno-698-33" name="__codelineno-698-33" href="#__codelineno-698-33"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-34"><a id="__codelineno-698-34" name="__codelineno-698-34" href="#__codelineno-698-34"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-698-35"><a id="__codelineno-698-35" name="__codelineno-698-35" href="#__codelineno-698-35"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO vendor_item_logs (timestamp, vendorid, itemtype, property, value) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-698-36"><a id="__codelineno-698-36" name="__codelineno-698-36" href="#__codelineno-698-36"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;stock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-698-37"><a id="__codelineno-698-37" name="__codelineno-698-37" href="#__codelineno-698-37"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-698-38"><a id="__codelineno-698-38" name="__codelineno-698-38" href="#__codelineno-698-38"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-698-39"><a id="__codelineno-698-39" name="__codelineno-698-39" href="#__codelineno-698-39"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-698-40"><a id="__codelineno-698-40" name="__codelineno-698-40" href="#__codelineno-698-40"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-41"><a id="__codelineno-698-41" name="__codelineno-698-41" href="#__codelineno-698-41"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; stock updated to &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span>
</span><span id="__span-698-42"><a id="__codelineno-698-42" name="__codelineno-698-42" href="#__codelineno-698-42"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-698-43"><a id="__codelineno-698-43" name="__codelineno-698-43" href="#__codelineno-698-43"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-44"><a id="__codelineno-698-44" name="__codelineno-698-44" href="#__codelineno-698-44"></a><span class="w">    </span><span class="c1">-- Update vendor UI if open</span>
</span><span id="__span-698-45"><a id="__codelineno-698-45" name="__codelineno-698-45" href="#__codelineno-698-45"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">.</span><span class="py">vendor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">vendor</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-46"><a id="__codelineno-698-46" name="__codelineno-698-46" href="#__codelineno-698-46"></a><span class="w">        </span><span class="nv">lia</span><span class="p">.</span><span class="py">gui</span><span class="p">.</span><span class="py">vendor</span><span class="p">:</span><span class="nf">Populate</span><span class="p">()</span>
</span><span id="__span-698-47"><a id="__codelineno-698-47" name="__codelineno-698-47" href="#__codelineno-698-47"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-48"><a id="__codelineno-698-48" name="__codelineno-698-48" href="#__codelineno-698-48"></a><span class="w">    </span><span class="c1">-- Check for low stock alerts</span>
</span><span id="__span-698-49"><a id="__codelineno-698-49" name="__codelineno-698-49" href="#__codelineno-698-49"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">lowStockThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">&quot;lowStockThreshold&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-698-50"><a id="__codelineno-698-50" name="__codelineno-698-50" href="#__codelineno-698-50"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nv">lowStockThreshold</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-51"><a id="__codelineno-698-51" name="__codelineno-698-51" href="#__codelineno-698-51"></a><span class="w">        </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-698-52"><a id="__codelineno-698-52" name="__codelineno-698-52" href="#__codelineno-698-52"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-698-53"><a id="__codelineno-698-53" name="__codelineno-698-53" href="#__codelineno-698-53"></a><span class="w">                </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Low stock alert: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; has &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; left&quot;</span><span class="p">)</span>
</span><span id="__span-698-54"><a id="__codelineno-698-54" name="__codelineno-698-54" href="#__codelineno-698-54"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-698-55"><a id="__codelineno-698-55" name="__codelineno-698-55" href="#__codelineno-698-55"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-698-56"><a id="__codelineno-698-56" name="__codelineno-698-56" href="#__codelineno-698-56"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-698-57"><a id="__codelineno-698-57" name="__codelineno-698-57" href="#__codelineno-698-57"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendoropened">VendorOpened</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor is opened by a player</p>
<p><strong>When Called</strong></p>
<p>When a player successfully opens a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity being opened</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-699-1"><a id="__codelineno-699-1" name="__codelineno-699-1" href="#__codelineno-699-1"></a><span class="c1">-- Simple: Log vendor opening</span>
</span><span id="__span-699-2"><a id="__codelineno-699-2" name="__codelineno-699-2" href="#__codelineno-699-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorOpened&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-699-3"><a id="__codelineno-699-3" name="__codelineno-699-3" href="#__codelineno-699-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vendor opened: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">())</span>
</span><span id="__span-699-4"><a id="__codelineno-699-4" name="__codelineno-699-4" href="#__codelineno-699-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-700-1"><a id="__codelineno-700-1" name="__codelineno-700-1" href="#__codelineno-700-1"></a><span class="c1">-- Medium: Track vendor usage</span>
</span><span id="__span-700-2"><a id="__codelineno-700-2" name="__codelineno-700-2" href="#__codelineno-700-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorOpened&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VendorTracking&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-700-3"><a id="__codelineno-700-3" name="__codelineno-700-3" href="#__codelineno-700-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-700-4"><a id="__codelineno-700-4" name="__codelineno-700-4" href="#__codelineno-700-4"></a><span class="nv">vendorData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">vendorData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-700-5"><a id="__codelineno-700-5" name="__codelineno-700-5" href="#__codelineno-700-5"></a><span class="nv">vendorData</span><span class="p">.</span><span class="py">lastOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-700-6"><a id="__codelineno-700-6" name="__codelineno-700-6" href="#__codelineno-700-6"></a><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-700-7"><a id="__codelineno-700-7" name="__codelineno-700-7" href="#__codelineno-700-7"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-701-1"><a id="__codelineno-701-1" name="__codelineno-701-1" href="#__codelineno-701-1"></a><span class="c1">-- High: Complex vendor opening system</span>
</span><span id="__span-701-2"><a id="__codelineno-701-2" name="__codelineno-701-2" href="#__codelineno-701-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorOpened&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorOpening&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">vendor</span><span class="p">)</span>
</span><span id="__span-701-3"><a id="__codelineno-701-3" name="__codelineno-701-3" href="#__codelineno-701-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-701-4"><a id="__codelineno-701-4" name="__codelineno-701-4" href="#__codelineno-701-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-701-5"><a id="__codelineno-701-5" name="__codelineno-701-5" href="#__codelineno-701-5"></a><span class="w">    </span><span class="c1">-- Update vendor statistics</span>
</span><span id="__span-701-6"><a id="__codelineno-701-6" name="__codelineno-701-6" href="#__codelineno-701-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">getNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span>
</span><span id="__span-701-7"><a id="__codelineno-701-7" name="__codelineno-701-7" href="#__codelineno-701-7"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">vendorData</span><span class="p">.</span><span class="py">openCount</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-701-8"><a id="__codelineno-701-8" name="__codelineno-701-8" href="#__codelineno-701-8"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">lastOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.time</span><span class="p">()</span>
</span><span id="__span-701-9"><a id="__codelineno-701-9" name="__codelineno-701-9" href="#__codelineno-701-9"></a><span class="w">    </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">totalRevenue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">totalRevenue</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-701-10"><a id="__codelineno-701-10" name="__codelineno-701-10" href="#__codelineno-701-10"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-701-11"><a id="__codelineno-701-11" name="__codelineno-701-11" href="#__codelineno-701-11"></a><span class="w">    </span><span class="c1">-- Check for vendor upgrades</span>
</span><span id="__span-701-12"><a id="__codelineno-701-12" name="__codelineno-701-12" href="#__codelineno-701-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">openCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">openCount</span>
</span><span id="__span-701-13"><a id="__codelineno-701-13" name="__codelineno-701-13" href="#__codelineno-701-13"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">openCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">upgraded</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-701-14"><a id="__codelineno-701-14" name="__codelineno-701-14" href="#__codelineno-701-14"></a><span class="w">        </span><span class="nv">vendorData</span><span class="p">.</span><span class="py">upgraded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-701-15"><a id="__codelineno-701-15" name="__codelineno-701-15" href="#__codelineno-701-15"></a><span class="w">        </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;vendorData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">vendorData</span><span class="p">)</span>
</span><span id="__span-701-16"><a id="__codelineno-701-16" name="__codelineno-701-16" href="#__codelineno-701-16"></a><span class="w">        </span><span class="nv">char</span><span class="p">:</span><span class="nf">getPlayer</span><span class="p">():</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vendor upgraded! Increased stock capacity.&quot;</span><span class="p">)</span>
</span><span id="__span-701-17"><a id="__codelineno-701-17" name="__codelineno-701-17" href="#__codelineno-701-17"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-701-18"><a id="__codelineno-701-18" name="__codelineno-701-18" href="#__codelineno-701-18"></a><span class="w">    </span><span class="c1">-- Apply faction bonuses</span>
</span><span id="__span-701-19"><a id="__codelineno-701-19" name="__codelineno-701-19" href="#__codelineno-701-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">faction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getFaction</span><span class="p">()</span>
</span><span id="__span-701-20"><a id="__codelineno-701-20" name="__codelineno-701-20" href="#__codelineno-701-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-701-21"><a id="__codelineno-701-21" name="__codelineno-701-21" href="#__codelineno-701-21"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;police&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">discount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="nv">bonusStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">},</span>
</span><span id="__span-701-22"><a id="__codelineno-701-22" name="__codelineno-701-22" href="#__codelineno-701-22"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;medic&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">discount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="nv">bonusStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">},</span>
</span><span id="__span-701-23"><a id="__codelineno-701-23" name="__codelineno-701-23" href="#__codelineno-701-23"></a><span class="w">    </span><span class="p">[</span><span class="s2">&quot;citizen&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">discount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nv">bonusStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
</span><span id="__span-701-24"><a id="__codelineno-701-24" name="__codelineno-701-24" href="#__codelineno-701-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-701-25"><a id="__codelineno-701-25" name="__codelineno-701-25" href="#__codelineno-701-25"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">bonuses</span><span class="p">[</span><span class="nv">faction</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{</span><span class="nv">discount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nv">bonusStock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
</span><span id="__span-701-26"><a id="__codelineno-701-26" name="__codelineno-701-26" href="#__codelineno-701-26"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;factionDiscount&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">bonus</span><span class="p">.</span><span class="py">discount</span><span class="p">)</span>
</span><span id="__span-701-27"><a id="__codelineno-701-27" name="__codelineno-701-27" href="#__codelineno-701-27"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;bonusStock&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">bonus</span><span class="p">.</span><span class="py">bonusStock</span><span class="p">)</span>
</span><span id="__span-701-28"><a id="__codelineno-701-28" name="__codelineno-701-28" href="#__codelineno-701-28"></a><span class="w">    </span><span class="c1">-- Check for time-based events</span>
</span><span id="__span-701-29"><a id="__codelineno-701-29" name="__codelineno-701-29" href="#__codelineno-701-29"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">tonumber</span><span class="p">(</span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">))</span>
</span><span id="__span-701-30"><a id="__codelineno-701-30" name="__codelineno-701-30" href="#__codelineno-701-30"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">currentHour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">currentHour</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-701-31"><a id="__codelineno-701-31" name="__codelineno-701-31" href="#__codelineno-701-31"></a><span class="w">        </span><span class="c1">-- Peak hours bonus</span>
</span><span id="__span-701-32"><a id="__codelineno-701-32" name="__codelineno-701-32" href="#__codelineno-701-32"></a><span class="w">        </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;peakHoursBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="__span-701-33"><a id="__codelineno-701-33" name="__codelineno-701-33" href="#__codelineno-701-33"></a><span class="w">    </span><span class="kr">else</span>
</span><span id="__span-701-34"><a id="__codelineno-701-34" name="__codelineno-701-34" href="#__codelineno-701-34"></a><span class="w">        </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">setNetVar</span><span class="p">(</span><span class="s2">&quot;peakHoursBonus&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="__span-701-35"><a id="__codelineno-701-35" name="__codelineno-701-35" href="#__codelineno-701-35"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-701-36"><a id="__codelineno-701-36" name="__codelineno-701-36" href="#__codelineno-701-36"></a><span class="w">    </span><span class="c1">-- Log vendor opening</span>
</span><span id="__span-701-37"><a id="__codelineno-701-37" name="__codelineno-701-37" href="#__codelineno-701-37"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;Vendor %s opened by %s (Faction: %s, Opens: %d)&quot;</span><span class="p">,</span>
</span><span id="__span-701-38"><a id="__codelineno-701-38" name="__codelineno-701-38" href="#__codelineno-701-38"></a><span class="w">    </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getName</span><span class="p">(),</span><span class="w"> </span><span class="nv">faction</span><span class="p">,</span><span class="w"> </span><span class="nv">openCount</span><span class="p">))</span>
</span><span id="__span-701-39"><a id="__codelineno-701-39" name="__codelineno-701-39" href="#__codelineno-701-39"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="vendortradeevent">VendorTradeEvent</h3>
<p><strong>Purpose</strong></p>
<p>Called when a vendor trade event occurs</p>
<p><strong>When Called</strong></p>
<p>When a player trades with a vendor</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player trading</li>
<li><code>vendor</code> (<em>Entity</em>): The vendor entity</li>
<li><code>itemType</code> (<em>string</em>): The type of item being traded</li>
<li><code>isSellingToVendor</code> (<em>boolean</em>): Whether the player is selling to the vendor</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-702-1"><a id="__codelineno-702-1" name="__codelineno-702-1" href="#__codelineno-702-1"></a><span class="c1">-- Simple: Log vendor trade</span>
</span><span id="__span-702-2"><a id="__codelineno-702-2" name="__codelineno-702-2" href="#__codelineno-702-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorTradeEvent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-702-3"><a id="__codelineno-702-3" name="__codelineno-702-3" href="#__codelineno-702-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; traded &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">itemType</span><span class="p">)</span>
</span><span id="__span-702-4"><a id="__codelineno-702-4" name="__codelineno-702-4" href="#__codelineno-702-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-703-1"><a id="__codelineno-703-1" name="__codelineno-703-1" href="#__codelineno-703-1"></a><span class="c1">-- Medium: Track trade statistics</span>
</span><span id="__span-703-2"><a id="__codelineno-703-2" name="__codelineno-703-2" href="#__codelineno-703-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorTradeEvent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TrackTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-703-3"><a id="__codelineno-703-3" name="__codelineno-703-3" href="#__codelineno-703-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-703-4"><a id="__codelineno-703-4" name="__codelineno-703-4" href="#__codelineno-703-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-703-5"><a id="__codelineno-703-5" name="__codelineno-703-5" href="#__codelineno-703-5"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-703-6"><a id="__codelineno-703-6" name="__codelineno-703-6" href="#__codelineno-703-6"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-703-7"><a id="__codelineno-703-7" name="__codelineno-703-7" href="#__codelineno-703-7"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-704-1"><a id="__codelineno-704-1" name="__codelineno-704-1" href="#__codelineno-704-1"></a><span class="c1">-- High: Complex vendor trade system</span>
</span><span id="__span-704-2"><a id="__codelineno-704-2" name="__codelineno-704-2" href="#__codelineno-704-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;VendorTradeEvent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedVendorTrade&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">vendor</span><span class="p">,</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="p">)</span>
</span><span id="__span-704-3"><a id="__codelineno-704-3" name="__codelineno-704-3" href="#__codelineno-704-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-704-4"><a id="__codelineno-704-4" name="__codelineno-704-4" href="#__codelineno-704-4"></a><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-704-5"><a id="__codelineno-704-5" name="__codelineno-704-5" href="#__codelineno-704-5"></a><span class="w">    </span><span class="c1">-- Update trade statistics</span>
</span><span id="__span-704-6"><a id="__codelineno-704-6" name="__codelineno-704-6" href="#__codelineno-704-6"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-704-7"><a id="__codelineno-704-7" name="__codelineno-704-7" href="#__codelineno-704-7"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorTrades&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">trades</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-704-8"><a id="__codelineno-704-8" name="__codelineno-704-8" href="#__codelineno-704-8"></a><span class="w">    </span><span class="c1">-- Track trade value</span>
</span><span id="__span-704-9"><a id="__codelineno-704-9" name="__codelineno-704-9" href="#__codelineno-704-9"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">tradeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;tradeValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-704-10"><a id="__codelineno-704-10" name="__codelineno-704-10" href="#__codelineno-704-10"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">itemType</span><span class="p">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">lia</span><span class="p">.</span><span class="py">item</span><span class="p">.</span><span class="py">list</span><span class="p">[</span><span class="nv">itemType</span><span class="p">].</span><span class="nv">price</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-704-11"><a id="__codelineno-704-11" name="__codelineno-704-11" href="#__codelineno-704-11"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;tradeValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">tradeValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">itemPrice</span><span class="p">)</span>
</span><span id="__span-704-12"><a id="__codelineno-704-12" name="__codelineno-704-12" href="#__codelineno-704-12"></a><span class="w">    </span><span class="c1">-- Log to database</span>
</span><span id="__span-704-13"><a id="__codelineno-704-13" name="__codelineno-704-13" href="#__codelineno-704-13"></a><span class="w">    </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO trade_logs (timestamp, steamid, vendorid, itemtype, selling) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-704-14"><a id="__codelineno-704-14" name="__codelineno-704-14" href="#__codelineno-704-14"></a><span class="w">    </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">(),</span><span class="w"> </span><span class="nv">itemType</span><span class="p">,</span><span class="w"> </span><span class="nv">isSellingToVendor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-704-15"><a id="__codelineno-704-15" name="__codelineno-704-15" href="#__codelineno-704-15"></a><span class="w">    </span><span class="c1">-- Update vendor reputation</span>
</span><span id="__span-704-16"><a id="__codelineno-704-16" name="__codelineno-704-16" href="#__codelineno-704-16"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vendorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">EntIndex</span><span class="p">()</span>
</span><span id="__span-704-17"><a id="__codelineno-704-17" name="__codelineno-704-17" href="#__codelineno-704-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">reputation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">char</span><span class="p">:</span><span class="nf">getData</span><span class="p">(</span><span class="s2">&quot;vendorRep_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">vendorID</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-704-18"><a id="__codelineno-704-18" name="__codelineno-704-18" href="#__codelineno-704-18"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;vendorRep_&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">vendorID</span><span class="p">,</span><span class="w"> </span><span class="nv">reputation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-704-19"><a id="__codelineno-704-19" name="__codelineno-704-19" href="#__codelineno-704-19"></a><span class="w">    </span><span class="c1">-- Notify nearby players</span>
</span><span id="__span-704-20"><a id="__codelineno-704-20" name="__codelineno-704-20" href="#__codelineno-704-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vendor</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span>
</span><span id="__span-704-21"><a id="__codelineno-704-21" name="__codelineno-704-21" href="#__codelineno-704-21"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-704-22"><a id="__codelineno-704-22" name="__codelineno-704-22" href="#__codelineno-704-22"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-704-23"><a id="__codelineno-704-23" name="__codelineno-704-23" href="#__codelineno-704-23"></a><span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; traded with the vendor&quot;</span><span class="p">)</span>
</span><span id="__span-704-24"><a id="__codelineno-704-24" name="__codelineno-704-24" href="#__codelineno-704-24"></a><span class="w">            </span><span class="kr">end</span>
</span><span id="__span-704-25"><a id="__codelineno-704-25" name="__codelineno-704-25" href="#__codelineno-704-25"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-704-26"><a id="__codelineno-704-26" name="__codelineno-704-26" href="#__codelineno-704-26"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="warningissued">WarningIssued</h3>
<p><strong>Purpose</strong></p>
<p>Called when a warning is issued</p>
<p><strong>When Called</strong></p>
<p>When a player receives a warning</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who issued the warning</li>
<li><code>target</code> (<em>Player</em>): The player who received the warning</li>
<li><code>reason</code> (<em>string</em>): The reason for the warning</li>
<li><code>count</code> (<em>number</em>): The total warning count</li>
<li><code>warnerSteamID</code> (<em>string</em>): The SteamID of the warner</li>
<li><code>warnerName</code> (<em>string</em>): The name of the warner</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-705-1"><a id="__codelineno-705-1" name="__codelineno-705-1" href="#__codelineno-705-1"></a><span class="c1">-- Simple: Log warning</span>
</span><span id="__span-705-2"><a id="__codelineno-705-2" name="__codelineno-705-2" href="#__codelineno-705-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningIssued&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-705-3"><a id="__codelineno-705-3" name="__codelineno-705-3" href="#__codelineno-705-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was warned by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-705-4"><a id="__codelineno-705-4" name="__codelineno-705-4" href="#__codelineno-705-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-706-1"><a id="__codelineno-706-1" name="__codelineno-706-1" href="#__codelineno-706-1"></a><span class="c1">-- Medium: Notify admins</span>
</span><span id="__span-706-2"><a id="__codelineno-706-2" name="__codelineno-706-2" href="#__codelineno-706-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningIssued&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyAdmins&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-706-3"><a id="__codelineno-706-3" name="__codelineno-706-3" href="#__codelineno-706-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-706-4"><a id="__codelineno-706-4" name="__codelineno-706-4" href="#__codelineno-706-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-706-5"><a id="__codelineno-706-5" name="__codelineno-706-5" href="#__codelineno-706-5"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was warned for: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-706-6"><a id="__codelineno-706-6" name="__codelineno-706-6" href="#__codelineno-706-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-706-7"><a id="__codelineno-706-7" name="__codelineno-706-7" href="#__codelineno-706-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-706-8"><a id="__codelineno-706-8" name="__codelineno-706-8" href="#__codelineno-706-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-707-1"><a id="__codelineno-707-1" name="__codelineno-707-1" href="#__codelineno-707-1"></a><span class="c1">-- High: Complex warning system</span>
</span><span id="__span-707-2"><a id="__codelineno-707-2" name="__codelineno-707-2" href="#__codelineno-707-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningIssued&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWarningSystem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-707-3"><a id="__codelineno-707-3" name="__codelineno-707-3" href="#__codelineno-707-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-707-4"><a id="__codelineno-707-4" name="__codelineno-707-4" href="#__codelineno-707-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO warning_logs (timestamp, warner_steamid, target_steamid, reason, count) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-707-5"><a id="__codelineno-707-5" name="__codelineno-707-5" href="#__codelineno-707-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-707-6"><a id="__codelineno-707-6" name="__codelineno-707-6" href="#__codelineno-707-6"></a><span class="c1">-- Notify target</span>
</span><span id="__span-707-7"><a id="__codelineno-707-7" name="__codelineno-707-7" href="#__codelineno-707-7"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;You have been warned by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">warnerName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; for: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-707-8"><a id="__codelineno-707-8" name="__codelineno-707-8" href="#__codelineno-707-8"></a><span class="nv">target</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Total warnings: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-707-9"><a id="__codelineno-707-9" name="__codelineno-707-9" href="#__codelineno-707-9"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-707-10"><a id="__codelineno-707-10" name="__codelineno-707-10" href="#__codelineno-707-10"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-707-11"><a id="__codelineno-707-11" name="__codelineno-707-11" href="#__codelineno-707-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-707-12"><a id="__codelineno-707-12" name="__codelineno-707-12" href="#__codelineno-707-12"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; was warned by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">warnerName</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; for: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">reason</span><span class="p">)</span>
</span><span id="__span-707-13"><a id="__codelineno-707-13" name="__codelineno-707-13" href="#__codelineno-707-13"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-707-14"><a id="__codelineno-707-14" name="__codelineno-707-14" href="#__codelineno-707-14"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-707-15"><a id="__codelineno-707-15" name="__codelineno-707-15" href="#__codelineno-707-15"></a><span class="c1">-- Auto-kick if too many warnings</span>
</span><span id="__span-707-16"><a id="__codelineno-707-16" name="__codelineno-707-16" href="#__codelineno-707-16"></a><span class="kr">if</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-707-17"><a id="__codelineno-707-17" name="__codelineno-707-17" href="#__codelineno-707-17"></a><span class="w">    </span><span class="nv">target</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Too many warnings (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="__span-707-18"><a id="__codelineno-707-18" name="__codelineno-707-18" href="#__codelineno-707-18"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-707-19"><a id="__codelineno-707-19" name="__codelineno-707-19" href="#__codelineno-707-19"></a><span class="c1">-- Update character data</span>
</span><span id="__span-707-20"><a id="__codelineno-707-20" name="__codelineno-707-20" href="#__codelineno-707-20"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">target</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-707-21"><a id="__codelineno-707-21" name="__codelineno-707-21" href="#__codelineno-707-21"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-707-22"><a id="__codelineno-707-22" name="__codelineno-707-22" href="#__codelineno-707-22"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;totalWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-707-23"><a id="__codelineno-707-23" name="__codelineno-707-23" href="#__codelineno-707-23"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastWarning&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-707-24"><a id="__codelineno-707-24" name="__codelineno-707-24" href="#__codelineno-707-24"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-707-25"><a id="__codelineno-707-25" name="__codelineno-707-25" href="#__codelineno-707-25"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="warningremoved">WarningRemoved</h3>
<p><strong>Purpose</strong></p>
<p>Called when a warning is removed</p>
<p><strong>When Called</strong></p>
<p>When a warning is removed from a player</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>client</code> (<em>Player</em>): The player who removed the warning</li>
<li><code>targetClient</code> (<em>Player</em>): The player whose warning was removed</li>
<li><code>reason</code> (<em>string</em>): The reason for the warning removal</li>
<li><code>count</code> (<em>number</em>): The remaining warning count</li>
<li><code>warnerSteamID</code> (<em>string</em>): The SteamID of the original warner</li>
<li><code>warnerName</code> (<em>string</em>): The name of the original warner</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-708-1"><a id="__codelineno-708-1" name="__codelineno-708-1" href="#__codelineno-708-1"></a><span class="c1">-- Simple: Log warning removal</span>
</span><span id="__span-708-2"><a id="__codelineno-708-2" name="__codelineno-708-2" href="#__codelineno-708-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-708-3"><a id="__codelineno-708-3" name="__codelineno-708-3" href="#__codelineno-708-3"></a><span class="nb">print</span><span class="p">(</span><span class="nv">targetClient</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;&#39;s warning was removed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-708-4"><a id="__codelineno-708-4" name="__codelineno-708-4" href="#__codelineno-708-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-709-1"><a id="__codelineno-709-1" name="__codelineno-709-1" href="#__codelineno-709-1"></a><span class="c1">-- Medium: Notify admins</span>
</span><span id="__span-709-2"><a id="__codelineno-709-2" name="__codelineno-709-2" href="#__codelineno-709-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NotifyWarningRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-709-3"><a id="__codelineno-709-3" name="__codelineno-709-3" href="#__codelineno-709-3"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-709-4"><a id="__codelineno-709-4" name="__codelineno-709-4" href="#__codelineno-709-4"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-709-5"><a id="__codelineno-709-5" name="__codelineno-709-5" href="#__codelineno-709-5"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="nv">targetClient</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;&#39;s warning was removed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-709-6"><a id="__codelineno-709-6" name="__codelineno-709-6" href="#__codelineno-709-6"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-709-7"><a id="__codelineno-709-7" name="__codelineno-709-7" href="#__codelineno-709-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-709-8"><a id="__codelineno-709-8" name="__codelineno-709-8" href="#__codelineno-709-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-710-1"><a id="__codelineno-710-1" name="__codelineno-710-1" href="#__codelineno-710-1"></a><span class="c1">-- High: Complex warning removal system</span>
</span><span id="__span-710-2"><a id="__codelineno-710-2" name="__codelineno-710-2" href="#__codelineno-710-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;WarningRemoved&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedWarningRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">client</span><span class="p">,</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">,</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerSteamID</span><span class="p">,</span><span class="w"> </span><span class="nv">warnerName</span><span class="p">)</span>
</span><span id="__span-710-3"><a id="__codelineno-710-3" name="__codelineno-710-3" href="#__codelineno-710-3"></a><span class="c1">-- Log to database</span>
</span><span id="__span-710-4"><a id="__codelineno-710-4" name="__codelineno-710-4" href="#__codelineno-710-4"></a><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO warning_removal_logs (timestamp, remover_steamid, target_steamid, reason, remaining_count) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-710-5"><a id="__codelineno-710-5" name="__codelineno-710-5" href="#__codelineno-710-5"></a><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">reason</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-710-6"><a id="__codelineno-710-6" name="__codelineno-710-6" href="#__codelineno-710-6"></a><span class="c1">-- Notify target</span>
</span><span id="__span-710-7"><a id="__codelineno-710-7" name="__codelineno-710-7" href="#__codelineno-710-7"></a><span class="nv">targetClient</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;One of your warnings has been removed by &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-710-8"><a id="__codelineno-710-8" name="__codelineno-710-8" href="#__codelineno-710-8"></a><span class="nv">targetClient</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Remaining warnings: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-710-9"><a id="__codelineno-710-9" name="__codelineno-710-9" href="#__codelineno-710-9"></a><span class="c1">-- Notify admins</span>
</span><span id="__span-710-10"><a id="__codelineno-710-10" name="__codelineno-710-10" href="#__codelineno-710-10"></a><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-710-11"><a id="__codelineno-710-11" name="__codelineno-710-11" href="#__codelineno-710-11"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-710-12"><a id="__codelineno-710-12" name="__codelineno-710-12" href="#__codelineno-710-12"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">client</span><span class="p">:</span><span class="nf">Name</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; removed a warning from &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">:</span><span class="nf">Name</span><span class="p">())</span>
</span><span id="__span-710-13"><a id="__codelineno-710-13" name="__codelineno-710-13" href="#__codelineno-710-13"></a><span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;[ADMIN] Reason: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">reason</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; | Remaining: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-710-14"><a id="__codelineno-710-14" name="__codelineno-710-14" href="#__codelineno-710-14"></a><span class="w">        </span><span class="kr">end</span>
</span><span id="__span-710-15"><a id="__codelineno-710-15" name="__codelineno-710-15" href="#__codelineno-710-15"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-710-16"><a id="__codelineno-710-16" name="__codelineno-710-16" href="#__codelineno-710-16"></a><span class="c1">-- Update character data</span>
</span><span id="__span-710-17"><a id="__codelineno-710-17" name="__codelineno-710-17" href="#__codelineno-710-17"></a><span class="kd">local</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">targetClient</span><span class="p">:</span><span class="nf">getChar</span><span class="p">()</span>
</span><span id="__span-710-18"><a id="__codelineno-710-18" name="__codelineno-710-18" href="#__codelineno-710-18"></a><span class="kr">if</span><span class="w"> </span><span class="nv">char</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-710-19"><a id="__codelineno-710-19" name="__codelineno-710-19" href="#__codelineno-710-19"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;totalWarnings&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">count</span><span class="p">)</span>
</span><span id="__span-710-20"><a id="__codelineno-710-20" name="__codelineno-710-20" href="#__codelineno-710-20"></a><span class="w">    </span><span class="nv">char</span><span class="p">:</span><span class="nf">setData</span><span class="p">(</span><span class="s2">&quot;lastWarningRemoval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">os.time</span><span class="p">())</span>
</span><span id="__span-710-21"><a id="__codelineno-710-21" name="__codelineno-710-21" href="#__codelineno-710-21"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-710-22"><a id="__codelineno-710-22" name="__codelineno-710-22" href="#__codelineno-710-22"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />
<h3 id="setdata">setData</h3>
<p><strong>Purpose</strong></p>
<p>Called to set persistent data</p>
<p><strong>When Called</strong></p>
<p>When setting global or character-specific data</p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>value</code> (<em>any</em>): The value to set</li>
<li><code>global</code> (<em>boolean</em>): Whether this is global data</li>
<li><code>ignoreMap</code> (<em>boolean</em>): Whether to ignore map-specific data</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Realm</strong></p>
<p>Server</p>
<p><strong>Example Usage</strong></p>
<p><strong>Low Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-711-1"><a id="__codelineno-711-1" name="__codelineno-711-1" href="#__codelineno-711-1"></a><span class="c1">-- Simple: Log data setting</span>
</span><span id="__span-711-2"><a id="__codelineno-711-2" name="__codelineno-711-2" href="#__codelineno-711-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;setData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyAddon&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">global</span><span class="p">,</span><span class="w"> </span><span class="nv">ignoreMap</span><span class="p">)</span>
</span><span id="__span-711-3"><a id="__codelineno-711-3" name="__codelineno-711-3" href="#__codelineno-711-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data set: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nb">tostring</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-711-4"><a id="__codelineno-711-4" name="__codelineno-711-4" href="#__codelineno-711-4"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Medium Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-712-1"><a id="__codelineno-712-1" name="__codelineno-712-1" href="#__codelineno-712-1"></a><span class="c1">-- Medium: Validate data before setting</span>
</span><span id="__span-712-2"><a id="__codelineno-712-2" name="__codelineno-712-2" href="#__codelineno-712-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;setData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ValidateData&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">global</span><span class="p">,</span><span class="w"> </span><span class="nv">ignoreMap</span><span class="p">)</span>
</span><span id="__span-712-3"><a id="__codelineno-712-3" name="__codelineno-712-3" href="#__codelineno-712-3"></a><span class="kr">if</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="o">#</span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-712-4"><a id="__codelineno-712-4" name="__codelineno-712-4" href="#__codelineno-712-4"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Data value too long&quot;</span><span class="p">)</span>
</span><span id="__span-712-5"><a id="__codelineno-712-5" name="__codelineno-712-5" href="#__codelineno-712-5"></a><span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-712-6"><a id="__codelineno-712-6" name="__codelineno-712-6" href="#__codelineno-712-6"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-712-7"><a id="__codelineno-712-7" name="__codelineno-712-7" href="#__codelineno-712-7"></a><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-712-8"><a id="__codelineno-712-8" name="__codelineno-712-8" href="#__codelineno-712-8"></a><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>High Complexity:</strong>
<div class="language-lua highlight"><pre><span></span><code><span id="__span-713-1"><a id="__codelineno-713-1" name="__codelineno-713-1" href="#__codelineno-713-1"></a><span class="c1">-- High: Complex data validation system</span>
</span><span id="__span-713-2"><a id="__codelineno-713-2" name="__codelineno-713-2" href="#__codelineno-713-2"></a><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;setData&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AdvancedDataValidation&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">global</span><span class="p">,</span><span class="w"> </span><span class="nv">ignoreMap</span><span class="p">)</span>
</span><span id="__span-713-3"><a id="__codelineno-713-3" name="__codelineno-713-3" href="#__codelineno-713-3"></a><span class="c1">-- Validate data type and size</span>
</span><span id="__span-713-4"><a id="__codelineno-713-4" name="__codelineno-713-4" href="#__codelineno-713-4"></a><span class="kr">if</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="o">#</span><span class="nv">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-713-5"><a id="__codelineno-713-5" name="__codelineno-713-5" href="#__codelineno-713-5"></a><span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Data value too long, truncating&quot;</span><span class="p">)</span>
</span><span id="__span-713-6"><a id="__codelineno-713-6" name="__codelineno-713-6" href="#__codelineno-713-6"></a><span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">string.sub</span><span class="p">(</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-713-7"><a id="__codelineno-713-7" name="__codelineno-713-7" href="#__codelineno-713-7"></a><span class="w">    </span><span class="kr">end</span>
</span><span id="__span-713-8"><a id="__codelineno-713-8" name="__codelineno-713-8" href="#__codelineno-713-8"></a><span class="c1">-- Validate global data</span>
</span><span id="__span-713-9"><a id="__codelineno-713-9" name="__codelineno-713-9" href="#__codelineno-713-9"></a><span class="kr">if</span><span class="w"> </span><span class="nv">global</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;table&quot;</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-713-10"><a id="__codelineno-713-10" name="__codelineno-713-10" href="#__codelineno-713-10"></a><span class="w">    </span><span class="c1">-- Check for circular references</span>
</span><span id="__span-713-11"><a id="__codelineno-713-11" name="__codelineno-713-11" href="#__codelineno-713-11"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">hasCircularRef</span><span class="p">(</span><span class="nv">obj</span><span class="p">,</span><span class="w"> </span><span class="nv">seen</span><span class="p">)</span>
</span><span id="__span-713-12"><a id="__codelineno-713-12" name="__codelineno-713-12" href="#__codelineno-713-12"></a><span class="w">        </span><span class="nv">seen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">seen</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-713-13"><a id="__codelineno-713-13" name="__codelineno-713-13" href="#__codelineno-713-13"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">obj</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;table&quot;</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-713-14"><a id="__codelineno-713-14" name="__codelineno-713-14" href="#__codelineno-713-14"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">seen</span><span class="p">[</span><span class="nv">obj</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-713-15"><a id="__codelineno-713-15" name="__codelineno-713-15" href="#__codelineno-713-15"></a><span class="w">                </span><span class="nv">seen</span><span class="p">[</span><span class="nv">obj</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-713-16"><a id="__codelineno-713-16" name="__codelineno-713-16" href="#__codelineno-713-16"></a><span class="w">                </span><span class="kr">for</span><span class="w"> </span><span class="nv">k</span><span class="p">,</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">pairs</span><span class="p">(</span><span class="nv">obj</span><span class="p">)</span><span class="w"> </span><span class="kr">do</span>
</span><span id="__span-713-17"><a id="__codelineno-713-17" name="__codelineno-713-17" href="#__codelineno-713-17"></a><span class="w">                    </span><span class="kr">if</span><span class="w"> </span><span class="nf">hasCircularRef</span><span class="p">(</span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="nv">seen</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="kr">end</span>
</span><span id="__span-713-18"><a id="__codelineno-713-18" name="__codelineno-713-18" href="#__codelineno-713-18"></a><span class="w">                        </span><span class="kr">end</span>
</span><span id="__span-713-19"><a id="__codelineno-713-19" name="__codelineno-713-19" href="#__codelineno-713-19"></a><span class="w">                    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-713-20"><a id="__codelineno-713-20" name="__codelineno-713-20" href="#__codelineno-713-20"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-713-21"><a id="__codelineno-713-21" name="__codelineno-713-21" href="#__codelineno-713-21"></a><span class="w">                </span><span class="kr">if</span><span class="w"> </span><span class="nf">hasCircularRef</span><span class="p">(</span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
</span><span id="__span-713-22"><a id="__codelineno-713-22" name="__codelineno-713-22" href="#__codelineno-713-22"></a><span class="w">                    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Circular reference detected in global data&quot;</span><span class="p">)</span>
</span><span id="__span-713-23"><a id="__codelineno-713-23" name="__codelineno-713-23" href="#__codelineno-713-23"></a><span class="w">                    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-713-24"><a id="__codelineno-713-24" name="__codelineno-713-24" href="#__codelineno-713-24"></a><span class="w">                    </span><span class="kr">end</span>
</span><span id="__span-713-25"><a id="__codelineno-713-25" name="__codelineno-713-25" href="#__codelineno-713-25"></a><span class="w">                </span><span class="kr">end</span>
</span><span id="__span-713-26"><a id="__codelineno-713-26" name="__codelineno-713-26" href="#__codelineno-713-26"></a><span class="w">            </span><span class="c1">-- Log data changes</span>
</span><span id="__span-713-27"><a id="__codelineno-713-27" name="__codelineno-713-27" href="#__codelineno-713-27"></a><span class="w">            </span><span class="nv">lia</span><span class="p">.</span><span class="py">db</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">&quot;INSERT INTO data_logs (timestamp, global, value_type) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
</span><span id="__span-713-28"><a id="__codelineno-713-28" name="__codelineno-713-28" href="#__codelineno-713-28"></a><span class="w">            </span><span class="nb">os.time</span><span class="p">(),</span><span class="w"> </span><span class="nv">global</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">value</span><span class="p">))</span>
</span><span id="__span-713-29"><a id="__codelineno-713-29" name="__codelineno-713-29" href="#__codelineno-713-29"></a><span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-713-30"><a id="__codelineno-713-30" name="__codelineno-713-30" href="#__codelineno-713-30"></a><span class="w">            </span><span class="kr">end</span><span class="p">)</span>
</span></code></pre></div></p>
<hr />












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../client/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Client-Side Hooks">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Client-Side Hooks
              </div>
            </div>
          </a>
        
        
          
          <a href="../shared/" class="md-footer__link md-footer__link--next" aria-label="Next: Shared Hooks">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Shared Hooks
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "toc.follow", "toc.integrate", "navigation.top", "header.autohide", "announce.dismiss", "navigation.footer", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.tooltips", "content.footnote.tooltips"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>